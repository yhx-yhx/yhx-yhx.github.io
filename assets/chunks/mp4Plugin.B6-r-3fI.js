import{b as yt,B as _t,U as Ht,c as pn,d as vn,e as St,S as pa,f as wr,W as gi,s as At,u as va,A as ya,g as ba}from"./index.min.MGxHSODb.js";import{i as Za}from"./theme.RIO5tSMr.js";function Si(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,r)}return t}function Ie(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?Si(Object(t),!0).forEach(function(r){O(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Si(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function ie(){ie=function(){return a};var a={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,G){return m[y]=G}}function u(f,m,y,G){var g=m&&m.prototype instanceof h?m:h,k=Object.create(g.prototype),M=new Y(G||[]);return r(k,"_invoke",{value:S(f,y,M)}),k}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(G){return{type:"throw",arg:G}}}a.wrap=u;var d={};function h(){}function p(){}function v(){}var Z={};l(Z,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==s&&t.call(L,i)&&(Z=L);var w=v.prototype=h.prototype=Object.create(Z);function W(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function X(f,m){function y(g,k,M,H){var C=c(f[g],f,k);if(C.type!=="throw"){var P=C.arg,A=P.value;return A&&typeof A=="object"&&t.call(A,"__await")?m.resolve(A.__await).then(function(N){y("next",N,M,H)},function(N){y("throw",N,M,H)}):m.resolve(A).then(function(N){P.value=N,M(P)},function(N){return y("throw",N,M,H)})}H(C.arg)}var G;r(this,"_invoke",{value:function(g,k){function M(){return new m(function(H,C){y(g,k,H,C)})}return G=G?G.then(M,M):M()}})}function S(f,m,y){var G="suspendedStart";return function(g,k){if(G==="executing")throw new Error("Generator is already running");if(G==="completed"){if(g==="throw")throw k;return U()}for(y.method=g,y.arg=k;;){var M=y.delegate;if(M){var H=R(M,y);if(H){if(H===d)continue;return H}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(G==="suspendedStart")throw G="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);G="executing";var C=c(f,m,y);if(C.type==="normal"){if(G=y.done?"completed":"suspendedYield",C.arg===d)continue;return{value:C.arg,done:y.done}}C.type==="throw"&&(G="completed",y.method="throw",y.arg=C.arg)}}}function R(f,m){var y=m.method,G=f.iterator[y];if(G===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,R(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var g=c(G,f.iterator,m.arg);if(g.type==="throw")return m.method="throw",m.arg=g.arg,m.delegate=null,d;var k=g.arg;return k?k.done?(m[f.resultName]=k.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):k:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function T(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function V(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function Y(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(T,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,G=function g(){for(;++y<f.length;)if(t.call(f,y))return g.value=f[y],g.done=!1,g;return g.value=void 0,g.done=!0,g};return G.next=G}}return{next:U}}function U(){return{value:void 0,done:!0}}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),a.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},a.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(w),f},a.awrap=function(f){return{__await:f}},W(X.prototype),l(X.prototype,n,function(){return this}),a.AsyncIterator=X,a.async=function(f,m,y,G,g){g===void 0&&(g=Promise);var k=new X(u(f,m,y,G),g);return a.isGeneratorFunction(m)?k:k.next().then(function(M){return M.done?M.value:k.next()})},W(w),l(w,o,"Generator"),l(w,i,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),a.keys=function(f){var m=Object(f),y=[];for(var G in m)y.push(G);return y.reverse(),function g(){for(;y.length;){var k=y.pop();if(k in m)return g.value=k,g.done=!1,g}return g.done=!0,g}},a.values=I,Y.prototype={constructor:Y,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(C,P){return k.type="throw",k.arg=f,m.next=C,P&&(m.method="next",m.arg=void 0),!!P}for(var G=this.tryEntries.length-1;G>=0;--G){var g=this.tryEntries[G],k=g.completion;if(g.tryLoc==="root")return y("end");if(g.tryLoc<=this.prev){var M=t.call(g,"catchLoc"),H=t.call(g,"finallyLoc");if(M&&H){if(this.prev<g.catchLoc)return y(g.catchLoc,!0);if(this.prev<g.finallyLoc)return y(g.finallyLoc)}else if(M){if(this.prev<g.catchLoc)return y(g.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return y(g.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var G=this.tryEntries[y];if(G.tryLoc<=this.prev&&t.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var g=G;break}}g&&(f==="break"||f==="continue")&&g.tryLoc<=m&&m<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=f,k.arg=m,g?(this.method="next",this.next=g.finallyLoc,d):this.complete(k)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),V(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var G=y.completion;if(G.type==="throw"){var g=G.arg;V(y)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},a}function Nr(a){"@babel/helpers - typeof";return Nr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Nr(a)}function Li(a,s,t,r,e,i,n){try{var o=a[i](n),l=o.value}catch(u){t(u);return}o.done?s(l):Promise.resolve(l).then(r,e)}function Te(a){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=a.apply(s,t);function n(l){Li(i,r,e,n,o,"next",l)}function o(l){Li(i,r,e,n,o,"throw",l)}n(void 0)})}}function pr(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function Xi(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,Zn(r.key),r)}}function vr(a,s,t){return s&&Xi(a.prototype,s),t&&Xi(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function O(a,s,t){return s=Zn(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function yn(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&Dr(a,s)}function lr(a){return lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lr(a)}function Dr(a,s){return Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Dr(a,s)}function ga(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ee(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Sa(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ee(a)}function bn(a){var s=ga();return function(){var r=lr(a),e;if(s){var i=lr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Sa(this,e)}}function La(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function Zn(a){var s=La(a,"string");return typeof s=="symbol"?s:String(s)}function Gi(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,r)}return t}function Nt(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?Gi(Object(t),!0).forEach(function(r){E(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Gi(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function Ze(){Ze=function(){return a};var a={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,G){return m[y]=G}}function u(f,m,y,G){var g=m&&m.prototype instanceof h?m:h,k=Object.create(g.prototype),M=new Y(G||[]);return r(k,"_invoke",{value:S(f,y,M)}),k}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(G){return{type:"throw",arg:G}}}a.wrap=u;var d={};function h(){}function p(){}function v(){}var Z={};l(Z,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==s&&t.call(L,i)&&(Z=L);var w=v.prototype=h.prototype=Object.create(Z);function W(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function X(f,m){function y(g,k,M,H){var C=c(f[g],f,k);if(C.type!=="throw"){var P=C.arg,A=P.value;return A&&typeof A=="object"&&t.call(A,"__await")?m.resolve(A.__await).then(function(N){y("next",N,M,H)},function(N){y("throw",N,M,H)}):m.resolve(A).then(function(N){P.value=N,M(P)},function(N){return y("throw",N,M,H)})}H(C.arg)}var G;r(this,"_invoke",{value:function(g,k){function M(){return new m(function(H,C){y(g,k,H,C)})}return G=G?G.then(M,M):M()}})}function S(f,m,y){var G="suspendedStart";return function(g,k){if(G==="executing")throw new Error("Generator is already running");if(G==="completed"){if(g==="throw")throw k;return U()}for(y.method=g,y.arg=k;;){var M=y.delegate;if(M){var H=R(M,y);if(H){if(H===d)continue;return H}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(G==="suspendedStart")throw G="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);G="executing";var C=c(f,m,y);if(C.type==="normal"){if(G=y.done?"completed":"suspendedYield",C.arg===d)continue;return{value:C.arg,done:y.done}}C.type==="throw"&&(G="completed",y.method="throw",y.arg=C.arg)}}}function R(f,m){var y=m.method,G=f.iterator[y];if(G===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,R(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var g=c(G,f.iterator,m.arg);if(g.type==="throw")return m.method="throw",m.arg=g.arg,m.delegate=null,d;var k=g.arg;return k?k.done?(m[f.resultName]=k.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):k:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function T(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function V(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function Y(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(T,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,G=function g(){for(;++y<f.length;)if(t.call(f,y))return g.value=f[y],g.done=!1,g;return g.value=void 0,g.done=!0,g};return G.next=G}}return{next:U}}function U(){return{value:void 0,done:!0}}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),a.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},a.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(w),f},a.awrap=function(f){return{__await:f}},W(X.prototype),l(X.prototype,n,function(){return this}),a.AsyncIterator=X,a.async=function(f,m,y,G,g){g===void 0&&(g=Promise);var k=new X(u(f,m,y,G),g);return a.isGeneratorFunction(m)?k:k.next().then(function(M){return M.done?M.value:k.next()})},W(w),l(w,o,"Generator"),l(w,i,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),a.keys=function(f){var m=Object(f),y=[];for(var G in m)y.push(G);return y.reverse(),function g(){for(;y.length;){var k=y.pop();if(k in m)return g.value=k,g.done=!1,g}return g.done=!0,g}},a.values=I,Y.prototype={constructor:Y,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(C,P){return k.type="throw",k.arg=f,m.next=C,P&&(m.method="next",m.arg=void 0),!!P}for(var G=this.tryEntries.length-1;G>=0;--G){var g=this.tryEntries[G],k=g.completion;if(g.tryLoc==="root")return y("end");if(g.tryLoc<=this.prev){var M=t.call(g,"catchLoc"),H=t.call(g,"finallyLoc");if(M&&H){if(this.prev<g.catchLoc)return y(g.catchLoc,!0);if(this.prev<g.finallyLoc)return y(g.finallyLoc)}else if(M){if(this.prev<g.catchLoc)return y(g.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return y(g.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var G=this.tryEntries[y];if(G.tryLoc<=this.prev&&t.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var g=G;break}}g&&(f==="break"||f==="continue")&&g.tryLoc<=m&&m<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=f,k.arg=m,g?(this.method="next",this.next=g.finallyLoc,d):this.complete(k)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),V(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var G=y.completion;if(G.type==="throw"){var g=G.arg;V(y)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},a}function Wt(a){"@babel/helpers - typeof";return Wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Wt(a)}function Wi(a,s,t,r,e,i,n){try{var o=a[i](n),l=o.value}catch(u){t(u);return}o.done?s(l):Promise.resolve(l).then(r,e)}function dt(a){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=a.apply(s,t);function n(l){Wi(i,r,e,n,o,"next",l)}function o(l){Wi(i,r,e,n,o,"throw",l)}n(void 0)})}}function De(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function wi(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,Sn(r.key),r)}}function Fe(a,s,t){return s&&wi(a.prototype,s),t&&wi(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function E(a,s,t){return s=Sn(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function Ot(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&Dt(a,s)}function wt(a){return wt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wt(a)}function Dt(a,s){return Dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Dt(a,s)}function gn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ar(a,s,t){return gn()?ar=Reflect.construct.bind():ar=function(e,i,n){var o=[null];o.push.apply(o,i);var l=Function.bind.apply(e,o),u=new l;return n&&Dt(u,n.prototype),u},ar.apply(null,arguments)}function Xa(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function ur(a){var s=typeof Map=="function"?new Map:void 0;return ur=function(r){if(r===null||!Xa(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof s<"u"){if(s.has(r))return s.get(r);s.set(r,e)}function e(){return ar(r,arguments,wt(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Dt(e,r)},ur(a)}function Ga(a,s){if(a==null)return{};var t={},r=Object.keys(a),e,i;for(i=0;i<r.length;i++)e=r[i],!(s.indexOf(e)>=0)&&(t[e]=a[e]);return t}function Wa(a,s){if(a==null)return{};var t=Ga(a,s),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(e=0;e<i.length;e++)r=i[e],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(t[r]=a[r])}return t}function j(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function wa(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j(a)}function jt(a){var s=gn();return function(){var r=wt(a),e;if(s){var i=wt(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return wa(this,e)}}function Ra(a,s){for(;!Object.prototype.hasOwnProperty.call(a,s)&&(a=wt(a),a!==null););return a}function sr(){return typeof Reflect<"u"&&Reflect.get?sr=Reflect.get.bind():sr=function(s,t,r){var e=Ra(s,t);if(e){var i=Object.getOwnPropertyDescriptor(e,t);return i.get?i.get.call(arguments.length<3?s:r):i.value}},sr.apply(this,arguments)}function Va(a,s){if(a){if(typeof a=="string")return Ri(a,s);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ri(a,s)}}function Ri(a,s){(s==null||s>a.length)&&(s=a.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=a[t];return r}function Ta(a,s){var t=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(!t){if(Array.isArray(a)||(t=Va(a))||s){t&&(a=t);var r=0,e=function(){};return{s:e,n:function(){return r>=a.length?{done:!0}:{done:!1,value:a[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,n=!1,o;return{s:function(){t=t.call(a)},n:function(){var l=t.next();return i=l.done,l},e:function(l){n=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(n)throw o}}}}function ka(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function Sn(a){var s=ka(a,"string");return typeof s=="symbol"?s:String(s)}var fe=function(){function a(){De(this,a)}return Fe(a,null,[{key:"start",value:function(t){return!t||!t.length||t.length===1&&t.end(0)-t.start(0)<1e-6||t.length===1&&t.start(0)<0?0:t.start(0)}},{key:"end",value:function(t){return!t||!t.length||t.length===1&&t.end(0)-t.start(0)<1e-6?0:t.end(t.length-1)}},{key:"get",value:function(t){if(t)try{return t.buffered}catch{}}},{key:"buffers",value:function(t,r){if(!t||!t.length)return[];for(var e=[],i=0,n=t.length;i<n;i++){var o=e.length;if(!o||!r)e.push([t.start(i),t.end(i)]);else{var l=e[o-1],u=l[1],c=t.start(i);if(c-u<=r){var d=t.end(i);d>u&&(l[1]=d)}else e.push([t.start(i),t.end(i)])}}return e}},{key:"totalLength",value:function(t){return!t||!t.length?0:t.reduce(function(r,e){return r+=e[1]-e[0]},0)}},{key:"info",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,n=0,o=0,l=0,u=0,c=0,d=0,h=a.buffers(t,e),p=0,v=h.length;p<v;p++){var Z=h[p];if(r+e>=Z[0]&&r<=Z[1])i=Z[0],n=Z[1],o=p;else if(r+e<Z[0]){l=Z[0],u=Z[1];break}else r+e>Z[1]&&(c=Z[0],d=Z[1])}return{start:i,end:n,index:o,buffers:h,nextStart:l,nextEnd:u,prevStart:c,prevEnd:d,currentTime:r,behind:r-i,remaining:n?n-r:0,length:a.totalLength&&a.totalLength(h)}}},{key:"isBuffered",value:function(t,r){if(t){var e=a.get(t);if(e!=null&&e.length){for(var i=0;i<e.length;i++)if(r>=e.start(i)&&r<=e.end(i))return!0}}return!1}}]),a}(),xa=typeof window<"u",Ce,F={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ve=(Ce={},E(Ce,F.MANIFEST,{HLS:1100,DASH:1200}),E(Ce,F.NETWORK,2100),E(Ce,F.NETWORK_TIMEOUT,2101),E(Ce,F.NETWORK_FORBIDDEN,2103),E(Ce,F.NETWORK_NOTFOUND,2104),E(Ce,F.NETWROK_RANGE_NOT_SATISFIABLE,2116),E(Ce,F.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),E(Ce,F.REMUX,{FMP4:4100,MP4:4200}),E(Ce,F.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),E(Ce,F.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),E(Ce,F.OTHER,8e3),E(Ce,F.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),Ce),le=function(a){Ot(t,a);var s=jt(t);function t(r,e,i,n,o){var l;return De(this,t),l=s.call(this,o||(i==null?void 0:i.message)),l.errorType=r===F.NETWORK_TIMEOUT?F.NETWORK:r,l.originError=i,l.ext=n,l.errorCode=ve[r][e]||ve[r],l.errorMessage=l.message,l.errorCode||(l.errorType=F.OTHER,l.errorCode=ve[l.errorType]),l}return Fe(t,null,[{key:"create",value:function(e,i,n,o,l){return e instanceof t?e:(e instanceof Error&&(n=e,e=""),e||(e=F.OTHER),new t(e,i,n,o,l))}},{key:"network",value:function(e){var i;return new t(e!=null&&e.isTimeout?F.NETWORK_TIMEOUT:F.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(i=e.response)===null||i===void 0?void 0:i.status})}}]),t}(ur(Error)),Qt={DEBUG:1,LOG:2,WARN:3,ERROR:4},Ma=200*1024,Ya=["Boolean","Number","String","Undefined","Null","Date","Object"],xe=function(){function a(s,t){De(this,a),this.name=s||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(t==null?void 0:t.logCacheLevel)||3,this.logMaxSize=(t==null?void 0:t.logMaxSize)||Ma,this.logSize=0,this.logTextArray=[]}return Fe(a,[{key:"debug",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[Qt.DEBUG].concat(e)),!a.disabled&&(t=console).debug.apply(t,[this._prefix,Kt()].concat(e))}},{key:"log",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[Qt.LOG].concat(e)),!a.disabled&&(t=console).log.apply(t,[this._prefix,Kt()].concat(e))}},{key:"warn",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[Qt.WARN].concat(e)),!a.disabled&&(t=console).warn.apply(t,[this._prefix,Kt()].concat(e))}},{key:"error",value:function(){for(var t,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];this.logCache.apply(this,[Qt.ERROR].concat(e)),!a.disabled&&(t=console).error.apply(t,[this._prefix,Kt()].concat(e))}},{key:"logCache",value:function(t){if(!(t<this.logCacheLevel)){var r="";try{for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var o=i.map(function(u){return Ln(u)});r=this._prefix+Kt()+JSON.stringify(o)}catch{return}if(t>=this.logCacheLevel&&(this.logSize+=r.length,this.logTextArray.push(r)),this.logSize>this.logMaxSize){var l=this.logTextArray.shift();this.logSize-=l.length}}}},{key:"getLogCache",value:function(){var t=this.logTextArray.join(`
`);return this.reset(),t}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;a.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(t){this.logCacheLevel=t}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();E(xe,"disabled",!0);function Kt(){return new Date().toLocaleString()}function Ia(a){if(Wt(a)!=="object")return a;var s=Object.prototype.toString.call(a).slice(8,-1);switch(s){case"Array":case"Uint8Array":case"ArrayBuffer":return s+"["+a.length+"]";case"Object":return"{}";default:return s}}function Ln(a,s,t){t||(t=1),s||(s=2);var r={};if(!a||Wt(a)!=="object")return a;var e=Object.prototype.toString.call(a).slice(8,-1);if(!Ya.includes(e))return e;if(!(t>s)){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t===s?r[i]=Ia(a[i]):Wt(a[i])==="object"?r[i]=Ln(a[i],s,t+1):r[i]=a[i]);return r}}function xt(){var a,s,t=new Promise(function(r,e){a=r,s=e});return t.used=!1,t.resolve=function(){return t.used=!0,a.apply(void 0,arguments)},t.reject=function(){return t.used=!0,s.apply(void 0,arguments)},t}function kt(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var _a={stringify:function(s){try{return JSON.stringify(s)}catch{return""}},parse:function(s){try{return JSON.parse(s)}catch{return}}};function Vi(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return xa?a&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function Rr(a){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(a))}function Ea(a){var s=[];if(a instanceof TimeRanges)for(var t=0;t<a.length;t++)s.push({start:a.start(t),end:a.end(t)});return s}var $t={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},he=function(){function a(s,t){var r=this;De(this,a),E(this,"media",null),E(this,"mediaSource",null),E(this,"_openPromise",xt()),E(this,"_queue",Object.create(null)),E(this,"_sourceBuffer",Object.create(null)),E(this,"_mseFullFlag",{}),E(this,"_st",0),E(this,"_opst",0),E(this,"_logger",null),E(this,"_config",null),E(this,"_url",null),E(this,"_onStartStreaming",function(){r._logger.debug("startstreaming")}),E(this,"_onEndStreaming",function(){r._logger.debug("endstreaming")}),E(this,"_onSBUpdateEnd",function(e){var i=r._queue[e];if(i){var n=i[0];if((n==null?void 0:n.opName)!==$t.UPDATE_DURATION&&i.shift(),n){var o,l,u=kt()-r._opst;r._logger.debug("UpdateEnd(".concat(e,"/").concat(n.opName,")"),_a.stringify(Ea((o=r._sourceBuffer[e])===null||o===void 0?void 0:o.buffered)),u,n.context),n.promise.resolve({name:n.opName,context:n.context,costtime:u});var c=(l=n.context)===null||l===void 0?void 0:l.callback;c&&typeof c=="function"&&c(n.context),r._startQueue(e)}}}),E(this,"_onSBUpdateError",function(e,i){var n=r._queue[e];if(n){var o=n[0];o&&(r._logger.error("UpdateError",e,o.opName,o.context),o.promise.reject(new le(F.MEDIA,F.SUB_TYPES.MSE_APPEND_BUFFER,i)))}}),this._config=Object.assign(a.getDefaultConfig(),t),s&&this.bindMedia(s),this._logger=new xe("MSE"),this._config.openLog&&xe.enable()}return Fe(a,[{key:"isOpened",get:function(){var t;return((t=this.mediaSource)===null||t===void 0?void 0:t.readyState)==="open"}},{key:"hasOpTasks",get:function(){var t=this,r=!1;return Object.keys(this._queue).forEach(function(e){var i=t._queue[e];Array.isArray(i)&&(r||(r=i.length>0))}),r}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var t;return((t=this.mediaSource)===null||t===void 0?void 0:t.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return Rr(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[a.VIDEO]}},{key:"updateDuration",value:function(t){var r=this,e=this.mediaSource&&this.mediaSource.duration>t;if(this.mediaSource&&this.mediaSource.duration>t){var i=0;if(Object.keys(this._sourceBuffer).forEach(function(n){try{i=Math.max(r.bufferEnd(n)||0,i)}catch{}}),t<i)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(r.isEnded){r._logger.debug("setDuration but ended");return}r.mediaSource&&(r.mediaSource.duration=t,r._logger.debug("setDuration",t))},$t.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var t=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var r=this.mediaSource,e=function i(){var n=kt()-t._st;t._logger.debug("sourceopen",n),r.removeEventListener("sourceopen",i),t._openPromise.resolve({costtime:n})};r.addEventListener("sourceopen",e),this._openPromise=xt()}return this._openPromise}},{key:"bindMedia",value:function(){var s=dt(Ze().mark(function r(e){var i=this,n,o,l,u;return Ze().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.mediaSource||this.media)){d.next=3;break}return d.next=3,this.unbindMedia();case 3:if(n=Vi(this._config.preferMMS),!(!e||!n)){d.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,o=this.mediaSource=new n,l=Rr(o),this._st=kt(),u=function h(){var p=kt()-i._st;i._logger.debug("sourceopen"),o.removeEventListener("sourceopen",h),URL.revokeObjectURL(e.src),i._openPromise.resolve({costtime:p})},o.addEventListener("sourceopen",u),l&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(o),e.src=this._url,e.disableRemotePlayback=l,d.abrupt("return",this._openPromise);case 17:case"end":return d.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"unbindMedia",value:function(){var s=dt(Ze().mark(function r(){var e=this,i,n,o;return Ze().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),i=this.mediaSource,i){if(Object.keys(this._queue).forEach(function(c){var d=e._queue[c];d&&d.forEach(function(h){var p,v;return(p=h.promise)===null||p===void 0||(v=p.resolve)===null||v===void 0?void 0:v.call(p)})}),n=!!this.media&&this.media.readyState>=1,o=i.readyState==="open",n&&o)try{i.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{i.removeSourceBuffer(e._sourceBuffer[c])}catch{}}),Rr(i)&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=xt(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return u.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"createSource",value:function(t,r){if(!(this._sourceBuffer[t]||!this.mediaSource)){var e;try{e=this._sourceBuffer[t]=this.mediaSource.addSourceBuffer(r)}catch(i){throw new le(F.MEDIA,F.SUB_TYPES.MSE_ADD_SB,i)}e.mimeType=r,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,t)),e.addEventListener("error",this._onSBUpdateError.bind(this,t))}}},{key:"changeType",value:function(t,r){var e=this,i=this._sourceBuffer[t];return!this.mediaSource||!i||i.mimeType===r?Promise.resolve():typeof i.changeType!="function"?Promise.reject(new le(F.MEDIA,F.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(t,function(){try{i.changeType(r)}catch(n){throw new le(F.MEDIA,F.SUB_TYPES.MSE_CHANGE_TYPE,n)}i.mimeType=r,e._onSBUpdateEnd(t)},"changeType",{mimeType:r})}},{key:"createOrChangeSource",value:function(t,r){return this.createSource(t,r),this.changeType(t,r)}},{key:"append",value:function(t,r,e){var i=this;return!r||!r.byteLength||!this._sourceBuffer[t]?Promise.resolve():this._enqueueOp(t,function(){var n;!i.mediaSource||i.media.error||(i._logger.debug("MSE APPEND START",e),i._opst=kt(),(n=i._sourceBuffer[t])===null||n===void 0||n.appendBuffer(r))},$t.APPEND,e)}},{key:"remove",value:function(t,r,e,i){var n=this,o=!1;return this._mseFullFlag[t]&&(o=!0),this._enqueueOp(t,function(){if(!(!n.mediaSource||n.media.error)){var l=n._sourceBuffer[t];if(r>=e||!l){n._onSBUpdateEnd(t);return}n._opst=kt(),n._logger.debug("MSE REMOVE START",t,r,e,i),l.remove(r,e)}},$t.REMOVE,i,o)}},{key:"clearBuffer",value:function(t,r){var e=this,i;return Object.keys(this._sourceBuffer).forEach(function(n){i=e.remove(n,t,r)}),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var t=this,r;return Object.keys(this._sourceBuffer).forEach(function(e){var i=t._sourceBuffer[e];r=t.remove(e,0,fe.end(fe.get(i)))}),r}},{key:"clearOpQueues",value:function(t,r){var e;this._logger.debug("MSE clearOpQueue START");var i=this._queue[t];if(r&&i){this._queue[t]=[];return}if(!(!i||!i[t]||i.length<5)){var n=[];i.forEach(function(o){o.context&&o.context.isinit&&n.push(o)}),this._queue[t]=i.slice(0,2),n.length>0&&(e=this._queue[t]).push.apply(e,n)}}},{key:"endOfStream",value:function(t){var r=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=r.mediaSource;!e||e.readyState!=="open"||(r._logger.debug("MSE endOfStream START"),t?e.endOfStream(t):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(t,r){var e=this.mediaSource;t<0||r<t||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(t,r)}},{key:"getSourceBuffer",value:function(t){return this._sourceBuffer[t]}},{key:"buffered",value:function(t){return fe.get(this._sourceBuffer[t])}},{key:"bufferStart",value:function(t){return fe.start(this.buffered(t))}},{key:"bufferEnd",value:function(t){return fe.end(this.buffered(t))}},{key:"_enqueueOp",value:function(t,r,e,i,n){var o=this;if(!this.mediaSource)return Promise.resolve();var l=this._queue[t]=this._queue[t]||[],u={exec:r,promise:xt(),opName:e,context:i};return n?(l.splice(0,0,u),this._mseFullFlag[t]=!1,this._startQueue(t)):l.push(u),this.isOpened||this.isEnded?l.length===1&&this._startQueue(t):this._openPromise.then(function(){l.length===1&&o._startQueue(t)}),u.promise}},{key:"_enqueueBlockingOp",value:function(){var s=dt(Ze().mark(function r(e,i,n){var o=this,l,u;return Ze().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.mediaSource){d.next=2;break}return d.abrupt("return",Promise.resolve());case 2:if(l=Object.keys(this._sourceBuffer),l.length){d.next=5;break}return d.abrupt("return",e());case 5:return u=[],l.forEach(function(h){var p=o._queue[h],v=xt();u.push(v),p.push({exec:function(){v.resolve()},promise:v,opName:i,context:n}),p.length===1&&o._startQueue(h)}),d.abrupt("return",Promise.all(u).then(function(){try{return e()}finally{l.forEach(function(h){var p=o._queue[h],v=o._sourceBuffer[h];p==null||p.shift(),(!v||!v.updating)&&o._startQueue(h)})}}));case 8:case"end":return d.stop()}},r,this)}));function t(r,e,i){return s.apply(this,arguments)}return t}()},{key:"_startQueue",value:function(t){var r=this._queue[t];if(r){var e=r[0];if(e&&!this._mseFullFlag[t])try{e.exec()}catch(i){i&&i.message&&i.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[t]=!0,e.context&&Wt(e.context)==="object"&&(e.context.isFull=!0),this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e.promise.reject(new le(F.MEDIA,F.SUB_TYPES.MSE_FULL,i))):(this._logger.error(i),e.promise.reject(i.constructor===le?i:new le(F.MEDIA,F.SUB_TYPES.MSE_OTHER,i)),r.shift(),this._startQueue(t))}}}},{key:"setTimeoffset",value:function(t,r,e){var i=this;return this._enqueueOp(t,function(){r<0&&(r+=.001),i._sourceBuffer[t].timestampOffset=r,i._onSBUpdateEnd(t)},"setTimeoffset",e)}},{key:"abort",value:function(t,r){var e=this;return this.isOpened?this._enqueueOp(t,function(){e._sourceBuffer[t].abort(),e._onSBUpdateEnd(t)},"abort",r):Promise.resolve()}}],[{key:"isSupported",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',r=Vi();if(!r)return!1;try{return r.isTypeSupported(t)}catch(e){return this._logger.error(t,e),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),a}();E(he,"VIDEO","video");E(he,"AUDIO","audio");var Xt={FETCH:"fetch",XHR:"xhr"},Ft={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},tt=function(a){Ot(t,a);var s=jt(t);function t(r,e,i,n){var o;return De(this,t),o=s.call(this,n),E(j(o),"retryCount",0),E(j(o),"isTimeout",!1),E(j(o),"loaderType",Xt.FETCH),E(j(o),"startTime",0),E(j(o),"endTime",0),E(j(o),"options",{}),o.url=r,o.request=e,o.response=i,o}return Fe(t)}(ur(Error)),Xn=Object.prototype.toString;function Ca(a){return a!==null&&Wt(a)==="object"}function Ti(a){if(Xn.call(a)!=="[object Object]")return!1;var s=Object.getPrototypeOf(a);return s===null||s===Object.prototype}function Ka(a){return Xn.call(a)==="[object Date]"}function Gn(a){if(!(!a||a[0]===null||a[0]===void 0||a[0]===0&&(a[1]===null||a[1]===void 0))){var s="bytes="+a[0]+"-";return a[1]&&(s+=a[1]),s}}function ki(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Wn(a,s){if(a){if(!s)return a;var t,r=Object.keys(s).map(function(i){if(t=s[i],t!=null)return Array.isArray(t)?i=i+"[]":t=[t],t.map(function(n){return Ka(n)?n=n.toISOString():Ca(n)&&(n=JSON.stringify(n)),"".concat(ki(i),"=").concat(ki(n))}).join("&")}).filter(Boolean).join("&");if(r){var e=a.indexOf("#");e!==-1&&(a=a.slice(0,e)),a+=(a.indexOf("?")===-1?"?":"&")+r}return a}}function Fr(a,s,t,r,e,i,n,o,l,u,c){e=e!=null?parseFloat(e):null,r=parseInt(r||"0",10),Number.isNaN(r)&&(r=0);var d={range:l,vid:u,index:o,contentLength:r,age:e,startTime:i,firstByteTime:n,endTime:Date.now(),priOptions:c};return{data:a,done:s,options:d,response:t}}function Ur(a,s){return Math.round(a*8*1e3/s/1024)}var K={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},xi=2*1024*1024,zr=function(a){Ot(t,a);var s=jt(t);function t(){var r;return De(this,t),r=s.call(this),E(j(r),"_abortController",null),E(j(r),"_timeoutTimer",null),E(j(r),"_reader",null),E(j(r),"_response",null),E(j(r),"_aborted",!1),E(j(r),"_index",-1),E(j(r),"_range",null),E(j(r),"_receivedLength",0),E(j(r),"_running",!1),E(j(r),"_logger",null),E(j(r),"_vid",""),E(j(r),"_onProcessMinLen",0),E(j(r),"_onCancel",null),E(j(r),"_priOptions",null),r}return Fe(t,[{key:"load",value:function(e){var i,n=this,o=e.url,l=e.vid,u=e.timeout,c=e.responseType,d=e.onProgress,h=e.index,p=e.onTimeout,v=e.onCancel,Z=e.range,b=e.transformResponse,L=e.request,w=e.params,W=e.logger,X=e.method,S=e.headers,R=e.body,T=e.mode,V=e.credentials,Y=e.cache,I=e.redirect,U=e.referrer,f=e.referrerPolicy,m=e.onProcessMinLen,y=e.priOptions;this._logger=W,this._aborted=!1,this._onProcessMinLen=m,this._onCancel=v,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=h,this._range=Z||[0,0],this._vid=l||o,this._priOptions=y||{};var G={method:X,headers:S,body:R,mode:T,credentials:V,cache:Y,redirect:I,referrer:U,referrerPolicy:f,signal:(i=this._abortController)===null||i===void 0?void 0:i.signal},g=!1;clearTimeout(this._timeoutTimer),o=Wn(o,w);var k=Gn(Z);k&&(L?S=L.headers:S=G.headers=G.headers||(Headers?new Headers:{}),Headers&&S instanceof Headers?S.append("Range",k):S.Range=k),u&&(this._timeoutTimer=setTimeout(function(){if(g=!0,n.cancel(),p){var H=new tt(o,G,null,"timeout");H.isTimeout=!0,p(H,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}},u));var M=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",Z),new Promise(function(H,C){fetch(L||o,L?void 0:G).then(function(){var P=dt(Ze().mark(function A(N){var ye,be,Je,me;return Ze().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=N,!(n._aborted||!n._running)){se.next=4;break}return se.abrupt("return");case 4:if(b&&(N=b(N,o)||N),N.ok){se.next=7;break}throw new tt(o,G,N,"bad network response");case 7:if(ye=Date.now(),c!==Ft.TEXT){se.next=15;break}return se.next=11,N.text();case 11:be=se.sent,n._running=!1,se.next=37;break;case 15:if(c!==Ft.JSON){se.next=22;break}return se.next=18,N.json();case 18:be=se.sent,n._running=!1,se.next=37;break;case 22:if(!d){se.next=29;break}return n.resolve=H,n.reject=C,n._loadChunk(N,d,M,ye),se.abrupt("return");case 29:return se.next=31,N.arrayBuffer();case 31:be=se.sent,be=new Uint8Array(be),n._running=!1,Je=Date.now()-M,me=Ur(be.byteLength,Je),n.emit(K.REAL_TIME_SPEED,{speed:me,len:be.byteLength,time:Je,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",h,",range,",Z),H(Fr(be,!0,N,N.headers.get("Content-Length"),N.headers.get("age"),M,ye,h,Z,n._vid,n._priOptions));case 39:case"end":return se.stop()}},A)}));return function(A){return P.apply(this,arguments)}}()).catch(function(P){var A;clearTimeout(n._timeoutTimer),n._running=!1,!(n._aborted&&!g)&&(P=P instanceof tt?P:new tt(o,G,null,(A=P)===null||A===void 0?void 0:A.message),P.startTime=M,P.endTime=Date.now(),P.isTimeout=g,P.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},C(P))})})}},{key:"cancel",value:function(){var r=dt(Ze().mark(function i(){return Ze().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._aborted){o.next=2;break}return o.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){o.next=14;break}if(o.prev=5,!this._reader){o.next=9;break}return o.next=9,this._reader.cancel();case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return o.stop()}},i,this,[[5,11]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadChunk",value:function(e,i,n,o){var l=this;if(!e.body||!e.body.getReader){this._running=!1;var u=new tt(e.url,"",e,"onProgress of bad response.body.getReader");u.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(u);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(xi),this._writeIdx=0);var c=this._reader=e.body.getReader(),d,h,p,v=function(){var Z=dt(Ze().mark(function b(){var L,w,W,X,S,R,T,V;return Ze().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return h=Date.now(),I.prev=1,I.next=4,c.read();case 4:d=I.sent,p=Date.now(),I.next=13;break;case 8:return I.prev=8,I.t0=I.catch(1),p=Date.now(),l._aborted||(l._running=!1,I.t0.options={index:l._index,range:l._range,vid:l._vid,priOptions:l._priOptions},l.reject(I.t0)),I.abrupt("return");case 13:if(w=((L=l._range)===null||L===void 0?void 0:L.length)>0?l._range[0]:0,W=w+l._receivedLength,!l._aborted){I.next=19;break}return l._running=!1,i(void 0,!1,{range:[W,W],vid:l._vid,index:l._index,startTime:h,endTime:p,st:n,firstByteTime:o,priOptions:l._priOptions},e),I.abrupt("return");case 19:X=d.value?d.value.byteLength:0,l._receivedLength+=X,l._logger.debug("【fetchLoader,onProgress call】,task,",l._range,", start,",W,", end,",w+l._receivedLength,", done,",d.done),l._onProcessMinLen>0?l._writeIdx+X>=l._onProcessMinLen||d.done?(S=new Uint8Array(l._writeIdx+X),S.set(l._cache.slice(0,l._writeIdx),0),X>0&&S.set(d.value,l._writeIdx),l._writeIdx=0,l._logger.debug("【fetchLoader,onProgress enough】,done,",d.done,",len,",S.byteLength,", writeIdx,",l._writeIdx)):X>0&&l._writeIdx+X<xi?(l._cache.set(d.value,l._writeIdx),l._writeIdx+=X,l._logger.debug("【fetchLoader,onProgress cache】,len,",X,", writeIdx,",l._writeIdx)):X>0&&(R=new Uint8Array(l._writeIdx+X+2048),l._logger.debug("【fetchLoader,onProgress extra start】,size,",l._writeIdx+X+2048,", datalen,",X,", writeIdx,",l._writeIdx),R.set(l._cache.slice(0,l._writeIdx),0),X>0&&R.set(d.value,l._writeIdx),l._writeIdx+=X,delete l._cache,l._cache=R,l._logger.debug("【fetchLoader,onProgress extra end】,len,",X,", writeIdx,",l._writeIdx)):S=d.value,(S&&S.byteLength>0||d.done)&&i(S,d.done,{range:[l._range[0]+l._receivedLength-(S?S.byteLength:0),l._range[0]+l._receivedLength],vid:l._vid,index:l._index,startTime:h,endTime:p,st:n,firstByteTime:o,priOptions:l._priOptions},e),d.done?(T=Date.now()-n,V=Ur(l._receivedLength,T),l.emit(K.REAL_TIME_SPEED,{speed:V,len:l._receivedLength,time:T,vid:l._vid,index:l._index,range:l._range,priOptions:l._priOptions}),l._running=!1,l._logger.debug("[fetchLoader onProgress end],task,",l._range,",done,",d.done),l.resolve(Fr(d,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,o,l._index,l._range,l._vid,l._priOptions))):v();case 25:case"end":return I.stop()}},b,null,[[1,8]])}));return function(){return Z.apply(this,arguments)}}();v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),t}(yt);function Pa(a){return Nt({loaderType:Xt.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Ft.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},a)}var Ha=function(a){Ot(t,a);var s=jt(t);function t(){var r;return De(this,t),r=s.call(this),E(j(r),"_xhr",null),E(j(r),"_aborted",!1),E(j(r),"_timeoutTimer",null),E(j(r),"_range",null),E(j(r),"_receivedLength",0),E(j(r),"_url",null),E(j(r),"_onProgress",null),E(j(r),"_index",-1),E(j(r),"_headers",null),E(j(r),"_currentChunkSizeKB",384),E(j(r),"_timeout",null),E(j(r),"_xhr",null),E(j(r),"_withCredentials",null),E(j(r),"_startTime",-1),E(j(r),"_loadCompleteResolve",null),E(j(r),"_loadCompleteReject",null),E(j(r),"_runing",!1),E(j(r),"_logger",!1),E(j(r),"_vid",""),E(j(r),"_responseType",void 0),E(j(r),"_credentials",void 0),E(j(r),"_method",void 0),E(j(r),"_transformResponse",void 0),E(j(r),"_firstRtt",void 0),E(j(r),"_onCancel",null),E(j(r),"_priOptions",null),r}return Fe(t,[{key:"load",value:function(e){var i=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Wn(e.url,e.params);var n=Date.now();return new Promise(function(o,l){i._loadCompleteResolve=o,i._loadCompleteReject=l,i._startLoad()}).catch(function(o){if(clearTimeout(i._timeoutTimer),i._runing=!1,!i._aborted)throw o=o instanceof tt?o:new tt(i._url,i._request),o.startTime=n,o.endTime=Date.now(),o.options={index:i._index,vid:i._vid,priOptions:i._priOptions},o})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===Ft.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var i=this._currentChunkSizeKB*1024,n=this._range[0]+this._receivedLength,o=this._range[1];i<this._range[1]-n&&(o=n+i),e=[n,o],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var i=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(u){var c,d,h;i._running=!1;var p=new tt(i._url,i._request,u==null||(c=u.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(u==null||(d=u.currentTarget)===null||d===void 0?void 0:d.status)+",statusText,"+(u==null||(h=u.currentTarget)===null||h===void 0?void 0:h.statusText));p.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(p)},n.ontimeout=function(u){i.cancel();var c=new tt(i._url,i._request,{status:408},"timeout");i._onTimeout&&(c.isTimeout=!0,i._onTimeout(c,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),c.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(c)};var o=this._headers||{},l=Gn(e);l&&(o.Range=l),o&&Object.keys(o).forEach(function(u){n.setRequestHeader(u,o[u])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),n.send(this._body)}catch(u){u.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(u)}}},{key:"_onReadyStatechange",value:function(e){var i=e.target;i.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var i,n=e.target.status;if(n<200||n>299){var o=new tt(this._url,null,Nt(Nt({},e.target.response),{},{status:n}),"bad response,status:"+n);return o.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(o)}var l=null,u=!1,c,d=((i=this._range)===null||i===void 0?void 0:i.length)>0?this._range[0]:0;if(this._responseType===Ft.ARRAY_BUFFER){var h,p=new Uint8Array(e.target.response);if(c=d+this._receivedLength,p&&p.byteLength>0){this._receivedLength+=p.byteLength;var v=Date.now()-this._startTime,Z=Ur(this._receivedLength,v);this.emit(K.REAL_TIME_SPEED,{speed:Z,len:this._receivedLength,time:v,vid:this._vid,index:this._index,range:[c,d+this._receivedLength],priOptions:this._priOptions})}l=p,((h=this._range)===null||h===void 0?void 0:h.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?u=!1:u=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",d+this._receivedLength,",dataLen,",p?p.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",u)}else u=!0,l=e.target.response;var b={ok:n>=200&&n<300,status:n,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(b=this._transformResponse(b,this._url)||b),this._onProgress&&this._onProgress(l,u,{index:this._index,vid:this._vid,range:[c,d+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},b),u?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Fr(this._onProgress?null:l,u,b,b.headers["content-length"],b.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,sr(wt(t.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var i=e.getAllResponseHeaders().trim().split(`\r
`),n={},o=Ta(i),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=u.split(": ");n[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(d){o.e(d)}finally{o.f()}return n}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),t}(yt),Na=["retry","retryDelay","onRetryError","transformError"],Da=function(){function a(s,t){De(this,a),this.promise=xt(),this.alive=!!t.onProgress,!t.logger&&(t.logger=new xe("Loader")),this._loaderType=s,this._loader=s===Xt.FETCH&&typeof fetch<"u"?new zr:new Ha,this._config=t,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=t.retryCheckFunc,this._logger=t.logger}return Fe(a,[{key:"exec",value:function(){var t=this,r=this._config,e=r.retry,i=r.retryDelay,n=r.onRetryError,o=r.transformError,l=Wa(r,Na),u=function(){var c=dt(Ze().mark(function d(){var h,p,v;return Ze().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,t._loader.load(l);case 3:h=b.sent,t.promise.resolve(h),b.next=27;break;case 7:if(b.prev=7,b.t0=b.catch(0),t._loader.running=!1,t._logger.debug("[task request catch err]",b.t0),!t._canceled){b.next=13;break}return b.abrupt("return");case 13:if(b.t0.loaderType=t._loaderType,b.t0.retryCount=t._retryCount,p=b.t0,o&&(p=o(p)||p),n&&t._retryCount>0&&n(p,t._retryCount,{index:l.index,vid:l.vid,range:l.range,priOptions:l.priOptions}),t._retryCount++,v=!0,t._retryCheckFunc&&(v=t._retryCheckFunc(b.t0)),!(v&&t._retryCount<=e)){b.next=26;break}return clearTimeout(t._retryTimer),t._logger.debug("[task request setTimeout],retry",t._retryCount,",retry range,",l.range),t._retryTimer=setTimeout(u,i),b.abrupt("return");case 26:t.promise.reject(p);case 27:case"end":return b.stop()}},d,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return u(),this.promise}},{key:"cancel",value:function(){var s=dt(Ze().mark(function r(){return Ze().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,i.abrupt("return",this._loader.cancel());case 4:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),a}();function wn(a){return a&&!a.paused&&!a.ended&&a.playbackRate!==0&&a.readyState!==0}function Rn(a){if(!a)return{};if(typeof a.getVideoPlaybackQuality=="function"){var s=a.getVideoPlaybackQuality();return{droppedVideoFrames:s.droppedVideoFrames||s.corruptedVideoFrames,totalVideoFrames:s.totalVideoFrames,creationTime:s.creationTime}}return{droppedVideoFrames:a.webkitDroppedFrameCount,totalVideoFrames:a.webkitDecodedFrameCount,creationTime:performance.now()}}function Gt(){for(var a=arguments.length,s=new Array(a),t=0;t<a;t++)s[t]=arguments[t];if(s=s.filter(Boolean),s.length<2)return s[0];var r=new Uint8Array(s.reduce(function(i,n){return i+n.byteLength},0)),e=0;return s.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}function Fa(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(s){return setTimeout(s,a)})}var pt=function(a){Ot(t,a);var s=jt(t);function t(r){var e;return De(this,t),e=s.call(this,r),E(j(e),"type",Xt.FETCH),E(j(e),"_queue",[]),E(j(e),"_alive",[]),E(j(e),"_currentTask",null),E(j(e),"_finnalUrl",""),E(j(e),"_config",void 0),e._config=Pa(r),(e._config.loaderType===Xt.XHR||!zr.isSupported())&&(e.type=Xt.XHR),e.log=r.logger,e}return Fe(t,[{key:"isFetch",value:function(){return this.type===Xt.FETCH}},{key:"load",value:function(e){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?n.url=e||n.url||this._config.url:n=e,n=Object.assign({},this._config,n),n.params&&(n.params=Object.assign({},n.params)),n.headers&&Ti(n.headers)&&(n.headers=Object.assign({},n.headers)),n.body&&Ti(n.body)&&(n.body=Object.assign({},n.body)),n.transformRequest&&(n=n.transformRequest(n)||n),n.logger=this.log;var o=new Da(this.type,n);return o.loader.on(K.REAL_TIME_SPEED,function(l){i.emit(K.REAL_TIME_SPEED,l)}),this._queue.push(o),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),o.promise}},{key:"cancel",value:function(){var r=dt(Ze().mark(function i(){var n;return Ze().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=this._queue.map(function(u){return u.cancel()}).concat(this._alive.map(function(u){return u.cancel()})),this._currentTask&&n.push(this._currentTask.cancel()),this._queue=[],this._alive=[],l.next=6,Promise.all(n);case 6:return l.next=8,Fa();case 8:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var i=this._currentTask.exec().catch(function(n){});i&&typeof i.finally=="function"&&i.finally(function(){var n,o;(n=e._currentTask)!==null&&n!==void 0&&n.alive&&((o=e._alive)===null||o===void 0?void 0:o.length)>0&&(e._alive=e._alive.filter(function(l){return l&&l!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return zr.isSupported()}}]),t}(yt),Vn=function(){function a(){De(this,a),E(this,"_prevCurrentTime",0)}return Fe(a,[{key:"do",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(t){var n=t.currentTime,o=0;if(this._prevCurrentTime===n){var l=fe.info(fe.get(t),n);if(!l.buffers.length)return;e&&l.nextStart||l.nextStart&&l.nextStart-n<r?o=l.nextStart+.1:l.end&&l.end-n>i&&!t.seeking&&(o=n+.1)}this._prevCurrentTime=n,o&&n!==o&&(t.currentTime=o)}}}]),a}(),Tn=function(){function a(s){var t=this;De(this,a),E(this,"_seiSet",new Set),this.emitter=s,s.on(K.SEI,function(r){r&&t._seiSet.add(r)})}return Fe(a,[{key:"throw",value:function(t,r){var e=this;if(!(t==null||!this._seiSet.size)){var i=t-.2,n=t+.2,o=[];this._seiSet.forEach(function(l){l.time>=i&&l.time<=n&&o.push(l)}),o.forEach(function(l){e._seiSet.delete(l),e.emitter.emit(K.SEI_IN_TIME,l)}),r&&this._seiSet.forEach(function(l){l.time<t-5&&e._seiSet.delete(l)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),a}(),Ua=1e3,za=50,Ja=3,Oa=3e3,kn=function(){function a(s){De(this,a),E(this,"_chunkSpeed",0),E(this,"_chunkCache",[]),E(this,"_speeds",[]),E(this,"_totalSize",0),E(this,"_totalCost",0),this._opts=s||{}}return Fe(a,[{key:"addRecord",value:function(t,r){!t||!r||(this._speeds.push(8e3*t/r),this._speeds=this._speeds.slice(-Ja))}},{key:"addChunkRecord",value:function(t,r){var e,i;if(!(!t||!r||t<(((e=this._opts)===null||e===void 0?void 0:e.skipChunkSize)||Ua))){this._totalSize+=t,this._totalCost+=r,this._chunkSpeed=8e3*t/r,this._chunkCache.push({size:t,duration:r,timestamp:performance.now()});var n=((i=this._opts)===null||i===void 0?void 0:i.chunkCountForSpeed)||za;this._chunkCache.length>n&&(this._chunkCache=this._chunkCache.slice(-n))}}},{key:"getAvgSpeed",value:function(){var t;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(o,l){return o+=l})/this._speeds.length;var r=this._chunkCache[this._chunkCache.length-1],e=performance.now()-r.timestamp;e>(((t=this._opts)===null||t===void 0?void 0:t.longtimeNoReceived)||Oa)&&this._chunkCache.push({size:0,duration:e,timestamp:performance.now()});var i=this._chunkCache.reduce(function(o,l){return o+=l.size},0),n=this._chunkCache.reduce(function(o,l){return o+=l.duration},0);return 8e3*i/n}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),a}(),Mi=function(){function a(s){De(this,a),E(this,"encodeType",""),E(this,"audioCodec",""),E(this,"videoCodec",""),E(this,"domain",""),E(this,"fps",0),E(this,"bitrate",0),E(this,"width",0),E(this,"height",0),E(this,"samplerate",0),E(this,"channelCount",0),E(this,"gop",0),E(this,"_bitsAccumulateSize",0),E(this,"_bitsAccumulateDuration",0),E(this,"_startGopId",-1),this._timescale=s}return Fe(a,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(t){this.encodeType=t}},{key:"setFpsFromScriptData",value:function(t){var r,e=t.data,i=e==null||(r=e.onMetaData)===null||r===void 0?void 0:r.framerate;i&&i>0&&i<100&&(this.fps=i)}},{key:"setVideoMeta",value:function(t){if(this.width=t.width,this.height=t.height,this.videoCodec=t.codec,this.encodeType=t.codecType,t.fpsNum&&t.fpsDen){var r=t.fpsNum/t.fpsDen;r>0&&r<100&&(this.fps=r)}}},{key:"setAudioMeta",value:function(t){this.audioCodec=t.codec,this.samplerate=t.sampleRate,this.channelCount=t.channelCount}},{key:"setDomain",value:function(t){this.domain=t.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(t){var r=this;if((!this.fps||this.fps>=100)&&t.length){var e=t.reduce(function(i,n){return i+=n.duration},0)/t.length;this.fps=Math.round(this._timescale/e)}t.forEach(function(i){r._startGopId===-1&&(r._startGopId=i.gopId),i.gopId===r._startGopId&&r.gop++,r._bitsAccumulateDuration+=i.duration/(r._timescale/1e3),r._bitsAccumulateSize+=i.units.reduce(function(n,o){return n+=o.length},0),r._bitsAccumulateDuration>=1e3&&(r.bitrate=r._bitsAccumulateSize*8,r._bitsAccumulateDuration=0,r._bitsAccumulateSize=0)})}}]),a}(),xn=function(){function a(s){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;De(this,a),E(this,"_core",null),E(this,"_samples",[]),this._core=s,this._timescale=t,this._stats=new Mi(t),this._bindEvents()}return Fe(a,[{key:"getStats",value:function(){var t,r,e,i,n,o,l,u,c,d,h,p=((t=this._core)===null||t===void 0?void 0:t.media)||{},v=p.currentTime,Z=v===void 0?0:v,b=p.decodeFps,L=b===void 0?0:b;return Nt(Nt({},this._stats.getStats()),{},{downloadSpeed:((r=this._core)===null||r===void 0||(e=r.speedInfo)===null||e===void 0?void 0:e.call(r).speed)||0,avgSpeed:((i=this._core)===null||i===void 0||(n=i.speedInfo)===null||n===void 0?void 0:n.call(i).avgSpeed)||0,totalReceivedByte:((o=this._core)===null||o===void 0||(l=o.speedInfo)===null||l===void 0?void 0:l.call(o).totalSize)||0,totalReceivedCost:((u=this._core)===null||u===void 0||(c=u.speedInfo)===null||c===void 0?void 0:c.call(u).totalCost)||0,currentTime:Z,bufferEnd:((d=this._core)===null||d===void 0||(h=d.bufferInfo())===null||h===void 0?void 0:h.remaining)||0,decodeFps:L})}},{key:"_bindEvents",value:function(){var t=this;this._core.on(K.DEMUXED_TRACK,function(r){var e=r.videoTrack;return t._stats.updateBitrate(e.samples)}),this._core.on(K.FLV_SCRIPT_DATA,function(r){t._stats.setFpsFromScriptData(r)}),this._core.on(K.METADATA_PARSED,function(r){r.type==="video"?t._stats.setVideoMeta(r.track):t._stats.setAudioMeta(r.track)}),this._core.on(K.TTFB,function(r){t._stats.setDomain(r.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Mi(this._timescale)}}]),a}();function ja(a,s){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var r,e,i,n,o=[],l=!0,u=!1;try{if(i=(t=t.call(a)).next,s!==0)for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==s);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(n=t.return(),Object(n)!==n))return}finally{if(u)throw e}}return o}}function ue(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function Yi(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,In(r.key),r)}}function ce(a,s,t){return s&&Yi(a.prototype,s),t&&Yi(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function _(a,s,t){return s=In(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function Mn(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&Jr(a,s)}function cr(a){return cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cr(a)}function Jr(a,s){return Jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Jr(a,s)}function Ba(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Aa(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Qa(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Aa(a)}function Yn(a){var s=Ba();return function(){var r=cr(a),e;if(s){var i=cr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Qa(this,e)}}function $a(a,s){return es(a)||ja(a,s)||oi(a,s)||is()}function ke(a){return qa(a)||ts(a)||oi(a)||rs()}function qa(a){if(Array.isArray(a))return Or(a)}function es(a){if(Array.isArray(a))return a}function ts(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function oi(a,s){if(a){if(typeof a=="string")return Or(a,s);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Or(a,s)}}function Or(a,s){(s==null||s>a.length)&&(s=a.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=a[t];return r}function rs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function is(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ns(a,s){var t=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(!t){if(Array.isArray(a)||(t=oi(a))||s){t&&(a=t);var r=0,e=function(){};return{s:e,n:function(){return r>=a.length?{done:!0}:{done:!1,value:a[r++]}},e:function(l){throw l},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,n=!1,o;return{s:function(){t=t.call(a)},n:function(){var l=t.next();return i=l.done,l},e:function(l){n=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(n)throw o}}}}function as(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function In(a){var s=as(a,"string");return typeof s=="symbol"?s:String(s)}var vt={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},rt={AV1:"av1",AVC:"avc",HEVC:"hevc"},it={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},pe={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},yr=function(){function a(){ue(this,a),_(this,"id",1),_(this,"type",vt.VIDEO),_(this,"codecType",rt.AVC),_(this,"pid",-1),_(this,"hvcC",void 0),_(this,"codec",""),_(this,"timescale",0),_(this,"formatTimescale",0),_(this,"sequenceNumber",0),_(this,"baseMediaDecodeTime",0),_(this,"baseDts",0),_(this,"duration",0),_(this,"warnings",[]),_(this,"samples",[]),_(this,"pps",[]),_(this,"sps",[]),_(this,"vps",[]),_(this,"fpsNum",0),_(this,"fpsDen",0),_(this,"sarRatio",[]),_(this,"width",0),_(this,"height",0),_(this,"nalUnitSize",4),_(this,"present",!1),_(this,"isVideoEncryption",!1),_(this,"isAudioEncryption",!1),_(this,"isVideo",!0),_(this,"kid",null),_(this,"pssh",null),_(this,"ext",void 0)}return ce(a,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var t=this.samples[0],r=this.samples[this.samples.length-1];return r.dts-t.dts+r.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),a}(),br=function(){function a(){ue(this,a),_(this,"id",2),_(this,"type",vt.AUDIO),_(this,"codecType",it.AAC),_(this,"pid",-1),_(this,"codec",""),_(this,"sequenceNumber",0),_(this,"sampleDuration",0),_(this,"timescale",0),_(this,"formatTimescale",0),_(this,"baseMediaDecodeTime",0),_(this,"duration",0),_(this,"warnings",[]),_(this,"samples",[]),_(this,"baseDts",0),_(this,"sampleSize",16),_(this,"sampleRate",0),_(this,"channelCount",0),_(this,"objectType",0),_(this,"sampleRateIndex",0),_(this,"config",[]),_(this,"present",!1),_(this,"isVideoEncryption",!1),_(this,"isAudioEncryption",!1),_(this,"kid",null),_(this,"ext",void 0)}return ce(a,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===it.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var t=this.samples[0],r=this.samples[this.samples.length-1];return r.dts-t.dts+r.duration}return 0}}]),a}(),Et=function(){function a(s,t,r){ue(this,a),_(this,"flag",{}),_(this,"keyframe",!1),_(this,"gopId",0),_(this,"duration",0),_(this,"size",0),_(this,"units",[]),_(this,"chromaFormat",420),this.originPts=this.pts=s,this.originDts=this.dts=t,r&&(this.units=r)}return ce(a,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),a}(),nt=ce(function a(s,t,r,e){ue(this,a),_(this,"duration",1024),_(this,"flag",{dependsOn:2,isNonSyncSample:0}),_(this,"keyframe",!0),this.originPts=this.pts=this.dts=s,this.data=t,this.size=t.byteLength,this.sampleOffset=e,r&&(this.duration=r)}),_n=ce(function a(s,t){ue(this,a),_(this,"time",0),this.data=s,this.originPts=this.pts=t}),ss=function(a){Mn(t,a);var s=Yn(t);function t(){return ue(this,t),s.apply(this,arguments)}return ce(t)}(_n),En=function(a){Mn(t,a);var s=Yn(t);function t(){return ue(this,t),s.apply(this,arguments)}return ce(t)}(_n),Zr=function(){function a(){ue(this,a),_(this,"id",3),_(this,"type",vt.METADATA),_(this,"timescale",0),_(this,"flvScriptSamples",[]),_(this,"seiSamples",[])}return ce(a,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),a}(),Rt=function(){function a(s){ue(this,a),this.name=s||"",this._prefix="[".concat(this.name,"]")}return ce(a,[{key:"warn",value:function(){var t;if(!a.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();_(Rt,"disabled",!0);var gr=typeof window<"u",li=gr&&navigator.userAgent.toLocaleLowerCase(),Cn=gr&&/^((?!chrome|android).)*safari/.test(li),os=gr&&li.includes("firefox"),ls=gr&&li.includes("android"),je=function(){function a(){ue(this,a)}return ce(a,null,[{key:"getRateIndexByRate",value:function(t){return a.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var e=t.length,i=0;i+2<e&&!(t[i]===255&&(t[i+1]&246)===240);)i++;if(!(i>=e)){var n=i,o=[],l=(t[i+2]&60)>>>2,u=a.FREQ[l];if(!u)throw new Error("Invalid sampling index: ".concat(l));for(var c=((t[i+2]&192)>>>6)+1,d=(t[i+2]&1)<<2|(t[i+3]&192)>>>6,h=a._getConfig(l,d,c),p=h.config,v=h.codec,Z,b,L=0,w=a.getFrameDuration(u);i+7<e;){if(t[i]!==255||(t[i+1]&246)!==240){i++;continue}if(b=(t[i+3]&3)<<11|t[i+4]<<3|(t[i+5]&224)>>5,!b||e-i<b)break;Z=(~t[i+1]&1)*2,o.push({pts:r+L*w,data:t.subarray(i+7+Z,i+b)}),L++,i+=b}return{skip:n,remaining:i>=e?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:l,sampleRate:u,objectType:c,channelCount:d,codec:v,config:p,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,e=(t[0]&7)<<1|t[1]>>>7,i=(t[1]&120)>>>3,n=a.FREQ[e];if(n){var o=a._getConfig(e,i,r),l=o.config,u=o.codec;return{samplingFrequencyIndex:e,sampleRate:n,objectType:r,channelCount:i,config:l,codec:u,originCodec:"mp4a.40.".concat(r)}}}}},{key:"getFrameDuration",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*r/t}},{key:"_getConfig",value:function(t,r,e){var i=[],n,o;return os?t>=6?(n=5,o=t-3):(n=2,o=t):ls?(n=2,o=t):(n=e===2||e===5?e:5,o=t,t>=6?o=t-3:r===1&&(n=2,o=t)),i[0]=n<<3,i[0]|=(t&14)>>1,i[1]=(t&1)<<7,i[1]|=r<<3,n===5&&(i[1]|=(o&14)>>1,i[2]=(o&1)<<7,i[2]|=8,i[3]=0),{config:i,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(t,r){switch(t){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),a}();_(je,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var us=500,Ii=3,Vr=1e3,Tr=5e3,cs=1e3,ds=200,_i=5e3,Ei=5,hs=function(){function a(s,t,r){ue(this,a),this.videoTrack=s,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return ce(a,[{key:"fix",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;r=Math.round(r*1e3);var n=this.videoTrack,o=this.audioTrack;(e||!i)&&(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),e&&!i&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(o,n),!i&&r&&(this._audioNextPts=this._videoNextDts=r);var l=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(l&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._keyFrameInNextChunk=!1,this._fixVideo(n),this.metadataTrack.exist()){var u=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(c){c.pts=c.originPts-t._baseDts,c.time=Math.max(0,c.pts)/u}),this.metadataTrack.flvScriptSamples.forEach(function(c){c.pts=c.originPts-t._baseDts,c.time=Math.max(0,c.pts)/u})}n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/1e3)}},{key:"_fixVideo",value:function(t){var r=this,e=t.samples;if(e.length){e.forEach(function(w){w.dts-=r._baseDts,w.pts-=r._baseDts,w.keyframe&&(r._keyFrameInNextChunk=!0)});var i;if(t.fpsNum&&t.fpsDen)i=t.timescale*(t.fpsDen/t.fpsNum);else if(t.length>1){var n=t.samples[0],o=t.samples[e.length-1];i=Math.floor((o.dts-n.dts)/(e.length-1))}else i=this._lastVideoDuration||40;var l=e.pop();if(this._videoLastSample&&e.unshift(this._videoLastSample),this._videoLastSample=l,!!e.length){if(this._videoNextDts===void 0){var u=e[0];this._videoNextDts=u.dts}var c=e.length,d=0,h=e[0],p=this._videoNextDts-h.dts;if(Math.abs(p)>ds){if(Math.abs(h.dts-this._lastVideoExceptionChunkFirstDtsDot)>_i){var v;this._lastVideoExceptionChunkFirstDtsDot=h.dts,t.warnings.push({type:pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:h.dts,nextSampleDts:(v=e[1])===null||v===void 0?void 0:v.dts,sampleDuration:p})}this._videoTimestampBreak>=Ei?(this._videoNextDts=h.dts,this._videoTimestampBreak=0):(h.dts+=p,h.pts+=p,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var Z=0;Z<c;Z++){var b=e[Z].dts,L=e[Z+1];Z<c-1?d=L.dts-b:l?d=l.dts-b:d=i,(d>cs||d<0)&&(this._videoTimestampBreak++,Math.abs(b-this._lastVideoExceptionLargeGapDot)>_i&&(this._lastVideoExceptionLargeGapDot=b,t.warnings.push({type:pe.LARGE_VIDEO_GAP,time:b/t.timescale,dts:b,originDts:e[Z].originDts,nextDts:this._videoNextDts,sampleDuration:d,refSampleDuration:i})),d=i),e[Z].duration=d,this._videoNextDts+=d,this._lastVideoDuration=d}}}}},{key:"_fixAudio",value:function(t){var r=this,e=t.samples;e.length&&(e.forEach(function(i){i.dts=i.pts-=r._baseDts}),this._doFixAudioInternal(t,e,1e3))}},{key:"_calculateBaseDts",value:function(t,r){var e=t.samples,i=r.samples;if(!e.length&&!i.length)return!1;var n=1/0,o=1/0;e.length&&(t.baseDts=n=e[0].pts),i.length&&(r.baseDts=o=i[0].dts),this._baseDts=Math.min(n,o);var l=o-n;return Number.isFinite(l)&&Math.abs(l)>us&&r.warnings.push({type:pe.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:n,baseDts:this._baseDts,delta:l}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var t=this._calculateBaseDts(this.audioTrack,this.videoTrack);t&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(t,r,e){t.sampleDuration||(t.sampleDuration=t.codecType===it.AAC?je.getFrameDuration(t.timescale,e):this._getG711Duration(t));var i=t.sampleDuration,n=t.codecType===it.AAC?1024:i*t.timescale/1e3;if(this._audioNextPts===void 0){var o=r[0];this._audioNextPts=o.pts}for(var l=0;l<r.length;l++){var u=this._audioNextPts,c=r[l],d=c.pts-u;if(l===0&&this._audioTimestampBreak>=Ei&&this._keyFrameInNextChunk&&(u=this._audioNextPts=c.dts,d=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&d>=Ii*i&&d<=Vr&&!Cn){var h=this._getSilentFrame(t)||r[0].data.subarray(),p=Math.floor(d/i);Math.abs(c.pts-this._lastAudioExceptionGapDot)>Tr&&(this._lastAudioExceptionGapDot=c.pts,t.warnings.push({type:pe.AUDIO_FILLED,pts:c.pts,originPts:c.originPts,count:p,nextPts:u,refSampleDuration:i}));for(var v=0;v<p;v++){var Z=new nt(Math.floor(this._audioNextPts+i)-Math.floor(this._audioNextPts),h,n);Z.originPts=Math.floor(this._baseDts+u),r.splice(l,0,Z),this._audioNextPts+=i,l++}l--}else d<=-Ii*i&&d>=-1*Vr?(Math.abs(c.pts-this._lastAudioExceptionOverlapDot)>Tr&&(this._lastAudioExceptionOverlapDot=c.pts,t.warnings.push({type:pe.AUDIO_DROPPED,pts:c.pts,originPts:c.originPts,nextPts:u,refSampleDuration:i})),r.splice(l,1),l--):(Math.abs(d)>Vr&&(this._audioTimestampBreak++,Math.abs(c.pts-this._lastAudioExceptionLargeGapDot)>Tr&&(this._lastAudioExceptionLargeGapDot=c.pts,t.warnings.push({type:pe.LARGE_AUDIO_GAP,time:c.pts/1e3,pts:c.pts,originPts:c.originPts,nextPts:u,sampleDuration:d,refSampleDuration:i}))),c.dts=c.pts=u,c.duration=n,this._audioNextPts+=i)}}},{key:"_getG711Duration",value:function(t){var r=t.sampleSize,e=t.channelCount,i=t.sampleRate,n=t.samples[0];if(n)return n.data.byteLength*2/e/(r/8)/i*1e3}},{key:"_getSilentFrame",value:function(t){return t.codecType===it.AAC?je.getSilentFrame(t.codec,t.channelCount):new Uint8Array(8*t.sampleDuration*t.channelCount)}}]),a}();function Ne(){for(var a=arguments.length,s=new Array(a),t=0;t<a;t++)s[t]=arguments[t];s=s.filter(Boolean);var r=new Uint8Array(s.reduce(function(i,n){return i+n.byteLength},0)),e=0;return s.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}var ms=Math.pow(2,32);function de(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[s]<<8)+(a[s+1]||0)}function fs(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[s]<<16)+(a[s+1]<<8)+(a[s+2]||0)}function D(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[s]<<24>>>0)+(a[s+1]<<16)+(a[s+2]<<8)+(a[s+3]||0)}function gt(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return D(a,s)*ms+D(a,s+4)}function Kn(a){for(var s="avc1.",t,r=0;r<3;r++)t=a[r].toString(16),t.length<2&&(t="0".concat(t)),s+=t;return s}function ps(a){var s="";if(a.forEach(function(e){s+=vs(e)}),s.length<=32)for(var t=32-s.length,r=0;r<t;r++)s+="0";return s}function Ci(a){if(!Array.isArray(a)){for(var s=[],t="",r=0;r<a.length;r++)r%2&&(t=a[r-1]+a[r],s.push(parseInt(t,16)),t="");return s}return a.map(function(e){return parseInt(e,16)})}function vs(a){return("0"+Number(a).toString(16)).slice(-2).toUpperCase()}function kr(a,s){return+(a+"."+s)}function ys(a){if(a.length<5)return 0;var s=Math.hypot(a[0],a[3]),t=Math.hypot(a[1],a[4]);return s===0||t===0?0:180*Math.atan2(a[1]/t,a[0]/s)/Math.PI}var qe=function(){function a(){ue(this,a)}return ce(a,null,[{key:"parseAnnexB",value:function(t){for(var r=t.length,e=2,i=0;t[e]!==null&&t[e]!==void 0&&t[e]!==1;)e++;if(e++,i=e+2,i>=r)return[];for(var n=[];i<r;)switch(t[i]){case 0:if(t[i-1]!==0){i+=2;break}else if(t[i-2]!==0){i++;break}e!==i-2&&n.push(t.subarray(e,i-2));do i++;while(t[i]!==1&&i<r);e=i+1,i=e+2;break;case 1:if(t[i-1]!==0||t[i-2]!==0){i+=3;break}e!==i-2&&n.push(t.subarray(e,i-2)),e=i+1,i=e+2;break;default:i+=3;break}return e<r&&n.push(t.subarray(e)),n}},{key:"parseAvcC",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(t.length<4)){for(var e=t.length,i=[],n=0,o;n+r<e;)if(o=D(t,n),r===3&&(o>>>=8),n+=r,!!o){if(n+o>e)break;i.push(t.subarray(n,n+o)),n+=o}return i}}},{key:"parseSEI",value:function(t,r){for(var e=t.length,i=r?2:1,n=0,o=0,l="";t[i]===255;)n+=255,i++;for(n+=t[i++];t[i]===255;)o+=255,i++;if(o+=t[i++],n===5&&e>i+16)for(var u=0;u<16;u++)l+=t[i].toString(16),i++;return{payload:t.subarray(i,i+o),type:n,size:o,uuid:l}}},{key:"removeEPB",value:function(t){for(var r=t.byteLength,e=[],i=1;i<r-2;)t[i]===0&&t[i+1]===0&&t[i+2]===3?(e.push(i+2),i+=2):i++;if(!e.length)return t;var n=r-e.length,o=new Uint8Array(n),l=0;for(i=0;i<n;l++,i++)l===e[0]&&(l++,e.shift()),o[i]=t[l];return o}}]),a}(),jr=function(){function a(s){if(ue(this,a),_(this,"_bytesAvailable",void 0),_(this,"_bitsAvailable",0),_(this,"_word",0),!s)throw new Error("ExpGolomb data params is required");this._data=s,this._bytesAvailable=s.byteLength,this._bytesAvailable&&this._loadWord()}return ce(a,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var t=this._data.byteLength-this._bytesAvailable,r=Math.min(4,this._bytesAvailable);if(r===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(t,t+r)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=r*8,this._bytesAvailable-=r}},{key:"skipBits",value:function(t){if(this._bitsAvailable>t)this._word<<=t,this._bitsAvailable-=t;else{t-=this._bitsAvailable;var r=Math.floor(t/8);t-=r*8,this._bytesAvailable-=r,this._loadWord(),this._word<<=t,this._bitsAvailable-=t}}},{key:"readBits",value:function(t){if(t>32)throw new Error("Cannot read more than 32 bits");var r=Math.min(this._bitsAvailable,t),e=this._word>>>32-r;return this._bitsAvailable-=r,this._bitsAvailable>0?this._word<<=r:this._bytesAvailable>0&&this._loadWord(),r=t-r,r>0&&this._bitsAvailable?e<<r|this.readBits(r):e}},{key:"skipLZ",value:function(){var t;for(t=0;t<this._bitsAvailable;++t)if(this._word&2147483648>>>t)return this._word<<=t,this._bitsAvailable-=t,t;return this._loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(t){for(var r=8,e=8,i,n=0;n<t;n++)e!==0&&(i=this.readEG(),e=(r+i+256)%256),r=e===0?r:e}}]),a}(),Pn=function(){function a(){ue(this,a)}return ce(a,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r=(t[4]&3)+1,e,i=[],n=[],o=6,l=t[5]&31,u,c=0;c<l;c++)if(u=t[o]<<8|t[o+1],o+=2,!!u){var d=t.subarray(o,o+u);o+=u,i.push(d),e||(e=a.parseSPS(qe.removeEPB(d)))}var h=t[o];o++;for(var p,v=0;v<h;v++)p=t[o]<<8|t[o+1],o+=2,p&&(n.push(t.subarray(o,o+p)),o+=p);return{sps:e,spsArr:i,ppsArr:n,nalUnitSize:r}}}},{key:"parseSPS",value:function(t){var r=new jr(t);r.readUByte();var e=r.readUByte(),i=r.readUByte(),n=r.readUByte();r.skipUEG();var o=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var l=r.readUEG();if(l<=3&&(o=[0,420,422,444][l]),l===3&&r.skipBits(1),r.skipUEG(),r.skipUEG(),r.skipBits(1),r.readBool())for(var u=l!==3?8:12,c=0;c<u;c++)r.readBool()&&(c<6?r.skipScalingList(16):r.skipScalingList(64))}r.skipUEG();var d=r.readUEG();if(d===0)r.readUEG();else if(d===1){r.skipBits(1),r.skipUEG(),r.skipUEG();for(var h=r.readUEG(),p=0;p<h;p++)r.skipUEG()}r.skipUEG(),r.skipBits(1);var v=r.readUEG(),Z=r.readUEG(),b=r.readBits(1);b===0&&r.skipBits(1),r.skipBits(1);var L=0,w=0,W=0,X=0;r.readBool()&&(L=r.readUEG(),w=r.readUEG(),W=r.readUEG(),X=r.readUEG());var S,R,T,V,Y;if(r.readBool()){if(r.readBool()){var I=r.readUByte();switch(I){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[r.readUByte()<<8|r.readUByte(),r.readUByte()<<8|r.readUByte()];break}}}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var U=r.readBits(32),f=r.readBits(32);R=r.readBool(),T=f,V=U*2,Y=T/V}}return{codec:Kn(t.subarray(1,4)),profileIdc:e,profileCompatibility:i,levelIdc:n,chromaFormat:o,width:Math.ceil((v+1)*16-2*(L+w)),height:(2-b)*(Z+1)*16-(b?2:4)*(W+X),sarRatio:S,fpsNum:T,fpsDen:V,fps:Y,fixedFrame:R}}}]),a}(),Br=function(){function a(){ue(this,a)}return ce(a,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var e=(t[21]&3)+1,i,n,o=[],l=[],u=[],c=23,d=t[22],h,p,v,Z=0;Z<d;Z++){h=t[c]&63,p=t[c+1]<<8|t[c+2],c+=3;for(var b=0;b<p;b++)if(v=t[c]<<8|t[c+1],c+=2,!!v){switch(h){case 32:{var L=t.subarray(c,c+v);i||(i=a.parseVPS(qe.removeEPB(L),r)),u.push(L)}break;case 33:{var w=t.subarray(c,c+v);n||(n=a.parseSPS(qe.removeEPB(w),r)),o.push(w)}break;case 34:l.push(t.subarray(c,c+v));break}c+=v}}return{hvcC:r,sps:n,spsArr:o,ppsArr:l,vpsArr:u,nalUnitSize:e}}}},{key:"parseVPS",value:function(t,r){r=r||{};var e=new jr(t);e.readUByte(),e.readUByte(),e.readBits(12);var i=e.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),e.readBits(17),a._parseProfileTierLevel(e,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r=r||{};var e=new jr(t);e.readUByte(),e.readUByte(),e.readBits(4);var i=e.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=e.readBits(1),a._parseProfileTierLevel(e,i,r),e.readUEG();var n=r.chromaFormatIdc=e.readUEG(),o=420;n<=3&&(o=[0,420,422,444][n]);var l=0;n===3&&(l=e.readBits(1));var u=e.readUEG(),c=e.readUEG(),d=e.readBits(1),h,p,v,Z;if(d===1&&(h=e.readUEG(),p=e.readUEG(),v=e.readUEG(),Z=e.readUEG()),r.bitDepthLumaMinus8=e.readUEG(),r.bitDepthChromaMinus8=e.readUEG(),d===1){var b=(n===1||n===2)&&l===0?2:1,L=n===1&&l===0?2:1;u-=b*(p+h),c-=L*(Z+v)}return{codec:"hev1.1.6.L93.B0",width:u,height:c,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(t,r,e){var i=e.generalTierFlag||0;e.generalProfileSpace=t.readBits(2),e.generalTierFlag=Math.max(t.readBits(1),i),e.generalProfileIdc=Math.max(t.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=t.readBits(32),e.generalConstraintIndicatorFlags=[t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8)];var n=t.readBits(8);i<e.generalTierFlag?e.generalLevelIdc=n:e.generalLevelIdc=Math.max(n,e.generalLevelIdc||0);var o=[],l=[];if(r>t.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(r));for(var u=0;u<r;u++)o[u]=t.readBits(1),l[u]=t.readBits(1);r>0&&t.readBits((8-r)*2);for(var c=0;c<r;c++)o[c]!==0&&(t.readBits(2),t.readBits(1),t.readBits(5),t.readBits(16),t.readBits(16),t.readBits(4),t.readBits(16),t.readBits(16),t.readBits(12)),l[c]!==0&&t.readBits(8)}}]),a}(),Ki=function(){function a(){ue(this,a)}return ce(a,null,[{key:"decode",value:function(t){for(var r=[],e=t,i=0,n=t.length;i<n;){if(e[i]<128){r.push(String.fromCharCode(e[i])),++i;continue}else if(!(e[i]<192)){if(e[i]<224){if(a._checkContinuation(e,i,1)){var o=(e[i]&31)<<6|e[i+1]&63;if(o>=128){r.push(String.fromCharCode(o&65535)),i+=2;continue}}}else if(e[i]<240){if(a._checkContinuation(e,i,2)){var l=(e[i]&15)<<12|(e[i+1]&63)<<6|e[i+2]&63;if(l>=2048&&(l&63488)!==55296){r.push(String.fromCharCode(l&65535)),i+=3;continue}}}else if(e[i]<248&&a._checkContinuation(e,i,3)){var u=(e[i]&7)<<18|(e[i+1]&63)<<12|(e[i+2]&63)<<6|e[i+3]&63;if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(u&1023|56320)),i+=4;continue}}}r.push("�"),++i}return r.join("")}},{key:"_checkContinuation",value:function(t,r,e){var i=t;if(r+e<i.length){for(;e--;)if((i[++r]&192)!==128)return!1;return!0}else return!1}}]),a}(),bs=function(){function a(){ue(this,a)}return ce(a,null,[{key:"parse",value:function(t){if(!(t.length<3)){var r={},e=a._parseValue(new DataView(t.buffer,t.byteOffset,t.byteLength)),i=a._parseValue(new DataView(t.buffer,t.byteOffset+e.size,t.byteLength-e.size));return r[e.data]=i.data,r}}},{key:"_parseValue",value:function(t){var r=t.byteLength,e=t.getUint8(0),i=1,n=!1,o;switch(e){case 0:o=t.getFloat64(1),i+=8;break;case 1:{o=!!t.getUint8(1),i+=1;break}case 2:{var l=a._parseString(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),u=l.data,c=l.size;o=u,i+=c}break;case 3:{o={};var d=0;for((t.getUint32(r-4)&16777215)===9&&(d=3);i<r-4;){var h=a._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-d)),p=h.size,v=h.data,Z=h.isEnd;if(Z)break;o[v.name]=v.value,i+=p}if(i<=r-3){var b=t.getUint32(i-1)&16777215;b===9&&(i+=3)}}break;case 8:{o={},i+=4;var L=0;for((t.getUint32(r-4)&16777215)===9&&(L=3);i<r-8;){var w=a._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-L)),W=w.size,X=w.data,S=w.isEnd;if(S)break;o[X.name]=X.value,i+=W}if(i<=r-3){var R=t.getUint32(i-1)&16777215;R===9&&(i+=3)}}break;case 9:o=void 0,i=1,n=!0;break;case 10:{o=[];var T=t.getUint32(1);i+=4;for(var V=0;V<T;V++){var Y=a._parseValue(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),I=Y.data,U=Y.size;o.push(I),i+=U}}break;case 11:{var f=t.getFloat64(i)+t.getInt16(i+8)*6e4;o=new Date(f),i+=10}break;case 12:{var m=t.getUint32(1);i+=4,o="",m>0&&(o=Ki.decode(new Uint8Array(t.buffer,t.byteOffset+i,m))),i+=m}break;default:i=r;break}return{data:o,size:i,isEnd:n}}},{key:"_parseString",value:function(t){var r=t.getUint16(0),e="";return r>0&&(e=Ki.decode(new Uint8Array(t.buffer,t.byteOffset+2,r))),{data:e,size:2+r}}},{key:"_parseObject",value:function(t){if(!(t.byteLength<3)){var r=a._parseString(t),e=a._parseValue(new DataView(t.buffer,t.byteOffset+r.size,t.byteLength-r.size));return{data:{name:r.data,value:e.data},size:r.size+e.size,isEnd:e.isEnd}}}}]),a}(),ot=new Rt("FlvDemuxer"),Hn=function(){function a(s,t,r){ue(this,a),_(this,"_headerParsed",!1),_(this,"_remainingData",null),_(this,"_gopId",0),_(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=s||new yr,this.audioTrack=t||new br,this.metadataTrack=r||new Zr,this._fixer=new hs(this.videoTrack,this.audioTrack,this.metadataTrack)}return ce(a,[{key:"demux",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.audioTrack,n=this.videoTrack,o=this.metadataTrack;if((r||!e)&&(this._remainingData=null),r&&(this._headerParsed=!1),r?(n.reset(),i.reset(),o.reset()):(n.samples=[],i.samples=[],o.seiSamples=[],o.flvScriptSamples=[],n.warnings=[],i.warnings=[],this._remainingData&&(t=Ne(this._remainingData,t),this._remainingData=null)),!t.length)return{videoTrack:n,audioTrack:i,metadataTrack:o};var l=0;if(!this._headerParsed){if(!a.probe(t))throw new Error("Invalid flv file");i.present=(t[4]&4)>>>2!==0,n.present=(t[4]&1)!==0,this._headerParsed=!0,l=D(t,5)+4}for(var u=t.length,c,d,h,p,v;l+15<u&&(c=t[l],d=t[l+1]<<16|t[l+2]<<8|t[l+3],!(l+15+d>u));)h=(t[l+7]<<24>>>0)+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6],l+=11,p=t.subarray(l,l+d),c===8?this._parseAudio(p,h):c===9?this._parseVideo(p,h):c===18?this._parseScript(p,h):ot.warn("Invalid tag type: ".concat(c)),l+=d,v=D(t,l),v!==11+d&&ot.warn("Invalid PrevTagSize ".concat(v," (").concat(11+d,")")),l+=4;return l<u&&(this._remainingData=t.subarray(l)),i.formatTimescale=n.formatTimescale=n.timescale=o.timescale=1e3,i.timescale=i.sampleRate||0,!i.exist()&&i.hasSample()&&i.reset(),!n.exist()&&n.hasSample()&&n.reset(),{videoTrack:n,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(t,r,e){return this._fixer.fix(t,r,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(t,r,e,i){return this.demux(t,r,e),this.fix(i,r,e)}},{key:"_parseAudio",value:function(t,r){if(t.length){var e=(t[0]&240)>>>4,i=this.audioTrack;if(e!==10&&e!==7&&e!==8){ot.warn("Unsupported sound format: ".concat(e)),i.reset();return}if(e!==10){var n=(t[0]&12)>>2,o=(t[0]&2)>>1,l=t[0]&1;i.sampleRate=a.AUDIO_RATE[n],i.sampleSize=o?16:8,i.channelCount=l+1}e===10?this._parseAac(t,r):this._parseG711(t,r,e)}}},{key:"_parseG711",value:function(t,r,e){var i=this.audioTrack;i.codecType=e===7?it.G711PCMA:it.G711PCMU,i.sampleRate=8e3,i.codec=i.codecType,i.samples.push(new nt(r,t.subarray(1)))}},{key:"_parseAac",value:function(t,r){var e=this.audioTrack;if(e.codecType=it.AAC,t[1]===0){var i=je.parseAudioSpecificConfig(t.subarray(2));i?(e.codec=i.codec,e.channelCount=i.channelCount,e.sampleRate=i.sampleRate,e.config=i.config,e.objectType=i.objectType,e.sampleRateIndex=i.samplingFrequencyIndex):(e.reset(),ot.warn("Cannot parse AudioSpecificConfig",t))}else if(t[1]===1){if(r==null)return;e.samples.push(new nt(r,t.subarray(2)))}else ot.warn("Unknown AACPacketType: ".concat(t[1]))}},{key:"_parseVideo",value:function(t,r){var e=this;if(!(t.length<6)){var i=(t[0]&240)>>>4,n=t[0]&15,o=this.videoTrack;if(n!==7&&n!==12){o.reset(),ot.warn("Unsupported codecId: ".concat(n));return}var l=n===12;o.codecType=l?rt.HEVC:rt.AVC;var u=t[1],c=(t[2]<<16|t[3]<<8|t[4])<<8>>8;if(u===0){var d=t.subarray(5),h=l?Br.parseHEVCDecoderConfigurationRecord(d):Pn.parseAVCDecoderConfigurationRecord(d);if(h){var p=h.hvcC,v=h.sps,Z=h.ppsArr,b=h.spsArr,L=h.vpsArr,w=h.nalUnitSize;p&&(o.hvcC=o.hvcC||p),v&&(o.codec=v.codec,o.width=v.width,o.height=v.height,o.sarRatio=v.sarRatio,o.fpsNum=v.fpsNum,o.fpsDen=v.fpsDen),b.length&&(o.sps=b),Z.length&&(o.pps=Z),L&&L.length&&(o.vps=L),w&&(o.nalUnitSize=w)}else ot.warn("Cannot parse ".concat(l?"HEVC":"AVC","DecoderConfigurationRecord"),t)}else if(u===1){var W=qe.parseAvcC(t.subarray(5),o.nalUnitSize);if(W=this._checkAddMetaNalToUnits(l,W,o),W&&W.length){var X=new Et(r+c,r,W);i===1&&X.setToKeyframe(),o.samples.push(X),W.forEach(function(S){var R=l?S[0]>>>1&63:S[0]&31;switch(R){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!l&&R!==5||l&&R===5)break;X.setToKeyframe();break;case 6:case 39:case 40:if(!l&&R!==6||l&&R===6)break;e.metadataTrack.seiSamples.push(new En(qe.parseSEI(qe.removeEPB(S),l),r+c));break}}),X.keyframe&&this._gopId++,X.gopId=this._gopId}else ot.warn("Cannot parse NALUs",t)}else u===2||ot.warn("Unknown AVCPacketType: ".concat(u))}}},{key:"_checkAddMetaNalToUnits",value:function(t,r,e){if(!t||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,r;var i=r.map(function(n){return n[0]>>>1&63});return i.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,r):(r.unshift(e.pps[0]),r.unshift(e.sps[0]),r.unshift(e.vps[0]),r.filter(Boolean))}},{key:"_parseScript",value:function(t,r){this.metadataTrack.flvScriptSamples.push(new ss(bs.parse(t),r))}}],[{key:"probe",value:function(t){return t[0]!==70||t[1]!==76||t[2]!==86||t[3]!==1?!1:D(t,5)>=9}}]),a}();_(Hn,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var Zs=9e4/2,Pi=3,qt=9e4,xr=5*9e4,Mr=9e4,gs=9e4/2,Ss=9e4*5,Ls=function(){function a(s,t,r,e){ue(this,a),this.videoTrack=s,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseVideoDts=-1,this._baseAudioDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._needForceFixLargeGap=e==null?void 0:e.forceFixLargeGap,this._largeGapThreshold=(e==null?void 0:e.largeGapThreshold)||Ss}return ce(a,[{key:"fix",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;r=Math.round(r*9e4);var n=this.videoTrack,o=this.audioTrack,l=n.samples,u=o.samples;if(!(!l.length&&!u.length)){var c=l[0],d=u[0],h=0;if(l.length&&u.length&&(h=c.dts-d.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),e&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=r,this._baseAudioDts-=r,this._baseVideoDts-=r),!i){this._videoNextDts=h>0?r+h:r,this._audioNextPts=h>0?r:r-h,this._needForceFixLargeGap&&(this._videoNextDts=0,this._audioNextPts=0);var p=c?c.dts-this._baseDts-this._videoNextDts:0,v=d?d.pts-this._baseDts-this._audioNextPts:0;Math.abs(p||v)>Mr&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=r)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._fixVideo(n),this.metadataTrack.exist()){var Z=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(b){b.pts=b.originPts-t._baseDts,b.time=Math.max(0,b.pts)/Z})}n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/9e4)}}},{key:"_fixVideo",value:function(t){var r=this,e=t.samples;if(e.length){if(e.forEach(function(T){T.dts-=r._needForceFixLargeGap?r._baseVideoDts:r._baseDts,T.pts-=r._needForceFixLargeGap?r._baseVideoDts:r._baseDts}),this._videoNextDts===void 0){var i=e[0];this._videoNextDts=i.dts}var n=e.length,o=0,l=e[0],u=e[1],c=this._videoNextDts-l.dts;if(Math.abs(c)>gs){var d;if(t.warnings.push({type:pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:l.dts/90,nextSampleDts:(((d=e[1])===null||d===void 0?void 0:d.dts)||0)/90,sampleDuration:c/90}),l.dts+=c,l.pts+=c,u&&Math.abs(u.dts-l.dts)>Mr)this._videoTimestampBreak=!0,e.forEach(function(T,V){V!==0&&(T.dts+=c,T.pts+=c)});else for(var h=1;h<n-1;h++){var p,v=(p=e[h])===null||p===void 0?void 0:p.dts,Z=e[h-1].dts;v&&v-Z<0&&(e[h].dts+=c,e[h].pts+=c)}}var b;if(t.fpsNum&&t.fpsDen&&(b=t.timescale*(t.fpsDen/t.fpsNum)),b<90*10&&(b=0),!b){var L=t.samples[0],w=t.samples[1];b=n===1?9e3:Math.floor(w.dts-L.dts)}for(var W=0;W<n;W++){var X=e[W].dts,S=e[W+1];if(W<n-1?o=S.dts-X:e[W-1]?o=Math.min(X-e[W-1].dts,b):o=b,o>Mr||o<0){this._videoTimestampBreak=!0,o=this._audioTimestampBreak?b:Math.max(o,30*90);var R=this._audioNextPts||0;S&&S.dts>R&&(o=b),t.warnings.push({type:pe.LARGE_VIDEO_GAP,time:X/t.timescale,dts:X,originDts:e[W].originDts,nextDts:this._videoNextDts,sampleDuration:o,refSampleDuration:b})}e[W].duration=o,this._videoNextDts+=o}}}},{key:"_fixAudio",value:function(t){var r=this,e=t.samples;e.length&&(e.forEach(function(i){i.pts-=r._needForceFixLargeGap?r._baseAudioDts:r._baseDts,i.dts=i.pts}),this._doFixAudioInternal(t,e,9e4))}},{key:"_calculateBaseDts",value:function(t,r){var e=t.samples,i=r.samples;if(!e.length&&!i.length)return!1;var n=1/0,o=1/0;e.length&&(t.baseDts=n=e[0].pts,this._baseAudioDts=n),i.length&&(r.baseDts=o=i[0].dts,this._baseVideoDts=o),this._baseDts=Math.min(n,o);var l=o-n,u=!1;return Number.isFinite(l)&&Math.abs(l)>Zs&&r.warnings.push({type:pe.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:n,baseDts:this._baseDts,delta:l}),Number.isFinite(l)&&Math.abs(l)>this._largeGapThreshold*qt&&(u=!0),this._baseDtsInited||(u&&this._needForceFixLargeGap?this._needForceFixLargeGap=!0:this._needForceFixLargeGap=!1),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var t=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!t)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(t,r,e){t.sampleDuration||(t.sampleDuration=je.getFrameDuration(t.timescale,e));var i=t.sampleDuration;if(this._audioNextPts===void 0){var n=r[0];this._audioNextPts=n.pts}for(var o=0;o<r.length;o++){var l=this._audioNextPts,u=r[o],c=u.pts-l;if(!this._audioTimestampBreak&&c>=Pi*i&&c<=qt&&!Cn){var d=je.getSilentFrame(t.codec,t.channelCount)||r[0].data.subarray(),h=Math.floor(c/i);Math.abs(u.pts-this._lastAudioExceptionGapDot)>xr&&(this._lastAudioExceptionGapDot=u.pts),t.warnings.push({type:pe.AUDIO_FILLED,pts:u.pts/90,originPts:u.originPts,count:h,nextPts:l/90,refSampleDuration:i});for(var p=0;p<h;p++){var v=new nt(Math.floor(l),d);v.originPts=Math.floor(this._baseDts+l),r.splice(o,0,v),this._audioNextPts+=i,o++}o--}else c<=-Pi*i&&c>=-1*qt?(Math.abs(u.pts-this._lastAudioExceptionOverlapDot)>xr&&(this._lastAudioExceptionOverlapDot=u.pts,t.warnings.push({type:pe.AUDIO_DROPPED,pts:u.pts/90,originPts:u.originPts,nextPts:l/90,refSampleDuration:i})),r.splice(o,1),o--):(Math.abs(c)>=qt&&(this._audioTimestampBreak=!0,Math.abs(u.pts-this._lastAudioExceptionLargeGapDot)>xr&&(this._lastAudioExceptionLargeGapDot=u.pts,t.warnings.push({type:pe.LARGE_AUDIO_GAP,time:u.pts/1e3,pts:u.pts/90,originPts:u.originPts,nextPts:l/90,sampleDuration:c,refSampleDuration:i}))),u.dts=u.pts=l,this._audioNextPts+=i)}}}]),a}(),Be=new Rt("TsDemuxer"),Nn=function(){function a(s,t,r){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ue(this,a),_(this,"_pmtId",-1),_(this,"_remainingPacketData",null),_(this,"_videoPesData",[]),_(this,"_audioPesData",[]),_(this,"_gopId",0),this.videoTrack=s||new yr,this.audioTrack=t||new br,this.metadataTrack=r||new Zr,this._fixer=new Ls(this.videoTrack,this.audioTrack,this.metadataTrack,e)}return ce(a,[{key:"demux",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.audioTrack,n=this.videoTrack,o=this.metadataTrack;r&&(this._pmtId=-1,n.reset(),i.reset(),o.reset()),!e||r?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(n.samples=[],i.samples=[],o.seiSamples=[],n.warnings=[],i.warnings=[],this._remainingPacketData&&(t=Ne(this._remainingPacketData,t),this._remainingPacketData=null));var l=t.length,u=l%188;u&&(this._remainingPacketData=t.subarray(l-u),l-=u);for(var c=n.pid,d=i.pid,h=0;h<l;h+=188){if(t[h]!==71)throw new Error("TS packet did not start with 0x47");var p=!!(t[h+1]&64),v=((t[h+1]&31)<<8)+t[h+2],Z=(t[h+3]&48)>>4,b=void 0;if(Z>1){if(b=h+5+t[h+4],b===h+188)continue}else b=h+4;switch(v){case 0:p&&(b+=t[b]+1),this._pmtId=(t[b+10]&31)<<8|t[b+11];break;case this._pmtId:{p&&(b+=t[b]+1);var L=b+3+((t[b+1]&15)<<8|t[b+2])-4,w=(t[b+10]&15)<<8|t[b+11];for(b+=12+w;b<L;){var W=(t[b+1]&31)<<8|t[b+2];switch(t[b]){case 15:i.pid=d=W;break;case 27:if(c!==-1)break;n.codecType=rt.AVC,n.pid=c=W;break;case 36:if(c!==-1)break;n.codecType=rt.HEVC,n.pid=c=W;break;default:Be.warn("Unsupported stream. type: ".concat(t[b],", pid: ").concat(W))}b+=((t[b+3]&15)<<8|t[b+4])+5}}break;case c:p&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(t.subarray(b,h+188));break;case d:p&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(t.subarray(b,h+188));break;case 17:case 8191:break;default:Be.warn("Unknown pid: ".concat(v))}}return this._parseVideoData(),this._parseAudioData(),i.formatTimescale=n.formatTimescale=n.timescale=o.timescale=9e4,i.timescale=i.sampleRate||0,{videoTrack:n,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(t,r,e){return this._fixer.fix(t,r,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(t,r,e,i){return this.demux(t,r,e),this.fix(i,r,e)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=a._parsePES(Ne.apply(void 0,ke(this._videoPesData)));if(!t){Be.warn("Cannot parse video pes",this._videoPesData);return}var r=qe.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):Be.warn("Cannot parse avc units",t),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(t,r,e){var i=this;if(t.length){var n=this.videoTrack,o=n.codecType===rt.HEVC,l=new Et(r,e);t.forEach(function(u){var c=o?u[0]>>>1&63:u[0]&31;switch(c){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&c!==5||o&&c===5)break;l.setToKeyframe(),i._gopId++;break;case 6:case 39:case 40:if(!o&&c!==6||o&&c===6)break;i.metadataTrack.seiSamples.push(new En(qe.parseSEI(qe.removeEPB(u),o),r));return;case 32:if(!o)break;if(!n.vps.length){var d=Br.parseVPS(qe.removeEPB(u),n.hvcC);n.hvcC=n.hvcC||d,n.vps=[u]}break;case 7:case 33:if(!o&&c!==7||o&&c===7)break;if(!n.sps.length){var h=qe.removeEPB(u),p=o?Br.parseSPS(h,n.hvcC):Pn.parseSPS(h);n.sps=[u],n.hvcC=n.hvcC||p.hvcC,n.codec=p.codec,n.width=p.width,n.height=p.height,n.sarRatio=p.sarRatio,n.fpsNum=p.fpsNum,n.fpsDen=p.fpsDen}break;case 8:case 34:if(!o&&c!==8||o&&c===8)break;n.pps.length||(n.pps=[u]);break;case 9:case 35:break;case 38:if(o){for(var v=!1,Z=2;Z<u.byteLength;Z++)if(u[Z]===255){v=!0;break}if(!v)return}break}l.units.push(u)}),l.gopId=this._gopId,this._pushVideoSample(n,l)}}},{key:"_pushVideoSample",value:function(t,r){if(r.units.length)if(r.pts===null||r.pts===void 0){Be.warn("Video sample no pts",r);var e=t.samples[t.samples.length-1];e?(r.pts=e.pts,r.dts=e.dts):Be.warn("Drop video sample",r)}else t.samples.push(r)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=a._parsePES(Ne.apply(void 0,ke(this._audioPesData)));if(!t){Be.warn("Cannot parse audio pes",this._audioPesData);return}this._parseAacData(t),this._audioPesData=[]}}},{key:"_parseAacData",value:function(t){var r=this.audioTrack,e=t.pts;if(e==null){if(Be.warn("AAC pes not pts",r),!r.samples.length||!r.sampleRate)return;e=r.samples[r.samples.length-1].pts+je.getFrameDuration(r.sampleRate)}var i=je.parseADTS(t.data,e);if(i){var n;r.codec=i.codec,r.channelCount=i.channelCount,r.sampleRate=i.sampleRate,r.objectType=i.objectType,r.sampleRateIndex=i.samplingFrequencyIndex,r.config=i.config,(n=r.samples).push.apply(n,ke(i.frames.map(function(o){return new nt(o.pts,o.data)}))),i.skip&&Be.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&Be.warn("Remaining aac adts ".concat(i.remaining," bits"))}else Be.warn("Cannot parse aac adts",t)}}],[{key:"probe",value:function(t){return t.length?t[0]===71&&t[188]===71&&t[376]===71:!1}},{key:"_parsePES",value:function(t){var r=t[8];if(!(r==null||t.length<r+9)){var e=t[0]<<16|t[1]<<8|t[2];if(e===1){var i=(t[4]<<8)+t[5];if(!(i&&i>t.length-6)){var n,o,l=t[7];return l&192&&(n=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,l&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,n-o>60*9e4&&(n=o)):o=n),{data:t.subarray(9+r),pts:n,dts:o}}}}}}]),a}(),Yr=function(){function a(s,t,r){ue(this,a),this.dv=new DataView(s),this.start=this.offset=t||this.dv.byteOffset,this.end=r?this.start+r:this.start+this.dv.byteLength}return ce(a,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(t){var r=0;switch(t){case 4:r=this.dv.getFloat32(this.offset);break;case 8:r=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(t,"-byte float is not supported"))}return this.offset+=t,r}},{key:"back",value:function(t){this.offset-=t}},{key:"skip",value:function(t){this.offset+=t}},{key:"readInt",value:function(t){var r=this.offset;switch(this.offset+=t,t){case 1:return this.dv.getInt8(r);case 2:return this.dv.getInt16(r);case 4:return this.dv.getInt32(r);default:throw new Error("read ".concat(t,"-byte integers is not supported"))}}},{key:"read",value:function(t){var r=this.offset;switch(this.offset+=t,t){case 1:return this.dv.getUint8(r);case 2:return this.dv.getUint16(r);case 3:return(this.dv.getUint16(r)<<8)+this.dv.getUint8(r+2);case 4:return this.dv.getUint32(r);default:return this.back(t-4),this.read(t-4)+this.dv.getUint32(r)*Math.pow(256,t-4)}}},{key:"write",value:function(t,r){var e=this.offset;switch(this.offset+=t,t){case 1:return this.dv.setUint8(e,r);case 2:return this.dv.setUint16(e,r);case 3:return this.dv.setUint8(e,r>>>16),this.dv.setUint16(e+1,65535&r);case 4:return this.dv.setUint32(e,r);default:throw new Error("write ".concat(t,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(t){var r;return this.offset||t?r=this.dv.buffer.slice(this.offset,t?this.offset+t:this.end):r=this.dv.buffer,this.offset+=r.byteLength,r}},{key:"readToUint8",value:function(t){var r=new Uint8Array(this.dv.buffer,this.offset,t||this.unreadLength);return this.offset+=r.byteLength,r}},{key:"readString",value:function(t){for(var r=0,e="";r<t;r++)e+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return e}}],[{key:"fromUint8",value:function(t){return new a(t.buffer,t.byteOffset,t.byteLength)}},{key:"concatUint8s",value:function(t){var r=new Uint8Array(t.reduce(function(i,n){return i+n.byteLength},0)),e=0;return t.forEach(function(i){r.set(i,e),e+=i.byteLength}),r}},{key:"concatUint8",value:function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return this.concatUint8s(r)}}]),a}(),Xs=function(){function a(s,t){ue(this,a),this.offset=0,this.val=s,this.size=t}return ce(a,[{key:"skip",value:function(t){this.offset+=t}},{key:"read",value:function(t){var r=this.size-this.offset-t;if(r>=0){var e=0,i=0;if(this.offset+=t,this.size>31){for(;i<t;i++)e+=Math.pow(2,i);return this.val/Math.pow(2,r)&e}else{for(;i<t;i++)e+=1<<i;return this.val>>>r&e}}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(t,r){return new a(t.read(r),r<<3)}}]),a}(),$=function(){function a(){ue(this,a)}return ce(a,null,[{key:"findBox",value:function(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[];if(!t)return i;for(var n=0,o="",l=0;t.length>7;){if(n=D(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),l=8,n===1?(n=gt(t,8),l+=8):n||(n=t.length),!r[0]||o===r[0]){var u=t.subarray(0,n);if(r.length<2)i.push({start:e,size:n,headerSize:l,type:o,data:u});else return a.findBox(u.subarray(l),r.slice(1),e+l)}e+=n,t=t.subarray(n)}return i}},{key:"tfhd",value:function(t){return B(t,!0,function(r,e){r.trackId=D(e);var i=4,n=r.flags&255&1,o=r.flags&255&2,l=r.flags&255&8,u=r.flags&255&16,c=r.flags&255&32;n&&(i+=4,r.baseDataOffset=D(e,i),i+=4),o&&(r.sampleDescriptionIndex=D(e,i),i+=4),l&&(r.defaultSampleDuration=D(e,i),i+=4),u&&(r.defaultSampleSize=D(e,i),i+=4),c&&(r.defaultSampleFlags=D(e,i))})}},{key:"sidx",value:function(t){return B(t,!0,function(r,e){var i=0;r.reference_ID=D(e,i),i+=4,r.timescale=D(e,i),i+=4,r.version===0?(r.earliest_presentation_time=D(e,i),i+=4,r.first_offset=D(e,i),i+=4):(r.earliest_presentation_time=gt(e,i),i+=8,r.first_offset=gt(e,i),i+=8),i+=2,r.references=[];var n=de(e,i);i+=2;for(var o=0;o<n;o++){var l={};r.references.push(l);var u=D(e,i);i+=4,l.reference_type=u>>31&1,l.referenced_size=u&2147483647,l.subsegment_duration=D(e,i),i+=4,u=D(e,i),i+=4,l.starts_with_SAP=u>>31&1,l.SAP_type=u>>28&7,l.SAP_delta_time=u&268435455}})}},{key:"moov",value:function(t){return B(t,!1,function(r,e,i){r.mvhd=a.mvhd(a.findBox(e,["mvhd"],i)[0]),r.trak=a.findBox(e,["trak"],i).map(function(n){return a.trak(n)}),r.pssh=a.pssh(a.findBox(e,["pssh"],i)[0])})}},{key:"mvhd",value:function(t){return B(t,!0,function(r,e){var i=0;r.version===1?(r.timescale=D(e,16),r.duration=gt(e,20),i+=28):(r.timescale=D(e,8),r.duration=D(e,12),i+=16),r.nextTrackId=D(e,i+76)})}},{key:"trak",value:function(t){return B(t,!1,function(r,e,i){r.tkhd=a.tkhd(a.findBox(e,["tkhd"],i)[0]),r.mdia=a.mdia(a.findBox(e,["mdia"],i)[0])})}},{key:"tkhd",value:function(t){return B(t,!0,function(r,e){var i=Yr.fromUint8(e);r.version===1?(i.read(8),i.read(8),r.trackId=i.read(4),i.read(4),r.duration=i.read(8)):(i.read(4),i.read(4),r.trackId=i.read(4),i.read(4),r.duration=i.read(4)),i.skip(16),r.matrix=[];for(var n=0;n<36;n++)r.matrix.push(i.read(1));i.back(36);for(var o=[],l=0,u;l<3;l++)o.push(kr(i.readInt(2),i.readInt(2))),o.push(kr(i.readInt(2),i.readInt(2))),u=i.readInt(4),o.push(kr(u>>30,u&1073741823));r.rotation=ys(o),r.width=i.read(4),r.height=i.read(4)})}},{key:"mdia",value:function(t){return B(t,!1,function(r,e,i){r.mdhd=a.mdhd(a.findBox(e,["mdhd"],i)[0]),r.hdlr=a.hdlr(a.findBox(e,["hdlr"],i)[0]),r.minf=a.minf(a.findBox(e,["minf"],i)[0])})}},{key:"mdhd",value:function(t){return B(t,!0,function(r,e){var i=0;r.version===1?(r.timescale=D(e,16),r.duration=gt(e,20),i+=28):(r.timescale=D(e,8),r.duration=D(e,12),i+=16);var n=de(e,i);r.language=String.fromCharCode((n>>10&31)+96,(n>>5&31)+96,(n&31)+96)})}},{key:"hdlr",value:function(t){return B(t,!0,function(r,e){r.version===0&&(r.handlerType=String.fromCharCode.apply(null,e.subarray(4,8)))})}},{key:"minf",value:function(t){return B(t,!1,function(r,e,i){r.vmhd=a.vmhd(a.findBox(e,["vmhd"],i)[0]),r.smhd=a.smhd(a.findBox(e,["smhd"],i)[0]),r.stbl=a.stbl(a.findBox(e,["stbl"],i)[0])})}},{key:"vmhd",value:function(t){return B(t,!0,function(r,e){r.graphicsmode=de(e),r.opcolor=[de(e,2),de(e,4),de(e,6)]})}},{key:"smhd",value:function(t){return B(t,!0,function(r,e){r.balance=de(e)})}},{key:"stbl",value:function(t){return B(t,!1,function(r,e,i){var n,o,l;r.stsd=a.stsd(a.findBox(e,["stsd"],i)[0]),r.stts=a.stts(a.findBox(e,["stts"],i)[0]),r.ctts=a.ctts(a.findBox(e,["ctts"],i)[0]),r.stsc=a.stsc(a.findBox(e,["stsc"],i)[0]),r.stsz=a.stsz(a.findBox(e,["stsz"],i)[0]),r.stco=a.stco(a.findBox(e,["stco"],i)[0]),r.stco||(r.co64=a.co64(a.findBox(e,["co64"],i)[0]),r.stco=r.co64);var u=(n=r.stsd.entries[0])===null||n===void 0||(o=n.sinf)===null||o===void 0||(l=o.schi)===null||l===void 0?void 0:l.tenc.default_IV_size;r.stss=a.stss(a.findBox(e,["stss"],i)[0]),r.senc=a.senc(a.findBox(e,["senc"],i)[0],u)})}},{key:"senc",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return B(t,!0,function(e,i){var n=0,o=D(i,n);n+=4,e.samples=[];for(var l=0;l<o;l++){var u={};u.InitializationVector=[];for(var c=0;c<r;c++)u.InitializationVector[c]=i[n+c];if(n+=r,e.flags&2){u.subsamples=[];var d=de(i,n);n+=2;for(var h=0;h<d;h++){var p={};p.BytesOfClearData=de(i,n),n+=2,p.BytesOfProtectedData=D(i,n),n+=4,u.subsamples.push(p)}}e.samples.push(u)}})}},{key:"pssh",value:function(t){return B(t,!0,function(r,e){for(var i=[],n=[],o=0,l=0;l<16;l++)n.push(_r(e[o+l]));if(o+=16,r.version>0){var u=D(e,o);o+=4;for(var c=0;c<(""+u).length;c++)for(var d=0;d<16;d++){var h=e[o];o+=1,i.push(_r(h))}}var p=D(e,o);r.data_size=p,o+=4,r.kid=i,r.system_id=n,r.buffer=e})}},{key:"stsd",value:function(t){return B(t,!0,function(r,e,i){r.entryCount=D(e),r.entries=a.findBox(e.subarray(4),[],i+4).map(function(n){switch(n.type){case"av01":return a.av01(n);case"avc1":case"avc2":case"avc3":case"avc4":return a.avc1(n);case"hvc1":case"hev1":return a.hvc1(n);case"mp4a":return a.mp4a(n);case"alaw":case"ulaw":return a.alaw(n);case"enca":return B(n,!1,function(o,l,u){o.channelCount=de(l,16),o.samplesize=de(l,18),o.sampleRate=D(l,24)/65536,l=l.subarray(28),o.sinf=a.sinf(a.findBox(l,["sinf"],u)[0]),o.esds=a.esds(a.findBox(l,["esds"],u)[0])});case"encv":return B(n,!1,function(o,l,u){o.width=de(l,24),o.height=de(l,26),o.horizresolution=D(l,28),o.vertresolution=D(l,32),l=l.subarray(78),o.sinf=a.sinf(a.findBox(l,["sinf"],u)[0]),o.avcC=a.avcC(a.findBox(l,["avcC"],u)[0]),o.hvcC=a.hvcC(a.findBox(l,["hvcC"],u)[0]),o.pasp=a.pasp(a.findBox(l,["pasp"],u)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(t){return B(t,!1,function(r,e){var i=6;r.default_IsEncrypted=e[i],i+=1,r.default_IV_size=e[i],i+=1,r.default_KID=[];for(var n=0;n<16;n++)r.default_KID.push(_r(e[i])),i+=1})}},{key:"schi",value:function(t){return B(t,!1,function(r,e,i){r.tenc=a.tenc(a.findBox(e,["tenc"],i)[0])})}},{key:"sinf",value:function(t){return B(t,!1,function(r,e,i){r.schi=a.schi(a.findBox(e,["schi"],i)[0]),r.frma=a.frma(a.findBox(e,["frma"],i)[0])})}},{key:"frma",value:function(t){return B(t,!1,function(r,e){r.data_format="";for(var i=0;i<4;i++)r.data_format+=String.fromCharCode(e[i])})}},{key:"colr",value:function(t){return B(t,!1,function(r,e){var i=Yr.fromUint8(e);r.data=t.data,r.colorType=i.readString(4),r.colorType==="nclx"?(r.colorPrimaries=i.read(2),r.transferCharacteristics=i.read(2),r.matrixCoefficients=i.read(2),r.fullRangeFlag=i.read(1)>>7):(r.colorType==="rICC"||r.colorType==="prof")&&(r.iccProfile=e.readToUint8())})}},{key:"av01",value:function(t){return B(t,!1,function(r,e,i){var n=Ir(r,e),o=e.subarray(n);i+=n,r.av1C=a.av1C(a.findBox(o,["av1C"],i)[0]),r.colr=a.colr(a.findBox(o,["colr"],i)[0])})}},{key:"av1C",value:function(t){return B(t,!1,function(r,e){r.data=t.data;var i=Yr.fromUint8(e),n=Xs.fromByte(i,4);r.marker=n.read(1),r.version=n.read(7),r.seqProfile=n.read(3),r.seqLevelIdx0=n.read(5),r.seqTier0=n.read(1),r.highBitdepth=n.read(1),r.twelveBit=n.read(1),r.monochrome=n.read(1),r.chromaSubsamplingX=n.read(1),r.chromaSubsamplingY=n.read(1),r.chromaSamplePosition=n.read(2),r.reserved=n.read(3),r.initialPresentationDelayPresent=n.read(1),r.initialPresentationDelayPresent?r.initialPresentationDelayMinusOne=n.read(4):r.initialPresentationDelayMinusOne=0,r.configOBUs=i.readToUint8();var o;r.seqLevelIdx0===2&&r.highBitdepth===1?o=r.twelveBit===1?"12":"10":r.seqProfile<=2&&(o=r.highBitdepth===1?"10":"08"),r.codec=["av01",r.seqProfile,(r.seqLevelIdx0<10?"0"+r.seqLevelIdx0:r.seqLevelIdx0)+(r.seqTier0?"H":"M"),o].join(".")})}},{key:"avc1",value:function(t){return B(t,!1,function(r,e,i){var n=Ir(r,e),o=e.subarray(n);i+=n,r.avcC=a.avcC(a.findBox(o,["avcC"],i)[0]),r.pasp=a.pasp(a.findBox(o,["pasp"],i)[0])})}},{key:"avcC",value:function(t){return B(t,!1,function(r,e){r.data=t.data,r.configurationVersion=e[0],r.AVCProfileIndication=e[1],r.profileCompatibility=e[2],r.AVCLevelIndication=e[3],r.codec=Kn([e[1],e[2],e[3]]),r.lengthSizeMinusOne=e[4]&3,r.spsLength=e[5]&31,r.sps=[];for(var i=6,n=0;n<r.spsLength;n++){var o=de(e,i);i+=2,r.sps.push(e.subarray(i,i+o)),i+=o}r.ppsLength=e[i],i+=1,r.pps=[];for(var l=0;l<r.ppsLength;l++){var u=de(e,i);i+=2,r.pps.push(e.subarray(i,i+=u)),i+=u}})}},{key:"hvc1",value:function(t){return B(t,!1,function(r,e,i){var n=Ir(r,e),o=e.subarray(n);i+=n,r.hvcC=a.hvcC(a.findBox(o,["hvcC"],i)[0]),r.pasp=a.pasp(a.findBox(o,["pasp"],i)[0])})}},{key:"hvcC",value:function(t){return B(t,!1,function(r,e){r.data=t.data,r.codec="hev1.1.6.L93.B0",r.configurationVersion=e[0];var i=e[1];r.generalProfileSpace=i>>6,r.generalTierFlag=(i&32)>>5,r.generalProfileIdc=i&31,r.generalProfileCompatibility=D(e,2),r.generalConstraintIndicatorFlags=e.subarray(6,12),r.generalLevelIdc=e[12],r.avgFrameRate=de(e,19),r.numOfArrays=e[22],r.vps=[],r.sps=[],r.pps=[];for(var n=23,o=0,l=0,u=0,c=0;c<r.numOfArrays;c++){o=e[n]&63,l=de(e,n+1),n+=3;for(var d=[],h=0;h<l;h++)u=de(e,n),n+=2,d.push(e.subarray(n,n+u)),n+=u;if(o===32){var p;(p=r.vps).push.apply(p,d)}else if(o===33){var v;(v=r.sps).push.apply(v,d)}else if(o===34){var Z;(Z=r.pps).push.apply(Z,d)}}})}},{key:"pasp",value:function(t){return B(t,!1,function(r,e){r.hSpacing=D(e),r.vSpacing=D(e,4)})}},{key:"mp4a",value:function(t){return B(t,!1,function(r,e,i){var n=Ni(r,e);r.esds=a.esds(a.findBox(e.subarray(n),["esds"],i+n)[0])})}},{key:"esds",value:function(t){return B(t,!0,function(r,e){r.codec="mp4a.";for(var i=0,n=0,o=0,l=0;e.length;){for(i=0,l=e[i],n=e[i+1],i+=2;n&128;)o=(n&127)<<7,n=e[i],i+=1;if(o+=n&127,l===3)e=e.subarray(i+3);else if(l===4)r.codec+=(e[i].toString(16)+".").padStart(3,"0"),e=e.subarray(i+13);else if(l===5){var u=r.config=e.subarray(i,i+o),c=(u[0]&248)>>3;c===31&&u.length>=2&&(c=32+((u[0]&7)<<3)+((u[1]&224)>>5)),r.objectType=c,r.codec+=c.toString(16),r.codec[r.codec.length-1]==="."&&(r.codec=r.codec.substring(0,r.codec.length-1));return}else{r.codec[r.codec.length-1]==="."&&(r.codec=r.codec.substring(0,r.codec.length-1));return}}})}},{key:"alaw",value:function(t){return B(t,!1,function(r,e){Ni(r,e)})}},{key:"stts",value:function(t){return B(t,!0,function(r,e){for(var i=D(e),n=[],o=4,l=0;l<i;l++)n.push({count:D(e,o),delta:D(e,o+4)}),o+=8;r.entryCount=i,r.entries=n})}},{key:"ctts",value:function(t){return B(t,!0,function(r,e){var i=D(e),n=[],o=4;if(r.version===1)for(var l=0;l<i;l++)n.push({count:D(e,o),offset:D(e,o+4)}),o+=8;else for(var u=0;u<i;u++)n.push({count:D(e,o),offset:-(~D(e,o+4)+1)}),o+=8;r.entryCount=i,r.entries=n})}},{key:"stsc",value:function(t){return B(t,!0,function(r,e){for(var i=D(e),n=[],o=4,l=0;l<i;l++)n.push({firstChunk:D(e,o),samplesPerChunk:D(e,o+4),sampleDescriptionIndex:D(e,o+8)}),o+=12;r.entryCount=i,r.entries=n})}},{key:"stsz",value:function(t){return B(t,!0,function(r,e){var i=D(e),n=D(e,4),o=[];if(!i)for(var l=8,u=0;u<n;u++)o.push(D(e,l)),l+=4;r.sampleSize=i,r.sampleCount=n,r.entrySizes=o})}},{key:"stco",value:function(t){return B(t,!0,function(r,e){for(var i=D(e),n=[],o=4,l=0;l<i;l++)n.push(D(e,o)),o+=4;r.entryCount=i,r.entries=n})}},{key:"co64",value:function(t){return B(t,!0,function(r,e){for(var i=D(e),n=[],o=4,l=0;l<i;l++)n.push(gt(e,o)),o+=8;r.entryCount=i,r.entries=n})}},{key:"stss",value:function(t){return B(t,!0,function(r,e){for(var i=D(e),n=[],o=4,l=0;l<i;l++)n.push(D(e,o)),o+=4;r.entryCount=i,r.entries=n})}},{key:"moof",value:function(t){return B(t,!1,function(r,e,i){r.mfhd=a.mfhd(a.findBox(e,["mfhd"],i)[0]),r.traf=a.findBox(e,["traf"],i).map(function(n){return a.traf(n)})})}},{key:"mfhd",value:function(t){return B(t,!0,function(r,e){r.sequenceNumber=D(e)})}},{key:"traf",value:function(t){return B(t,!1,function(r,e,i){r.tfhd=a.tfhd(a.findBox(e,["tfhd"],i)[0]),r.tfdt=a.tfdt(a.findBox(e,["tfdt"],i)[0]),r.trun=a.trun(a.findBox(e,["trun"],i)[0])})}},{key:"trun",value:function(t){return B(t,!0,function(r,e){var i=r.version,n=r.flags,o=e.length,l=r.sampleCount=D(e),u=4;if(o>u&&n&1&&(r.dataOffset=-(~D(e,u)+1),u+=4),o>u&&n&4&&(r.firstSampleFlags=D(e,u),u+=4),r.samples=[],o>u)for(var c,d=0;d<l;d++)c={},n&256&&(c.duration=D(e,u),u+=4),n&512&&(c.size=D(e,u),u+=4),n&1024&&(c.flags=D(e,u),u+=4),n&2048&&(i?c.cts=-(~D(e,u+4)+1):c.cts=D(e,u),u+=4),r.samples.push(c)})}},{key:"tfdt",value:function(t){return B(t,!0,function(r,e){r.version===1?r.baseMediaDecodeTime=gt(e):r.baseMediaDecodeTime=D(e)})}},{key:"probe",value:function(t){return!!a.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(t){return{isLeading:(t[0]&12)>>>2,dependsOn:t[0]&3,isDependedOn:(t[1]&192)>>>6,hasRedundancy:(t[1]&48)>>>4,paddingValue:(t[1]&14)>>>1,isNonSyncSample:t[1]&1,degradationPriority:t[2]<<8|t[3]}}},{key:"moovToTrack",value:function(t,r,e){var i,n,o=t.trak;if(!(!o||!o.length)){var l=o.find(function(Wr){var bt,Zt;return((bt=Wr.mdia)===null||bt===void 0||(Zt=bt.hdlr)===null||Zt===void 0?void 0:Zt.handlerType)==="vide"}),u=o.find(function(Wr){var bt,Zt;return((bt=Wr.mdia)===null||bt===void 0||(Zt=bt.hdlr)===null||Zt===void 0?void 0:Zt.handlerType)==="soun"});if(l&&r){var c,d,h,p,v,Z,b,L=r,w=(c=l.tkhd)===null||c===void 0?void 0:c.trackId;w!=null&&(L.id=l.tkhd.trackId),L.tkhdDuration=l.tkhd.duration,L.mvhdDurtion=t.mvhd.duration,L.mvhdTimecale=t.mvhd.timescale,L.timescale=L.formatTimescale=l.mdia.mdhd.timescale,L.duration=l.mdia.mdhd.duration||L.mvhdDurtion/L.mvhdTimecale*L.timescale,L.rotation=l.tkhd.rotation,L.matrix=l.tkhd.matrix;var W=l.mdia.minf.stbl.stsd.entries[0];if(L.width=W.width,L.height=W.height,W.pasp&&(L.sarRatio=[W.pasp.hSpacing,W.pasp.vSpacing]),W.av1C)L.codecType=rt.AV1,L.codec=W.av1C.codec,L.av1C=W.av1C.data,L.colr=W.colr.data;else if(W.hvcC)L.codecType=rt.HEVC,L.codec=W.hvcC.codec,L.vps=W.hvcC.vps,L.sps=W.hvcC.sps,L.pps=W.hvcC.pps,L.hvcC=W.hvcC.data;else if(W.avcC)L.codec=W.avcC.codec,L.sps=W.avcC.sps,L.pps=W.avcC.pps;else throw new Error("unknown video stsd entry");if(L.present=!0,L.ext={},L.ext.stss=(d=l.mdia)===null||d===void 0||(h=d.minf)===null||h===void 0||(p=h.stbl)===null||p===void 0?void 0:p.stss,L.ext.ctts=(v=l.mdia)===null||v===void 0||(Z=v.minf)===null||Z===void 0||(b=Z.stbl)===null||b===void 0?void 0:b.ctts,W&&W.type==="encv"){var X,S,R,T,V,Y,I,U;L.isVideoEncryption=!0,W.default_KID=(X=W.sinf)===null||X===void 0||(S=X.schi)===null||S===void 0?void 0:S.tenc.default_KID,W.default_IsEncrypted=(R=W.sinf)===null||R===void 0||(T=R.schi)===null||T===void 0?void 0:T.tenc.default_IsEncrypted,W.default_IV_size=(V=W.sinf)===null||V===void 0||(Y=V.schi)===null||Y===void 0?void 0:Y.tenc.default_IV_size,L.videoSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,W.data_format=(I=W.sinf)===null||I===void 0||(U=I.frma)===null||U===void 0?void 0:U.data_format,L.useEME=t.useEME,L.kidValue=t.kidValue,L.pssh=t.pssh,L.encv=W}}if(u&&e){var f,m,y,G,g,k,M,H,C,P=e,A=(f=u.tkhd)===null||f===void 0?void 0:f.trackId;A!=null&&(P.id=u.tkhd.trackId),P.tkhdDuration=u.tkhd.duration,P.mvhdDurtion=t.mvhd.duration,P.mvhdTimecale=t.mvhd.timescale,P.timescale=P.formatTimescale=u.mdia.mdhd.timescale,P.duration=u.mdia.mdhd.duration||P.mvhdDurtion/P.mvhdTimecale*P.timescale;var N=u.mdia.minf.stbl.stsd.entries[0];switch(P.sampleSize=N.sampleSize,P.sampleRate=N.sampleRate,P.channelCount=N.channelCount,P.present=!0,N.type){case"alaw":P.codecType=P.codec=it.G711PCMA,P.sampleRate=8e3;break;case"ulaw":P.codecType=P.codec=it.G711PCMU,P.sampleRate=8e3;break;default:P.sampleDuration=je.getFrameDuration(P.sampleRate,P.timescale),P.sampleRateIndex=je.getRateIndexByRate(P.sampleRate),P.objectType=((i=N.esds)===null||i===void 0?void 0:i.objectType)||2,N.esds&&(P.config=Array.from(N.esds.config)),P.codec=((n=N.esds)===null||n===void 0?void 0:n.codec)||"mp4a.40.2";break}if(P.sampleDuration=je.getFrameDuration(P.sampleRate,P.timescale),P.objectType=((m=N.esds)===null||m===void 0?void 0:m.objectType)||2,N.esds&&(N.esds.config?P.config=Array.from(N.esds.config):console.warn("esds config is null")),P.codec=((y=N.esds)===null||y===void 0?void 0:y.codec)||"mp4a.40.2",P.sampleRateIndex=je.getRateIndexByRate(P.sampleRate),P.ext={},P.ext.stss=(G=u.mdia)===null||G===void 0||(g=G.minf)===null||g===void 0||(k=g.stbl)===null||k===void 0?void 0:k.stss,P.ext.ctts=(M=u.mdia)===null||M===void 0||(H=M.minf)===null||H===void 0||(C=H.stbl)===null||C===void 0?void 0:C.ctts,P.present=!0,N&&N.type==="enca"){var ye,be,Je,me,mt,se,at,Oe;P.isAudioEncryption=!0,N.data_format=(ye=N.sinf)===null||ye===void 0||(be=ye.frma)===null||be===void 0?void 0:be.data_format,N.default_KID=(Je=N.sinf)===null||Je===void 0||(me=Je.schi)===null||me===void 0?void 0:me.tenc.default_KID,N.default_IsEncrypted=(mt=N.sinf)===null||mt===void 0||(se=mt.schi)===null||se===void 0?void 0:se.tenc.default_IsEncrypted,N.default_IV_size=(at=N.sinf)===null||at===void 0||(Oe=at.schi)===null||Oe===void 0?void 0:Oe.tenc.default_IV_size,P.audioSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,P.useEME=t.useEME,P.kidValue=t.kidValue,P.enca=N}}if(e&&(e.isVideoEncryption=r?r.isVideoEncryption:!1),r&&(r.isAudioEncryption=e?e.isAudioEncryption:!1),r!=null&&r.encv||e!=null&&e.enca){var st,Gr,yi=r==null||(st=r.encv)===null||st===void 0?void 0:st.default_KID,bi=e==null||(Gr=e.enca)===null||Gr===void 0?void 0:Gr.default_KID,Zi=yi||bi?(yi||bi).join(""):null;r&&(r.kid=Zi),e&&(e.kid=Zi)}return r&&(r.flags=3841),e&&(e.flags=1793),{videoTrack:r,audioTrack:e}}}},{key:"evaluateDefaultDuration",value:function(t,r,e){var i,n=r==null||(i=r.samples)===null||i===void 0?void 0:i.length;if(!n)return 1024;var o=1024*n/r.timescale;return o*t.timescale/e}},{key:"moofToSamples",value:function(t,r,e){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),e&&(e.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach(function(n){var o=n.tfhd,l=n.tfdt,u=n.trun;if(!(!o||!u)){l&&(r&&r.id===o.trackId&&(r.baseMediaDecodeTime=l.baseMediaDecodeTime),e&&e.id===o.trackId&&(e.baseMediaDecodeTime=l.baseMediaDecodeTime));var c=o.defaultSampleSize||0,d=o.defaultSampleDuration||a.evaluateDefaultDuration(r,e,u.samples.length||u.sampleCount),h=u.dataOffset||0,p=0,v=-1;if(!u.samples.length&&u.sampleCount){i[o.trackId]=[];for(var Z=0;Z<u.sampleCount;Z++)i[o.trackId].push({offset:h,dts:p,duration:d,size:c}),p+=d,h+=c}else i[o.trackId]=u.samples.map(function(b,L){return b={offset:h,dts:p,pts:p+(b.cts||0),duration:b.duration||d,size:b.size||c,gopId:v,keyframe:L===0||b.flags!==null&&b.flags!==void 0&&(b.flags&65536)>>>0!==65536},b.keyframe&&(v++,b.gopId=v),p+=b.duration,h+=b.size,b})}}),i}},{key:"moovToSamples",value:function(t){var r=t.trak;if(!(!r||!r.length)){var e=r.find(function(I){var U,f;return((U=I.mdia)===null||U===void 0||(f=U.hdlr)===null||f===void 0?void 0:f.handlerType)==="vide"}),i=r.find(function(I){var U,f;return((U=I.mdia)===null||U===void 0||(f=U.hdlr)===null||f===void 0?void 0:f.handlerType)==="soun"});if(!(!e&&!i)){var n,o;if(e){var l,u,c=(l=e.mdia)===null||l===void 0||(u=l.minf)===null||u===void 0?void 0:u.stbl;if(!c)return;var d=c.stts,h=c.stsc,p=c.stsz,v=c.stco,Z=c.stss,b=c.ctts;if(!d||!h||!p||!v||!Z)return;n=Hi(d,h,p,v,b,Z)}if(i){var L,w,W,X=(L=i.mdia)===null||L===void 0||(w=L.minf)===null||w===void 0?void 0:w.stbl;if(!X)return;var S=(W=i.mdia.mdhd)===null||W===void 0?void 0:W.timescale,R=X.stts,T=X.stsc,V=X.stsz,Y=X.stco;if(!S||!R||!T||!V||!Y)return;o=Hi(R,T,V,Y)}return{videoSamples:n,audioSamples:o}}}}}]),a}();function Hi(a,s,t,r,e,i){var n=[],o=e==null?void 0:e.entries,l=s.entries,u=r.entries,c=t.entrySizes,d=i==null?void 0:i.entries,h;d&&(h={},d.forEach(function(T){h[T-1]=!0}));var p;o&&(p=[],o.forEach(function(T){for(var V=T.count,Y=T.offset,I=0;I<V;I++)p.push(Y)}));var v,Z=-1,b=0,L=0,w=0,W=0,X=0,S=l[0].samplesPerChunk,R=l[1]?l[1].firstChunk-1:1/0;return a.entries.forEach(function(T){for(var V=T.count,Y=T.delta,I=0;I<V;I++)v={dts:b,duration:Y,size:c[L]||t.sampleSize,offset:u[w]+X,index:L},d&&(v.keyframe=h[L],v.keyframe&&Z++,v.gopId=Z),p&&L<p.length&&(v.pts=v.dts+p[L]),n.push(v),b+=Y,L++,L<S?X+=v.size:(w++,X=0,w>=R&&(W++,R=l[W+1]?l[W+1].firstChunk-1:1/0),S+=l[W].samplesPerChunk)}),n}function Ir(a,s){return a.dataReferenceIndex=de(s,6),a.width=de(s,24),a.height=de(s,26),a.horizresolution=D(s,28),a.vertresolution=D(s,32),a.frameCount=de(s,40),a.depth=de(s,74),78}function Ni(a,s){return a.dataReferenceIndex=de(s,6),a.channelCount=de(s,16),a.sampleSize=de(s,18),a.sampleRate=D(s,24)/65536,28}function B(a,s,t){if(a){if(a.size!==a.data.length)throw new Error("box ".concat(a.type," size !== data.length"));var r={start:a.start,size:a.size,headerSize:a.headerSize,type:a.type};return s&&(r.version=a.data[a.headerSize],r.flags=fs(a.data,a.headerSize+1),r.headerSize+=4),t(r,a.data.subarray(r.headerSize),r.start+r.headerSize),r}}var Gs=function(s,t,r){for(var e=String(r),i=t>>0,n=Math.ceil(i/e.length),o=[],l=String(s);n--;)o.push(e);return o.join("").substring(0,i-l.length)+l},_r=function(){for(var s=[],t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r.forEach(function(i){s.push(Gs(Number(i).toString(16),2,0))}),s[0]},Dn=function(){function a(s,t,r){ue(this,a),_(this,"__loadedMoofWraps",[]),_(this,"__lastRemainData",null),_(this,"__lastRemainDataStart",0),_(this,"__nextMoofStart",-1),this.videoTrack=s||new yr,this.audioTrack=t||new br,this.metadataTrack=r||new Zr}return ce(a,[{key:"demuxPart",value:function(t,r,e){var i=this,n=this.videoTrack,o=this.audioTrack,l=n.exist(),u=o.exist(),c=/av01/.test(n.codec);n.samples=[],o.samples=[];var d=t,h=r;if(this.__lastRemainData){var p=this.__lastRemainDataStart+this.__lastRemainData.byteLength,v=r<=p&&r>this.__lastRemainDataStart&&r+t.byteLength>p;if(v){var Z=t.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-r);d=Ne(this.__lastRemainData,Z),h=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!e){var b=$.findBox(d,["moov"])[0];if(!b)throw new Error("cannot found moov box");e=$.moov(b)}if(d){var L=h+d.byteLength;!l&&!u&&$.moovToTrack(e,n,o);var w=[];this.__nextMoofStart<0?$.findBox(d,["moof"],h).forEach(function(T){return w.push(T)}):this.__nextMoofStart>=h&&this.__nextMoofStart<=L-8&&$.findBox(d.subarray(this.__nextMoofStart-h),["moof"],this.__nextMoofStart).forEach(function(T){return w.push(T)}),w.filter(function(T){return T.size<=T.data.length}).forEach(function(T){var V=$.moof(T);i.__nextMoofStart=V.start+Math.max.apply(Math,ke(V.traf.map(function(Y){return Y.trun.samples.reduce(function(I,U){return I+U.size},Y.trun.dataOffset||0)}))),i.__loadedMoofWraps.push({start:V.start,nextMoofStart:i.__nextMoofStart,moof:V}),i.__loadedMoofWraps.sort(function(Y,I){return Y.start-I.start})});var W=ns(this.__loadedMoofWraps),X;try{var S=function(){var V=X.value;if(V.start>L||V.nextMoofStart<h)return"continue";var Y=V.start,I=$.moofToSamples(V.moof,n,o),U=n.baseMediaDecodeTime,f=o.baseMediaDecodeTime,m;Object.keys(I).forEach(function(y){n.id==y?I[y].some(function(G){var g=G.offset+=Y;if(!(g<h)){if(g+G.size>L)return!0;var k=new Et((G.pts||G.dts)+U,G.dts+U);k.duration=G.duration,k.gopId=G.gopId,G.keyframe&&k.setToKeyframe();var M=d.subarray(g-h,g-h+G.size);if(k.data=M,!c)for(var H=0,C=M.length-1;H<C;)m=D(M,H),H+=4,k.units.push(M.subarray(H,H+m)),H+=m;i.__lastRemainDataStart=g+G.size,n.samples.push(k)}}):o.id==y&&I[y].some(function(G){var g=G.offset+Y;if(!(g<h)){if(g+G.size>L)return!0;var k=d.subarray(g-h,g-h+G.size);o.samples.push(new nt(G.dts+f,k,G.duration)),i.__lastRemainDataStart=g+G.size}})})};for(W.s();!(X=W.n()).done;)var R=S()}catch(T){W.e(T)}finally{W.f()}}return this.__lastRemainDataStart>h&&this.__lastRemainDataStart<d.byteLength+h?this.__lastRemainData=d.subarray(this.__lastRemainDataStart-h):(this.__lastRemainData=d,this.__lastRemainDataStart=h),n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].pts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts),{videoTrack:n,audioTrack:o,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(t,r){var e=this.videoTrack,i=this.audioTrack,n=e.exist(),o=i.exist();if(e.samples=[],i.samples=[],r){if(!o){var l=$.findBox(r,["moov"])[0];if(!l)throw new Error("cannot found moov box");$.moovToTrack($.moov(l),null,i)}var u=$.findBox(r,["moof"])[0];if(u){var c=$.moofToSamples($.moof(u),null,i)[i.id],d=i.baseMediaDecodeTime;if(c){var h=u.start;c.map(function(X){X.offset+=h;var S=r.subarray(X.offset,X.offset+X.size);i.samples.push(new nt(X.dts+d,S,X.duration))})}}}if(t){if(!n&&!o){var p=$.findBox(t,["moov"])[0];if(!p)throw new Error("cannot found moov box");$.moovToTrack($.moov(p),e,i)}var v=$.findBox(t,["moof"])[0];if(v){var Z=$.moofToSamples($.moof(v),e,i),b=e.baseMediaDecodeTime,L=i.baseMediaDecodeTime,w=v.start,W;Object.keys(Z).forEach(function(X){e.id==X?Z[X].map(function(S){S.offset+=w;var R=new Et((S.pts||S.dts)+b,S.dts+b);R.duration=S.duration,R.gopId=S.gopId,S.keyframe&&R.setToKeyframe();var T=t.subarray(S.offset,S.offset+S.size);R.data=T;for(var V=0,Y=T.length-1;V<Y;)W=D(T,V),V+=4,R.units.push(T.subarray(V,V+W)),V+=W;e.samples.push(R)}):i.id==X&&Z[X].map(function(S){S.offset+=w;var R=t.subarray(S.offset,S.offset+S.size);i.samples.push(new nt(S.dts+L,R,S.duration))})})}}return{videoTrack:e,audioTrack:i,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(t){return $.probe(t)}}]),a}();function Ws(a){for(var s=0,t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];r.forEach(function(o){s+=o.length});var i=new a(s),n=0;return r.forEach(function(o){i.set(o,n),n+=o.length}),i}var Le=function(){function a(){ue(this,a),this.buffer=new Uint8Array(0)}return ce(a,[{key:"write",value:function(){for(var t=this,r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];e.forEach(function(n){n?t.buffer=Ws(Uint8Array,t.buffer,n):window.console.warn(n)})}}],[{key:"writeUint16",value:function(t){return new Uint8Array([t>>8&255,t&255])}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255])}}]),a}(),Di=Math.pow(2,32)-1,q=function(){function a(){ue(this,a)}return ce(a,null,[{key:"box",value:function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),i=1;i<r;i++)e[i-1]=arguments[i];e=e.filter(Boolean);var n=8+e.reduce(function(u,c){return u+c.byteLength},0),o=new Uint8Array(n);o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(t,4);var l=8;return e.forEach(function(u){o.set(u,l),l+=u.byteLength}),o}},{key:"ftyp",value:function(t){var r=t.find(function(e){return e.type===vt.VIDEO&&e.codecType===rt.HEVC});return r?a.FTYPHEV1:a.FTYPAVC1}},{key:"initSegment",value:function(t){var r=a.ftyp(t),e=Ne(r,a.moov(t));return e}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Ci(t.kid),[0,0,0,0]));return a.box(a.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return a.box.apply(a,[a.types.moov,a.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),a.mvex(t)].concat(ke(t.map(function(e){return a.trak(e)})),[r]))}else return a.box.apply(a,[a.types.moov,a.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(ke(t.map(function(e){return a.trak(e)})),[a.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=a.box(a.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,t>>24&255,t>>16&255,t>>8&255,t&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(t){var r=a.box(a.types.trak,a.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),a.mdia(t));return r}},{key:"tkhd",value:function(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=a.box(a.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,i>>8&255,i&255,0,0]));return n}},{key:"mdia",value:function(t){var r=a.box(a.types.mdia,a.mdhd(t.duration,t.timescale),a.hdlr(t.type),a.minf(t));return r}},{key:"mdhd",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=a.box(a.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,t>>24&255,t>>16&255,t>>8&255,t&255,85,196,0,0]));return e}},{key:"hdlr",value:function(t){var r=a.box(a.types.hdlr,a.HDLR_TYPES[t]);return r}},{key:"minf",value:function(t){var r=a.box(a.types.minf,t.type===vt.VIDEO?a.VMHD:a.SMHD,a.DINF,a.stbl(t));return r}},{key:"stbl",value:function(t){var r=[];t&&t.ext&&t.ext.stss&&r.push(a.stss(t.ext.stss.entries));var e=a.box(a.types.stbl,a.stsd(t),a.STTS,r[0],a.STSC,a.STSZ,a.STCO);return e}},{key:"stsd",value:function(t){var r;t.type==="audio"?t.useEME&&t.enca?r=a.enca(t):r=a.mp4a(t):t.useEME&&t.encv?r=a.encv(t):t.av1C?r=a.av01(t):r=a.avc1hev1(t);var e=a.box(a.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r);return e}},{key:"enca",value:function(t){var r=t.enca.channelCount,e=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,e>>8&255,e&255,0,0]),n=a.esds(t.config),o=a.sinf(t.enca);return a.box(a.types.enca,i,n,o)}},{key:"encv",value:function(t){var r,e,i=t.sps.length>0?t.sps[0]:[],n=t.pps.length>0?t.pps[0]:[],o=t.width,l=t.height,u=t.sarRatio[0],c=t.sarRatio[1],d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((r=(e=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,i.length&255]).concat.apply(e,ke(i)).concat([1,n.length>>>8&255,n.length&255])).concat.apply(r,ke(n))),p=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),v=a.sinf(t.encv),Z=new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,c>>24,c>>16&255,c>>8&255,c&255]);return a.box(a.types.encv,d,a.box(a.types.avcC,h),a.box(a.types.btrt,p),v,a.box(a.types.pasp,Z))}},{key:"schi",value:function(t){var r=new Uint8Array([]),e=a.tenc(t);return a.box(a.types.schi,r,e)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,t.default_IsEncrypted&255,t.default_IV_size&255].concat(Ci(t.default_KID)));return a.box(a.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),e=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),n=a.schi(t);return a.box(a.types.sinf,r,a.box(a.types.frma,e),a.box(a.types.schm,i),n)}},{key:"av01",value:function(t){return a.box(a.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,t.width&255,t.height>>8&255,t.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t.av1C,t.colr)}},{key:"avc1hev1",value:function(t){var r=t.codecType===rt.HEVC,e=r?a.types.hvc1:a.types.avc1,i=r?a.hvcC(t):a.avcC(t),n=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,t.width&255,t.height>>8&255,t.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?n.push(a.box(a.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&n.push(a.pasp(t.sarRatio)),a.box.apply(a,[e].concat(n))}},{key:"avcC",value:function(t){var r,e,i=[],n=[],o;return t.sps.forEach(function(l){o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i.push.apply(i,ke(l))}),t.pps.forEach(function(l){o=l.byteLength,n.push(o>>>8&255),n.push(o&255),n.push.apply(n,ke(l))}),a.box(a.types.avcC,new Uint8Array((r=(e=[1,i[3],i[4],i[5],255,224|t.sps.length]).concat.apply(e,i).concat([t.pps.length])).concat.apply(r,n)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var e=t.vps,i=t.sps,n=t.pps,o;if(r){var l=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(e.length&&1)+(i.length&&1)+(n.length&&1);o=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,l>>>24,l>>>16,l>>>8,l,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,r.chromaFormatIdc|252,r.bitDepthLumaMinus8|248,r.bitDepthChromaMinus8|248,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var d=function(p){var v;o.push(p.length>>8,p.length),(v=o).push.apply(v,ke(p))};e.length&&(o.push(160,0,e.length),e.forEach(d)),i.length&&(o.push(161,0,i.length),i.forEach(d)),n.length&&(o.push(162,0,n.length),n.forEach(d))}else o=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return a.box(a.types.hvcC,new Uint8Array(o))}},{key:"pasp",value:function(t){var r=$a(t,2),e=r[0],i=r[1];return a.box(a.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"mp4a",value:function(t){return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,t.sampleRate&255,0,0]),t.config.length?a.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length,e=a.box(a.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])));return e}},{key:"mvex",value:function(t){var r=a.box.apply(a,[a.types.mvex].concat(ke(t.map(function(e){return a.trex(e.id)}))));return r}},{key:"trex",value:function(t){var r=a.box(a.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return r}},{key:"trex1",value:function(t){var r=a.box(a.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return r}},{key:"trex2",value:function(t){var r=a.box(a.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return r}},{key:"moof",value:function(t){var r=a.box.apply(a,[a.types.moof,a.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(ke(t.map(function(e){return a.traf(e)}))));return r}},{key:"mfhd",value:function(t){var r=a.box(a.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]));return r}},{key:"traf",value:function(t){var r=a.tfhd(t.id),e=a.tfdt(t,t.baseMediaDecodeTime),i=0,n;if(t.isVideo&&t.videoSenc&&(n=t.videoSenc,n.forEach(function(m){i=i+8,m.subsamples&&m.subsamples.length&&(i=i+2,i=i+m.subsamples.length*6)})),t.videoSencLength=i,!t.useEME||!t.isVideoEncryption&&!t.isAudioEncryption){var o=a.sdtp(t),l=76;return a.box(a.types.traf,r,e,o,a.trun(t.samples,o.byteLength+l))}else if(t.isVideoEncryption)if(t.isVideo){var u=a.saiz(t),c=a.saio(t),d=a.trun1(t),h=a.senc(t),p=a.box(a.types.traf,r,e,u,c,d,h);return p}else if(t.isAudioEncryption){var b=a.sbgp(),L=a.saiz(t),w=a.saio(t),W=a.senc(t),X=a.trun1(t),S=a.box(a.types.traf,r,e,b,L,w,W,X);return S}else{var v=a.sbgp(),Z=a.trun1(t);return a.box(a.types.traf,r,e,v,Z)}else if(t.isVideo){var R=a.trun1(t);return a.box(a.types.traf,r,e,R)}else{var T=a.sbgp(),V=a.saiz(t),Y=a.saio(t),I=a.senc(t),U=a.trun1(t),f=a.box(a.types.traf,r,e,T,V,Y,I,U);return f}}},{key:"sdtp",value:function(t){var r=new Le;return t.samples.forEach(function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))}),a.box(a.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Le,e=Le.writeUint32(t.samples.length),i=null;if(t.isVideo){var n=t.videoSencLength;i=Le.writeUint32(t.samples.length*16+n+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Le.writeUint32(t.samples.length*16+92))}else{var o=t.samples.length*12+124;t.isAudioEncryption&&(o=t.samples.length*12+8*t.audioSenc.length+177),i=Le.writeUint32(o)}return t.samples.forEach(function(l){r.write(Le.writeUint32(l.duration)),r.write(Le.writeUint32(l.size)),r.write(Le.writeUint32(l.keyframe?33554432:65536)),t.isVideo&&r.write(Le.writeUint32(l.cts?l.cts:0))}),a.box(a.types.trun,this.extension(0,t.flags),e,i,r.buffer)}},{key:"senc",value:function(t){var r=new Le,e=t.samples.length,i=t.isVideo?16:8,n=t.isVideo?2:0,o=[],l=0;return t.isVideo?(o=t.videoSenc,l=t.videoSencLength):o=t.audioSenc,l=l||i*e,r.write(Le.writeUint32(16+l),a.types.senc,this.extension(0,n)),r.write(Le.writeUint32(e)),o.forEach(function(u){for(var c=0;c<u.InitializationVector.length;c++)r.write(new Uint8Array([u.InitializationVector[c]]));u.subsamples&&u.subsamples.length&&(r.write(Le.writeUint16(u.subsamples.length)),u.subsamples.forEach(function(d){r.write(Le.writeUint16(d.BytesOfClearData)),r.write(Le.writeUint32(d.BytesOfProtectedData))}))}),r.buffer}},{key:"saio",value:function(t){var r=t.samples.length*12+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255]);return a.box(a.types.saio,e)}},{key:"saiz",value:function(t){var r=t.samples.length,e=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,r&255]);return a.box(a.types.saiz,e)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return a.box(a.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(t,r){return new Uint8Array([t,r>>16&255,r>>8&255,r&255])}},{key:"tfhd",value:function(t){return a.box(a.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}},{key:"tfdt",value:function(t,r){var e=Math.floor(r/(Di+1)),i=Math.floor(r%(Di+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?a.box(a.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])):a.box(a.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"trun",value:function(t,r){var e=t.length,i=12+16*e;r+=8+i;var n=new Uint8Array(i);n.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(var o=0;o<e;o++){var l=t[o],u=l.duration,c=l.size,d=l.flag,h=d===void 0?{}:d,p=l.cts,v=p===void 0?0:p;n.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|(h.dependsOn===null||h.dependsOn===void 0?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(h.isNonSyncSample===null||h.isNonSyncSample===void 0?1:h.isNonSyncSample),h.degradationPriority&61440,h.degradationPriority&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*o)}return a.box(a.types.trun,n)}},{key:"moovMP4",value:function(t){return a.box.apply(a,[a.types.moov,a.mvhd(t[0].duration,t[0].timescale)].concat(ke(t.map(function(r){return a.trackMP4(r)}))))}},{key:"trackMP4",value:function(t){return a.box(a.types.trak,a.tkhd(t.id,t.duration,t.width,t.height),a.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return a.box(a.types.mdia,a.mdhd(t.duration,t.timescale),a.hdlr(t.type),a.minfMP4(t))}},{key:"minfMP4",value:function(t){return a.box(a.types.minf,t.type===vt.VIDEO?a.VMHD:a.SMHD,a.DINF,a.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,e=[a.stsd(t),a.stts(r.stts),a.stsc(r.stsc),a.stsz(r.stsz),a.stco(r.stco)];return r.stss.length&&e.push(a.stss(r.stss)),r.ctts.length&&e.push(a.ctts(r.ctts)),a.box.apply(a,[a.types.stbl].concat(e))}},{key:"stts",value:function(t){var r=t.length,e=new Uint8Array(8*r),i=0;return t.forEach(function(n){var o=n.value,l=n.count;e.set([l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),a.box(a.types.stts,Ne(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stsc",value:function(t){var r=t.length,e=new Uint8Array(12*r),i=0;return t.forEach(function(n){var o=n.firstChunk,l=n.samplesPerChunk,u=n.sampleDescIndex;e.set([o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255],i),i+=12}),a.box(a.types.stsc,Ne(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stsz",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),a.box(a.types.stsz,Ne(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stco",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),a.box(a.types.stco,Ne(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"stss",value:function(t){var r=t.length,e=new Uint8Array(4*r),i=0;return t.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],i),i+=4}),a.box(a.types.stss,Ne(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"ctts",value:function(t){var r=t.length,e=new Uint8Array(8*r),i=0;return t.forEach(function(n){var o=n.value,l=n.count;e.set([l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),a.box(a.types.ctts,Ne(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]),e))}},{key:"styp",value:function(){return a.box(a.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,e=t.samples[0].duration,i=e*t.samples.length,n=t.samples[0].sampleOffset*e,o=8;t.samples.forEach(function(h){o+=h.size});var l=0;if(t.isVideo){var u=0,c;t.videoSenc&&(c=t.videoSenc),t.isVideo&&c.forEach(function(h){u=u+8,h.subsamples&&h.subsamples.length&&(u=u+2,u=u+h.subsamples.length*6)}),t.videoSencLength=u,l=o+141+t.samples.length*16+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(l=o+t.samples.length*16+84)}else l=o+116+t.samples.length*12,t.useEME&&t.isAudioEncryption&&(l=o+169+t.samples.length*12+8*t.audioSenc.length);var d=new Uint8Array([0,0,0,0,0,0,0,t.id&255,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,0,0,0,1,0,l>>16&255,l>>8&255,l&255,i>>24&255,i>>16&255,i>>8&255,i&255,144,0,0,0]);return a.box(a.types.sidx,d)}},{key:"mdat",value:function(t){var r=a.box(a.types.mdat,t);return r}}]),a}();_(q,"types",["av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(a,s){return a[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)],a},Object.create(null)));_(q,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});_(q,"FTYPAVC1",q.box(q.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));_(q,"FTYPHEV1",q.box(q.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));_(q,"DINF",q.box(q.types.dinf,q.box(q.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));_(q,"VMHD",q.box(q.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));_(q,"SMHD",q.box(q.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));_(q,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));_(q,"STTS",q.box(q.types.stts,q.StblTable));_(q,"STSC",q.box(q.types.stsc,q.StblTable));_(q,"STSZ",q.box(q.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));_(q,"STCO",q.box(q.types.stco,q.StblTable));var ui=function(){function a(s,t){ue(this,a),this.name=s||"",this._prefix="[".concat(this.name,"]"),a.disabled=t}return ce(a,[{key:"debug",value:function(){var t;if(!a.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(e))}}},{key:"log",value:function(){var t;if(!a.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(e))}}},{key:"warn",value:function(){var t;if(!a.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(e))}}},{key:"error",value:function(){var t;if(!a.disabled){for(var r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(e))}}},{key:"table",value:function(){var t;a.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();_(ui,"disabled",!0);var ci=function(){function a(s,t,r){ue(this,a),this.videoTrack=s,this.audioTrack=t;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new ui("FMP4Remuxer",r&&r.openLog?!r.openLog:!0)}return ce(a,[{key:"remux",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,i=this.audioTrack,n=e.exist(),o=i.exist(),l,u,c,d=[];t&&(r&&r.initMerge?(n&&d.push(this.videoTrack),o&&d.push(this.audioTrack),c=q.initSegment(d)):(n&&(l=q.initSegment([this.videoTrack])),o&&(u=q.initSegment([this.audioTrack]))));var h,p;return n&&e.hasSample()&&(h=this._remuxVideo()),o&&i.hasSample()&&(p=this._remuxAudio()),e.samples=[],i.samples=[],{initSegment:c,videoInitSegment:l,audioInitSegment:u,videoSegment:h,audioSegment:p}}},{key:"_remuxVideo",value:function(){var t=this.videoTrack;this.forceFirstIDR&&(t.samples[0].flag={dependsOn:2,isNonSyncSample:0});var r=t.samples,e=/av01/.test(t.codec),i=0;e?r.forEach(function(W){i+=W.data.byteLength}):r.forEach(function(W){i+=W.units.reduce(function(X,S){return X+S.byteLength},0),i+=W.units.length*4});var n=new Uint8Array(i);if(e)for(var o=0,l=r.length,u=0,c;o<l;o++)c=r[o],n.set(c.data,u),c.size=c.data.byteLength,u+=c.size;else for(var d=new DataView(n.buffer),h=function(X,S){S=r[p];var R=0;S.units.forEach(function(T){d.setUint32(X,T.byteLength),X+=4,n.set(T,X),X+=T.byteLength,R+=4+T.byteLength}),S.size=R,Z=X,b=S},p=0,v=r.length,Z=0,b;p<v;p++)h(Z,b);var L=q.mdat(n),w=q.moof([t]);return Ne(w,L)}},{key:"_remuxAudio",value:function(){var t=this.audioTrack,r=new Uint8Array(t.samples.reduce(function(n,o){return n+o.size},0));t.samples.reduce(function(n,o){return r.set(o.data,n),n+o.size},0);var e=q.mdat(r),i=q.moof([t]);return Ne(i,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),a}();class _e{static create(...s){return new this(...s)}mixIn(s){return Object.assign(this,s)}clone(){const s=new this.constructor;return Object.assign(s,this),s}}class Ee extends _e{constructor(s=[],t=s.length*4){super();let r=s;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),(r instanceof Int8Array||r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)&&(r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),r instanceof Uint8Array){const e=r.byteLength,i=[];for(let n=0;n<e;n+=1)i[n>>>2]|=r[n]<<24-n%4*8;this.words=i,this.sigBytes=e}else this.words=s,this.sigBytes=t}static random(s){const t=[],r=e=>{let i=e,n=987654321;const o=4294967295;return()=>{n=36969*(n&65535)+(n>>16)&o,i=18e3*(i&65535)+(i>>16)&o;let l=(n<<16)+i&o;return l/=4294967296,l+=.5,l*(Math.random()>.5?1:-1)}};for(let e=0,i;e<s;e+=4){const n=r((i||Math.random())*4294967296);i=n()*987654071,t.push(n()*4294967296|0)}return new Ee(t,s)}toString(s=Ar){return s.stringify(this)}concat(s){const t=this.words,r=s.words,e=this.sigBytes,i=s.sigBytes;if(this.clamp(),e%4)for(let n=0;n<i;n+=1){const o=r[n>>>2]>>>24-n%4*8&255;t[e+n>>>2]|=o<<24-(e+n)%4*8}else for(let n=0;n<i;n+=4)t[e+n>>>2]=r[n>>>2];return this.sigBytes+=i,this}clamp(){const{words:s,sigBytes:t}=this;s[t>>>2]&=4294967295<<32-t%4*8,s.length=Math.ceil(t/4)}clone(){const s=super.clone.call(this);return s.words=this.words.slice(0),s}}const Ar={stringify(a){const{words:s,sigBytes:t}=a,r=[];for(let e=0;e<t;e+=1){const i=s[e>>>2]>>>24-e%4*8&255;r.push((i>>>4).toString(16)),r.push((i&15).toString(16))}return r.join("")},parse(a){const s=a.length,t=[];for(let r=0;r<s;r+=2)t[r>>>3]|=parseInt(a.substr(r,2),16)<<24-r%8*4;return new Ee(t,s/2)}},Fi={stringify(a){const{words:s,sigBytes:t}=a,r=[];for(let e=0;e<t;e+=1){const i=s[e>>>2]>>>24-e%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse(a){const s=a.length,t=[];for(let r=0;r<s;r+=1)t[r>>>2]|=(a.charCodeAt(r)&255)<<24-r%4*8;return new Ee(t,s)}},Fn={stringify(a){try{return decodeURIComponent(escape(Fi.stringify(a)))}catch{throw new Error("Malformed UTF-8 data")}},parse(a){return Fi.parse(unescape(encodeURIComponent(a)))}};class Un extends _e{constructor(){super(),this._minBufferSize=0}reset(){this._data=new Ee,this._nDataBytes=0}_append(s){let t=s;typeof t=="string"&&(t=Fn.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(s){let t;const{_data:r,blockSize:e}=this,i=r.words,n=r.sigBytes,o=e*4;let l=n/o;s?l=Math.ceil(l):l=Math.max((l|0)-this._minBufferSize,0);const u=l*e,c=Math.min(u*4,n);if(u){for(let d=0;d<u;d+=e)this._doProcessBlock(i,d);t=i.splice(0,u),r.sigBytes-=c}return new Ee(t,c)}clone(){const s=super.clone.call(this);return s._data=this._data.clone(),s}}class ws extends Un{constructor(s){super(),this.blockSize=512/32,this.cfg=Object.assign(new _e,s),this.reset()}static _createHelper(s){return(t,r)=>new s(r).finalize(t)}static _createHmacHelper(s){return(t,r)=>new Rs(s,r).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(s){return this._append(s),this._process(),this}finalize(s){return s&&this._append(s),this._doFinalize()}}class Rs extends _e{constructor(s,t){super();const r=new s;this._hasher=r;let e=t;typeof e=="string"&&(e=Fn.parse(e));const i=r.blockSize,n=i*4;e.sigBytes>n&&(e=r.finalize(t)),e.clamp();const o=e.clone();this._oKey=o;const l=e.clone();this._iKey=l;const u=o.words,c=l.words;for(let d=0;d<i;d+=1)u[d]^=1549556828,c[d]^=909522486;o.sigBytes=n,l.sigBytes=n,this.reset()}reset(){const s=this._hasher;s.reset(),s.update(this._iKey)}update(s){return this._hasher.update(s),this}finalize(s){const t=this._hasher,r=t.finalize(s);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}const Vs=(a,s,t)=>{const r=[];let e=0;for(let i=0;i<s;i+=1)if(i%4){const n=t[a.charCodeAt(i-1)]<<i%4*2,o=t[a.charCodeAt(i)]>>>6-i%4*2,l=n|o;r[e>>>2]|=l<<24-e%4*8,e+=1}return Ee.create(r,e)},Ui={stringify(a){const{words:s,sigBytes:t}=a,r=this._map;a.clamp();const e=[];for(let n=0;n<t;n+=3){const o=s[n>>>2]>>>24-n%4*8&255,l=s[n+1>>>2]>>>24-(n+1)%4*8&255,u=s[n+2>>>2]>>>24-(n+2)%4*8&255,c=o<<16|l<<8|u;for(let d=0;d<4&&n+d*.75<t;d+=1)e.push(r.charAt(c>>>6*(3-d)&63))}const i=r.charAt(64);if(i)for(;e.length%4;)e.push(i);return e.join("")},parse(a){let s=a.length;const t=this._map;let r=this._reverseMap;if(!r){this._reverseMap=[],r=this._reverseMap;for(let i=0;i<t.length;i+=1)r[t.charCodeAt(i)]=i}const e=t.charAt(64);if(e){const i=a.indexOf(e);i!==-1&&(s=i)}return Vs(a,s,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},z=[];for(let a=0;a<64;a+=1)z[a]=Math.abs(Math.sin(a+1))*4294967296|0;const Ge=(a,s,t,r,e,i,n)=>{const o=a+(s&t|~s&r)+e+n;return(o<<i|o>>>32-i)+s},We=(a,s,t,r,e,i,n)=>{const o=a+(s&r|t&~r)+e+n;return(o<<i|o>>>32-i)+s},we=(a,s,t,r,e,i,n)=>{const o=a+(s^t^r)+e+n;return(o<<i|o>>>32-i)+s},Re=(a,s,t,r,e,i,n)=>{const o=a+(t^(s|~r))+e+n;return(o<<i|o>>>32-i)+s};class Ts extends ws{_doReset(){this._hash=new Ee([1732584193,4023233417,2562383102,271733878])}_doProcessBlock(s,t){const r=s;for(let Y=0;Y<16;Y+=1){const I=t+Y,U=s[I];r[I]=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360}const e=this._hash.words,i=r[t+0],n=r[t+1],o=r[t+2],l=r[t+3],u=r[t+4],c=r[t+5],d=r[t+6],h=r[t+7],p=r[t+8],v=r[t+9],Z=r[t+10],b=r[t+11],L=r[t+12],w=r[t+13],W=r[t+14],X=r[t+15];let S=e[0],R=e[1],T=e[2],V=e[3];S=Ge(S,R,T,V,i,7,z[0]),V=Ge(V,S,R,T,n,12,z[1]),T=Ge(T,V,S,R,o,17,z[2]),R=Ge(R,T,V,S,l,22,z[3]),S=Ge(S,R,T,V,u,7,z[4]),V=Ge(V,S,R,T,c,12,z[5]),T=Ge(T,V,S,R,d,17,z[6]),R=Ge(R,T,V,S,h,22,z[7]),S=Ge(S,R,T,V,p,7,z[8]),V=Ge(V,S,R,T,v,12,z[9]),T=Ge(T,V,S,R,Z,17,z[10]),R=Ge(R,T,V,S,b,22,z[11]),S=Ge(S,R,T,V,L,7,z[12]),V=Ge(V,S,R,T,w,12,z[13]),T=Ge(T,V,S,R,W,17,z[14]),R=Ge(R,T,V,S,X,22,z[15]),S=We(S,R,T,V,n,5,z[16]),V=We(V,S,R,T,d,9,z[17]),T=We(T,V,S,R,b,14,z[18]),R=We(R,T,V,S,i,20,z[19]),S=We(S,R,T,V,c,5,z[20]),V=We(V,S,R,T,Z,9,z[21]),T=We(T,V,S,R,X,14,z[22]),R=We(R,T,V,S,u,20,z[23]),S=We(S,R,T,V,v,5,z[24]),V=We(V,S,R,T,W,9,z[25]),T=We(T,V,S,R,l,14,z[26]),R=We(R,T,V,S,p,20,z[27]),S=We(S,R,T,V,w,5,z[28]),V=We(V,S,R,T,o,9,z[29]),T=We(T,V,S,R,h,14,z[30]),R=We(R,T,V,S,L,20,z[31]),S=we(S,R,T,V,c,4,z[32]),V=we(V,S,R,T,p,11,z[33]),T=we(T,V,S,R,b,16,z[34]),R=we(R,T,V,S,W,23,z[35]),S=we(S,R,T,V,n,4,z[36]),V=we(V,S,R,T,u,11,z[37]),T=we(T,V,S,R,h,16,z[38]),R=we(R,T,V,S,Z,23,z[39]),S=we(S,R,T,V,w,4,z[40]),V=we(V,S,R,T,i,11,z[41]),T=we(T,V,S,R,l,16,z[42]),R=we(R,T,V,S,d,23,z[43]),S=we(S,R,T,V,v,4,z[44]),V=we(V,S,R,T,L,11,z[45]),T=we(T,V,S,R,X,16,z[46]),R=we(R,T,V,S,o,23,z[47]),S=Re(S,R,T,V,i,6,z[48]),V=Re(V,S,R,T,h,10,z[49]),T=Re(T,V,S,R,W,15,z[50]),R=Re(R,T,V,S,c,21,z[51]),S=Re(S,R,T,V,L,6,z[52]),V=Re(V,S,R,T,l,10,z[53]),T=Re(T,V,S,R,Z,15,z[54]),R=Re(R,T,V,S,n,21,z[55]),S=Re(S,R,T,V,p,6,z[56]),V=Re(V,S,R,T,X,10,z[57]),T=Re(T,V,S,R,d,15,z[58]),R=Re(R,T,V,S,w,21,z[59]),S=Re(S,R,T,V,u,6,z[60]),V=Re(V,S,R,T,b,10,z[61]),T=Re(T,V,S,R,o,15,z[62]),R=Re(R,T,V,S,v,21,z[63]),e[0]=e[0]+S|0,e[1]=e[1]+R|0,e[2]=e[2]+T|0,e[3]=e[3]+V|0}_doFinalize(){const s=this._data,t=s.words,r=this._nDataBytes*8,e=s.sigBytes*8;t[e>>>5]|=128<<24-e%32;const i=Math.floor(r/4294967296),n=r;t[(e+64>>>9<<4)+15]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360,t[(e+64>>>9<<4)+14]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360,s.sigBytes=(t.length+1)*4,this._process();const o=this._hash,l=o.words;for(let u=0;u<4;u+=1){const c=l[u];l[u]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}return o}clone(){const s=super.clone.call(this);return s._hash=this._hash.clone(),s}}class ks extends _e{constructor(s){super(),this.cfg=Object.assign(new _e,{keySize:128/32,hasher:Ts,iterations:1},s)}compute(s,t){let r;const{cfg:e}=this,i=e.hasher.create(),n=Ee.create(),o=n.words,{keySize:l,iterations:u}=e;for(;o.length<l;){r&&i.update(r),r=i.update(s).finalize(t),i.reset();for(let c=1;c<u;c+=1)r=i.finalize(r),i.reset();n.concat(r)}return n.sigBytes=l*4,n}}class Bt extends Un{constructor(s,t,r){super(),this.cfg=Object.assign(new _e,r),this._xformMode=s,this._key=t,this.reset()}static createEncryptor(s,t){return this.create(this._ENC_XFORM_MODE,s,t)}static createDecryptor(s,t){return this.create(this._DEC_XFORM_MODE,s,t)}static _createHelper(s){const t=r=>typeof r=="string"?jn:It;return{encrypt(r,e,i){return t(e).encrypt(s,r,e,i)},decrypt(r,e,i){return t(e).decrypt(s,r,e,i)}}}reset(){super.reset.call(this),this._doReset()}process(s){return this._append(s),this._process()}finalize(s){return s&&this._append(s),this._doFinalize()}}Bt._ENC_XFORM_MODE=1;Bt._DEC_XFORM_MODE=2;Bt.keySize=128/32;Bt.ivSize=128/32;class zn extends _e{constructor(s,t){super(),this._cipher=s,this._iv=t}static createEncryptor(s,t){return this.Encryptor.create(s,t)}static createDecryptor(s,t){return this.Decryptor.create(s,t)}}function Jn(a,s,t){const r=a;let e;const i=this._iv;i?(e=i,this._iv=void 0):e=this._prevBlock;for(let n=0;n<t;n+=1)r[s+n]^=e[n]}class Ut extends zn{}Ut.Encryptor=class extends Ut{processBlock(a,s){const t=this._cipher,{blockSize:r}=t;Jn.call(this,a,s,r),t.encryptBlock(a,s),this._prevBlock=a.slice(s,s+r)}};Ut.Decryptor=class extends Ut{processBlock(a,s){const t=this._cipher,{blockSize:r}=t,e=a.slice(s,s+r);t.decryptBlock(a,s),Jn.call(this,a,s,r),this._prevBlock=e}};const xs={pad(a,s){const t=s*4,r=t-a.sigBytes%t,e=r<<24|r<<16|r<<8|r,i=[];for(let o=0;o<r;o+=4)i.push(e);const n=Ee.create(i,r);a.concat(n)},unpad(a){const s=a,t=s.words[s.sigBytes-1>>>2]&255;s.sigBytes-=t}};class On extends Bt{constructor(s,t,r){super(s,t,Object.assign({mode:Ut,padding:xs},r)),this.blockSize=128/32}reset(){let s;super.reset.call(this);const{cfg:t}=this,{iv:r,mode:e}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?s=e.createEncryptor:(s=e.createDecryptor,this._minBufferSize=1),this._mode=s.call(e,this,r&&r.words),this._mode.__creator=s}_doProcessBlock(s,t){this._mode.processBlock(s,t)}_doFinalize(){let s;const{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),s=this._process(!0)):(s=this._process(!0),t.unpad(s)),s}}class Sr extends _e{constructor(s){super(),this.mixIn(s)}toString(s){return(s||this.formatter).stringify(this)}}const Ms={stringify(a){let s;const{ciphertext:t,salt:r}=a;return r?s=Ee.create([1398893684,1701076831]).concat(r).concat(t):s=t,s.toString(Ui)},parse(a){let s;const t=Ui.parse(a),r=t.words;return r[0]===1398893684&&r[1]===1701076831&&(s=Ee.create(r.slice(2,4)),r.splice(0,4),t.sigBytes-=16),Sr.create({ciphertext:t,salt:s})}};class It extends _e{static encrypt(s,t,r,e){const i=Object.assign(new _e,this.cfg,e),n=s.createEncryptor(r,i),o=n.finalize(t),l=n.cfg;return Sr.create({ciphertext:o,key:r,iv:l.iv,algorithm:s,mode:l.mode,padding:l.padding,blockSize:n.blockSize,formatter:i.format})}static decrypt(s,t,r,e){let i=t;const n=Object.assign(new _e,this.cfg,e);return i=this._parse(i,n.format),s.createDecryptor(r,n).finalize(i.ciphertext)}static _parse(s,t){return typeof s=="string"?t.parse(s,this):s}}It.cfg=Object.assign(new _e,{format:Ms});const Ys={execute(a,s,t,r){let e=r;e||(e=Ee.random(64/8));const i=ks.create({keySize:s+t}).compute(a,e),n=Ee.create(i.words.slice(s),t*4);return i.sigBytes=s*4,Sr.create({key:i,iv:n,salt:e})}};class jn extends It{static encrypt(s,t,r,e){const i=Object.assign(new _e,this.cfg,e),n=i.kdf.execute(r,s.keySize,s.ivSize);i.iv=n.iv;const o=It.encrypt.call(this,s,t,n.key,i);return o.mixIn(n),o}static decrypt(s,t,r,e){let i=t;const n=Object.assign(new _e,this.cfg,e);i=this._parse(i,n.format);const o=n.kdf.execute(r,s.keySize,s.ivSize,i.salt);return n.iv=o.iv,It.decrypt.call(this,s,i,o.key,n)}}jn.cfg=Object.assign(It.cfg,{kdf:Ys});const Pe=[],Bn=[],An=[],Qn=[],$n=[],qn=[],Qr=[],$r=[],qr=[],ei=[],Qe=[];for(let a=0;a<256;a+=1)a<128?Qe[a]=a<<1:Qe[a]=a<<1^283;let Ae=0,lt=0;for(let a=0;a<256;a+=1){let s=lt^lt<<1^lt<<2^lt<<3^lt<<4;s=s>>>8^s&255^99,Pe[Ae]=s,Bn[s]=Ae;const t=Qe[Ae],r=Qe[t],e=Qe[r];let i=Qe[s]*257^s*16843008;An[Ae]=i<<24|i>>>8,Qn[Ae]=i<<16|i>>>16,$n[Ae]=i<<8|i>>>24,qn[Ae]=i,i=e*16843009^r*65537^t*257^Ae*16843008,Qr[s]=i<<24|i>>>8,$r[s]=i<<16|i>>>16,qr[s]=i<<8|i>>>24,ei[s]=i,Ae?(Ae=t^Qe[Qe[Qe[e^t]]],lt^=Qe[Qe[lt]]):(lt=1,Ae=lt)}const Is=[0,1,2,4,8,16,32,64,128,27,54];class ea extends On{_doReset(){let s;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;const t=this._keyPriorReset,r=t.words,e=t.sigBytes/4;this._nRounds=e+6;const n=(this._nRounds+1)*4;this._keySchedule=[];const o=this._keySchedule;for(let u=0;u<n;u+=1)u<e?o[u]=r[u]:(s=o[u-1],u%e?e>6&&u%e===4&&(s=Pe[s>>>24]<<24|Pe[s>>>16&255]<<16|Pe[s>>>8&255]<<8|Pe[s&255]):(s=s<<8|s>>>24,s=Pe[s>>>24]<<24|Pe[s>>>16&255]<<16|Pe[s>>>8&255]<<8|Pe[s&255],s^=Is[u/e|0]<<24),o[u]=o[u-e]^s);this._invKeySchedule=[];const l=this._invKeySchedule;for(let u=0;u<n;u+=1){const c=n-u;u%4?s=o[c]:s=o[c-4],u<4||c<=4?l[u]=s:l[u]=Qr[Pe[s>>>24]]^$r[Pe[s>>>16&255]]^qr[Pe[s>>>8&255]]^ei[Pe[s&255]]}}encryptBlock(s,t){this._doCryptBlock(s,t,this._keySchedule,An,Qn,$n,qn,Pe)}decryptBlock(s,t){const r=s;let e=r[t+1];r[t+1]=r[t+3],r[t+3]=e,this._doCryptBlock(r,t,this._invKeySchedule,Qr,$r,qr,ei,Bn),e=r[t+1],r[t+1]=r[t+3],r[t+3]=e}_doCryptBlock(s,t,r,e,i,n,o,l){const u=s,c=this._nRounds;let d=u[t]^r[0],h=u[t+1]^r[1],p=u[t+2]^r[2],v=u[t+3]^r[3],Z=4;for(let X=1;X<c;X+=1){const S=e[d>>>24]^i[h>>>16&255]^n[p>>>8&255]^o[v&255]^r[Z];Z+=1;const R=e[h>>>24]^i[p>>>16&255]^n[v>>>8&255]^o[d&255]^r[Z];Z+=1;const T=e[p>>>24]^i[v>>>16&255]^n[d>>>8&255]^o[h&255]^r[Z];Z+=1;const V=e[v>>>24]^i[d>>>16&255]^n[h>>>8&255]^o[p&255]^r[Z];Z+=1,d=S,h=R,p=T,v=V}const b=(l[d>>>24]<<24|l[h>>>16&255]<<16|l[p>>>8&255]<<8|l[v&255])^r[Z];Z+=1;const L=(l[h>>>24]<<24|l[p>>>16&255]<<16|l[v>>>8&255]<<8|l[d&255])^r[Z];Z+=1;const w=(l[p>>>24]<<24|l[v>>>16&255]<<16|l[d>>>8&255]<<8|l[h&255])^r[Z];Z+=1;const W=(l[v>>>24]<<24|l[d>>>16&255]<<16|l[h>>>8&255]<<8|l[p&255])^r[Z];Z+=1,u[t]=b,u[t+1]=L,u[t+2]=w,u[t+3]=W}}ea.keySize=256/32;const _s=On._createHelper(ea);class zt extends zn{}zt.Encryptor=class extends zt{processBlock(a,s){const t=a,r=this._cipher,{blockSize:e}=r,i=this._iv;let n=this._counter;i&&(this._counter=i.slice(0),n=this._counter,this._iv=void 0);const o=n.slice(0);r.encryptBlock(o,0),n[e-1]=n[e-1]+1|0;for(let l=0;l<e;l+=1)t[s+l]^=o[l]}};zt.Decryptor=zt.Encryptor;const Es={pad(){},unpad(){}};var or={decryptWordArray:function(s,t,r){var e=Ar.parse(t),i=Ar.parse(ps(r)),n=Ee.create(new Uint8Array(s)),o=_s.decrypt(Sr.create({ciphertext:n}),e,{iv:i,mode:zt,padding:Es});return or.wordArrayToUint8Array(o)},wordArrayToUint8Array:function(s){for(var t=s.sigBytes,r=s.words,e=new Uint8Array(t),i=0,n=0;i!==t;){var o=r[n++];if(e[i++]=(o&4278190080)>>>24,i===t||(e[i++]=(o&16711680)>>>16,i===t)||(e[i++]=(o&65280)>>>8,i===t))break;e[i++]=o&255}return e},decoderAESCTRData:function(s,t,r){if(s.videoSenc){var e=s.kidValue,i=s.videoSenc;s.samples.forEach(function(l,u){var c=i[u],d=l.data,h=[],p=[],v=c.InitializationVector;if(c.subsamples&&c.subsamples.length)c.subsamples.forEach(function(W){var X=W.BytesOfClearData+W.BytesOfProtectedData,S=d.slice(0,X);h.push(S.slice(0,W.BytesOfClearData)),p.push(S.slice(W.BytesOfClearData)),d=d.slice(X)});else{var Z=l.size;h.push(d.slice(0,0)),p.push(d.slice(0,Z)),d=d.slice(Z)}var b=new Le;b.write.apply(b,p);var L=r?r(b.buffer,e,v):or.decryptWordArray(b.buffer,e,v),w=new Le;h.forEach(function(W,X){var S=p[X].length,R=L.slice(0,S);w.write(W),w.write(R),L=L.slice(S)}),s.samples[u].data=w.buffer})}if(t.audioSenc){var n=t.kidValue,o=t.audioSenc;t.samples.forEach(function(l,u){var c=o[u],d=r?r(l.data,n,c.InitializationVector):or.decryptWordArray(l.data,n,c.InitializationVector);t.samples[u].data=d})}}},zi=20,Cs=function(){function a(s,t,r,e){var i=this;ue(this,a),_(this,"_videoSamples",[]),_(this,"_audioSamples",[]),_(this,"_lastRemainBuffer",[]),_(this,"_lastRemainBufferStartPos",0),this.videoTrack=new yr,this.audioTrack=new br,this.metadataTrack=r||new Zr,this.log=new ui("MP4Demuxer",e&&e.openLog?!e.openLog:!0),s&&s.forEach(function(n){var o;(o=i._videoSamples).push.apply(o,ke(n.frames))}),t&&t.forEach(function(n){var o;(o=i._audioSamples).push.apply(o,ke(n.frames))})}return ce(a,[{key:"parseSamples",value:function(t){if(!t)throw new Error("moov is required");if(!this.videoTrack.codec&&!this.audioTrack.codec&&($.moovToTrack(t,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc),!this._audioSamples.length&&!this._videoSamples.length){var r=$.moovToSamples(t);if(!r)throw new Error("cannot parse samples from moov box");this._videoSamples=r.videoSamples||[],this._audioSamples=r.audioSamples||[]}}},{key:"demux",value:function(t,r,e,i,n){this.parseSamples(n);var o=this.videoTrack,l=this.audioTrack;o.samples=[],l.samples=[];var u,c,d;if(e){for(var h,p=0,v=e[0],Z=e[1];v<=Z;v++){if(u=this._videoSamples[v],!u)throw new Error("cannot found video frame #".concat(v));d=u.offset-r,c=t.subarray(d,d+u.size),h=new Et(u.pts||u.dts,u.dts),h.duration=u.duration,h.gopId=u.gopId,u.keyframe&&h.setToKeyframe();for(var b=0,L=c.length-1;b<L;)p=D(c,b),b+=4,h.units.push(c.subarray(b,b+p)),b+=p;o.samples.push(h)}o.baseMediaDecodeTime=o.samples[0].dts}if(i){for(var w=i[0],W=i[1];w<=W;w++){if(u=this._audioSamples[w],!u)throw new Error("cannot found video frame #".concat(w));d=u.offset-r,c=t.subarray(d,d+u.size),l.samples.push(new nt(u.dts,c,u.duration))}l.baseMediaDecodeTime=l.samples[0].dts}return{videoTrack:o,audioTrack:l,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(t,r,e,i,n,o,l,u){if(this.parseSamples(n),this.videoTrack.useEME=o,this.audioTrack.useEME=o,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&r>this._lastRemainBufferStartPos&&r<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength)for(var c=0;c<zi;)try{var d=this._lastRemainBuffer.subarray(0,r-this._lastRemainBufferStartPos),h=new Uint8Array(t.byteLength+d.byteLength);h.set(d,0),h.set(new Uint8Array(t),d.byteLength),t=h,r-=d.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(m){if(c<zi)c++;else throw new Error("new Uint8Array error:,"+m.errorMessage)}var p=this.videoTrack,v=this.audioTrack;p.samples=[],v.samples=[],p.videoSenc=null,v.audioSenc=null;var Z,b,L,w=0,W=0;if(this._videoSamples.length>0&&e.length>0){for(var X,S=t.byteLength+r,R=e[0];R<=e[1];R++){if(Z=this._videoSamples[R],!Z)throw new Error("cannot found video frame #".concat(R));Z.offset>=r&&Z.offset+Z.size<=S&&(L=Z.offset-r,w=L+Z.size,b=t.subarray(L,w),X=new Et(Z.pts||Z.dts,Z.dts),X.duration=Z.duration,X.gopId=Z.gopId,X.sampleOffset=Z.index,Z.keyframe&&X.setToKeyframe(),X.data=b,X.size=Z.size,p.samples.push(X))}p.samples.length>0&&(p.gopId=p.samples[0].gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,this.videoSenc&&(p.videoSenc=this.videoSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=l))}if(this._audioSamples.length>0&&i.length>0){for(var T=i[0];T<=i[1];T++){if(Z=this._audioSamples[T],!Z)throw new Error("cannot found video frame #".concat(T));Z.offset>=r&&Z.offset+Z.size<=t.byteLength+r&&(L=Z.offset-r,W=L+Z.size,b=t.subarray(L,W),v.samples.push(new nt(Z.dts,b,Z.duration,Z.index)))}v.samples.length>0&&(v.gopId=v.samples[0].gopId||p.gopId,v.baseMediaDecodeTime=v.samples[0].dts,v.startPts=v.samples[0].pts/v.timescale,v.endPts=v.samples[v.samples.length-1].pts/v.timescale,this.audioSenc&&(v.audioSenc=this.audioSenc.slice(v.samples[0].sampleOffset,v.samples[0].sampleOffset+v.samples.length),v.kidValue=l))}this.decoderData(p,v,u);for(var V=0,Y=0;Y<p.samples.length;Y++)for(var I=0,U=p.samples[Y].data,f=U.length-1;I<f;)V=D(U,I),I+=4,p.samples[Y].units.push(U.subarray(I,I+V)),I+=V;return this._lastRemainBuffer=t.subarray(Math.max(w,W)),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=r+t.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:p,audioTrack:v,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this._videoSamples=[],this._audioSamples=[],this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(t,r,e){t.useEME||r.useEME||or.decoderAESCTRData(t,r,e)}}],[{key:"probe",value:function(t){return $.probe(t)}}]),a}(),ut=new xe("BufferService"),Ks=function(){function a(s,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};pr(this,a),O(this,"flv",null),O(this,"_demuxer",new Hn),O(this,"_remuxer",null),O(this,"_mse",null),O(this,"_softVideo",null),O(this,"_sourceCreated",!1),O(this,"_needInitSegment",!0),O(this,"_discontinuity",!0),O(this,"_contiguous",!1),O(this,"_initSegmentId",""),O(this,"_cachedBuffer",null),O(this,"_demuxStartTime",0),O(this,"_opts",null),this.flv=s,this._opts=r,t?this._softVideo=t:(this._remuxer=new ci(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new he(null,{preferMMS:typeof r.preferMMS=="boolean"?r.preferMMS:!!r.perferMMS}),this._mse.bindMedia(s.media))}return vr(a,[{key:"baseDts",get:function(){var t,r;return(t=this._demuxer)===null||t===void 0||(r=t._fixer)===null||r===void 0?void 0:r._baseDts}},{key:"blobUrl",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.url}},{key:"isFull",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.VIDEO;return this._mse.isFull(t)}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(t){this._contiguous=!1,this._demuxStartTime=t}},{key:"reset",value:function(){var s=Te(ie().mark(function r(){var e,i=arguments;return ie().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){o.next=6;break}return o.next=4,this._mse.unbindMedia();case 4:return o.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="";case 11:case"end":return o.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var s=Te(ie().mark(function r(){return ie().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=7;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.flv.emit(K.BUFFEREOS);case 5:i.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"updateDuration",value:function(){var s=Te(ie().mark(function r(e){return ie().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=7;break}if(this._mse.isOpened){n.next=4;break}return n.next=4,this._mse.open();case 4:return ut.debug("update duration",e),n.next=7,this._mse.updateDuration(e);case 7:case"end":return n.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var s=Te(ie().mark(function r(){return ie().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=3;break}return i.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"appendBuffer",value:function(){var s=Te(ie().mark(function r(e){var i,n,o,l,u,c,d,h,p,v,Z,b,L,w;return ie().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(this._cachedBuffer&&(e=Gt(this._cachedBuffer,e),this._cachedBuffer=null),i=this._demuxer,!(!e||!e.length||!i)){X.next=4;break}return X.abrupt("return");case 4:X.prev=4,i.demuxAndFix(e,this._discontinuity,this._contiguous,this._demuxStartTime),X.next=11;break;case 8:throw X.prev=8,X.t0=X.catch(4),new le(F.DEMUX,F.SUB_TYPES.FLV,X.t0);case 11:if(n=i.videoTrack,o=i.audioTrack,l=i.metadataTrack,u=n.exist(),c=o.exist(),this._opts.onlyAudio&&(u=!1,n.present=!1),this._opts.onlyVideo&&(c=!1,o.present=!1),!(!u&&n.present||!c&&o.present)){X.next=29;break}if(d=0,h=u?n:c?o:void 0,h&&h.samples.length&&(d=(h.samples[h.samples.length-1].originPts-h.samples[0].originPts)/h.timescale*1e3),!(d>this._opts.analyzeDuration)){X.next=27;break}ut.warn("analyze duration exceeded, ".concat(d,"ms"),h),n.present=u,o.present=c,this.flv.emit(K.ANALYZE_DURATION_EXCEEDED,{duration:d}),X.next=29;break;case 27:return this._cachedBuffer=e,X.abrupt("return");case 29:if(p=n.type,v=o.type,this._fireEvents(n,o,l),this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0,Z=this._mse,this.flv.emit(K.DEMUXED_TRACK,{videoTrack:n}),b="".concat(n.codec,"/").concat(n.width,"/").concat(n.height,"/").concat(o.codec,"/").concat(o.config),b!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=b,this._emitMetaParsedEvent(n,o)),!Z){X.next=66;break}if(this._sourceCreated){X.next=47;break}return X.next=43,Z.open();case 43:u&&(ut.log("codec: video/mp4;codecs=".concat(n.codec)),Z.createSource(p,"video/mp4;codecs=".concat(n.codec))),c&&(ut.log("codec: audio/mp4;codecs=".concat(o.codec)),Z.createSource(v,"audio/mp4;codecs=".concat(o.codec))),this._sourceCreated=!0,this.flv.emit(K.SOURCEBUFFER_CREATED);case 47:X.prev=47,this._needInitSegment&&!this._opts.mseLowLatency&&(n.duration=this._opts.durationForMSELowLatencyOff*n.timescale,o.duration=this._opts.durationForMSELowLatencyOff*c.timescale),L=this._remuxer.remux(this._needInitSegment),X.next=55;break;case 52:throw X.prev=52,X.t1=X.catch(47),new le(F.REMUX,F.SUB_TYPES.FMP4,X.t1);case 55:if(!(this._needInitSegment&&!L.videoInitSegment&&!L.audioInitSegment)){X.next=57;break}return X.abrupt("return");case 57:return this._needInitSegment=!1,w=[],L.videoInitSegment&&w.push(Z.append(p,L.videoInitSegment)),L.audioInitSegment&&w.push(Z.append(v,L.audioInitSegment)),L.videoSegment&&w.push(Z.append(p,L.videoSegment)),L.audioSegment&&w.push(Z.append(v,L.audioSegment)),X.abrupt("return",Promise.all(w));case 66:this._softVideo&&this._softVideo.appendBuffer(n,o);case 67:case"end":return X.stop()}},r,this,[[4,8],[47,52]])}));function t(r){return s.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var s=Te(ie().mark(function r(e){var i=this,n,o,l,u;return ie().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(n=this.flv.media,!(!this._mse||!this._demuxer||!n||!e||e<0)){d.next=3;break}return d.abrupt("return");case 3:if(o=n.currentTime,l=o-e,!(l<=0)){d.next=7;break}return d.abrupt("return");case 7:if(u=fe.start(fe.get(n)),!(u+1>=l)){d.next=10;break}return d.abrupt("return");case 10:return d.abrupt("return",this._mse.clearBuffer(0,l).then(function(){return i.flv.emit(K.REMOVE_BUFFER,{removeEnd:l})}));case 11:case"end":return d.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"_emitMetaParsedEvent",value:function(t,r){t.exist()&&this.flv.emit(K.METADATA_PARSED,{type:"video",track:t,meta:{codec:t.codec,timescale:t.timescale,width:t.width,height:t.height,sarRatio:t.sarRatio,baseDts:t.baseDts}}),r.exist()&&this.flv.emit(K.METADATA_PARSED,{type:"audio",track:r,meta:{codec:r.codec,channelCount:r.channelCount,sampleRate:r.sampleRate,timescale:r.timescale,baseDts:r.baseDts}}),ut.debug("track parsed",t,r)}},{key:"_fireEvents",value:function(t,r,e){var i=this;ut.debug(t.samples,r.samples),e.flvScriptSamples.forEach(function(n){i.flv.emit(K.FLV_SCRIPT_DATA,n),ut.debug("flvScriptData",n)}),t.samples.forEach(function(n){n.keyframe&&i.flv.emit(K.KEYFRAME,{pts:n.pts})}),t.warnings.forEach(function(n){var o;switch(n.type){case pe.LARGE_AV_SHIFT:o=K.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP:o=K.LARGE_VIDEO_DTS_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK:o=K.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}o&&i.flv.emit(K.STREAM_EXCEPTION,Ie(Ie({},n),{},{type:o})),ut.warn("video exception",n)}),r.warnings.forEach(function(n){var o;switch(n.type){case pe.LARGE_AUDIO_GAP:o=K.LARGE_AUDIO_DTS_GAP_DETECT;break;case pe.AUDIO_FILLED:o=K.AUDIO_GAP_DETECT;break;case pe.AUDIO_DROPPED:o=K.AUDIO_OVERLAP_DETECT;break}o&&i.flv.emit(K.STREAM_EXCEPTION,Ie(Ie({},n),{},{type:o})),ut.warn("audio exception",n)}),e.seiSamples.forEach(function(n){i.flv.emit(K.SEI,Ie(Ie({},n),{},{sei:{code:n.data.type,content:n.data.payload,dts:n.pts}}))})}}]),a}();function Ps(a){var s=Ie({retryCount:3,retryDelay:1e3,disconnectRetryCount:0,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,defaultVodLoadSize:1e7,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1,preferMMS:!1,mseLowLatency:!0,durationForMSELowLatencyOff:6,chunkCountForSpeed:50,skipChunkSize:1e3,longtimeNoReceived:3e3},a);return s.isLive&&s.preloadTime&&(s.maxLatency||(s.maxLatency=s.preloadTime*2),s.targetLatency||(s.targetLatency=s.preloadTime),(s.disconnectTime===null||s.disconnectTime===void 0)&&(s.disconnectTime=s.maxLatency)),s}function Ji(a,s){var t=0,r=a.length-1,e=0,i=0,n=r;for(s<a[0]&&(t=0,i=n+1);i<=n;)if(e=i+Math.floor((n-i)/2),e===r||s>=a[e]&&s<a[e+1]){t=e;break}else a[e]<s?i=e+1:n=e-1;return t}var ct=new xe("flv"),er=.1,Hs=.3,Jt=function(a){yn(t,a);var s=bn(t);function t(r){var e;return pr(this,t),e=s.call(this),O(ee(e),"media",null),O(ee(e),"_loading",!1),O(ee(e),"_opts",null),O(ee(e),"_bufferService",null),O(ee(e),"_gapService",null),O(ee(e),"_stats",null),O(ee(e),"_mediaLoader",null),O(ee(e),"_maxChunkWaitTimer",null),O(ee(e),"_tickTimer",null),O(ee(e),"_tickInterval",500),O(ee(e),"_urlSwitching",!1),O(ee(e),"_seamlessSwitching",!1),O(ee(e),"_disconnectRetryCount",0),O(ee(e),"_preLoadEndPoint",0),O(ee(e),"_keyframes",null),O(ee(e),"_acceptRanges",!0),O(ee(e),"_onProgress",function(){var i=Te(ie().mark(function n(o,l,u,c){var d,h,p,v,Z,b,L,w,W;return ie().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(d=u.startTime,h=u.endTime,p=u.st,v=u.firstByteTime,e._loading=!l,e._firstProgressEmit){S.next=11;break}if(e.media){S.next=6;break}return(Z=e._mediaLoader)===null||Z===void 0||Z.cancel(),S.abrupt("return");case 6:b=c.headers,e.emit(K.TTFB,{url:e._opts.url,responseUrl:c.url,elapsed:p?v-p:h-d}),e.emit(K.LOAD_RESPONSE_HEADERS,{headers:b}),e._acceptRanges=!!(b!=null&&b.get("Accept-Ranges"))||!!(b!=null&&b.get("Content-Range")),e._firstProgressEmit=!0;case 11:if(e._bufferService){S.next=13;break}return S.abrupt("return");case 13:return clearTimeout(e._maxChunkWaitTimer),e._bandwidthService.addChunkRecord(o==null?void 0:o.byteLength,h-d),S.prev=15,S.next=18,e._bufferService.appendBuffer(o);case 18:(L=e._bufferService)===null||L===void 0||L.evictBuffer(e._opts.bufferBehind),S.next=31;break;case 21:if(S.prev=21,S.t0=S.catch(15),!(!e.isLive&&e._bufferService.isFull())){S.next=30;break}return S.next=26,e._mediaLoader.cancel();case 26:return e._loading=!1,w=e.bufferInfo().remaining,e._opts.preloadTime=parseInt(w)/2,S.abrupt("return");case 30:return S.abrupt("return",e._emitError(le.create(S.t0)));case 31:if(e._urlSwitching&&(e._urlSwitching=!1,e.emit(K.SWITCH_URL_SUCCESS,{url:e._opts.url})),e._seamlessSwitching&&(e._seamlessSwitching=!1,e._tick()),!(l&&!e.media.seeking)){S.next=38;break}return e.emit(K.LOAD_COMPLETE),ct.debug("load done"),e.isLive&&e._disconnectRetryCount<=0&&e._end(),S.abrupt("return");case 38:if(e.isLive){S.next=40;break}return S.abrupt("return");case 40:W=e._opts.maxReaderInterval,W&&e._firstProgressEmit&&(clearTimeout(e._maxChunkWaitTimer),e._maxChunkWaitTimer=setTimeout(function(){if(e._disconnectRetryCount){e._disconnectRetryCount--,e.load();return}ct.debug("onMaxChunkWait",W),e._end()},W));case 42:case"end":return S.stop()}},n,null,[[15,21]])}));return function(n,o,l,u){return i.apply(this,arguments)}}()),O(ee(e),"_onRetryError",function(i,n){ct.debug("load retry",i,n),e.emit(K.LOAD_RETRY,{error:le.network(i),retryTime:n})}),O(ee(e),"_end",function(){e._clear(),e._bufferService&&e._bufferService.endOfStream(),ct.debug("end stream")}),O(ee(e),"_resetDisconnectCount",function(){e._disconnectRetryCount=e._opts.disconnectRetryCount}),O(ee(e),"_tick",function(){clearTimeout(e._tickTimer);var i=ee(e),n=i.media;if(n){e._tickTimer=setTimeout(e._tick,e._tickInterval);var o=fe.end(fe.get(n));if(!(o<er||!n.readyState)){var l=e._opts;if(wn(n))e._gapService&&e._gapService.do(n,l.maxJumpDistance,e.isLive,3);else{if(!n.currentTime&&e._gapService){var u=e._opts.mseLowLatency||e._opts.mseLowLatency===!1&&e.bufferInfo(Hs).nextStart;u&&e._gapService.do(n,l.maxJumpDistance,e.isLive,3);return}l.isLive&&n.readyState===4&&o-n.currentTime>l.disconnectTime&&e.disconnect()}}}}),O(ee(e),"_onPlay",function(){var i,n,o=e._opts.softDecode||((i=e.media)===null||i===void 0||(n=i.buffered)===null||n===void 0?void 0:n.length);if(e.isLive){!e._loading&&o&&e.replay(void 0,!0);return}var l=e.bufferInfo();(l.start||l.nextStart)>er&&e._tick()}),O(ee(e),"_onLoadeddata",function(){e.isLive&&!e._opts.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(i){})}),O(ee(e),"_onSeeking",Te(ie().mark(function i(){return ie().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:!e.isLive&&e.seekable&&(e._preLoadEndPoint=-1,e._checkPreload());case 1:case"end":return o.stop()}},i)}))),O(ee(e),"_onTimeupdate",function(){if(e.media){var i=e._opts,n=e.media.currentTime;if(i.isLive&&i.maxLatency&&i.targetLatency){var o=fe.end(fe.get(e.media)),l=o-n;l>=i.maxLatency&&(e.media.currentTime=o-i.targetLatency,e.emit(K.CHASEFRAME,{currentTime:e.media.currentTime,latency:i.targetLatency}))}e._seiService.throw(n,!0),!(i.isLive||!e.seekable||e._loading)&&e._checkPreload()}}),O(ee(e),"_onWaiting",function(){e.isLive&&!e._loading&&e._disconnectRetryCount&&(e._disconnectRetryCount--,e.load())}),O(ee(e),"_onBufferUpdate",function(){if(!e._opts.isLive){var i=e.bufferInfo(),n=i.end,o=i.nextEnd;Math.abs((n||o)-e.media.duration)<1&&(e._end(),e.media.readyState<=2&&e._tick())}}),O(ee(e),"_checkPreload",Te(ie().mark(function i(){var n,o,l,u,c,d,h,p,v,Z;return ie().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(n=e.bufferInfo(),o=n.remaining,l=o===void 0?0:o,u=e._opts,c=e._keyframes.filepositions,d=e._keyframes.times,h=e.media.currentTime,!(l<u.preloadTime)){L.next=19;break}if(p=Ji(e._keyframes.times,h+l+er),v=Ji(e._keyframes.times,h+l+e._opts.preloadTime),v===p&&(v=p+1),e._preLoadEndPoint!==v){L.next=11;break}return L.abrupt("return");case 11:if(Z=c[p],Z!=null){L.next=14;break}return L.abrupt("return");case 14:return L.next=16,e._mediaLoader.cancel();case 16:e._loadData(null,[Z,c[v]]),e._preLoadEndPoint=v,e._bufferService.unContiguous(d[p]);case 19:case"end":return L.stop()}},i)}))),O(ee(e),"_onFlvScriptData",function(i){var n,o,l,u,c=(n=i.data)===null||n===void 0||(o=n.onMetaData)===null||o===void 0?void 0:o.keyframes,d=(l=i.data)===null||l===void 0||(u=l.onMetaData)===null||u===void 0?void 0:u.duration;c&&(e._keyframes=c),!e._opts.isLive&&d&&e._bufferService.updateDuration(d)}),e._opts=Ps(r),e.media=e._opts.media||document.createElement("video"),e._opts.media=null,e._firstProgressEmit=!1,e._mediaLoader=new pt(Ie(Ie({},e._opts.fetchOptions),{},{retry:e._opts.retryCount,retryDelay:e._opts.retryDelay,timeout:e._opts.loadTimeout,onRetryError:e._onRetryError,onProgress:e._onProgress,responseType:"arraybuffer"})),e._disconnectRetryCount=e._opts.disconnectRetryCount,e._bufferService=new Ks(ee(e),e._opts.softDecode?e.media:void 0,e._opts),e._seiService=new Tn(ee(e)),e._bandwidthService=new kn({chunkCountForSpeed:e._opts.chunkCountForSpeed,skipChunkSize:e._opts.skipChunkSize,longtimeNoReceived:e._opts.longtimeNoReceived}),e._stats=new xn(ee(e)),e._opts.softDecode||(e._gapService=new Vn),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e.media.addEventListener("progress",e._onBufferUpdate),e.media.addEventListener("waiting",e._onWaiting),e.on(K.FLV_SCRIPT_DATA,e._onFlvScriptData),e}return vr(t,[{key:"version",get:function(){return"3.0.19"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"loader",get:function(){return this._mediaLoader}},{key:"blobUrl",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.blobUrl}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed(),totalSize:this._bandwidthService.getTotalSize(),totalCost:this._bandwidthService.getTotalCost()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:er;return fe.info(fe.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"playbackQuality",value:function(){return Rn(this.media)}},{key:"load",value:function(){var r=Te(ie().mark(function i(n){var o,l=arguments;return ie().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o=l.length>1&&l[1]!==void 0?l[1]:!1,this._bufferService){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,this._reset(o);case 5:this._loadData(n,this._opts.isLive?[]:[0,this._opts.defaultVodLoadSize]),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return c.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"replay",value:function(){var r=Te(ie().mark(function i(){var n=this,o,l,u=arguments;return ie().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(o=u.length>0&&u[0]!==void 0?u[0]:this._opts.seamlesslyReload,l=u.length>1?u[1]:void 0,this.media){d.next=4;break}return d.abrupt("return");case 4:if(this._resetDisconnectCount(),!o){d.next=11;break}return d.next=8,this._clear();case 8:setTimeout(function(){n._loadData(n._opts.url),n._bufferService.seamlessSwitch(),n._seamlessSwitching=!0}),d.next=13;break;case 11:return d.next=13,this.load();case 13:return d.abrupt("return",this.media.play(!l).catch(function(){}));case 14:case"end":return d.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"disconnect",value:function(){return ct.debug("disconnect!"),this._clear()}},{key:"switchURL",value:function(){var r=Te(ie().mark(function i(n,o){var l=this;return ie().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this._bufferService){c.next=2;break}return c.abrupt("return");case 2:if(this._resetDisconnectCount(),!(!o||!this._opts.isLive)){c.next=8;break}return c.next=6,this.load(n);case 6:return this._urlSwitching=!0,c.abrupt("return",this.media.play(!0).catch(function(){}));case 8:return c.next=10,this._clear();case 10:setTimeout(function(){l._urlSwitching=!0,l._seamlessSwitching=!0,l._loadData(n),l._bufferService.seamlessSwitch()});case 11:case"end":return c.stop()}},i,this)}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=Te(ie().mark(function i(){return ie().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.media){o.next=2;break}return o.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),this.media.removeEventListener("waiting",this._onWaiting),this.media.removeEventListener("progress",this._onBufferUpdate),o.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null,this._bufferService=null;case 14:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_emitError",value:function(e){var i,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;ct.table(e),ct.error(e),ct.error((i=this.media)===null||i===void 0?void 0:i.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(K.SWITCH_URL_FAILED,e)),this.emit(K.ERROR,e),n&&(this._seiService.reset(),this._end())}},{key:"_reset",value:function(){var r=Te(ie().mark(function i(){var n,o=arguments;return ie().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=o.length>0&&o[0]!==void 0?o[0]:!1,this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),u.next=6,this._clear();case 6:return u.next=8,this._bufferService.reset(n);case 8:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var r=Te(ie().mark(function i(n,o){var l;return ie().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n&&(this._opts.url=n),l=n=this._opts.url,n){c.next=4;break}throw new Error("Source url is missing");case 4:if(this._opts.preProcessUrl&&(l=this._opts.preProcessUrl(n).url),this._mediaLoader.finnalUrl=l,this.emit(K.LOAD_START,{url:l,seamlessSwitching:this._seamlessSwitching}),ct.debug("load data, loading:",this._loading,l),!this._loading){c.next=11;break}return c.next=11,this._mediaLoader.cancel();case 11:return this._loading=!0,c.prev=12,c.next=15,this._mediaLoader.load({url:l,range:o});case 15:c.next=21;break;case 17:return c.prev=17,c.t0=c.catch(12),this._loading=!1,c.abrupt("return",this._emitError(le.network(c.t0),!1));case 21:case"end":return c.stop()}},i,this,[[12,17]])}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"_clear",value:function(){var r=Te(ie().mark(function i(){return ie().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._mediaLoader){o.next=3;break}return o.next=3,this._mediaLoader.cancel();case 3:clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),this._loading=!1,this._firstProgressEmit=!1;case 7:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?he.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){xe.enable(),Rt.enable()}},{key:"disableLogger",value:function(){xe.disable(),Rt.disable()}}]),t}(yt);try{localStorage.getItem("xgd")?Jt.enableLogger():Jt.disableLogger()}catch{}var Ns=function(){function a(s,t){var r=this;pr(this,a),O(this,"_onLowDecode",function(){var e,i,n,o,l=r._opts,u=l.media,c=l.innerDegrade,d=l.backupURL;(e=r._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",u.degradeInfo),(n=r._plugin)===null||n===void 0||(o=n.player)===null||o===void 0||o.emit("core_event",Ie(Ie({},u.degradeInfo),{},{eventName:K.LOWDECODE})),(c===1||c===3)&&d&&r._degrade(d)}),O(this,"_degrade",function(e){var i=r._plugin.player,n=i.video;if((n==null?void 0:n.TAG)==="MVideo"){var o=i.video.degradeVideo;i.video=o,n.degrade(e),e&&(i.config.url=e);var l=i.root.firstChild;l.TAG==="MVideo"&&i.root.replaceChild(o,l);var u=r._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(u),i.once("canplay",function(){i.play()})}}),O(this,"forceDegradeToVideo",function(e){var i=r._opts.innerDegrade;(i===1||i===3)&&r._degrade(e)}),this._opts=s,this._plugin=t,this._init()}return vr(a,[{key:"_init",value:function(){var t=this._opts,r=t.media,e=t.preloadTime,i=t.innerDegrade,n=t.decodeMode;r&&(i&&r.setAttribute("innerdegrade",i),e&&r.setAttribute("preloadtime",e),r.setDecodeMode&&r.setDecodeMode(n),this._bindEvents())}},{key:"_bindEvents",value:function(){var t=this._opts.media;t.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var t,r;(t=this._opts)===null||t===void 0||(r=t.media)===null||r===void 0||r.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),a}(),Ds=function(a){yn(t,a);var s=bn(t);function t(){var r;pr(this,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return r=s.call.apply(s,[this].concat(i)),O(ee(r),"flv",null),O(ee(r),"pluginExtension",null),O(ee(r),"getStats",function(){var o;return(o=r.flv)===null||o===void 0?void 0:o.getStats()}),O(ee(r),"destroy",function(){var o;r.flv&&(r.flv.destroy(),r.flv=null),(o=r.pluginExtension)===null||o===void 0||o.destroy(),r.pluginExtension=null}),O(ee(r),"_onSwitchURL",function(o,l){if(r.flv){var u,c;r.player.config.url=o,Nr(l)==="object"&&(l=l.seamless),r.flv.switchURL(o,l),!l&&(u=r.player.config)!==null&&u!==void 0&&(c=u.flv)!==null&&c!==void 0&&c.keepStatusAfterSwitch&&r._keepPauseStatus()}}),O(ee(r),"_keepPauseStatus",function(){var o=r.player.paused;o&&r.player.once("canplay",function(){r.player.pause()})}),O(ee(r),"_onDefinitionChange",function(o){var l=o.to;r.flv&&r.flv.switchURL(l)}),r}return vr(t,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,n=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!n&&n!=="video"&&n!=="audio"}},{key:"loader",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.loader}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config;if(i.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var n=i.flv||{};if((n.disconnectTime===null||n.disconnectTime===void 0)&&(n.disconnectTime=0),this.flv=new Jt(Ie({softDecode:this.softDecode,isLive:i.isLive,media:this.player.video,preProcessUrl:function(u,c){var d,h;return((d=e.player)===null||d===void 0||(h=d.preProcessUrl)===null||h===void 0?void 0:h.call(d,u,c))||{url:u,ext:c}}},n)),this.softDecode||_t.defineGetterOrSetter(this.player,{url:{get:function(){var u;return(u=e.flv)===null||u===void 0?void 0:u.blobUrl},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Ns(Ie({media:this.player.video},i.flv),this),this.player.forceDegradeToVideo=function(){for(var l,u=arguments.length,c=new Array(u),d=0;d<u;d++)c[d]=arguments[d];return(l=e.pluginExtension)===null||l===void 0?void 0:l.forceDegradeToVideo.apply(l,c)}),i.isLive){var o;(o=this.player)===null||o===void 0||o.useHooks("replay",function(){var l;return(l=e.flv)===null||l===void 0?void 0:l.replay()})}this.on(Ht,this._onSwitchURL),this.on(pn,this.destroy),this._transError(),this._transCoreEvent(K.TTFB),this._transCoreEvent(K.LOAD_START),this._transCoreEvent(K.LOAD_RESPONSE_HEADERS),this._transCoreEvent(K.LOAD_COMPLETE),this._transCoreEvent(K.LOAD_RETRY),this._transCoreEvent(K.SOURCEBUFFER_CREATED),this._transCoreEvent(K.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(K.REMOVE_BUFFER),this._transCoreEvent(K.BUFFEREOS),this._transCoreEvent(K.KEYFRAME),this._transCoreEvent(K.CHASEFRAME),this._transCoreEvent(K.METADATA_PARSED),this._transCoreEvent(K.SEI),this._transCoreEvent(K.SEI_IN_TIME),this._transCoreEvent(K.FLV_SCRIPT_DATA),this._transCoreEvent(K.STREAM_EXCEPTION),this._transCoreEvent(K.SWITCH_URL_SUCCESS),this._transCoreEvent(K.SWITCH_URL_FAILED),this.flv.load(i.url,!0)}}},{key:"_transError",value:function(){var e=this;this.flv.on(K.ERROR,function(i){e.player&&e.player.emit(vn,new St(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.flv.on(e,function(n){i.player&&i.player.emit("core_event",Ie(Ie({},n),{},{eventName:e}))})}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e,i){return Jt.isSupported(e,i)}},{key:"isSupportedMMS",value:function(){return typeof ManagedMediaSource<"u"}}]),t}(_t);O(Ds,"Flv",Jt);function Fs(a,s){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var r,e,i,n,o=[],l=!0,u=!1;try{if(i=(t=t.call(a)).next,s===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==s);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(n=t.return(),Object(n)!==n))return}finally{if(u)throw e}}return o}}function Oi(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,r)}return t}function ne(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?Oi(Object(t),!0).forEach(function(r){x(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Oi(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function J(){J=function(){return a};var a={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,G){return m[y]=G}}function u(f,m,y,G){var g=m&&m.prototype instanceof h?m:h,k=Object.create(g.prototype),M=new Y(G||[]);return r(k,"_invoke",{value:S(f,y,M)}),k}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(G){return{type:"throw",arg:G}}}a.wrap=u;var d={};function h(){}function p(){}function v(){}var Z={};l(Z,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==s&&t.call(L,i)&&(Z=L);var w=v.prototype=h.prototype=Object.create(Z);function W(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function X(f,m){function y(g,k,M,H){var C=c(f[g],f,k);if(C.type!=="throw"){var P=C.arg,A=P.value;return A&&typeof A=="object"&&t.call(A,"__await")?m.resolve(A.__await).then(function(N){y("next",N,M,H)},function(N){y("throw",N,M,H)}):m.resolve(A).then(function(N){P.value=N,M(P)},function(N){return y("throw",N,M,H)})}H(C.arg)}var G;r(this,"_invoke",{value:function(g,k){function M(){return new m(function(H,C){y(g,k,H,C)})}return G=G?G.then(M,M):M()}})}function S(f,m,y){var G="suspendedStart";return function(g,k){if(G==="executing")throw new Error("Generator is already running");if(G==="completed"){if(g==="throw")throw k;return U()}for(y.method=g,y.arg=k;;){var M=y.delegate;if(M){var H=R(M,y);if(H){if(H===d)continue;return H}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(G==="suspendedStart")throw G="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);G="executing";var C=c(f,m,y);if(C.type==="normal"){if(G=y.done?"completed":"suspendedYield",C.arg===d)continue;return{value:C.arg,done:y.done}}C.type==="throw"&&(G="completed",y.method="throw",y.arg=C.arg)}}}function R(f,m){var y=m.method,G=f.iterator[y];if(G===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,R(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var g=c(G,f.iterator,m.arg);if(g.type==="throw")return m.method="throw",m.arg=g.arg,m.delegate=null,d;var k=g.arg;return k?k.done?(m[f.resultName]=k.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):k:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function T(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function V(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function Y(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(T,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,G=function g(){for(;++y<f.length;)if(t.call(f,y))return g.value=f[y],g.done=!1,g;return g.value=void 0,g.done=!0,g};return G.next=G}}return{next:U}}function U(){return{value:void 0,done:!0}}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),a.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},a.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(w),f},a.awrap=function(f){return{__await:f}},W(X.prototype),l(X.prototype,n,function(){return this}),a.AsyncIterator=X,a.async=function(f,m,y,G,g){g===void 0&&(g=Promise);var k=new X(u(f,m,y,G),g);return a.isGeneratorFunction(m)?k:k.next().then(function(M){return M.done?M.value:k.next()})},W(w),l(w,o,"Generator"),l(w,i,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),a.keys=function(f){var m=Object(f),y=[];for(var G in m)y.push(G);return y.reverse(),function g(){for(;y.length;){var k=y.pop();if(k in m)return g.value=k,g.done=!1,g}return g.done=!0,g}},a.values=I,Y.prototype={constructor:Y,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(C,P){return k.type="throw",k.arg=f,m.next=C,P&&(m.method="next",m.arg=void 0),!!P}for(var G=this.tryEntries.length-1;G>=0;--G){var g=this.tryEntries[G],k=g.completion;if(g.tryLoc==="root")return y("end");if(g.tryLoc<=this.prev){var M=t.call(g,"catchLoc"),H=t.call(g,"finallyLoc");if(M&&H){if(this.prev<g.catchLoc)return y(g.catchLoc,!0);if(this.prev<g.finallyLoc)return y(g.finallyLoc)}else if(M){if(this.prev<g.catchLoc)return y(g.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return y(g.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var G=this.tryEntries[y];if(G.tryLoc<=this.prev&&t.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var g=G;break}}g&&(f==="break"||f==="continue")&&g.tryLoc<=m&&m<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=f,k.arg=m,g?(this.method="next",this.next=g.finallyLoc,d):this.complete(k)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),V(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var G=y.completion;if(G.type==="throw"){var g=G.arg;V(y)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},a}function dr(a){"@babel/helpers - typeof";return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},dr(a)}function ji(a,s,t,r,e,i,n){try{var o=a[i](n),l=o.value}catch(u){t(u);return}o.done?s(l):Promise.resolve(l).then(r,e)}function ae(a){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=a.apply(s,t);function n(l){ji(i,r,e,n,o,"next",l)}function o(l){ji(i,r,e,n,o,"throw",l)}n(void 0)})}}function ge(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function Bi(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,ra(r.key),r)}}function Se(a,s,t){return s&&Bi(a.prototype,s),t&&Bi(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function x(a,s,t){return s=ra(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function Lr(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&ti(a,s)}function hr(a){return hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hr(a)}function ti(a,s){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ti(a,s)}function Us(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zs(a,s){if(a==null)return{};var t={},r=Object.keys(a),e,i;for(i=0;i<r.length;i++)e=r[i],!(s.indexOf(e)>=0)&&(t[e]=a[e]);return t}function Ai(a,s){if(a==null)return{};var t=zs(a,s),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(e=0;e<i.length;e++)r=i[e],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(t[r]=a[r])}return t}function Q(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Js(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q(a)}function Xr(a){var s=Us();return function(){var r=hr(a),e;if(s){var i=hr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Js(this,e)}}function ht(a,s){return Bs(a)||Fs(a,s)||ta(a,s)||$s()}function Os(a){return js(a)||As(a)||ta(a)||Qs()}function js(a){if(Array.isArray(a))return ri(a)}function Bs(a){if(Array.isArray(a))return a}function As(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function ta(a,s){if(a){if(typeof a=="string")return ri(a,s);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ri(a,s)}}function ri(a,s){(s==null||s>a.length)&&(s=a.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=a[t];return r}function Qs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $s(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qs(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function ra(a){var s=qs(a,"string");return typeof s=="symbol"?s:String(s)}var eo=function(){function a(){ge(this,a);var s=window.crypto||window.msCrypto;this.subtle=s&&(s.subtle||s.webkitSubtle),this.externalDecryptor=null}return Se(a,[{key:"destroy",value:function(){var t;(t=this.externalDecryptor)!==null&&t!==void 0&&t.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(t,r){if(!(!t&&!r)){var e=[];return t&&(e[0]=this._decryptSegment(t)),r&&(e[1]=this._decryptSegment(r)),Promise.all(e)}}},{key:"_decryptSegment",value:function(){var s=ae(J().mark(function r(e){var i;return J().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=e.data,!e.key){o.next=5;break}return o.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:i=o.sent;case 5:if(e.map){o.next=7;break}return o.abrupt("return",i);case 7:return o.abrupt("return",Gt(e.map,i));case 8:case"end":return o.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"_decryptData",value:function(){var s=ae(J().mark(function r(e,i,n){var o;return J().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!this.externalDecryptor){u.next=6;break}return u.next=3,this.externalDecryptor.decrypt(e,i,n);case 3:return u.abrupt("return",u.sent);case 6:if(this.subtle){u.next=8;break}throw new Error("crypto is not defined");case 8:return u.next=10,this.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return o=u.sent,u.t0=Uint8Array,u.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},o,e);case 14:return u.t1=u.sent,u.abrupt("return",new u.t0(u.t1));case 16:case"end":return u.stop()}},r,this)}));function t(r,e,i){return s.apply(this,arguments)}return t}()}]),a}(),te=ne(ne({},K),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),Er=new xe("Transmuxer"),Qi=function(){function a(s,t,r,e){ge(this,a),x(this,"_initSegmentId",""),this.hls=s,this._demuxer=t?new Dn:new Nn(null,null,null,e),this._isMP4=t,r&&(this._remuxer=new ci(this._demuxer.videoTrack,this._demuxer.audioTrack))}return Se(a,[{key:"transmux",value:function(t,r,e,i,n,o){var l=this._demuxer;try{this._isMP4?l.demux(t,r):l.demuxAndFix(Gt(t,r),e,i,n)}catch(R){throw new le(F.DEMUX,F.SUB_TYPES.HLS,R)}var u=l.videoTrack,c=l.audioTrack,d=l.metadataTrack,h={codec:u.codec,timescale:u.timescale,firstDts:u.firstDts/u.timescale,firstPts:u.firstPts/u.timescale,duration:u.samplesDuration/u.timescale},p={codec:c.codec,timescale:c.timescale,firstDts:c.firstDts/u.timescale,firstPts:c.firstPts/u.timescale,duration:c.samplesDuration/u.timescale},v="".concat(u.codec,"/").concat(u.width,"/").concat(u.height,"/").concat(c.codec,"/").concat(c.config);if(v!==this._initSegmentId&&(this._initSegmentId=v,o=!0),this._fireEvents(u,c,d,e||o),this.hls.emit(te.DEMUXED_TRACK,{videoTrack:u,audioTrack:c}),this._remuxer){o&&this.hls.isLive&&!this.hls.config.mseLowLatency&&(u.duration=this.hls.totalDuration*u.timescale,c.duration=this.hls.totalDuration*c.timescale);try{var Z=this._remuxer.remux(o),b=Z.videoInitSegment,L=Z.videoSegment,w=Z.audioInitSegment,W=Z.audioSegment,X=Gt(b,L),S=Gt(w,W);return[X?ne(ne({},h),{},{data:X}):void 0,S?ne(ne({},p),{},{data:S}):void 0]}catch(R){throw new le(F.REMUX,F.SUB_TYPES.FMP4,R)}}else return[u,c]}},{key:"_fireEvents",value:function(t,r,e,i){var n=this,o=[t,r],l="discontinuity: ".concat(i);o.forEach(function(u){var c;(c=u.samples)!==null&&c!==void 0&&c.length&&(l+="; ".concat(u.samples.length," ").concat(u.type===vt.VIDEO?"video":"audio"," samples, firstDts/firstPts/duration: ").concat((u.firstDts/u.timescale).toFixed(3),"/").concat((u.firstPts/u.timescale).toFixed(3),"/").concat((u.samplesDuration/u.timescale).toFixed(3))),i&&u.exist()&&n.hls.emit(te.METADATA_PARSED,{type:u.type,track:u,meta:ne({codec:u.codec,timescale:u.timescale,baseDts:u.baseDts},u.type===vt.VIDEO?{width:u.width,height:u.height,sarRatio:u.sarRatio}:{codec:u.codec,channelCount:u.channelCount,sampleRate:u.sampleRate})})}),Er.debug(l),t.warnings.forEach(function(u){var c;switch(u.type){case pe.LARGE_AV_SHIFT:c=te.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP:c=te.LARGE_VIDEO_DTS_GAP_DETECT;break;case pe.LARGE_VIDEO_GAP_BETWEEN_CHUNK:c=te.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}c&&n.hls.emit(te.STREAM_EXCEPTION,ne(ne({},u),{},{type:c})),Er.warn("video exception",u)}),r.warnings.forEach(function(u){var c;switch(u.type){case pe.LARGE_AUDIO_GAP:c=te.LARGE_AUDIO_DTS_GAP_DETECT;break;case pe.AUDIO_FILLED:c=te.AUDIO_GAP_DETECT;break;case pe.AUDIO_DROPPED:c=te.AUDIO_OVERLAP_DETECT;break}c&&n.hls.emit(te.STREAM_EXCEPTION,ne(ne({},u),{},{type:c})),Er.warn("audio exception",u)}),t.samples.forEach(function(u){u.keyframe&&n.hls.emit(te.KEYFRAME,{pts:u.pts})}),e.seiSamples.forEach(function(u){n.hls.emit(te.SEI,ne(ne({},u),{},{originPts:u.originPts/90,sei:{code:u.data.type,content:u.data.payload,dts:u.pts}}))})}}]),a}(),to=["data"],ro=["data"],$i=new xe("BufferService"),io=function(){function a(s){var t=this;ge(this,a),x(this,"_decryptor",new eo),x(this,"_transmuxer",null),x(this,"_mse",null),x(this,"_softVideo",null),x(this,"_sourceCreated",!1),x(this,"_needInitSegment",!0),x(this,"_directAppend",!1),this.hls=s,s.config.softDecode?this._softVideo=s.media:(this._mse=new he(null,{preferMMS:s.config.preferMMS}),s.config.url&&this._mse.bindMedia(s.media).then(function(r){t.hls.emit(K.MEDIASOURCE_OPENED,r)})),s.config.decryptor&&(this._decryptor.externalDecryptor=s.config.decryptor)}return Se(a,[{key:"baseDts",get:function(){var t,r,e;return(t=this._transmuxer)===null||t===void 0||(r=t._demuxer)===null||r===void 0||(e=r._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var t;return(t=this._mse)!==null&&t!==void 0&&t._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpened",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.isOpened}},{key:"msHasOpTasks",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.hasOpTasks}},{key:"msStreaming",get:function(){var t;return(t=this._mse)===null||t===void 0?void 0:t.streaming}},{key:"updateDuration",value:function(){var s=ae(J().mark(function r(e){return J().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if($i.debug("update duration",e),!this._mse){n.next=9;break}if(this._mse.isOpened){n.next=5;break}return n.next=5,this._mse.open();case 5:return n.next=7,this._mse.updateDuration(e);case 7:n.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return n.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"createSource",value:function(t,r,e,i){if(!this._sourceCreated){var n=t||r;if(n){if(Nn.probe(n))this._transmuxer||(this._transmuxer=new Qi(this.hls,!1,!this._softVideo,this.hls.config.fixerConfig));else if($.probe(n))if(this._softVideo)this._transmuxer||(this._transmuxer=new Qi(this.hls,!0,null,this.hls.config.fixerConfig));else{this._directAppend=!0;var o=!1;t&&!e&&$.findBox(t,["moov","trak"]).forEach(function(l){var u=$.findBox(l.data,["trak","mdia","minf","stbl","stsd"])[0];if(u){var c=$.stsd(u).entries[0];if(c){if(c.hvcC)e=c.hvcC.codec||"hev1.1.6.L93.B0";else if(c.avcC)e=c.avcC.codec;else if(c.sampleRate||c.esds){var d;i=((d=c.esds)===null||d===void 0?void 0:d.codec)||"mp4a.40.2",o=!0}}}}),r&&!i&&$.findBox(r,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(l){var u=$.stsd(l).entries[0];u&&u.esds&&(i=u.esds.codec)}),t&&!e&&(e="avc1.42e01e"),r&&!i&&(i="mp4a.40.2"),o&&(e+=", ".concat(i),i=""),this._createMseSource(e,i)}else throw new le(F.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var s=ae(J().mark(function r(e,i,n,o,l,u,c){var d,h,p,v,Z,b,L,w,W,X,S,R,T;return J().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!(!(n!=null&&n.length)&&!(o!=null&&o.length))){Y.next=2;break}return Y.abrupt("return");case 2:if(!this._directAppend){Y.next=7;break}return d=[],n&&d.push(this._mse.append(he.VIDEO,n)),o&&d.push(this._mse.append(he.AUDIO,o)),Y.abrupt("return",Promise.all(d));case 7:if(h=this._needInitSegment||l,p=this._transmuxer.transmux(n,o,h,u,c,this._needInitSegment||l),v=ht(p,2),Z=v[0],b=v[1],o&&i&&(i==null||i.setTrackExist(!1,!0)),o&&e&&(e==null||e.setTrackExist(!0,!1)),i||e==null||e.setTrackExist(!!Z,!!b),Z&&!b&&this.hls.emit(te.NO_AUDIO_TRACK),!this._softVideo){Y.next=18;break}this._softVideo.appendBuffer(Z,b),this._needInitSegment=!1,Y.next=28;break;case 18:if(!this._mse){Y.next=28;break}return L=!this._sourceCreated,L&&this._createMseSource(Z==null?void 0:Z.codec,b==null?void 0:b.codec),this._needInitSegment=!1,w=this._mse,W=[],h&&!L&&this._handleCodecChange(Z,b).forEach(function(I){return W.push(I)}),Z&&(X=Z.data,S=Ai(Z,to),W.push(w.append(he.VIDEO,X,S))),b&&(R=b.data,T=Ai(b,ro),W.push(w.append(he.AUDIO,R,T))),Y.abrupt("return",Promise.all(W));case 28:case"end":return Y.stop()}},r,this)}));function t(r,e,i,n,o,l,u){return s.apply(this,arguments)}return t}()},{key:"removeBuffer",value:function(){var s=ae(J().mark(function r(){var e=this,i,n,o,l=arguments;return J().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=l.length>0&&l[0]!==void 0?l[0]:0,n=l.length>1&&l[1]!==void 0?l[1]:1/0,o=this.hls.media,!(!this._mse||!o||i<0||n<i||i>=this._mse.duration)){c.next=5;break}return c.abrupt("return");case 5:return c.abrupt("return",this._mse.clearBuffer(i,n).then(function(){return e.hls.emit(K.REMOVE_BUFFER,{start:i,end:n,removeEnd:n})}));case 6:case"end":return c.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var s=ae(J().mark(function r(e){var i,n,o,l;return J().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=this.hls.media,!(!this._mse||!i||!e||e<0)){c.next=3;break}return c.abrupt("return");case 3:if(n=i.currentTime,o=n-e,!(o<=0)){c.next=7;break}return c.abrupt("return");case 7:if(l=fe.start(fe.get(i)),!(l+1>=o)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this.removeBuffer(0,o));case 11:case"end":return c.stop()}},r,this)}));function t(r){return s.apply(this,arguments)}return t}()},{key:"clearAllBuffer",value:function(){var s=ae(J().mark(function r(){return J().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=2;break}return i.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"decryptBuffer",value:function(t,r){return this._decryptor.decrypt(t,r)}},{key:"reset",value:function(){var s=ae(J().mark(function r(){var e,i=arguments;return J().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e=i.length>0&&i[0]!==void 0?i[0]:!1,!(this._mse&&!e)){o.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,o.next=6,this._mse.unbindMedia();case 6:return o.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return o.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var s=ae(J().mark(function r(){return J().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this._mse){i.next=5;break}if(!this._sourceCreated){i.next=5;break}return i.next=4,this._mse.endOfStream();case 4:this.hls.emit(K.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"setLiveSeekableRange",value:function(){var s=ae(J().mark(function r(e,i){return J().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,i);case 1:case"end":return o.stop()}},r,this)}));function t(r,e){return s.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var s=ae(J().mark(function r(){var e;return J().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if((e=this._decryptor)===null||e===void 0||e.destroy(),!this._mse){n.next=4;break}return n.next=4,this._mse.unbindMedia();case 4:this._decryptor=null,this._mse=null,this._softVideo=null;case 7:case"end":return n.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()},{key:"_createMseSource",value:function(t,r){$i.debug("create mse source, videoCodec=".concat(t,", audioCodec=").concat(r));var e=this._mse;e&&(t&&(e.createSource(he.VIDEO,"video/mp4;codecs=".concat(t)),this._sourceCreated=!0),r&&(e.createSource(he.AUDIO,"audio/mp4;codecs=".concat(r)),this._sourceCreated=!0),this.hls.emit(K.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(t,r){var e=[],i=this._mse,n=[{type:he.VIDEO,codecs:t==null?void 0:t.codec},{type:he.AUDIO,codecs:r==null?void 0:r.codec}];return n.filter(function(o){return!!o.codecs}).forEach(function(o){var l=o.type,u=o.codecs,c=i.getSourceBuffer(l);if(c){var d=u.split(",")[0];new RegExp(d,"ig").test(c.mimeType)||e.push(i.changeType(l,"".concat(l,"/mp4;codecs=").concat(u)))}}),e}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.VIDEO;return(t=this._mse)===null||t===void 0?void 0:t.isFull(r)}}]),a}();function no(a){var s=(a==null?void 0:a.media)||document.createElement("video");return ne(ne({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1,mseLowLatency:!0,fixerConfig:{forceFixLargeGap:!1,largeGapThreshold:5}},a),{},{media:s})}var ao=Se(function a(){ge(this,a),x(this,"version",0),x(this,"streams",[]),x(this,"isMaster",!0)}),ia={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},tr={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:["urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2","com.apple.streamingkeydelivery"],WIDEVINE:["urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha","com.widevine"],PLAYREADY:["urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready"]};function na(a){for(var s=[],t=0;t<a.length;t++)Array.isArray(a[t])?s=s.concat(na(a[t])):s.push(a[t]);return s}var di=Se(function a(){ge(this,a),x(this,"id",0),x(this,"url",""),x(this,"default",!1),x(this,"autoSelect",!1),x(this,"forced",!1),x(this,"group",""),x(this,"name",""),x(this,"lang",""),x(this,"segments",[]),x(this,"endSN",0)}),so=function(a){Lr(t,a);var s=Xr(t);function t(){var r;ge(this,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return r=s.call.apply(s,[this].concat(i)),x(Q(r),"mediaType",ia.Audio),x(Q(r),"channels",0),r}return Se(t)}(di),oo=function(a){Lr(t,a);var s=Xr(t);function t(){var r;ge(this,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return r=s.call.apply(s,[this].concat(i)),x(Q(r),"mediaType",ia.SubTitle),r}return Se(t)}(di),lo=Se(function a(){ge(this,a),x(this,"id",0),x(this,"bitrate",0),x(this,"width",0),x(this,"height",0),x(this,"name",""),x(this,"url",""),x(this,"audioCodec",""),x(this,"videoCodec",""),x(this,"textCodec",""),x(this,"audioGroup",""),x(this,"audioStreams",[]),x(this,"subtitleStreams",[]),x(this,"closedCaptionsStream",[])}),uo=Se(function a(){ge(this,a),x(this,"version",0),x(this,"url",""),x(this,"type",""),x(this,"startCC",0),x(this,"endCC",0),x(this,"startSN",0),x(this,"endSN",0),x(this,"totalDuration",0),x(this,"targetDuration",0),x(this,"partTargetDuration",0),x(this,"canSkipUntil",0),x(this,"canSkipDateRanges",!1),x(this,"skippedSegments",0),x(this,"canBlockReload",!1),x(this,"partHoldBack",0),x(this,"live",!0),x(this,"lowLatency",!1),x(this,"endPartIndex",0),x(this,"segments",[])}),rr=function(){function a(s){ge(this,a),x(this,"sn",0),x(this,"cc",0),x(this,"url",""),x(this,"parentUrl",""),x(this,"title",""),x(this,"start",0),x(this,"duration",0),x(this,"dataTime",""),x(this,"key",null),x(this,"byteRange",null),x(this,"isInitSegment",!1),x(this,"initSegment",null),x(this,"isLast",!1),x(this,"hasAudio",!1),x(this,"hasVideo",!1),x(this,"independent",!1),x(this,"partIndex",0),this.parentUrl=s}return Se(a,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(t,r){this.hasVideo=t,this.hasAudio=r}},{key:"setByteRange",value:function(t,r){this.byteRange=[0];var e=t.split("@");e.length===1&&r&&r.byteRange?(this.byteRange[0]=r.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),a}(),co=function(){function a(s){ge(this,a),x(this,"method",""),x(this,"url",""),x(this,"iv",null),x(this,"keyFormat",""),x(this,"keyFormatVersions",""),s instanceof a&&(this.method=s.method,this.url=s.url,this.keyFormat=s.keyFormat,this.keyFormatVersions=s.keyFormatVersions,s.iv&&(this.iv=new Uint8Array(s.iv)))}return Se(a,[{key:"clone",value:function(t){var r=new a(this);return t!=null&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(t){if(!this.iv&&this.method==="AES-128"&&typeof t=="number"&&this.url){this.iv=new Uint8Array(16);for(var r=12;r<16;r++)this.iv[r]=t>>8*(15-r)&255}}},{key:"isSegmentEncrypted",value:function(){var t=this.method;return t==="AES-128"}},{key:"isValidKeySystem",value:function(){var t=na([tr.CLEAR_KEY,tr.FAIRPLAY,tr.WIDEVINE,tr.PLAYREADY]).indexOf(this.keyFormat)>-1;if(!t)return!1;var r=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!r}},{key:"isSupported",value:function(){return this.method?this.isSegmentEncrypted()?!0:!!this.isValidKeySystem():!1}}]),a}(),ho=/^#(EXT[^:]*)(?::(.*))?$/,qi=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,mo=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,fo=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function po(a){return a.split(/[\r\n]/).map(function(s){return s.trim()}).filter(Boolean)}function aa(a){var s=a.match(ho);if(!(!s||!s[1]))return[s[1].replace("EXT-X-",""),s[2]]}function Lt(a){for(var s={},t=qi.exec(a);t;)s[t[1]]=t[2]||t[3],t=qi.exec(a);return s}function Yt(a,s){if(!s||!a||mo.test(a))return a;var t=fo.exec(s);return t?a[0]==="/"?t[1]+a:t[1]+t[2]+a:a}var vo={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Cr(a,s){var t=vo[a];if(!(!t||!s||!s.length)){for(var r=0;r<t.length;r++)for(var e=0;e<s.length;e++)if(t[r].test(s[e]))return s[e]}}function yo(a,s){for(var t=new ao,r=0,e,i=[],n=[];e=a[r++];){var o=aa(e);if(o){var l=ht(o,2),u=l[0],c=l[1];if(u==="VERSION")t.version=parseInt(c);else if(u==="MEDIA"&&c){var d=Lt(c),h=void 0;switch(d.TYPE){case"AUDIO":h=new so;break;case"SUBTITLES":h=new oo;break;default:h=new di}h.url=Yt(d.URI,s),h.default=d.DEFAULT==="YES",h.autoSelect=d.AUTOSELECT==="YES",h.group=d["GROUP-ID"],h.name=d.NAME,h.lang=d.LANGUAGE,d.CHANNELS&&(h.channels=Number(d.CHANNELS.split("/")[0]),Number.isNaN(h.channels)&&(h.channels=0)),d.TYPE==="AUDIO"&&d.URI&&i.push(h),d.TYPE==="SUBTITLES"&&n.push(h)}else if(u==="STREAM-INF"&&c){var p=new lo,v=Lt(c);if(p.bitrate=parseInt(v["AVERAGE-BANDWIDTH"]||v.BANDWIDTH),p.name=v.NAME,p.url=Yt(a[r++],s),v.RESOLUTION){var Z=v.RESOLUTION.split("x"),b=ht(Z,2),L=b[0],w=b[1];p.width=parseInt(L),p.height=parseInt(w)}if(v.CODECS){var W=v.CODECS.split(/[ ,]+/).filter(Boolean);p.videoCodec=Cr("video",W),p.audioCodec=Cr("audio",W),p.textCodec=Cr("text",W)}p.audioGroup=v.AUDIO,p.subtitleGroup=v.SUBTITLES,t.streams.push(p)}}}return t.streams.forEach(function(X,S){X.id=S}),i.length&&(i.forEach(function(X,S){X.id=S}),t.streams.forEach(function(X){X.audioGroup&&(X.audioStreams=i.filter(function(S){return S.group===X.audioGroup}))})),n.length&&(n.forEach(function(X,S){X.id=S}),t.streams.forEach(function(X){X.subtitleGroup&&(X.subtitleStreams=n.filter(function(S){return S.group===X.subtitleGroup}))})),t}function bo(a,s,t){var r=new uo;r.url=s;for(var e=new rr(s),i=null,n=null,o=0,l=0,u=0,c=0,d,h=!1,p=0;d=a[c++];){if(d[0]!=="#"){if(r.lowLatency){l++;continue}e.sn=l,e.cc=u,e.url=Yt(d,s),n&&(e.key=n.clone(l)),i&&(e.initSegment=i),r.segments.push(e),e=new rr(s),l++;continue}var v=aa(d);if(v){var Z=ht(v,2),b=Z[0],L=Z[1];switch(b){case"VERSION":r.version=parseInt(L);break;case"PLAYLIST-TYPE":r.type=L==null?void 0:L.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(L);break;case"PART-INF":{t&&(r.lowLatency=!0);var w=Lt(L);w["PART-TARGET"]&&(r.partTargetDuration=parseFloat(w["PART-TARGET"]))}break;case"SERVER-CONTROL":{var W=Lt(L);r.canBlockReload=W["CAN-BLOCK-RELOAD"]==="YES",r.partHoldBack=parseFloat(W["PART-HOLD-BACK"]||0),r.canSkipUntil=parseFloat(W["CAN-SKIP-UNTIL"]||0),r.canSkipDateRanges=W["CAN-SKIP-DATERANGES"]==="YES"}break;case"ENDLIST":h=!0;break;case"MEDIA-SEQUENCE":l=r.startSN=parseInt(L);break;case"DISCONTINUITY-SEQUENCE":u=r.startCC=parseInt(L);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":e.setByteRange(L,r.segments[r.segments.length-1]);break;case"PART":{if(!r.lowLatency)break;var X=Lt(L);e.duration=parseFloat(X.DURATION),e.independent=X.INDEPENDENT==="YES",e.sn=l,e.cc=u,e.partIndex=p,e.start=o,e.duration=parseFloat(X.DURATION),o+=e.duration,e.url=Yt(X.URI,s),n&&(e.key=n.clone(l)),i&&(e.initSegment=i),r.segments.push(e),e=new rr(s),p++}break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":e.dataTime=L;break;case"EXTINF":{if(r.lowLatency){p=0;break}var S=L.split(","),R=ht(S,2),T=R[0],V=R[1];e.start=o,e.duration=parseFloat(T),o+=e.duration,e.title=V}break;case"KEY":{var Y=Lt(L);if(Y.METHOD==="NONE"){n=null;break}if(n=new co,n.method=Y.METHOD,n.url=/^blob:/.test(Y.URI)?Y.URI:Yt(Y.URI,s),n.keyFormat=Y.KEYFORMAT||"identity",n.keyFormatVersions=Y.KEYFORMATVERSIONS,!n.isSupported())throw new Error("encrypt ".concat(Y.METHOD,"/").concat(Y.KEYFORMAT," is not supported"));if(Y.IV){var I=Y.IV.slice(2);I=(I.length&1?"0":"")+I,n.iv=new Uint8Array(I.length/2);for(var U=0,f=I.length/2;U<f;U++)n.iv[U]=parseInt(I.slice(U*2,U*2+2),16)}}break;case"MAP":{var m=Lt(L);e.url=Yt(m.URI,s),m.BYTERANGE&&e.setByteRange(m.BYTERANGE),e.isInitSegment=!0,e.sn=0,n&&(e.key=n.clone(0)),i=e,e=new rr(s)}break}}}r.segments=r.segments.filter(function(G){return G.duration!==0});var y=r.segments[r.segments.length-1];return y&&(h&&(y.isLast=!0),r.endSN=y.sn,r.endPartIndex=y.partIndex),h&&(r.live=!1),r.totalDuration=o,r.endCC=u,r}var ir=function(){function a(){ge(this,a)}return Se(a,null,[{key:"parse",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var i=po(t);return a.isMediaPlaylist(t)?bo(i,r,e):yo(i,r)}},{key:"isMediaPlaylist",value:function(t){return t.includes("#EXTINF:")||t.includes("#EXT-X-TARGETDURATION:")}}]),a}(),Zo=function(){function a(s){var t=this;ge(this,a),x(this,"_emitOnLoaded",function(l,u){var c=l.response,d=l.options,h=d||{},p=h.firstByteTime,v=h.startTime,Z=h.endTime,b=h.contentLength,L=Z-v;t.hls.emit(K.SPEED,{time:L,byteLength:b,url:u}),t.hls.emit(K.LOAD_COMPLETE,{url:u,elapsed:L||0}),t.hls.emit(K.TTFB,{url:u,responseUrl:c.url,elapsed:p-v}),t.hls.emit(K.LOAD_RESPONSE_HEADERS,{headers:c.headers,url:u})}),x(this,"_onLoaderRetry",function(l,u){t.hls.emit(te.LOAD_RETRY,{error:le.network(l),retryTime:u})}),this.hls=s,this._timer=null,this._useLowLatency=s.config.useLowLatency;var r=this.hls.config,e=r.retryCount,i=r.retryDelay,n=r.manifestLoadTimeout,o=r.fetchOptions;this._loader=new pt(ne(ne({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry})),this._audioLoader=new pt(ne(ne({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new pt(ne(ne({},o),{},{responseType:"text",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry}))}return Se(a,[{key:"load",value:function(){var s=ae(J().mark(function r(e,i,n){var o,l,u,c,d,h,p,v,Z,b,L,w,W,X,S,R,T,V,Y,I;return J().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o=[this._loader.load(e)],i&&o.push(this._audioLoader.load(i)),n&&o.push(this._subtitleLoader.load(n)),f.prev=3,f.next=6,Promise.all(o);case 6:if(v=f.sent,Z=ht(v,3),b=Z[0],L=Z[1],w=Z[2],b){f.next=13;break}return f.abrupt("return",[]);case 13:this._emitOnLoaded(b,e),l=b.data,d=b.response.url||e,i?(u=L==null?void 0:L.data,c=w==null?void 0:w.data,h=(L==null||(W=L.response)===null||W===void 0?void 0:W.url)||i,p=(w==null||(X=w.response)===null||X===void 0?void 0:X.url)||n,u&&this._emitOnLoaded(L,i),c&&this._emitOnLoaded(w,n)):(c=L==null?void 0:L.data,p=(L==null||(S=L.response)===null||S===void 0?void 0:S.url)||n,c&&this._emitOnLoaded(L,n)),f.next=22;break;case 19:throw f.prev=19,f.t0=f.catch(3),le.network(f.t0);case 22:if(R=this.hls.config.onPreM3U8Parse,f.prev=23,R&&(l=R(l)||l,u&&(u=R(u,!0)||u),c&&(c=R(c,!0)||c)),T=ir.parse(l,d,this._useLowLatency),!(((I=T)===null||I===void 0?void 0:I.live)===!1&&T.segments&&!T.segments.length)){f.next=28;break}throw new Error("empty segments list");case 28:u&&(V=ir.parse(u,h,this._useLowLatency)),c&&(Y=ir.parse(c,p,this._useLowLatency)),f.next=35;break;case 32:throw f.prev=32,f.t1=f.catch(23),new le(F.MANIFEST,F.SUB_TYPES.HLS,f.t1);case 35:return T&&(T.isMaster?this.hls.emit(te.HLS_MANIFEST_LOADED,{playlist:T}):this.hls.emit(te.HLS_LEVEL_LOADED,{playlist:T})),f.abrupt("return",[T,V,Y]);case 37:case"end":return f.stop()}},r,this,[[3,19],[23,32]])}));function t(r,e,i){return s.apply(this,arguments)}return t}()},{key:"parseText",value:function(t,r){var e=this.hls.config.onPreM3U8Parse,i;try{var n;if(e&&(t=e(t)||t),i=ir.parse(t,r,this._useLowLatency),((n=i)===null||n===void 0?void 0:n.live)===!1&&i.segments&&!i.segments.length)throw new Error("empty segments list")}catch(o){throw new le(F.MANIFEST,F.SUB_TYPES.HLS,o)}return i&&(i.isMaster?this.hls.emit(te.HLS_MANIFEST_LOADED,{playlist:i}):this.hls.emit(te.HLS_LEVEL_LOADED,{playlist:i})),[i]}},{key:"poll",value:function(t,r,e,i,n,o){var l=this;clearTimeout(this._timer),o=o||3e3;var u=this.hls.config.pollRetryCount,c=function(){var d=ae(J().mark(function h(){var p;return J().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return clearTimeout(l._timer),Z.prev=1,Z.next=4,l.load(t,r,e);case 4:if(p=Z.sent,p[0]){Z.next=7;break}return Z.abrupt("return");case 7:u=l.hls.config.pollRetryCount,i(p[0],p[1],p[2]),Z.next=15;break;case 11:Z.prev=11,Z.t0=Z.catch(1),u--,u<=0&&n(Z.t0);case 15:l._timer=setTimeout(c,o);case 16:case"end":return Z.stop()}},h,null,[[1,11]])}));return function(){return d.apply(this,arguments)}}();this._timer=setTimeout(c,o)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),a}();function sa(a,s,t){return s>t&&(t=s),Math.min(Math.max(a,s),t)}var Kr=new xe("playlist"),en=function(){function a(s,t,r){ge(this,a),x(this,"live",void 0),x(this,"id",0),x(this,"bitrate",0),x(this,"width",0),x(this,"height",0),x(this,"name",""),x(this,"url",""),x(this,"audioCodec",""),x(this,"videoCodec",""),x(this,"textCodec",""),x(this,"startCC",0),x(this,"endCC",0),x(this,"startSN",0),x(this,"endSN",-1),x(this,"totalDuration",0),x(this,"targetDuration",0),x(this,"partTargetDuration",0),x(this,"canSkipUntil",0),x(this,"canSkipDateRanges",!1),x(this,"skippedSegments",0),x(this,"canBlockReload",!1),x(this,"partHoldBack",0),x(this,"lowLatency",!1),x(this,"endPartIndex",0),x(this,"snDiff",null),x(this,"segments",[]),x(this,"audioStreams",[]),x(this,"subtitleStreams",[]),x(this,"closedCaptions",[]),x(this,"currentAudioStream",null),x(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(s),t,r)}return Se(a,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var t;return this.targetDuration||((t=this.segments[0])===null||t===void 0?void 0:t.duration)||0}},{key:"liveEdge",get:function(){return this.endTime},set:function(t){this.endTime=t}},{key:"endTime",get:function(){var t;return((t=this.lastSegment)===null||t===void 0?void 0:t.end)||0},set:function(t){var r=this.lastSegment;r&&(r.duration=t-r.start)}},{key:"currentSubtitleEndSn",get:function(){var t;return((t=this.currentSubtitleStream)===null||t===void 0?void 0:t.endSN)||0}},{key:"clearOldSegment",value:function(t,r){return this.currentAudioStream&&this._clearSegments(t,r),this._clearSegments(t,r)}},{key:"getAudioSegment",value:function(t){if(!(!t||!this.currentAudioStream)){var r=t.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===r})}}},{key:"update",value:function(t,r){this.url=t.url,Array.isArray(t.segments)?((this.live===null||this.live===void 0)&&(this.live=t.live),this._updateSegments(t,this),this.startCC=t.startCC,this.endCC=t.endCC,this.startSN=t.startSN,this.endSN=t.endSN||-1,this.totalDuration=t.totalDuration,this.targetDuration=t.targetDuration,this.live=t.live,this.lowLatency=t.lowLatency,this.canBlockReload=t.canBlockReload,this.canSkipDateRanges=t.canSkipDateRanges,this.canSkipUntil=t.canSkipUntil,this.partHoldBack=t.partHoldBack,this.partTargetDuration=t.partTargetDuration,this.skippedSegments=t.skippedSegments,this.endPartIndex=t.endPartIndex,r&&this.currentAudioStream&&Array.isArray(r.segments)&&(this._updateSegments(r,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&t.segments.length&&r.segments.length&&(this.snDiff=t.segments[0].sn-r.segments[0].sn))):(this.id=t.id,this.bitrate=t.bitrate,this.width=t.width,this.height=t.height,this.name=t.name,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.textCodec=t.textCodec,this.audioStreams=t.audioStreams,this.subtitleStreams=t.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(t){var r=this;if(t&&this.currentSubtitleStream&&Array.isArray(t.segments)){var e=this._updateSegments(t,this.currentSubtitleStream),i=this.currentSubtitleStream.segments;if(i.length>100&&(this.currentSubtitleStream.segments=i.slice(100)),!!e)return e.map(function(n){return{sn:n.sn,url:n.url,duration:n.duration,start:n.start,end:n.end,lang:r.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(t){var r=this.subtitleStreams.find(function(i){return i.lang===t}),e=this.currentSubtitleStream;r&&(this.currentSubtitleStream=r,e.segments=[])}},{key:"_setLLPlaybackPoint",value:function(t){if(!t.lowLatency||!t.segments.length)return t;for(var r=t.totalDuration-t.partHoldBack,e=t.segments,i=0,n=0,o=e.length;n<o;n++)e[n].start<=r&&e[n].independent&&(i=n);var l=e.slice(i),u=0;return l.forEach(function(c){c.start=u,u=c.end}),t.segments=l,t.totalDuration=u,t.startSN=l[0].sn,t.startCC=l[0].cc,Kr.log("set ll-hls playback point: SN=".concat(t.startSN," partIndex=").concat(l[0].partIndex,", duration=").concat(u)),t}},{key:"_clearSegments",value:function(t,r){for(var e=0,i=this.segments,n=0,o=i.length;n<o;n++)if(i[n].end>=t){e=n;break}return e>r&&(e=r),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),r-e}},{key:"_updateSegments",value:function(t,r){var e=r.segments;if(this.live){var i,n=t.lowLatency,o=e[e.length-1],l=(i=o==null?void 0:o.sn)!==null&&i!==void 0?i:-1,u=(o==null?void 0:o.partIndex)||0,c=l<t.endSN&&t.segments.length;if(n&&(c=c||u<t.endPartIndex),c){Kr.log("update segments: endSN:".concat(l,", partIndex:").concat(u," --> endSN:").concat(t.endSN,", partIndex:").concat(t.endPartIndex));var d=t.segments.findIndex(function(b){return b.sn===l&&b.partIndex===u}),h=d<0?t.segments:t.segments.slice(d+1);if(e.length&&h.length){var p=o.end,v=p;h.forEach(function(b){b.start=p,p=b.end}),Kr.log("liveEdge: ".concat(v," -> ").concat(p));var Z=(o==null?void 0:o.cc)||-1;Z>h[0].cc&&h.forEach(function(b){return b.cc+=Z})}return r.endSN=t.endSN,r.segments=e.concat(h),h}}else r.segments=t.segments}}]),a}(),go=function(){function a(s){ge(this,a),x(this,"streams",[]),x(this,"currentStream",null),x(this,"dvrWindow",0),x(this,"_segmentPointer",-1),this.hls=s}return Se(a,[{key:"lowLatency",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.lowLatency}},{key:"lastSegment",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.lastSegment}},{key:"currentSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer]}},{key:"nextSegment",get:function(){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.segments}},{key:"currentSubtitleEndSn",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.liveEdge},set:function(t){this.currentStream&&(this.currentStream.liveEdge=t)}},{key:"totalDuration",get:function(){var t;return((t=this.currentStream)===null||t===void 0?void 0:t.totalDuration)||0}},{key:"seekRange",get:function(){var t=this.currentSegments;if(!(!t||!t.length))return[t[0].start,t[t.length-1].end]}},{key:"nbSegments",get:function(){var t;return((t=this.currentSegments)===null||t===void 0?void 0:t.length)||0}},{key:"isEmpty",get:function(){var t;return!((t=this.currentSegments)!==null&&t!==void 0&&t.length)}},{key:"isLive",get:function(){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.live}},{key:"hadSegmentLoaded",get:function(){return this._segmentPointer!==-1}},{key:"hasSubtitle",get:function(){var t;return!!((t=this.currentStream)!==null&&t!==void 0&&t.currentSubtitleStream)}},{key:"getAudioSegment",value:function(t){var r;return(r=this.currentStream)===null||r===void 0?void 0:r.getAudioSegment(t)}},{key:"moveSegmentPointer",value:function(t){var r;t==null&&(t=this._segmentPointer+1),this._segmentPointer=sa(t,-1,(r=this.currentSegments)===null||r===void 0?void 0:r.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(t){var r;return(r=this.currentSegments)===null||r===void 0?void 0:r[t]}},{key:"setNextSegmentByIndex",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=t-1}},{key:"setNextSegmentBySN",value:function(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=(t=this.currentSegments)===null||t===void 0?void 0:t.findIndex(function(i){return i.sn===r});return e!==-1&&this.setNextSegmentByIndex(e+1),e}},{key:"findSegmentIndexByTime",value:function(t){var r=this.currentSegments;if(r){for(var e=0,i=r.length,n;e<i;e++)if(n=r[e],t>=n.start&&t<n.end)return e;var o=r[r.length-1];if(Math.abs(t-(o==null?void 0:o.end))<.2)return r.length-1}}},{key:"upsertPlaylist",value:function(t,r,e){var i=this;if(t){if(t.isMaster)this.streams.length=t.streams.length,t.streams.filter(function(u){return u.url}).forEach(function(u,c){i.streams[c]?i.streams[c].update(u):i.streams[c]=new en(u)}),this.currentStream=this.streams[0];else if(Array.isArray(t.segments)){var n=this.currentStream;if(n){n.update(t,r,e);var o=n.updateSubtitle(e);o&&this.hls.emit(te.SUBTITLE_SEGMENTS,{list:o})}else this.reset(),this.currentStream=this.streams[0]=new en(t,r,e)}var l=this.currentStream;l&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(u,c){return u+=c.duration,u},0))}}},{key:"updateSegmentsRanges",value:function(t,r){var e,i=(e=this.currentSegments)===null||e===void 0?void 0:e.filter(function(n){return n.sn>=t});i.forEach(function(n){n.start=r,r=n.end})}},{key:"switchSubtitle",value:function(t){var r;(r=this.currentStream)===null||r===void 0||r.switchSubtitle(t)}},{key:"clearOldSegment",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=this.currentStream;if(!(!this.dvrWindow||!r)){var e=r.endTime-this.dvrWindow;if(!(e<=0)){var i=r.segments;i.length<=t||(this._segmentPointer=r.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(t,r){var e=this.findSegmentIndexByTime(t),i=this.getSegmentByIndex(e);if(i&&!(!i.hasAudio&&!i.hasVideo)){if(r!==2&&i.hasAudio&&i.hasVideo)return i;if(!(i.end-t>.3)){var n=this.getSegmentByIndex(e+1);if(n&&!(!n.hasAudio&&!n.hasVideo)&&(n.hasAudio!==i.hasAudio||n.hasVideo!==i.hasVideo))return n}}}},{key:"feedbackLiveEdge",value:function(t,r){var e,i=this.currentSegments;if(i){var n=((e=this.lastSegment)===null||e===void 0?void 0:e.sn)===t.sn;if(n){this.liveEdge=r;return}this.updateSegmentsRanges(t.sn+1,r)}}}]),a}(),So=function(){function a(s){var t=this;ge(this,a),x(this,"error",null),x(this,"_emitOnLoaded",function(l,u){var c=l.data,d=l.response,h=l.options,p=h||{},v=p.firstByteTime,Z=p.startTime,b=p.endTime,L=p.contentLength,w=b-Z;t._bandwidthService.addRecord(L||c.byteLength,w),t.hls.emit(K.SPEED,{time:w,byteLength:L,url:u}),t.hls.emit(K.LOAD_COMPLETE,{url:u,elapsed:w||0}),t.hls.emit(K.TTFB,{url:u,responseUrl:d.url,elapsed:v-Z}),t.hls.emit(K.LOAD_RESPONSE_HEADERS,{headers:d.headers,url:u})}),x(this,"_onLoaderRetry",function(l,u){t.hls.emit(K.LOAD_RETRY,{error:le.network(l),retryTime:u})}),this.hls=s,this._bandwidthService=new kn,this._mapCache={},this._keyCache={};var r=this.hls.config,e=r.retryCount,i=r.retryDelay,n=r.loadTimeout,o=r.fetchOptions;this._segmentLoader=new pt(ne(ne({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new pt(ne(ne({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry})),this._keyLoader=new pt(ne(ne({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:i,timeout:n,onRetryError:this._onLoaderRetry}))}return Se(a,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(t,r,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,n=[];return t&&(n[0]=this.loadVideoSegment(t,e)),r&&(n[1]=this.loadAudioSegment(r,i)),Promise.all(n)}},{key:"loadVideoSegment",value:function(t,r){return this._loadSegment(this._segmentLoader,t,r)}},{key:"loadAudioSegment",value:function(t,r){return this._loadSegment(this._audioSegmentLoader,t,r)}},{key:"_loadSegment",value:function(){var s=ae(J().mark(function r(e,i,n){var o=this,l,u,c,d,h,p,v,Z,b,L,w,W,X,S,R;return J().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return v=[],this.hls.emit(K.LOAD_START,{url:i.url}),v[0]=e.load(i.url),n&&i.initSegment&&(b=i.initSegment.url,u=this._mapCache[b],u||(this.hls.emit(K.LOAD_START,{url:b}),v[1]=e.load(b).then(function(Y){if(Y){var I=Object.keys(o._mapCache);I>30&&(o._mapCache={}),u=o._mapCache[b]=Y.data,o._emitOnLoaded(Y,b)}})),L=(Z=i.initSegment.key)===null||Z===void 0?void 0:Z.url,L&&(p=i.initSegment.key.iv,h=this._keyCache[L],h||(this.hls.emit(K.LOAD_START,{url:L}),v[2]=this._keyLoader.load(L).then(function(Y){Y&&(h=o._keyCache[L]=Y.data,o._emitOnLoaded(Y,L))})))),w=(l=i.key)===null||l===void 0?void 0:l.url,w&&i.key.isSegmentEncrypted()&&(d=i.key.iv,c=this._keyCache[w],c||(this.hls.emit(K.LOAD_START,{url:w}),v[3]=this._keyLoader.load(w).then(function(Y){Y&&(c=o._keyCache[w]=Y.data,o._emitOnLoaded(Y,w))}))),V.next=8,Promise.all(v);case 8:if(W=V.sent,X=ht(W,1),S=X[0],S){V.next=13;break}return V.abrupt("return");case 13:return R=S.data,this._emitOnLoaded(S,i.url),V.abrupt("return",{data:R,map:u,key:c,mapKey:h,keyIv:d,mapKeyIv:p});case 16:case"end":return V.stop()}},r,this)}));function t(r,e,i){return s.apply(this,arguments)}return t}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var s=ae(J().mark(function r(){return J().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return i.stop()}},r,this)}));function t(){return s.apply(this,arguments)}return t}()}]),a}(),Me=new xe("hls"),Ct=function(a){Lr(t,a);var s=Xr(t);function t(r){var e;return ge(this,t),e=s.call(this),x(Q(e),"version",t.version),x(Q(e),"media",null),x(Q(e),"config",null),x(Q(e),"_manifestLoader",null),x(Q(e),"_segmentLoader",null),x(Q(e),"_playlist",null),x(Q(e),"_bufferService",null),x(Q(e),"_gapService",null),x(Q(e),"_seiService",null),x(Q(e),"_stats",null),x(Q(e),"_prevSegSn",null),x(Q(e),"_prevSegCc",null),x(Q(e),"_tickTimer",null),x(Q(e),"_tickInterval",500),x(Q(e),"_segmentProcessing",!1),x(Q(e),"_reloadOnPlay",!1),x(Q(e),"_switchUrlOpts",null),x(Q(e),"_isProcessQuotaExceeded",!1),x(Q(e),"_loadSegment",ae(J().mark(function i(){var n,o,l,u,c,d,h,p,v;return J().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(e._segmentProcessing||!e.media)){b.next=2;break}return b.abrupt("return");case 2:if(n=e._playlist,o=n.nextSegment,l=n.lastSegment,u=Q(e),c=u.config,d=.016,h=Math.min(Math.max((l==null?void 0:l.duration)-d/2||0,d),.1),o){b.next=8;break}return b.abrupt("return");case 8:if(e.isLive){b.next=18;break}if(p=e.bufferInfo(),e.media.paused&&!e.media.currentTime&&(p=e.bufferInfo(p.nextStart||.5)),v=Math.abs(p.end-e.media.duration)<h,!(p.remaining>=c.preloadTime||v)){b.next=15;break}return e._tryEos(),b.abrupt("return");case 15:if(!(c.preferMMSStreaming&&!e._bufferService.msStreaming)){b.next=17;break}return b.abrupt("return");case 17:!e._urlSwitching&&e._prevSegSn!==o.sn-1&&p.end&&Math.abs(o.start-p.end)>1&&e._playlist.setNextSegmentByIndex(e._playlist.findSegmentIndexByTime(p.end+.1));case 18:return b.abrupt("return",e._loadSegmentDirect());case 19:case"end":return b.stop()}},i)}))),x(Q(e),"_onLoadeddata",function(){e.isLive&&!e.config.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(i){})}),x(Q(e),"_onPlay",ae(J().mark(function i(){return J().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e.media.seeking&&e.media.currentTime===0)){o.next=3;break}return Me.debug("replay currentTime 0, return"),o.abrupt("return");case 3:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){o.next=9;break}e._reloadOnPlay=!1,e.replay(!0),o.next=12;break;case 9:return o.next=11,e._loadSegment();case 11:e._startTick();case 12:case"end":return o.stop()}},i)}))),x(Q(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var i=e.config.disconnectTime;if(i==null&&(i=e._playlist.dvrWindow),!Number.isFinite(i))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},i||0)}}else e._stopTick()}),x(Q(e),"_onSeeking",ae(J().mark(function i(){var n,o,l,u,c,d,h;return J().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.media){v.next=2;break}return v.abrupt("return");case 2:if(e._onCheckQuotaExceeded(),n=e.media.currentTime,o=e._playlist.seekRange,!o){v.next=10;break}if(l=sa(n,o[0],e.isLive?o[1]:e.media.duration),!(l>=0&&Math.abs(n-l)>=.1)){v.next=10;break}return e.media.currentTime=l,v.abrupt("return");case 10:if(u=e._playlist.currentSegment,c=fe.info(fe.get(e.media),n,.1),!u){v.next=17;break}if(!(c.end&&Math.abs(c.end-u.end)<.2)){v.next=15;break}return v.abrupt("return");case 15:if(!(e.isLive&&c.end)){v.next=17;break}return v.abrupt("return");case 17:if(d=e._playlist.findSegmentIndexByTime(n),h=e._playlist.getSegmentByIndex(d),!(d==null||!h||e._segmentProcessing&&h===e._playlist.nextSegment)){v.next=21;break}return v.abrupt("return");case 21:return Me.debug("seek to",n,h),e._playlist.setNextSegmentByIndex(d),e._stopTick(),v.next=26,e._segmentLoader.cancel();case 26:if(e._segmentProcessing=!1,!(!c.end||e.isLive)){v.next=30;break}return v.next=30,e._loadSegmentDirect(!0);case 30:e._startTick();case 31:case"end":return v.stop()}},i)}))),x(Q(e),"_onTimeupdate",function(){if(e.media){var i=e.config;if(i.isLive&&i.maxLatency&&i.targetLatency&&e.media){var n=e._playlist.liveEdge;if(!n)return;var o=n-e.media.currentTime;o>=i.maxLatency&&(Me.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(n,",  latency=").concat(o)),e.media.currentTime=n-i.targetLatency)}if(i.seiInTime){var l;(l=e._seiService)===null||l===void 0||l.throw(e.media.currentTime)}e.config.allowedStreamTrackChange&&!e.config.softDecode&&e._checkStreamTrackChange(e.media.currentTime)}}),x(Q(e),"_tick",function(){if(e.media){e._startTick();var i=e.media,n=fe.get(i),o=e._segmentLoader.error;if(e._onCheckQuotaExceeded(),e._isProcessQuotaExceeded&&(e._bufferService.isFull()||(e._isProcessQuotaExceeded=!1,e._segmentProcessing=!1)),o){var l=.5;(!i.readyState||e.bufferInfo(l).remaining<1)&&(o.fatal=!0,e._emitError(le.network(o)));return}fe.end(n)>=.1&&i.readyState&&(wn(i)?(e._loadSegment(),e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,e.isLive)):i.readyState<2&&e._gapService&&e._gapService.do(i,e.config.maxJumpDistance,i.currentTime?e.isLive:!0)),e.isLive||e._tryEos()}}),e.config=r=no(r),e.media=e.config.media,e._manifestLoader=new Zo(Q(e)),e._segmentLoader=new So(Q(e)),e._playlist=new go(Q(e)),e._bufferService=new io(Q(e)),r.seiInTime&&(e._seiService=new Tn(Q(e))),r.softDecode||(e._gapService=new Vn),e._stats=new xn(Q(e),9e4),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return Se(t,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"totalDuration",get:function(){return this._playlist.totalDuration}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return fe.info(fe.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,i)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Rn(this.media)}},{key:"load",value:function(){var r=ae(J().mark(function i(n){var o,l=arguments;return J().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>1&&l[1]!==void 0?l[1]:!1,n&&(this.config.url=n),n=this.config.url,c.next=5,this._reset(o);case 5:return c.next=7,this._loadData(n);case 7:this._startTick();case 8:case"end":return c.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d,h,p,v,Z,b,L;return J().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:try{n&&(n=n.trim())}catch{}if(n){W.next=3;break}throw this._emitError(new le(F.OTHER,F.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return W.next=5,this._loadM3U8(n);case 5:if(o=W.sent,l=this._playlist.currentStream,!(this._urlSwitching&&!this.isLive)){W.next=17;break}if(l.bitrate===0&&(u=this._switchUrlOpts)!==null&&u!==void 0&&u.bitrate&&(l.bitrate=(c=this._switchUrlOpts)===null||c===void 0?void 0:c.bitrate),d=this._getSeamlessSwitchPoint(),this.config.startTime=d,h=this._playlist.findSegmentIndexByTime(d),p=this._playlist.getSegmentByIndex(h+1),!p){W.next=17;break}return v=p.start,W.next=17,this._bufferService.removeBuffer(v);case 17:if(this._urlSwitching&&this.isLive&&(Z=this._playlist.setNextSegmentBySN(this._prevSegSn),Me.log("segment nb=".concat(this._prevSegSn," index of ").concat(Z," in the new playlist")),Z===-1&&(this._prevSegCc=null,this._prevSegSn=null)),o){W.next=20;break}return W.abrupt("return");case 20:if(!this.isLive){W.next=31;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),Me.log("totalDuration first time got:",this._playlist.totalDuration),Me.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),o.isMaster||this._pollM3U8(n),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){W.next=28;break}return W.abrupt("return");case 28:return W.next=30,this._loadSegment();case 30:return W.abrupt("return");case 31:return W.next=33,this._bufferService.updateDuration(l.totalDuration);case 33:return b=this.config.startTime,b&&((L=this._switchUrlOpts)!==null&&L!==void 0&&L.seamless||(this.media.currentTime=b),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(b)||0)),W.next=37,this._loadSegment();case 37:case"end":return W.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"replay",value:function(){var r=ae(J().mark(function i(n){return J().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.config.startTime=0,l.next=3,this.load();case 3:return this._reloadOnPlay=!1,l.abrupt("return",this.media.play(!n));case 5:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchURL",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d,h,p,v=arguments;return J().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:o=v.length>1&&v[1]!==void 0?v[1]:{},l={seamless:!1,startTime:0,bitrate:0},b.t0=dr(o),b.next=b.t0==="number"?5:b.t0==="boolean"?7:b.t0==="object"?9:11;break;case 5:return o={startTime:o},b.abrupt("break",12);case 7:return o={seamless:o},b.abrupt("break",12);case 9:for(u in o)(o[u]===void 0||o[u]===null)&&delete o[u];return b.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(o);case 12:if(o=Object.assign({},l,o),c=o,d=c.seamless,h=c.startTime,this.config.url=n,this.config.startTime=h,this._switchUrlOpts=o,d){b.next=38;break}if(b.prev=18,!this.config.softDecode){b.next=23;break}b.t1=this.load(n),b.next=26;break;case 23:return b.next=25,this.load(n);case 25:b.t1=b.sent;case 26:p=b.t1,b.next=33;break;case 29:throw b.prev=29,b.t2=b.catch(18),this.emit(te.SWITCH_URL_FAILED,b.t2),b.t2;case 33:return this._reloadOnPlay=!1,p&&this.emit(te.SWITCH_URL_SUCCESS,{url:n}),b.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this.isLive||(this._prevSegSn=null,this._prevSegCc=null),this._playlist.reset(),this._bufferService.seamlessSwitch(),b.next=44,this._clear();case 44:return b.next=46,this._loadData(n);case 46:this._startTick();case 47:this._switchUrlOpts=null;case 48:case"end":return b.stop()}},i,this,[[18,29]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchStream",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d,h=arguments;return J().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=h.length>1&&h[1]!==void 0?h[1]:!0,l=this.currentStream,u=this.streams,!(!l||l.id===n||!u||u.length<2)){v.next=5;break}return v.abrupt("return");case 5:if(c=u.find(function(Z){return Z.id===n}),c){v.next=8;break}return v.abrupt("return");case 8:return v.prev=8,v.next=11,this._clear();case 11:if(!o){v.next=14;break}return v.next=14,this._bufferService.clearAllBuffer();case 14:v.next=19;break;case 16:throw v.prev=16,v.t0=v.catch(8),this._emitError(le.create(v.t0));case 19:if(l.currentAudioStream&&c.audioStreams.length>2&&(d=l.currentAudioStream.id,c.currentAudioStream=c.audioStreams.find(function(Z){return Z.id===d})||c.currentAudioStream),this._playlist.currentStream=c,v.prev=21,!(this.isLive||!c.segments.length)){v.next=25;break}return v.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,v.next=29,this._loadSegmentDirect();case 29:v.next=35;break;case 31:throw v.prev=31,v.t1=v.catch(21),this._playlist.currentStream=l,v.t1;case 35:return this._startTick(),v.abrupt("return",c);case 37:case"end":return v.stop()}},i,this,[[8,16],[21,31]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchAudioStream",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d=arguments;return J().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=d.length>1&&d[1]!==void 0?d[1]:!0,l=this.currentStream,l){p.next=4;break}return p.abrupt("return");case 4:if(u=l.currentAudioStream,!(!u||u.id===n||l.audioStreams.length<2)){p.next=7;break}return p.abrupt("return");case 7:if(c=l.audioStreams.find(function(v){return v.id===n}),c){p.next=10;break}return p.abrupt("return");case 10:return p.prev=10,p.next=13,this._clear();case 13:if(!o){p.next=16;break}return p.next=16,this._bufferService.clearAllBuffer();case 16:p.next=21;break;case 18:throw p.prev=18,p.t0=p.catch(10),this._emitError(le.create(p.t0));case 21:if(l.currentAudioStream=c,p.prev=22,!(this.isLive||!c.segments.length)){p.next=26;break}return p.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,p.next=30,this._loadSegmentDirect();case 30:p.next=36;break;case 32:throw p.prev=32,p.t1=p.catch(22),l.currentAudioStream=u,p.t1;case 36:return this._startTick(),p.abrupt("return",c);case 38:case"end":return p.stop()}},i,this,[[10,18],[22,32]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"switchSubtitleStream",value:function(){var r=ae(J().mark(function i(n){return J().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this._playlist.switchSubtitle(n),l.next=3,this._manifestLoader.stopPoll();case 3:return l.next=5,this._refreshM3U8();case 5:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=ae(J().mark(function i(){var n;return J().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.media){l.next=2;break}return l.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),(n=this._seiService)===null||n===void 0||n.reset(),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),l.next=13,Promise.all([this._clear(),this._bufferService.destroy()]);case 13:this.media=null;case 14:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadM3U8",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d,h,p;return J().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(Z.prev=0,c=(l=this.config.manifestList)===null||l===void 0||(u=l.filter(function(b){return b.url===n})[0])===null||u===void 0?void 0:u.manifest,!c){Z.next=6;break}Z.t0=this._manifestLoader.parseText(c,n),Z.next=9;break;case 6:return Z.next=8,this._manifestLoader.load(n);case 8:Z.t0=Z.sent;case 9:d=Z.t0,h=ht(d,1),o=h[0],Z.next=17;break;case 14:throw Z.prev=14,Z.t1=Z.catch(0),this._emitError(le.create(Z.t1));case 17:if(o){Z.next=19;break}return Z.abrupt("return");case 19:if(this._playlist.upsertPlaylist(o),!o.isMaster){Z.next=24;break}return(p=this._playlist.currentStream.subtitleStreams)!==null&&p!==void 0&&p.length&&this.emit(te.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),Z.next=24,this._refreshM3U8();case 24:return this.emit(te.STREAM_PARSED),Z.abrupt("return",o);case 26:case"end":return Z.stop()}},i,this,[[0,14]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_refreshM3U8",value:function(){var e,i,n=this,o=this._playlist.currentStream;if(!o||!o.url)throw this._emitError(le.create(null,null,new Error("m3u8 url is not defined")));var l=o.url,u=(e=o.currentAudioStream)===null||e===void 0?void 0:e.url,c=(i=o.currentSubtitleStream)===null||i===void 0?void 0:i.url;return this._manifestLoader.load(l,u,c).then(function(d){var h=ht(d,3),p=h[0],v=h[1],Z=h[2];p&&(n._playlist.upsertPlaylist(p,v,Z),n.isLive&&n._pollM3U8(l,u,c))}).catch(function(d){throw n._emitError(le.create(d))})}},{key:"_pollM3U8",value:function(e,i,n){var o=this,l=this._playlist.isEmpty,u;if(this._playlist.lowLatency)u=(this._playlist.currentStream.partTargetDuration*2||0)*1e3;else{var c;u=(((c=this._playlist.lastSegment)===null||c===void 0?void 0:c.duration)||0)*1e3}this._manifestLoader.poll(e,i,n,function(d,h,p){o._playlist.upsertPlaylist(d,h,p),o._playlist.clearOldSegment();var v=d&&l&&!o._playlist.isEmpty;(v||!o._playlist.hadSegmentLoaded&&o._playlist.nbSegments>=o.config.minSegmentsStartPlay)&&o._loadSegment(),l&&(l=o._playlist.isEmpty)},function(d){o._emitError(le.create(d))},u)}},{key:"_loadSegmentDirect",value:function(){var r=ae(J().mark(function i(n){var o,l,u,c,d,h;return J().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=this._playlist.nextSegment,o){v.next=3;break}return v.abrupt("return");case 3:return l=!1,u=null,v.prev=5,this._segmentProcessing=!0,Me.log("load segment, sn:".concat(o.sn,", [").concat(o.start,", ").concat(o.end,"], partIndex:").concat(o.partIndex)),v.next=10,this._reqAndBufferSegment(o,this._playlist.getAudioSegment(o));case 10:l=v.sent,v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),u=v.t0;case 16:return v.prev=16,this._segmentProcessing=!1,v.finish(16);case 19:if(!u){v.next=26;break}if(!this._bufferService.isFull()){v.next=25;break}return Me.log("load segment, sn:".concat(o.sn,", partIndex:").concat(o.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,v.abrupt("return",!1);case 25:return v.abrupt("return",this._emitError(le.create(u)));case 26:return l&&(d=this.bufferInfo().end,this.isLive&&!this.media.seeking&&d&&Math.abs(o.end-d)>1&&(Me.warn("segment: ".concat(o.sn," expected end=").concat(o.end,", real end=").concat(d)),this._playlist.feedbackLiveEdge(o,d)),h=((c=this._playlist.currentStream)===null||c===void 0?void 0:c.url)===o.parentUrl,this._urlSwitching&&!h&&(Me.warn("pre playlist segment appended!"),this._bufferService.seamlessSwitch()),this.isLive&&this._urlSwitching&&h&&(this._urlSwitching=!1,this.emit(te.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),o.isLast?this._end():n||this._loadSegment()),v.abrupt("return",l);case 28:case"end":return v.stop()}},i,this,[[5,13,16,19]])}));function e(i){return r.apply(this,arguments)}return e}()},{key:"_reqAndBufferSegment",value:function(){var r=ae(J().mark(function i(n,o){var l,u,c,d,h,p,v,Z,b,L,w;return J().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return u=n?n.cc:o.cc,c=this._prevSegCc!==u,d=[],X.prev=3,X.next=6,this._segmentLoader.load(n,o,c);case 6:d=X.sent,X.next=14;break;case 9:throw X.prev=9,X.t0=X.catch(3),X.t0.fatal=!1,this._segmentLoader.error=X.t0,X.t0;case 14:if(d[0]){X.next=16;break}return X.abrupt("return");case 16:return X.next=18,(l=this._bufferService).decryptBuffer.apply(l,Os(d));case 18:if(h=X.sent,h){X.next=21;break}return X.abrupt("return");case 21:return p=n?n.sn:o.sn,v=n?n.start:o.start,Z=this._playlist.currentStream,this._bufferService.createSource(h[0],h[1],Z==null?void 0:Z.videoCodec,Z==null?void 0:Z.audioCodec),b=Date.now(),L=this._prevSegSn===p-1,this.isLive&&this._urlSwitching&&(w=this.bufferInfo().end,this._playlist.updateSegmentsRanges(p,w),Me.warn("update the new playlist liveEdge, segment id=".concat(p,", buffer start=").concat(w,", liveEdge=").concat(this._playlist.liveEdge)),v=w),X.next=30,this._bufferService.appendBuffer(n,o,h[0],h[1],c,L,v);case 30:return this.emit(te.APPEND_COST,{elapsed:Date.now()-b,url:n.url}),X.next=33,this._bufferService.evictBuffer(this.config.bufferBehind);case 33:return this._prevSegCc=u,this._prevSegSn=p,X.abrupt("return",!0);case 36:case"end":return X.stop()}},i,this,[[3,9]])}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"_onCheckQuotaExceeded",value:function(){var r=ae(J().mark(function i(){var n,o,l,u,c,d;return J().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:n=this.media.currentTime,o=this.media.buffered,l=!1,u=0;case 4:if(!(u<o.length)){p.next=11;break}if(!(o.start(0)>=n&&n<o.end(u))){p.next=8;break}return l=!0,p.abrupt("break",11);case 8:u++,p.next=4;break;case 11:if(!this._bufferService.isFull()){p.next=17;break}if(c=l?this.config.bufferBehind:5,d=this.media.currentTime,!(d-c>0)){p.next=17;break}return p.next=17,this._bufferService.removeBuffer(0,d-c);case 17:case"end":return p.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_checkStreamTrackChange",value:function(e){var i=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);i&&this.switchURL(this.config.url,i.start+.2)}},{key:"_clear",value:function(){var r=ae(J().mark(function i(){return J().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),o.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_reset",value:function(){var r=ae(J().mark(function i(){var n,o,l=arguments;return J().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>0&&l[0]!==void 0?l[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),(n=this._seiService)===null||n===void 0||n.reset(),this._stats.reset(),c.next=11,this._clear();case 11:return c.abrupt("return",this._bufferService.reset(o));case 12:case"end":return c.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var i,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((i=e.originError)===null||i===void 0?void 0:i.fatal)===!1)Me.warn(e);else{var o,l,u;Me.table(e),Me.error(e),Me.error((o=this.media)===null||o===void 0?void 0:o.error),(l=this.media)!==null&&l!==void 0&&l.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(te.SWITCH_URL_FAILED,e)),this.emit(te.ERROR,e),n&&this._end(),(u=this._seiService)===null||u===void 0||u.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,i=e.currentTime;if(!e.paused){var n,o=this._playlist.findSegmentIndexByTime(e.currentTime),l=this._playlist.getSegmentByIndex(o),u=(n=this._stats)===null||n===void 0?void 0:n.getStats().downloadSpeed;if(u&&l){var c=l.duration*this._playlist.currentStream.bitrate/u+1;i+=c}else i+=5}return i}},{key:"_tryEos",value:function(){var e,i,n=this.media,o=this._playlist,l=o.nextSegment,u=o.lastSegment,c=(!l||u&&fe.isBuffered(n,u.start+u.duration/2))&&n.readyState&&n.duration>0&&((e=this._bufferService)===null||e===void 0?void 0:e.msIsOpened)&&!((i=this._bufferService)!==null&&i!==void 0&&i.msHasOpTasks);if(c){var d=this.bufferInfo();n.paused&&!n.currentTime&&(d=this.bufferInfo(d.nextStart||.5));var h=Math.abs(d.end-n.duration)<.1||!this.isLive&&u&&d.end>=u.start+u.duration;h&&this._bufferService.endOfStream()}}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?he.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){xe.enable(),Rt.enable()}},{key:"disableLogger",value:function(){xe.disable(),Rt.disable()}}]),t}(yt);x(Ct,"version","3.0.19");try{localStorage.getItem("xgd")?Ct.enableLogger():Ct.disableLogger()}catch{}var Lo=function(){function a(s,t){var r=this;ge(this,a),x(this,"_opts",null),x(this,"_plugin",null),x(this,"_onLowDecode",function(){var e,i,n,o,l=r._opts,u=l.media,c=l.innerDegrade;(e=r._plugin)===null||e===void 0||(i=e.player)===null||i===void 0||i.emit("lowdecode",u.degradeInfo),(n=r._plugin)===null||n===void 0||(o=n.player)===null||o===void 0||o.emit("core_event",ne(ne({},u.degradeInfo),{},{eventName:te.LOWDECODE})),c===1&&r._degrade(u.src)}),x(this,"_degrade",function(e){var i=r._plugin.player,n=i.video;if(!(n&&n.TAG!=="MVideo")){var o=i.video.degradeVideo;i.video=o,n.degrade(e),e&&(i.config.url=e);var l=i.root.firstChild;l.TAG==="MVideo"&&i.root.replaceChild(o,l);var u=r._plugin.constructor.pluginName.toLowerCase();i.unRegisterPlugin(u),i.once("canplay",function(){i.play()})}}),x(this,"forceDegradeToVideo",function(e){var i=r._opts.innerDegrade;i===1&&r._degrade(e)}),this._opts=s,this._plugin=t,this._init()}return Se(a,[{key:"_init",value:function(){var t=this._opts,r=t.media,e=t.preloadTime,i=t.innerDegrade,n=t.isLive;if(r){if(!n&&r.setPlayMode){r.setPlayMode("VOD");return}i&&r.setAttribute("innerdegrade",i),e&&r.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var t=this._opts.media;t.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var t,r;(t=this._opts)===null||t===void 0||(r=t.media)===null||r===void 0||r.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),a}();function Xo(a,s){var t=s.player,r=t.currentTime,e={startTime:r};switch(dr(a)){case"boolean":e.seamless=a;break;case"object":Object.assign(e,a);break}return e}var oa=function(a){Lr(t,a);var s=Xr(t);function t(){var r;ge(this,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return r=s.call.apply(s,[this].concat(i)),x(Q(r),"hls",null),x(Q(r),"pluginExtension",null),x(Q(r),"getStats",function(){var o;return(o=r.hls)===null||o===void 0?void 0:o.getStats()}),x(Q(r),"_onSwitchSubtitle",function(o){var l,u=o.lang;(l=r.hls)===null||l===void 0||l.switchSubtitleStream(u)}),x(Q(r),"_onSwitchURL",function(o,l){return new Promise(function(u,c){var d=Q(r),h=d.player,p=d.hls;if(p){var v,Z,b=Xo(l,Q(r));h.config.url=o,p.switchURL(o,b).then(function(){return u(!0)}).catch(c),!b.seamless&&(v=r.player.config)!==null&&v!==void 0&&(Z=v.hls)!==null&&Z!==void 0&&Z.keepStatusAfterSwitch&&r._keepPauseStatus()}else c()})}),x(Q(r),"_keepPauseStatus",function(){var o=r.player.paused;o&&r.player.once("canplay",function(){r.player.pause()})}),r}return Se(t,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,i,n=(e=this.player)===null||e===void 0||(i=e.config)===null||i===void 0?void 0:i.mediaType;return!!n&&n!=="video"&&n!=="audio"}},{key:"beforePlayerInit",value:function(){var e=this,i=this.player.config,n=i.hls||{};if(!(!i.url&&!i.__allowHlsEmptyUrl__||!n.preferMMS&&he.isMMSOnly())){if(this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL,this.player.handleSource=!1,n.innerDegrade=n.innerDegrade||i.innerDegrade,(n.disconnectTime===null||n.disconnectTime===void 0)&&(n.disconnectTime=0),this.hls=new Ct(ne({softDecode:this.softDecode,isLive:i.isLive,media:this.player.media||this.player.video,startTime:i.startTime,url:i.url},n)),this.softDecode||_t.defineGetterOrSetter(this.player,{url:{get:function(){var u,c;return(u=e.hls)===null||u===void 0||(c=u.media)===null||c===void 0?void 0:c.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Lo(ne({isLive:i.isLive,media:this.player.video},n),this),this.player.forceDegradeToVideo=function(){for(var l,u=arguments.length,c=new Array(u),d=0;d<u;d++)c[d]=arguments[d];return(l=e.pluginExtension)===null||l===void 0?void 0:l.forceDegradeToVideo.apply(l,c)}),i.isLive){var o;(o=this.player)===null||o===void 0||o.useHooks("replay",function(){var l;return(l=e.hls)===null||l===void 0?void 0:l.replay()})}this.on(pa,this._onSwitchSubtitle),this.on(Ht,this._onSwitchURL),this.on(pn,this.destroy.bind(this)),this._transError(),this._transCoreEvent(K.TTFB),this._transCoreEvent(K.LOAD_START),this._transCoreEvent(K.LOAD_RESPONSE_HEADERS),this._transCoreEvent(K.LOAD_COMPLETE),this._transCoreEvent(K.LOAD_RETRY),this._transCoreEvent(K.SOURCEBUFFER_CREATED),this._transCoreEvent(K.MEDIASOURCE_OPENED),this._transCoreEvent(K.REMOVE_BUFFER),this._transCoreEvent(K.BUFFEREOS),this._transCoreEvent(K.KEYFRAME),this._transCoreEvent(K.METADATA_PARSED),this._transCoreEvent(K.DEMUXED_TRACK),this._transCoreEvent(K.SEI),this._transCoreEvent(K.SEI_IN_TIME),this._transCoreEvent(K.SPEED),this._transCoreEvent(K.HLS_MANIFEST_LOADED),this._transCoreEvent(K.HLS_LEVEL_LOADED),this._transCoreEvent(K.STREAM_EXCEPTION),this._transCoreEvent(K.SWITCH_URL_SUCCESS),this._transCoreEvent(K.SWITCH_URL_FAILED),this._transCoreEvent(te.NO_AUDIO_TRACK),this._transCoreEvent(te.STREAM_PARSED),this._transCoreEvent(te.SUBTITLE_SEGMENTS),this._transCoreEvent(te.SUBTITLE_PLAYLIST),this._transCoreEvent(te.APPEND_COST),i.url&&this.hls.load(i.url,!0).catch(function(l){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(te.ERROR,function(i){e.player&&e.player.emit(vn,new St(e.player,i))})}},{key:"_transCoreEvent",value:function(e){var i=this;this.hls.on(e,function(n){i.player&&(i.player.emit("core_event",ne(ne({},n),{},{eventName:e})),e===K.SEI_IN_TIME&&i.hls.hasSubtitle&&i._emitSeiPaylodTime(n))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var i=JSON.parse(Array.from(e.data.payload).map(function(n){return String.fromCharCode(n)}).join("").slice(0,-1));if(!i.rtmp_dts)return;this.player.emit("core_event",{eventName:te.SEI_PAYLOAD_TIME,time:i.rtmp_dts})}catch{}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,i){return Ct.isSupported(e,i)}}]),t}(_t);x(oa,"Hls",Ct);x(oa,"EVENT",te);function tn(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,r)}return t}function ft(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?tn(Object(t),!0).forEach(function(r){ze(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):tn(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function re(){re=function(){return a};var a={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,G){return m[y]=G}}function u(f,m,y,G){var g=m&&m.prototype instanceof h?m:h,k=Object.create(g.prototype),M=new Y(G||[]);return r(k,"_invoke",{value:S(f,y,M)}),k}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(G){return{type:"throw",arg:G}}}a.wrap=u;var d={};function h(){}function p(){}function v(){}var Z={};l(Z,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==s&&t.call(L,i)&&(Z=L);var w=v.prototype=h.prototype=Object.create(Z);function W(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function X(f,m){function y(g,k,M,H){var C=c(f[g],f,k);if(C.type!=="throw"){var P=C.arg,A=P.value;return A&&typeof A=="object"&&t.call(A,"__await")?m.resolve(A.__await).then(function(N){y("next",N,M,H)},function(N){y("throw",N,M,H)}):m.resolve(A).then(function(N){P.value=N,M(P)},function(N){return y("throw",N,M,H)})}H(C.arg)}var G;r(this,"_invoke",{value:function(g,k){function M(){return new m(function(H,C){y(g,k,H,C)})}return G=G?G.then(M,M):M()}})}function S(f,m,y){var G="suspendedStart";return function(g,k){if(G==="executing")throw new Error("Generator is already running");if(G==="completed"){if(g==="throw")throw k;return U()}for(y.method=g,y.arg=k;;){var M=y.delegate;if(M){var H=R(M,y);if(H){if(H===d)continue;return H}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(G==="suspendedStart")throw G="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);G="executing";var C=c(f,m,y);if(C.type==="normal"){if(G=y.done?"completed":"suspendedYield",C.arg===d)continue;return{value:C.arg,done:y.done}}C.type==="throw"&&(G="completed",y.method="throw",y.arg=C.arg)}}}function R(f,m){var y=m.method,G=f.iterator[y];if(G===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,R(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var g=c(G,f.iterator,m.arg);if(g.type==="throw")return m.method="throw",m.arg=g.arg,m.delegate=null,d;var k=g.arg;return k?k.done?(m[f.resultName]=k.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):k:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function T(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function V(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function Y(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(T,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,G=function g(){for(;++y<f.length;)if(t.call(f,y))return g.value=f[y],g.done=!1,g;return g.value=void 0,g.done=!0,g};return G.next=G}}return{next:U}}function U(){return{value:void 0,done:!0}}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),a.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},a.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(w),f},a.awrap=function(f){return{__await:f}},W(X.prototype),l(X.prototype,n,function(){return this}),a.AsyncIterator=X,a.async=function(f,m,y,G,g){g===void 0&&(g=Promise);var k=new X(u(f,m,y,G),g);return a.isGeneratorFunction(m)?k:k.next().then(function(M){return M.done?M.value:k.next()})},W(w),l(w,o,"Generator"),l(w,i,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),a.keys=function(f){var m=Object(f),y=[];for(var G in m)y.push(G);return y.reverse(),function g(){for(;y.length;){var k=y.pop();if(k in m)return g.value=k,g.done=!1,g}return g.done=!0,g}},a.values=I,Y.prototype={constructor:Y,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(C,P){return k.type="throw",k.arg=f,m.next=C,P&&(m.method="next",m.arg=void 0),!!P}for(var G=this.tryEntries.length-1;G>=0;--G){var g=this.tryEntries[G],k=g.completion;if(g.tryLoc==="root")return y("end");if(g.tryLoc<=this.prev){var M=t.call(g,"catchLoc"),H=t.call(g,"finallyLoc");if(M&&H){if(this.prev<g.catchLoc)return y(g.catchLoc,!0);if(this.prev<g.finallyLoc)return y(g.finallyLoc)}else if(M){if(this.prev<g.catchLoc)return y(g.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return y(g.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var G=this.tryEntries[y];if(G.tryLoc<=this.prev&&t.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var g=G;break}}g&&(f==="break"||f==="continue")&&g.tryLoc<=m&&m<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=f,k.arg=m,g?(this.method="next",this.next=g.finallyLoc,d):this.complete(k)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),V(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var G=y.completion;if(G.type==="throw"){var g=G.arg;V(y)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},a}function rn(a,s,t,r,e,i,n){try{var o=a[i](n),l=o.value}catch(u){t(u);return}o.done?s(l):Promise.resolve(l).then(r,e)}function Ve(a){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=a.apply(s,t);function n(l){rn(i,r,e,n,o,"next",l)}function o(l){rn(i,r,e,n,o,"throw",l)}n(void 0)})}}function Vt(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function nn(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,la(r.key),r)}}function Tt(a,s,t){return s&&nn(a.prototype,s),t&&nn(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function ze(a,s,t){return s=la(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function hi(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&ii(a,s)}function mr(a){return mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mr(a)}function ii(a,s){return ii=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ii(a,s)}function Go(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xe(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Wo(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xe(a)}function mi(a){var s=Go();return function(){var r=mr(a),e;if(s){var i=mr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Wo(this,e)}}function wo(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function la(a){var s=wo(a,"string");return typeof s=="symbol"?s:String(s)}var fi={};Object.defineProperty(fi,"__esModule",{value:!0});fi.default=function(a){for(var s=0,t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var i=!0,n=!1,o=void 0;try{for(var l=r[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var c=u.value;s+=c.length}}catch(W){n=!0,o=W}finally{try{!i&&l.return&&l.return()}finally{if(n)throw o}}var d=new a(s),h=0,p=!0,v=!1,Z=void 0;try{for(var b=r[Symbol.iterator](),L;!(p=(L=b.next()).done);p=!0){var w=L.value;d.set(w,h),h+=w.length}}catch(W){v=!0,Z=W}finally{try{!p&&b.return&&b.return()}finally{if(v)throw Z}}return d};var Ro=fi,Vo=To(Ro);function To(a){return a&&a.__esModule?a:{default:a}}var ko=Vo.default;const xo=Za(ko);var ua="3.0.19",$e={416:ve[F.NETWROK_RANGE_NOT_SATISFIABLE],403:ve[F.NETWORK_FORBIDDEN],404:ve[F.NETWORK_NOTFOUND],timeout:ve[F.NETWORK_TIMEOUT],"4xx":"".concat(ve[F.NETWORK],"4XX"),"5xx":"".concat(ve[F.NETWORK],"5XX"),networkError:ve[F.NETWORK],contentError:"".concat(ve[F.NETWORK],"contentError"),mse:ve[F.MEDIA][F.SUB_TYPES.MSE_OTHER],mseOpen:ve[F.MEDIA][F.SUB_TYPES.MSE_ADD_SB],mseAppend:ve[F.MEDIA][F.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:ve[F.MEDIA][F.SUB_TYPES.MSE_HIJACK],eme_hijack:ve[F.MEDIA][F.SUB_TYPES.EME_HIJACK],metaError:ve[F.DEMUX][F.SUB_TYPES.MP4],muxError:ve[F.REMUX][F.SUB_TYPES.FMP4],other:ve[F.OTHER],waitTimeout:ve[F.RUNTIME][F.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:ve[F.RUNTIME][F.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:ve[F.DRM][F.SUB_TYPES.LICENSE]},Mt=F;function Mo(a){return $e[a]||a}var Yo=Tt(function a(s,t,r){Vt(this,a);var e=0,i=0;r&&r.range&&r.range.length>1&&(e=r.range[0],i=r.range[1]);var n=Mo(t);return{errorCode:n,errorType:s,errorMessage:(r==null?void 0:r.httpText)||(r==null?void 0:r.message),url:r==null?void 0:r.url,httpCode:t,version:ua,rangeStart:e,rangeEnd:i,ext:r,mediaError:{code:n,message:(r==null?void 0:r.httpText)||(r==null?void 0:r.message)}}}),Io=Tt(function a(s,t,r){return Vt(this,a),{errorCode:t,errorType:s,version:ua,errorMessage:r.msg,ext:r,mediaError:{code:t,message:r.msg}}}),et={};et.nowTime=function(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}};et.concatData=function(a,s){var t=[],r=0;a&&t.push(a),s&&t.push(s),t.every(function(n){return n&&(r+=n.byteLength),!0});var e=new Uint8Array(r),i=0;return t.every(function(n){return n&&(e.set(n,i),i+=n.byteLength),!0}),e};function _o(a,s){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var r,e,i,n,o=[],l=!0,u=!1;try{if(i=(t=t.call(a)).next,s!==0)for(;!(l=(r=i.call(t)).done)&&(o.push(r.value),o.length!==s);l=!0);}catch(c){u=!0,e=c}finally{try{if(!l&&t.return!=null&&(n=t.return(),Object(n)!==n))return}finally{if(u)throw e}}return o}}function an(a,s){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);s&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),t.push.apply(t,r)}return t}function ni(a){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?an(Object(t),!0).forEach(function(r){He(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):an(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function oe(){oe=function(){return a};var a={},s=Object.prototype,t=s.hasOwnProperty,r=Object.defineProperty||function(f,m,y){f[m]=y.value},e=typeof Symbol=="function"?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function l(f,m,y){return Object.defineProperty(f,m,{value:y,enumerable:!0,configurable:!0,writable:!0}),f[m]}try{l({},"")}catch{l=function(m,y,G){return m[y]=G}}function u(f,m,y,G){var g=m&&m.prototype instanceof h?m:h,k=Object.create(g.prototype),M=new Y(G||[]);return r(k,"_invoke",{value:S(f,y,M)}),k}function c(f,m,y){try{return{type:"normal",arg:f.call(m,y)}}catch(G){return{type:"throw",arg:G}}}a.wrap=u;var d={};function h(){}function p(){}function v(){}var Z={};l(Z,i,function(){return this});var b=Object.getPrototypeOf,L=b&&b(b(I([])));L&&L!==s&&t.call(L,i)&&(Z=L);var w=v.prototype=h.prototype=Object.create(Z);function W(f){["next","throw","return"].forEach(function(m){l(f,m,function(y){return this._invoke(m,y)})})}function X(f,m){function y(g,k,M,H){var C=c(f[g],f,k);if(C.type!=="throw"){var P=C.arg,A=P.value;return A&&typeof A=="object"&&t.call(A,"__await")?m.resolve(A.__await).then(function(N){y("next",N,M,H)},function(N){y("throw",N,M,H)}):m.resolve(A).then(function(N){P.value=N,M(P)},function(N){return y("throw",N,M,H)})}H(C.arg)}var G;r(this,"_invoke",{value:function(g,k){function M(){return new m(function(H,C){y(g,k,H,C)})}return G=G?G.then(M,M):M()}})}function S(f,m,y){var G="suspendedStart";return function(g,k){if(G==="executing")throw new Error("Generator is already running");if(G==="completed"){if(g==="throw")throw k;return U()}for(y.method=g,y.arg=k;;){var M=y.delegate;if(M){var H=R(M,y);if(H){if(H===d)continue;return H}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(G==="suspendedStart")throw G="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);G="executing";var C=c(f,m,y);if(C.type==="normal"){if(G=y.done?"completed":"suspendedYield",C.arg===d)continue;return{value:C.arg,done:y.done}}C.type==="throw"&&(G="completed",y.method="throw",y.arg=C.arg)}}}function R(f,m){var y=m.method,G=f.iterator[y];if(G===void 0)return m.delegate=null,y==="throw"&&f.iterator.return&&(m.method="return",m.arg=void 0,R(f,m),m.method==="throw")||y!=="return"&&(m.method="throw",m.arg=new TypeError("The iterator does not provide a '"+y+"' method")),d;var g=c(G,f.iterator,m.arg);if(g.type==="throw")return m.method="throw",m.arg=g.arg,m.delegate=null,d;var k=g.arg;return k?k.done?(m[f.resultName]=k.value,m.next=f.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,d):k:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,d)}function T(f){var m={tryLoc:f[0]};1 in f&&(m.catchLoc=f[1]),2 in f&&(m.finallyLoc=f[2],m.afterLoc=f[3]),this.tryEntries.push(m)}function V(f){var m=f.completion||{};m.type="normal",delete m.arg,f.completion=m}function Y(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(T,this),this.reset(!0)}function I(f){if(f){var m=f[i];if(m)return m.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var y=-1,G=function g(){for(;++y<f.length;)if(t.call(f,y))return g.value=f[y],g.done=!1,g;return g.value=void 0,g.done=!0,g};return G.next=G}}return{next:U}}function U(){return{value:void 0,done:!0}}return p.prototype=v,r(w,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=l(v,o,"GeneratorFunction"),a.isGeneratorFunction=function(f){var m=typeof f=="function"&&f.constructor;return!!m&&(m===p||(m.displayName||m.name)==="GeneratorFunction")},a.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,v):(f.__proto__=v,l(f,o,"GeneratorFunction")),f.prototype=Object.create(w),f},a.awrap=function(f){return{__await:f}},W(X.prototype),l(X.prototype,n,function(){return this}),a.AsyncIterator=X,a.async=function(f,m,y,G,g){g===void 0&&(g=Promise);var k=new X(u(f,m,y,G),g);return a.isGeneratorFunction(m)?k:k.next().then(function(M){return M.done?M.value:k.next()})},W(w),l(w,o,"Generator"),l(w,i,function(){return this}),l(w,"toString",function(){return"[object Generator]"}),a.keys=function(f){var m=Object(f),y=[];for(var G in m)y.push(G);return y.reverse(),function g(){for(;y.length;){var k=y.pop();if(k in m)return g.value=k,g.done=!1,g}return g.done=!0,g}},a.values=I,Y.prototype={constructor:Y,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!f)for(var m in this)m.charAt(0)==="t"&&t.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var f=this.tryEntries[0].completion;if(f.type==="throw")throw f.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var m=this;function y(C,P){return k.type="throw",k.arg=f,m.next=C,P&&(m.method="next",m.arg=void 0),!!P}for(var G=this.tryEntries.length-1;G>=0;--G){var g=this.tryEntries[G],k=g.completion;if(g.tryLoc==="root")return y("end");if(g.tryLoc<=this.prev){var M=t.call(g,"catchLoc"),H=t.call(g,"finallyLoc");if(M&&H){if(this.prev<g.catchLoc)return y(g.catchLoc,!0);if(this.prev<g.finallyLoc)return y(g.finallyLoc)}else if(M){if(this.prev<g.catchLoc)return y(g.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return y(g.finallyLoc)}}}},abrupt:function(f,m){for(var y=this.tryEntries.length-1;y>=0;--y){var G=this.tryEntries[y];if(G.tryLoc<=this.prev&&t.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var g=G;break}}g&&(f==="break"||f==="continue")&&g.tryLoc<=m&&m<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=f,k.arg=m,g?(this.method="next",this.next=g.finallyLoc,d):this.complete(k)},complete:function(f,m){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&m&&(this.next=m),d},finish:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.finallyLoc===f)return this.complete(y.completion,y.afterLoc),V(y),d}},catch:function(f){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc===f){var G=y.completion;if(G.type==="throw"){var g=G.arg;V(y)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(f,m,y){return this.delegate={iterator:I(f),resultName:m,nextLoc:y},this.method==="next"&&(this.arg=void 0),d}},a}function sn(a,s,t,r,e,i,n){try{var o=a[i](n),l=o.value}catch(u){t(u);return}o.done?s(l):Promise.resolve(l).then(r,e)}function Ke(a){return function(){var s=this,t=arguments;return new Promise(function(r,e){var i=a.apply(s,t);function n(l){sn(i,r,e,n,o,"next",l)}function o(l){sn(i,r,e,n,o,"throw",l)}n(void 0)})}}function pi(a,s){if(!(a instanceof s))throw new TypeError("Cannot call a class as a function")}function Eo(a,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,da(r.key),r)}}function vi(a,s,t){return s&&Eo(a.prototype,s),Object.defineProperty(a,"prototype",{writable:!1}),a}function He(a,s,t){return s=da(s),s in a?Object.defineProperty(a,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[s]=t,a}function Co(a,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(s&&s.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),s&&ai(a,s)}function fr(a){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fr(a)}function ai(a,s){return ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ai(a,s)}function Ko(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Po(a,s){if(a==null)return{};var t={},r=Object.keys(a),e,i;for(i=0;i<r.length;i++)e=r[i],!(s.indexOf(e)>=0)&&(t[e]=a[e]);return t}function Ho(a,s){if(a==null)return{};var t=Po(a,s),r,e;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(e=0;e<i.length;e++)r=i[e],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(t[r]=a[r])}return t}function Ue(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function No(a,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ue(a)}function Do(a){var s=Ko();return function(){var r=fr(a),e;if(s){var i=fr(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return No(this,e)}}function Fo(a,s){return Jo(a)||_o(a,s)||ca(a,s)||Bo()}function Uo(a){return zo(a)||Oo(a)||ca(a)||jo()}function zo(a){if(Array.isArray(a))return si(a)}function Jo(a){if(Array.isArray(a))return a}function Oo(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function ca(a,s){if(a){if(typeof a=="string")return si(a,s);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return si(a,s)}}function si(a,s){(s==null||s>a.length)&&(s=a.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=a[t];return r}function jo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ao(a,s){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,s||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function da(a){var s=Ao(a,"string");return typeof s=="symbol"?s:String(s)}function Qo(a){return ni({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",cache:null},a)}var nr=vi(function a(s,t){pi(this,a),this.type="file",this.message=s,this.data=t}),$o=function(){function a(){pi(this,a),He(this,"_data",Object.create(null))}return vi(a,[{key:"set",value:function(t,r){this._data[t]=r}},{key:"get",value:function(t){return this._data[t]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),a}();function on(a,s){var t=a.trak;if(!(!t||!t.length)){var r=t.find(function(p){var v,Z;return((v=p.mdia)===null||v===void 0||(Z=v.hdlr)===null||Z===void 0?void 0:Z.handlerType)==="vide"}),e=t.find(function(p){var v,Z;return((v=p.mdia)===null||v===void 0||(Z=v.hdlr)===null||Z===void 0?void 0:Z.handlerType)==="soun"});if(!(!r&&!e)){var i=[],n=[];if(s){var o=[],l=0,u=s.start+s.size;s.references.forEach(function(p,v){o.push({index:v,startTime:l,endTime:l+p.subsegment_duration/s.timescale,duration:p.subsegment_duration/s.timescale,range:[u,u+p.referenced_size],frames:[]}),l+=p.subsegment_duration/s.timescale,u+=p.referenced_size}),i=o,n=o}else{var c,d,h=function(v){return v?[{index:0,startTime:0,endTime:v.duration/v.timescale,duration:v.duration/v.timescale,range:[a.start+a.size,""],frames:[]}]:[]};n=h(a.mvhd.duration?a.mvhd:(c=r.mdia)===null||c===void 0?void 0:c.mdhd),i=h(a.mvhd.duration?a.mvhd:(d=e.mdia)===null||d===void 0?void 0:d.mdhd)}return{videoSegments:n,audioSegments:i}}}}function Pr(a,s){var t=a.trak;if(!(!t||!t.length)){var r=t.find(function(f){var m,y;return((m=f.mdia)===null||m===void 0||(y=m.hdlr)===null||y===void 0?void 0:y.handlerType)==="vide"}),e=t.find(function(f){var m,y;return((m=f.mdia)===null||m===void 0||(y=m.hdlr)===null||y===void 0?void 0:y.handlerType)==="soun"});if(!(!r&&!e)){var i=[],n=[],o;if(r){var l,u,c,d=(l=r.mdia)===null||l===void 0||(u=l.minf)===null||u===void 0?void 0:u.stbl;if(!d)return;var h=(c=r.mdia.mdhd)===null||c===void 0?void 0:c.timescale,p=d.stts,v=d.stsc,Z=d.stsz,b=d.stco,L=d.stss,w=d.ctts;if(!h||!p||!v||!Z||!b||!L)return;i=ln(s,h,p,v,Z,b,L,w),o=i.map(function(f){return f.duration})}if(e){var W,X,S,R=(W=e.mdia)===null||W===void 0||(X=W.minf)===null||X===void 0?void 0:X.stbl;if(!R)return;var T=(S=e.mdia.mdhd)===null||S===void 0?void 0:S.timescale,V=R.stts,Y=R.stsc,I=R.stsz,U=R.stco;if(!T||!V||!Y||!I||!U)return;n=ln(s,T,V,Y,I,U,null,null,o)}return{videoSegments:i,audioSegments:n}}}}function ln(a,s,t,r,e,i,n,o,l){var u,c=[],d=[],h=[],p=r.entries,v=i.entries,Z=e.entrySizes,b=n==null?void 0:n.entries,L=o==null?void 0:o.entries,w;L&&(w=[],L.forEach(function(se){for(var at=se.count,Oe=se.offset,st=0;st<at;st++)w.push(Oe)}));var W;b&&(W={},b.forEach(function(se){W[se-1]=!0}));var X,S,R=0,T=0,V=0,Y=0,I=0,U=(u=p[0])===null||u===void 0?void 0:u.samplesPerChunk,f=p[1]?p[1].firstChunk-1:1/0,m=0,y=-1;t.entries.forEach(function(se){var at=se.count,Oe=se.delta;S=Oe;for(var st=0;st<at;st++)X={dts:m,startTime:R,duration:S,size:Z[T]||e.sampleSize,offset:v[V]+I,index:T},b&&(X.keyframe=W[T],X.keyframe?(y++,d.push([X]),h.push(X.duration)):(d[d.length-1].push(X),h[d.length-1]+=X.duration),X.gopId=y),w&&T<w.length&&(X.pts=m+w[T]),T===0&&(X.pts=0),c.push(X),R+=S,m+=Oe,T++,T<U?I+=X.size:(V++,I=0,V>=f&&(Y++,f=p[Y+1]?p[Y+1].firstChunk-1:1/0),U+=p[Y].samplesPerChunk)});var G=c.length;if(!G||n&&!c[0].keyframe)return[];var g=[],k=[],M=0,H,C=0,P=function(at){var Oe;H=k[k.length-1],g.push({index:g.length,startTime:((Oe=g[g.length-1])===null||Oe===void 0?void 0:Oe.endTime)||k[0].startTime/s,endTime:(H.startTime+H.duration)/s,duration:at,range:[k[0].offset,H.offset+H.size],frames:k}),M=0,k=[]};if(n)for(var A=a*s,N=0,ye=d.length;N<ye;N++){var be;M+=h[N],(be=k).push.apply(be,Uo(d[N])),N+1<ye?(N===0||M>A)&&P(M/s):P(M/s)}else{l=l||[];for(var Je=l[0]||a,me=0;me<G;me++){k.push(c[me]),M+=c[me].duration;var mt=M/s;(me+1>=G||mt+C>=Je)&&(C+=mt-Je,P(mt),Je=l[g.length]||a)}}return g}function un(a,s){var t="",r="",e=0,i=0,n=0,o=0,l=0,u=0,c=0;a.mvhd&&(l=a.mvhd.duration/a.mvhd.timescale);var d=a.trak;if(d){var h=d.find(function(g){var k,M;return((k=g.mdia)===null||k===void 0||(M=k.hdlr)===null||M===void 0?void 0:M.handlerType)==="vide"}),p=d.find(function(g){var k,M;return((k=g.mdia)===null||k===void 0||(M=k.hdlr)===null||M===void 0?void 0:M.handlerType)==="soun"}),v=null,Z;if(h){var b,L,w;if(v=(b=h.mdia)===null||b===void 0||(L=b.minf)===null||L===void 0||(w=L.stbl)===null||w===void 0?void 0:w.stsd.entries[0],v){var W,X,S;if(e=v.width,i=v.height,u=(W=h.mdia)===null||W===void 0||(X=W.mdhd)===null||X===void 0?void 0:X.timescale,t=(S=v.avcC||v.hvcC||v.av1C)===null||S===void 0?void 0:S.codec,v.type==="encv"){var R,T;Z=(R=v.sinf)===null||R===void 0||(T=R.schi)===null||T===void 0?void 0:T.tenc.default_KID}}}if(p){var V,Y,I;if(v=(V=p.mdia)===null||V===void 0||(Y=V.minf)===null||Y===void 0||(I=Y.stbl)===null||I===void 0?void 0:I.stsd.entries[0],v){var U,f,m;if(n=v.channelCount,o=v.sampleRate,r=(U=v.esds)===null||U===void 0?void 0:U.codec,c=(f=p.mdia)===null||f===void 0||(m=f.mdhd)===null||m===void 0?void 0:m.timescale,v.type==="enca"){var y,G;Z=Z||((y=v.sinf)===null||y===void 0||(G=y.schi)===null||G===void 0?void 0:G.tenc.default_KID)}}}return{kid:Z?Z.join(""):null,videoCodec:t,audioCodec:r,width:e,height:i,videoTimescale:u,audioChannelCount:n,audioSampleRate:o,duration:l,audioTimescale:c,moov:a,isFragmentMP4:s}}}function cn(a){return typeof a=="number"&&!Number.isNaN(a)}var qo=["vid","cache"],el=function(a){Co(t,a);var s=Do(t);function t(r){var e;pi(this,t),e=s.call(this),He(Ue(e),"vid",""),He(Ue(e),"url",""),He(Ue(e),"meta",{}),He(Ue(e),"downloadInfo",[]),He(Ue(e),"videoSegments",[]),He(Ue(e),"audioSegments",[]),He(Ue(e),"cache",null),He(Ue(e),"_currentSegmentIndex",-1),He(Ue(e),"_currentLoadingSegmentIndex",-1),He(Ue(e),"buffer",void 0),He(Ue(e),"_error",void 0),He(Ue(e),"_transformError",function(u){return u}),e._config=Qo(r);var i=e._config,n=i.vid,o=i.cache,l=Ho(i,qo);return e.cache=o||new $o,e.vid=n||l.url,e.url=l.url,l.transformError=e._transformError,e.logger=new xe("MP4Loader_"+e.vid),r.openLog&&xe.enable(),l.logger=e.logger,e._loader=new pt(l),e._loader.on(K.REAL_TIME_SPEED,function(u){e.emit(K.REAL_TIME_SPEED,u)}),e}return vi(t,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){cn(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){if(cn(e)){var i,n,o=((i=this.videoSegments[this.videoSegments.length-1])===null||i===void 0?void 0:i.index)||((n=this.audioSegments[this.audioSegments.length-1])===null||n===void 0?void 0:n.index)||0;return e>=o}return!1}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:function(){var r=Ke(oe().mark(function i(n){var o,l,u,c=arguments;return oe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=c.length>1&&c[1]!==void 0?c[1]:n,l=c.length>2?c[2]:void 0,u=c.length>3?c[3]:void 0,h.next=5,this.reset(u);case 5:n&&(this.url=n),o&&(this.vid=o),l&&(this._config.moovEnd=l);case 8:case"end":return h.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"getOrLoadMeta",value:function(){var r=Ke(oe().mark(function i(n){return oe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.isMetaLoaded){l.next=3;break}return l.next=3,this.loadMeta(n);case 3:return l.abrupt("return",this.meta);case 4:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"loadMetaProcess",value:function(){var r=Ke(oe().mark(function i(n,o,l,u){var c=this,d,h,p,v;return oe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=Fo(o,2),h=d[0],p=d[1],this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[h,p]),v=function(){var L=Ke(oe().mark(function w(W,X,S){var R,T,V,Y,I,U,f,m,y,G,g,k,M;return oe().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(c.meta&&S!==null&&S!==void 0&&S.range&&S.range.length>0&&S.range[1]>=p&&(X=!0,c.logger.debug("[loadMetaProcess],data done,setstate true,[",h,p,"]")),X&&S!==null&&S!==void 0&&S.range&&S.range.length>0&&S.range[1]<p&&(X=!1,c.logger.debug("[loadMetaProcess],data not done,setstate false,[",h,p,"]")),c.logger.debug("[loadMetaProcess],task,[",h,p,"], range,",S.range,",dataLen,",W?W.byteLength:void 0,", state,",X,",err,",c._error),!c._error&&W&&W.byteLength>0&&l(W,X,S),!(c.meta.moov||c._error)){C.next=6;break}return C.abrupt("return");case 6:if(!(W&&W.byteLength>0)){C.next=51;break}if(c.buffer=Gt(c.buffer,W),R=$.findBox(c.buffer,["moov"])[0],R){C.next=23;break}if(T=$.findBox(c.buffer,["mdat"])[0],!X){C.next=23;break}if(T){C.next=18;break}return c._error=!0,l(null,X,S,{err:"cannot find moov or mdat box"}),C.abrupt("return");case 18:return V=T.start+T.size,C.next=21,c.loadData([V,""],n,u);case 21:Y=C.sent,Y&&(R=$.findBox(Y.data,["moov"])[0]);case 23:if(!(R&&X&&R.size>R.data.length)){C.next=27;break}return c.logger.debug("[loadMetaProcess],moov not all, range,",S.range[1],",dataLen,",c.buffer.byteLength,", state,",X),C.next=27,c.loadMetaProcess(n,[S.range[1],R.start+R.size-1],l);case 27:if(!(R&&R.size<=R.data.length&&!c.meta.moov)){C.next=51;break}if(I=$.moov(R),I){C.next=33;break}return c._error=!0,l(null,X,S,{err:"cannot parse moov box"}),C.abrupt("return");case 33:if(U=Pr(I,c._config.segmentDuration),f=function(){var P=Ke(oe().mark(function A(N){var ye,be;return oe().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(ye=$.findBox(c.buffer,[N])[0],!ye){me.next=11;break}if(!(ye.size>ye.data.length)){me.next=10;break}return me.next=5,c.loadData([ye.start,ye.start+ye.size-1],n,u);case 5:if(be=me.sent,!be){me.next=8;break}return me.abrupt("return",$.findBox(be.data,[N])[0]);case 8:me.next=11;break;case 10:return me.abrupt("return",ye);case 11:case"end":return me.stop()}},A)}));return function(N){return P.apply(this,arguments)}}(),m=!1,U&&U.videoSegments.length&&U.audioSegments.length){C.next=41;break}return C.next=39,f("sidx");case 39:y=C.sent,y&&(G=$.sidx(y),G&&(U=on(I,G),m=!0));case 41:if(U){C.next=45;break}return c._error=!0,l(null,X,S,{err:"cannot parse segments"}),C.abrupt("return");case 45:c.meta=un(I,m),g=U,k=g.videoSegments,M=g.audioSegments,c.videoSegments=k,c.audioSegments=M,c.logger.debug("[loadMetaProcess] moov ok"),l(void 0,X,{meta:{meta:c.meta,videoSegments:k,audioSegments:M}});case 51:case"end":return C.stop()}},w)}));return function(W,X,S){return L.apply(this,arguments)}}(),b.next=6,this.loadData([h,p||this._config.moovEnd],n,ni({onProgress:v},u));case 6:case"end":return b.stop()}},i,this)}));function e(i,n,o,l){return r.apply(this,arguments)}return e}()},{key:"loadMeta",value:function(){var r=Ke(oe().mark(function i(n,o,l){var u,c,d,h,p,v,Z,b,L,w,W,X,S,R;return oe().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return u=[],this.logger.debug("[loadMeta start]"),V.next=4,this.loadData([0,o||this._config.moovEnd],n,l);case 4:if(c=V.sent,c){V.next=7;break}return V.abrupt("return");case 7:if(u.push(c),d=$.findBox(c.data,["moov"])[0],d){V.next=23;break}if(h=$.findBox(c.data,["mdat"])[0],h){V.next=13;break}throw new nr("cannot find moov or mdat box",c.data);case 13:return p=h.start+h.size,V.next=16,this.loadData([p],n,l);case 16:if(c=V.sent,c){V.next=19;break}return V.abrupt("return");case 19:if(u.push(c),d=$.findBox(c.data,["moov"],p)[0],d){V.next=23;break}throw new nr("cannot find moov box",c.data);case 23:if(!(d.size>d.data.length)){V.next=31;break}return V.next=26,this.loadData([c.data.length,d.start+d.size-1],n,l);case 26:if(c=V.sent,c){V.next=29;break}return V.abrupt("return");case 29:u.push(c),d.data=Gt(d.data,c.data);case 31:if(v=$.moov(d),v){V.next=34;break}throw new nr("cannot parse moov box",d.data);case 34:if(Z=Pr(v,this._config.segmentDuration),Z){V.next=37;break}throw new nr("cannot parse segments",d.data);case 37:return Z.videoSegments.length&&Z.audioSegments.length||(L=$.findBox(this.buffer,["moof"])[0],w=$.findBox(this.buffer,["sidx"])[0],L&&L.size<=L.data.length&&w&&(W=$.moof(L),b=$.sidx(w),W&&b&&(Z=on(v,b)))),this.meta=un(v,b),X=Z,S=X.videoSegments,R=X.audioSegments,this.videoSegments=S,this.audioSegments=R,this.logger.debug("[load moov end!!!!!]"),V.abrupt("return",{meta:this.meta,videoSegments:S,audioSegments:R,responses:u});case 44:case"end":return V.stop()}},i,this)}));function e(i,n,o){return r.apply(this,arguments)}return e}()},{key:"loadCacheMeta",value:function(e,i){var n=e.moov,o=Pr(n,this._config.segmentDuration),l=o.videoSegments,u=o.audioSegments;this.videoSegments=l,this.audioSegments=u,this._currentSegmentIndex=i,this.meta=e}},{key:"getSegmentByTime",value:function(e){var i,n;return this.videoSegments.length?(i=this.videoSegments.find(function(o){return o.startTime<=e&&o.endTime>e}),i&&(n=this.audioSegments[i.index])):n=this.audioSegments.find(function(o){return o.startTime<=e&&o.endTime>e}),{video:i,audio:n}}},{key:"loadSegmentByTime",value:function(){var r=Ke(oe().mark(function i(n,o){var l,u,c,d,h,p=arguments;return oe().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(l=p.length>2&&p[2]!==void 0?p[2]:!0,u=p.length>3&&p[3]!==void 0?p[3]:{},this.isMetaLoaded){Z.next=5;break}return Z.next=5,this.loadMeta(o);case 5:return c=this.getSegmentByTime(n),d=c.video,h=c.audio,Z.abrupt("return",this._loadSegment(d,h,o,l,u));case 7:case"end":return Z.stop()}},i,this)}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"loadNextSegment",value:function(){var r=Ke(oe().mark(function i(n){var o,l,u,c,d=arguments;return oe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(o=d.length>1&&d[1]!==void 0?d[1]:!0,l=d.length>2&&d[2]!==void 0?d[2]:{},this.isMetaLoaded){p.next=5;break}return p.next=5,this.loadMeta();case 5:return u=this.videoSegments[this._currentSegmentIndex+1],c=this.audioSegments[this._currentSegmentIndex+1],p.abrupt("return",this._loadSegment(u,c,n,o,l));case 8:case"end":return p.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"preload",value:function(){var r=Ke(oe().mark(function i(n){var o=this,l,u,c,d,h,p,v;return oe().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.isMetaLoaded){b.next=3;break}return b.next=3,this.loadMeta(!0);case 3:if(!(!n||n<0)){b.next=5;break}return b.abrupt("return");case 5:if(l=this.getSegmentByTime(n),u=l.video,c=l.audio,d=Math.max((u==null?void 0:u.index)||0,(c==null?void 0:c.index)||0),d){b.next=9;break}return b.abrupt("return");case 9:return h=this.videoSegments.slice(0,d),p=this.audioSegments.slice(0,d),v=function(){var L=Ke(oe().mark(function w(W){return oe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!(W>d)){S.next=2;break}return S.abrupt("return");case 2:return S.next=4,o._loadSegment(h[W],p[W],!0,!1);case 4:return S.next=6,v(W+1);case 6:case"end":return S.stop()}},w)}));return function(W){return L.apply(this,arguments)}}(),b.next=14,v(0);case 14:case"end":return b.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:function(){var r=Ke(oe().mark(function i(){var n,o=arguments;return oe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(n=o.length>0&&o[0]!==void 0?o[0]:!1,n){u.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),u.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return u.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var r=Ke(oe().mark(function i(){return oe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_loadSegment",value:function(){var r=Ke(oe().mark(function i(n,o,l,u,c){var d,h;return oe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(!n&&!o)){v.next=2;break}return v.abrupt("return");case 2:return d=(n==null?void 0:n.index)||(o==null?void 0:o.index)||0,this._currentLoadingSegmentIndex=d,v.prev=4,v.next=7,this.loadData([Math.min((n==null?void 0:n.range[0])||1/0,(o==null?void 0:o.range[0])||1/0),Math.max((n==null?void 0:n.range[1])||0,(o==null?void 0:o.range[1])||0)],l,c);case 7:h=v.sent;case 8:return v.prev=8,this._currentLoadingSegmentIndex=-1,v.finish(8);case 11:if(h){v.next=13;break}return v.abrupt("return");case 13:return u&&(this._currentSegmentIndex=d),h.video=n,h.audio=o,v.abrupt("return",h);case 17:case"end":return v.stop()}},i,this,[[4,,8,11]])}));function e(i,n,o,l,u){return r.apply(this,arguments)}return e}()},{key:"loadData",value:function(){var r=Ke(oe().mark(function i(n,o,l){var u,c,d,h;return oe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=this._getCacheKey(n),v.next=3,this.cache.get(u);case 3:if(c=v.sent,c){v.next=11;break}return h=l&&l.url?l.url:this.url,v.next=8,this._loader.load(h,ni({range:n,vid:this.vid},l));case 8:d=v.sent,v.next=12;break;case 11:d={data:c,state:!0,options:{fromCache:!0,range:n,vid:this.vid}};case 12:if(d){v.next=14;break}return v.abrupt("return");case 14:return c||(d.data&&this.downloadInfo.push({startTime:d.startTime,endTime:d.endTime,size:d.data.byteLength,range:n}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),v.abrupt("return",d);case 17:case"end":return v.stop()}},i,this)}));function e(i,n,o){return r.apply(this,arguments)}return e}()},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),t}(yt),ha=nl(),tl=Pt();al();function rl(){try{return typeof localStorage<"u"&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch{return!1}}function il(){var a="_localstorage_support_test";try{return window.localStorage.setItem(a,!0),window.localStorage.removeItem(a),!1}catch{return!0}}function Pt(){if(ha)try{return!!window.localStorage.getItem("playerlog")}catch{return!1}return!1}function nl(){return rl()&&!il()}function ma(a){for(var s,t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];tl&&console.log&&(s=console).log.apply(s,["[logger]",et.nowTime(),a].concat(r))}function al(){if(ha)try{return!!window.localStorage.getItem("playertestlog")}catch{return!1}return!1}var fa="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGUoZSx0KXt2YXIgcj1PYmplY3Qua2V5cyhlKTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgYT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3QmJihhPWEuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLHQpLmVudW1lcmFibGV9KSkpLHIucHVzaC5hcHBseShyLGEpfXJldHVybiByfWZ1bmN0aW9uIHQodCl7Zm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl7dmFyIGE9bnVsbCE9YXJndW1lbnRzW3JdP2FyZ3VtZW50c1tyXTp7fTtyJTI/ZShPYmplY3QoYSksITApLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kodCxlLGFbZV0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHQsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoYSkpOmUoT2JqZWN0KGEpKS5mb3JFYWNoKChmdW5jdGlvbihlKXtPYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSxlKSl9KSl9cmV0dXJuIHR9ZnVuY3Rpb24gcihlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfWZ1bmN0aW9uIGEoZSx0KXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIGE9dFtyXTthLmVudW1lcmFibGU9YS5lbnVtZXJhYmxlfHwhMSxhLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gYSYmKGEud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGsoYS5rZXkpLGEpfX1mdW5jdGlvbiBuKGUsdCxyKXtyZXR1cm4gdCYmYShlLnByb3RvdHlwZSx0KSxyJiZhKGUsciksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksZX1mdW5jdGlvbiBpKGUsdCxyKXtyZXR1cm4odD1rKHQpKWluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09cixlfWZ1bmN0aW9uIHMoZSx0KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTtlLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKHQmJnQucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6ZSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksdCYmdShlLHQpfWZ1bmN0aW9uIG8oZSl7cmV0dXJuKG89T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSl9KShlKX1mdW5jdGlvbiB1KGUsdCl7cmV0dXJuKHU9T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5fX3Byb3RvX189dCxlfSkoZSx0KX1mdW5jdGlvbiBjKCl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBSZWZsZWN0fHwhUmVmbGVjdC5jb25zdHJ1Y3QpcmV0dXJuITE7aWYoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSlyZXR1cm4hMTtpZigiZnVuY3Rpb24iPT10eXBlb2YgUHJveHkpcmV0dXJuITA7dHJ5e3JldHVybiBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbixbXSwoZnVuY3Rpb24oKXt9KSkpLCEwfWNhdGNoKGUpe3JldHVybiExfX1mdW5jdGlvbiBsKGUsdCxyKXtyZXR1cm4obD1jKCk/UmVmbGVjdC5jb25zdHJ1Y3QuYmluZCgpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1bbnVsbF07YS5wdXNoLmFwcGx5KGEsdCk7dmFyIG49bmV3KEZ1bmN0aW9uLmJpbmQuYXBwbHkoZSxhKSk7cmV0dXJuIHImJnUobixyLnByb3RvdHlwZSksbn0pLmFwcGx5KG51bGwsYXJndW1lbnRzKX1mdW5jdGlvbiBmKGUsdCl7aWYodCYmKCJvYmplY3QiPT10eXBlb2YgdHx8ImZ1bmN0aW9uIj09dHlwZW9mIHQpKXJldHVybiB0O2lmKHZvaWQgMCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTtyZXR1cm4gZnVuY3Rpb24oZSl7aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiBlfShlKX1mdW5jdGlvbiBkKGUpe3ZhciB0PWMoKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcixhPW8oZSk7aWYodCl7dmFyIG49byh0aGlzKS5jb25zdHJ1Y3RvcjtyPVJlZmxlY3QuY29uc3RydWN0KGEsYXJndW1lbnRzLG4pfWVsc2Ugcj1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gZih0aGlzLHIpfX1mdW5jdGlvbiBoKGUsdCl7Zm9yKDshT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCkmJm51bGwhPT0oZT1vKGUpKTspO3JldHVybiBlfWZ1bmN0aW9uIHAoKXtyZXR1cm4gcD0idW5kZWZpbmVkIiE9dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuZ2V0P1JlZmxlY3QuZ2V0LmJpbmQoKTpmdW5jdGlvbihlLHQscil7dmFyIGE9aChlLHQpO2lmKGEpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYSx0KTtyZXR1cm4gbi5nZXQ/bi5nZXQuY2FsbChhcmd1bWVudHMubGVuZ3RoPDM/ZTpyKTpuLnZhbHVlfX0scC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZnVuY3Rpb24gdihlLHQpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBlfShlKXx8ZnVuY3Rpb24oZSx0KXt2YXIgcj1udWxsPT1lP251bGw6InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJmVbU3ltYm9sLml0ZXJhdG9yXXx8ZVsiQEBpdGVyYXRvciJdO2lmKG51bGwhPXIpe3ZhciBhLG4saSxzLG89W10sdT0hMCxjPSExO3RyeXtpZihpPShyPXIuY2FsbChlKSkubmV4dCwwPT09dCl7aWYoT2JqZWN0KHIpIT09cilyZXR1cm47dT0hMX1lbHNlIGZvcig7ISh1PShhPWkuY2FsbChyKSkuZG9uZSkmJihvLnB1c2goYS52YWx1ZSksby5sZW5ndGghPT10KTt1PSEwKTt9Y2F0Y2gobCl7Yz0hMCxuPWx9ZmluYWxseXt0cnl7aWYoIXUmJm51bGwhPXIucmV0dXJuJiYocz1yLnJldHVybigpLE9iamVjdChzKSE9PXMpKXJldHVybn1maW5hbGx5e2lmKGMpdGhyb3cgbn19cmV0dXJuIG99fShlLHQpfHxtKGUsdCl8fGZ1bmN0aW9uKCl7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiB5KGUpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBnKGUpfShlKXx8ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPWVbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9ZVsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKGUpfShlKXx8bShlKXx8ZnVuY3Rpb24oKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiBtKGUsdCl7aWYoZSl7aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBnKGUsdCk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnNsaWNlKDgsLTEpO3JldHVybiJPYmplY3QiPT09ciYmZS5jb25zdHJ1Y3RvciYmKHI9ZS5jb25zdHJ1Y3Rvci5uYW1lKSwiTWFwIj09PXJ8fCJTZXQiPT09cj9BcnJheS5mcm9tKGUpOiJBcmd1bWVudHMiPT09cnx8L14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3Qocik/ZyhlLHQpOnZvaWQgMH19ZnVuY3Rpb24gZyhlLHQpeyhudWxsPT10fHx0PmUubGVuZ3RoKSYmKHQ9ZS5sZW5ndGgpO2Zvcih2YXIgcj0wLGE9bmV3IEFycmF5KHQpO3I8dDtyKyspYVtyXT1lW3JdO3JldHVybiBhfWZ1bmN0aW9uIGsoZSl7dmFyIHQ9ZnVuY3Rpb24oZSx0KXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiBlO3ZhciByPWVbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZih2b2lkIDAhPT1yKXt2YXIgYT1yLmNhbGwoZSx0fHwiZGVmYXVsdCIpO2lmKCJvYmplY3QiIT10eXBlb2YgYSlyZXR1cm4gYTt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpfXJldHVybigic3RyaW5nIj09PXQ/U3RyaW5nOk51bWJlcikoZSl9KGUsInN0cmluZyIpO3JldHVybiJzeW1ib2wiPT10eXBlb2YgdD90OlN0cmluZyh0KX12YXIgYj0idmlkZW8iLF89ImF1ZGlvIix3PSJtZXRhZGF0YSIseD0iYXYxIixTPSJhdmMiLEE9ImhldmMiLEQ9ImFhYyIsQj0iZzcxMTBhIixFPSJnNzExMG0iLFQ9IkxBUkdFX0FWX1NISUZUIixVPSJMQVJHRV9WSURFT19HQVAiLEM9IkxBUkdFX1ZJREVPX0dBUF9CRVRXRUVOX0NIVU5LIixQPSJMQVJHRV9BVURJT19HQVAiLEk9IkFVRElPX0ZJTExFRCIsTT0iQVVESU9fRFJPUFBFRCIsej1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSksaSh0aGlzLCJpZCIsMSksaSh0aGlzLCJ0eXBlIixiKSxpKHRoaXMsImNvZGVjVHlwZSIsUyksaSh0aGlzLCJwaWQiLC0xKSxpKHRoaXMsImh2Y0MiLHZvaWQgMCksaSh0aGlzLCJjb2RlYyIsIiIpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZvcm1hdFRpbWVzY2FsZSIsMCksaSh0aGlzLCJzZXF1ZW5jZU51bWJlciIsMCksaSh0aGlzLCJiYXNlTWVkaWFEZWNvZGVUaW1lIiwwKSxpKHRoaXMsImJhc2VEdHMiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywid2FybmluZ3MiLFtdKSxpKHRoaXMsInNhbXBsZXMiLFtdKSxpKHRoaXMsInBwcyIsW10pLGkodGhpcywic3BzIixbXSksaSh0aGlzLCJ2cHMiLFtdKSxpKHRoaXMsImZwc051bSIsMCksaSh0aGlzLCJmcHNEZW4iLDApLGkodGhpcywic2FyUmF0aW8iLFtdKSxpKHRoaXMsIndpZHRoIiwwKSxpKHRoaXMsImhlaWdodCIsMCksaSh0aGlzLCJuYWxVbml0U2l6ZSIsNCksaSh0aGlzLCJwcmVzZW50IiwhMSksaSh0aGlzLCJpc1ZpZGVvRW5jcnlwdGlvbiIsITEpLGkodGhpcywiaXNBdWRpb0VuY3J5cHRpb24iLCExKSxpKHRoaXMsImlzVmlkZW8iLCEwKSxpKHRoaXMsImtpZCIsbnVsbCksaSh0aGlzLCJwc3NoIixudWxsKSxpKHRoaXMsImV4dCIsdm9pZCAwKX1yZXR1cm4gbihlLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNlcXVlbmNlTnVtYmVyPXRoaXMud2lkdGg9dGhpcy5oZWlnaHQ9dGhpcy5mcHNEZW49dGhpcy5mcHNOdW09dGhpcy5kdXJhdGlvbj10aGlzLmJhc2VNZWRpYURlY29kZVRpbWU9dGhpcy50aW1lc2NhbGU9MCx0aGlzLmNvZGVjPSIiLHRoaXMucHJlc2VudD0hMSx0aGlzLnBpZD0tMSx0aGlzLnBwcz1bXSx0aGlzLnNwcz1bXSx0aGlzLnZwcz1bXSx0aGlzLnNhclJhdGlvPVtdLHRoaXMuc2FtcGxlcz1bXSx0aGlzLndhcm5pbmdzPVtdLHRoaXMuaHZjQz1udWxsfX0se2tleToiZmlyc3REdHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNhbXBsZXMubGVuZ3RoP3RoaXMuc2FtcGxlc1swXS5kdHM6bnVsbH19LHtrZXk6ImZpcnN0UHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0ucHRzOm51bGx9fSx7a2V5OiJzYW1wbGVzRHVyYXRpb24iLGdldDpmdW5jdGlvbigpe2lmKHRoaXMuc2FtcGxlcy5sZW5ndGg+MCl7dmFyIGU9dGhpcy5zYW1wbGVzWzBdLHQ9dGhpcy5zYW1wbGVzW3RoaXMuc2FtcGxlcy5sZW5ndGgtMV07cmV0dXJuIHQuZHRzLWUuZHRzK3QuZHVyYXRpb259cmV0dXJuIDB9fSx7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hIS9hdjAxLy50ZXN0KHRoaXMuY29kZWMpfHwhISh0aGlzLnBwcy5sZW5ndGgmJnRoaXMuc3BzLmxlbmd0aCYmdGhpcy5jb2RlYyl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX0se2tleToiaXNFbmNyeXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc1ZpZGVvRW5jcnlwdGlvbn19XSksZX0oKSxPPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKSxpKHRoaXMsImlkIiwyKSxpKHRoaXMsInR5cGUiLF8pLGkodGhpcywiY29kZWNUeXBlIixEKSxpKHRoaXMsInBpZCIsLTEpLGkodGhpcywiY29kZWMiLCIiKSxpKHRoaXMsInNlcXVlbmNlTnVtYmVyIiwwKSxpKHRoaXMsInNhbXBsZUR1cmF0aW9uIiwwKSxpKHRoaXMsInRpbWVzY2FsZSIsMCksaSh0aGlzLCJmb3JtYXRUaW1lc2NhbGUiLDApLGkodGhpcywiYmFzZU1lZGlhRGVjb2RlVGltZSIsMCksaSh0aGlzLCJkdXJhdGlvbiIsMCksaSh0aGlzLCJ3YXJuaW5ncyIsW10pLGkodGhpcywic2FtcGxlcyIsW10pLGkodGhpcywiYmFzZUR0cyIsMCksaSh0aGlzLCJzYW1wbGVTaXplIiwxNiksaSh0aGlzLCJzYW1wbGVSYXRlIiwwKSxpKHRoaXMsImNoYW5uZWxDb3VudCIsMCksaSh0aGlzLCJvYmplY3RUeXBlIiwwKSxpKHRoaXMsInNhbXBsZVJhdGVJbmRleCIsMCksaSh0aGlzLCJjb25maWciLFtdKSxpKHRoaXMsInByZXNlbnQiLCExKSxpKHRoaXMsImlzVmlkZW9FbmNyeXB0aW9uIiwhMSksaSh0aGlzLCJpc0F1ZGlvRW5jcnlwdGlvbiIsITEpLGkodGhpcywia2lkIixudWxsKSxpKHRoaXMsImV4dCIsdm9pZCAwKX1yZXR1cm4gbihlLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNlcXVlbmNlTnVtYmVyPTAsdGhpcy50aW1lc2NhbGU9MCx0aGlzLnNhbXBsZUR1cmF0aW9uPTAsdGhpcy5zYW1wbGVSYXRlPTAsdGhpcy5jaGFubmVsQ291bnQ9MCx0aGlzLmJhc2VNZWRpYURlY29kZVRpbWU9MCx0aGlzLnByZXNlbnQ9ITEsdGhpcy5waWQ9LTEsdGhpcy5jb2RlYz0iIix0aGlzLnNhbXBsZXM9W10sdGhpcy5jb25maWc9W10sdGhpcy53YXJuaW5ncz1bXX19LHtrZXk6ImV4aXN0Iix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEhKHRoaXMuc2FtcGxlUmF0ZSYmdGhpcy5jaGFubmVsQ291bnQmJnRoaXMuY29kZWMmJnRoaXMuY29kZWNUeXBlPT09RCl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX0se2tleToiaXNFbmNyeXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc0F1ZGlvRW5jcnlwdGlvbn19LHtrZXk6ImZpcnN0RHRzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zYW1wbGVzLmxlbmd0aD90aGlzLnNhbXBsZXNbMF0uZHRzOm51bGx9fSx7a2V5OiJmaXJzdFB0cyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2FtcGxlcy5sZW5ndGg/dGhpcy5zYW1wbGVzWzBdLnB0czpudWxsfX0se2tleToic2FtcGxlc0R1cmF0aW9uIixnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLnNhbXBsZXMubGVuZ3RoPjApe3ZhciBlPXRoaXMuc2FtcGxlc1swXSx0PXRoaXMuc2FtcGxlc1t0aGlzLnNhbXBsZXMubGVuZ3RoLTFdO3JldHVybiB0LmR0cy1lLmR0cyt0LmR1cmF0aW9ufXJldHVybiAwfX1dKSxlfSgpLFI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksaSh0aGlzLCJmbGFnIix7fSksaSh0aGlzLCJrZXlmcmFtZSIsITEpLGkodGhpcywiZ29wSWQiLDApLGkodGhpcywiZHVyYXRpb24iLDApLGkodGhpcywic2l6ZSIsMCksaSh0aGlzLCJ1bml0cyIsW10pLGkodGhpcywiY2hyb21hRm9ybWF0Iiw0MjApLHRoaXMub3JpZ2luUHRzPXRoaXMucHRzPXQsdGhpcy5vcmlnaW5EdHM9dGhpcy5kdHM9YSxuJiYodGhpcy51bml0cz1uKX1yZXR1cm4gbihlLFt7a2V5OiJjdHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB0cy10aGlzLmR0c319LHtrZXk6InNldFRvS2V5ZnJhbWUiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5rZXlmcmFtZT0hMCx0aGlzLmZsYWcuZGVwZW5kc09uPTIsdGhpcy5mbGFnLmlzTm9uU3luY1NhbXBsZT0wfX1dKSxlfSgpLEw9bigoZnVuY3Rpb24gZSh0LGEsbixzKXtyKHRoaXMsZSksaSh0aGlzLCJkdXJhdGlvbiIsMTAyNCksaSh0aGlzLCJmbGFnIix7ZGVwZW5kc09uOjIsaXNOb25TeW5jU2FtcGxlOjB9KSxpKHRoaXMsImtleWZyYW1lIiwhMCksdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9dGhpcy5kdHM9dCx0aGlzLmRhdGE9YSx0aGlzLnNpemU9YS5ieXRlTGVuZ3RoLHRoaXMuc2FtcGxlT2Zmc2V0PXMsbiYmKHRoaXMuZHVyYXRpb249bil9KSksVj1uKChmdW5jdGlvbiBlKHQsYSl7cih0aGlzLGUpLGkodGhpcywidGltZSIsMCksdGhpcy5kYXRhPXQsdGhpcy5vcmlnaW5QdHM9dGhpcy5wdHM9YX0pKSxGPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShWKSxOPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEpfShWKSxqPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKSxpKHRoaXMsImlkIiwzKSxpKHRoaXMsInR5cGUiLHcpLGkodGhpcywidGltZXNjYWxlIiwwKSxpKHRoaXMsImZsdlNjcmlwdFNhbXBsZXMiLFtdKSxpKHRoaXMsInNlaVNhbXBsZXMiLFtdKX1yZXR1cm4gbihlLFt7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aHx8IXRoaXMudGltZXNjYWxlKX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMudGltZXNjYWxlPTAsdGhpcy5mbHZTY3JpcHRTYW1wbGVzPVtdLHRoaXMuc2VpU2FtcGxlcz1bXX19LHtrZXk6Imhhc1NhbXBsZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLmZsdlNjcmlwdFNhbXBsZXMubGVuZ3RoJiYhdGhpcy5zZWlTYW1wbGVzLmxlbmd0aCl9fV0pLGV9KCksRz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCl7aWYocih0aGlzLGUpLGkodGhpcywiX2J5dGVzQXZhaWxhYmxlIix2b2lkIDApLGkodGhpcywiX2JpdHNBdmFpbGFibGUiLDApLGkodGhpcywiX3dvcmQiLDApLCF0KXRocm93IG5ldyBFcnJvcigiRXhwR29sb21iIGRhdGEgcGFyYW1zIGlzIHJlcXVpcmVkIik7dGhpcy5fZGF0YT10LHRoaXMuX2J5dGVzQXZhaWxhYmxlPXQuYnl0ZUxlbmd0aCx0aGlzLl9ieXRlc0F2YWlsYWJsZSYmdGhpcy5fbG9hZFdvcmQoKX1yZXR1cm4gbihlLFt7a2V5OiJiaXRzQXZhaWxhYmxlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYml0c0F2YWlsYWJsZX19LHtrZXk6Il9sb2FkV29yZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9kYXRhLmJ5dGVMZW5ndGgtdGhpcy5fYnl0ZXNBdmFpbGFibGUsdD1NYXRoLm1pbig0LHRoaXMuX2J5dGVzQXZhaWxhYmxlKTtpZigwPT09dCl0aHJvdyBuZXcgRXJyb3IoIk5vIGJ5dGVzIGF2YWlsYWJsZSIpO3ZhciByPW5ldyBVaW50OEFycmF5KDQpO3Iuc2V0KHRoaXMuX2RhdGEuc3ViYXJyYXkoZSxlK3QpKSx0aGlzLl93b3JkPW5ldyBEYXRhVmlldyhyLmJ1ZmZlcikuZ2V0VWludDMyKDApLHRoaXMuX2JpdHNBdmFpbGFibGU9OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10fX0se2tleToic2tpcEJpdHMiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKHRoaXMuX2JpdHNBdmFpbGFibGU+ZSl0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lO2Vsc2V7ZS09dGhpcy5fYml0c0F2YWlsYWJsZTt2YXIgdD1NYXRoLmZsb29yKGUvOCk7ZS09OCp0LHRoaXMuX2J5dGVzQXZhaWxhYmxlLT10LHRoaXMuX2xvYWRXb3JkKCksdGhpcy5fd29yZDw8PWUsdGhpcy5fYml0c0F2YWlsYWJsZS09ZX19fSx7a2V5OiJyZWFkQml0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoZT4zMil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZWFkIG1vcmUgdGhhbiAzMiBiaXRzIik7dmFyIHQ9TWF0aC5taW4odGhpcy5fYml0c0F2YWlsYWJsZSxlKSxyPXRoaXMuX3dvcmQ+Pj4zMi10O3JldHVybiB0aGlzLl9iaXRzQXZhaWxhYmxlLT10LHRoaXMuX2JpdHNBdmFpbGFibGU+MD90aGlzLl93b3JkPDw9dDp0aGlzLl9ieXRlc0F2YWlsYWJsZT4wJiZ0aGlzLl9sb2FkV29yZCgpLCh0PWUtdCk+MCYmdGhpcy5fYml0c0F2YWlsYWJsZT9yPDx0fHRoaXMucmVhZEJpdHModCk6cn19LHtrZXk6InNraXBMWiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtmb3IoZT0wO2U8dGhpcy5fYml0c0F2YWlsYWJsZTsrK2UpaWYoMCE9KHRoaXMuX3dvcmQmMjE0NzQ4MzY0OD4+PmUpKXJldHVybiB0aGlzLl93b3JkPDw9ZSx0aGlzLl9iaXRzQXZhaWxhYmxlLT1lLGU7cmV0dXJuIHRoaXMuX2xvYWRXb3JkKCksZSt0aGlzLnNraXBMWigpfX0se2tleToic2tpcFVFRyIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNraXBCaXRzKDErdGhpcy5za2lwTFooKSl9fSx7a2V5OiJyZWFkVUVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuc2tpcExaKCk7cmV0dXJuIHRoaXMucmVhZEJpdHMoZSsxKS0xfX0se2tleToicmVhZEVHIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMucmVhZFVFRygpO3JldHVybiAxJmU/MStlPj4+MTotMSooZT4+PjEpfX0se2tleToicmVhZEJvb2wiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIDE9PT10aGlzLnJlYWRCaXRzKDEpfX0se2tleToicmVhZFVCeXRlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnJlYWRCaXRzKDgpfX0se2tleToic2tpcFNjYWxpbmdMaXN0Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9OCxyPTgsYT0wO2E8ZTthKyspMCE9PXImJihyPSh0K3RoaXMucmVhZEVHKCkrMjU2KSUyNTYpLHQ9MD09PXI/dDpyfX1dKSxlfSgpLEg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQpe3IodGhpcyxlKSx0aGlzLm5hbWU9dHx8IiIsdGhpcy5fcHJlZml4PSJbIi5jb25jYXQodGhpcy5uYW1lLCJdIil9cmV0dXJuIG4oZSxbe2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkud2Fybi5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX1dLFt7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMX19LHtrZXk6ImRpc2FibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMH19XSksZX0oKTtpKEgsImRpc2FibGVkIiwhMCk7dmFyIEs9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToiZGVjb2RlIix2YWx1ZTpmdW5jdGlvbih0KXtmb3IodmFyIHI9W10sYT10LG49MCxpPXQubGVuZ3RoO248aTspaWYoYVtuXTwxMjgpci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYVtuXSkpLCsrbjtlbHNle2lmKGFbbl08MTkyKTtlbHNlIGlmKGFbbl08MjI0KXtpZihlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMSkpe3ZhciBzPSgzMSZhW25dKTw8Nnw2MyZhW24rMV07aWYocz49MTI4KXtyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSg2NTUzNSZzKSksbis9Mjtjb250aW51ZX19fWVsc2UgaWYoYVtuXTwyNDApe2lmKGUuX2NoZWNrQ29udGludWF0aW9uKGEsbiwyKSl7dmFyIG89KDE1JmFbbl0pPDwxMnwoNjMmYVtuKzFdKTw8Nnw2MyZhW24rMl07aWYobz49MjA0OCYmNTUyOTYhPSg2MzQ4OCZvKSl7ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzUmbykpLG4rPTM7Y29udGludWV9fX1lbHNlIGlmKGFbbl08MjQ4JiZlLl9jaGVja0NvbnRpbnVhdGlvbihhLG4sMykpe3ZhciB1PSg3JmFbbl0pPDwxOHwoNjMmYVtuKzFdKTw8MTJ8KDYzJmFbbisyXSk8PDZ8NjMmYVtuKzNdO2lmKHU+NjU1MzYmJnU8MTExNDExMil7dS09NjU1MzYsci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUodT4+PjEwfDU1Mjk2KSksci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAyMyZ1fDU2MzIwKSksbis9NDtjb250aW51ZX19ci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoNjU1MzMpKSwrK259cmV0dXJuIHIuam9pbigiIil9fSx7a2V5OiJfY2hlY2tDb250aW51YXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYT1lO2lmKHQrcjxhLmxlbmd0aCl7Zm9yKDtyLS07KWlmKDEyOCE9KDE5MiZhWysrdF0pKXJldHVybiExO3JldHVybiEwfXJldHVybiExfX1dKSxlfSgpLHE9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3csVz1xJiZuYXZpZ2F0b3IudXNlckFnZW50LnRvTG9jYWxlTG93ZXJDYXNlKCksWD1xJiYvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvLnRlc3QoVyksWT1xJiZXLmluY2x1ZGVzKCJmaXJlZm94IiksWj1xJiZXLmluY2x1ZGVzKCJhbmRyb2lkIik7ZnVuY3Rpb24gUSgpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHQ9bmV3IEFycmF5KGUpLHI9MDtyPGU7cisrKXRbcl09YXJndW1lbnRzW3JdO3Q9dC5maWx0ZXIoQm9vbGVhbik7dmFyIGE9bmV3IFVpbnQ4QXJyYXkodC5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChlLG4pLG4rPWUuYnl0ZUxlbmd0aH0pKSxhfXZhciBKPU1hdGgucG93KDIsMzIpO2Z1bmN0aW9uICQoZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKGVbdF08PDgpKyhlW3QrMV18fDApfWZ1bmN0aW9uIGVlKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybihlW3RdPDwyND4+PjApKyhlW3QrMV08PDE2KSsoZVt0KzJdPDw4KSsoZVt0KzNdfHwwKX1mdW5jdGlvbiB0ZShlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4gZWUoZSx0KSpKK2VlKGUsdCs0KX1mdW5jdGlvbiByZShlKXtmb3IodmFyIHQscj0iYXZjMS4iLGE9MDthPDM7YSsrKSh0PWVbYV0udG9TdHJpbmcoMTYpKS5sZW5ndGg8MiYmKHQ9IjAiLmNvbmNhdCh0KSkscis9dDtyZXR1cm4gcn1mdW5jdGlvbiBhZShlKXt2YXIgdD0iIjtpZihlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3QrPWZ1bmN0aW9uKGUpe3JldHVybigiMCIrTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpLnRvVXBwZXJDYXNlKCl9KGUpfSkpLHQubGVuZ3RoPD0zMilmb3IodmFyIHI9MzItdC5sZW5ndGgsYT0wO2E8cjthKyspdCs9IjAiO3JldHVybiB0fWZ1bmN0aW9uIG5lKGUpe2lmKCFBcnJheS5pc0FycmF5KGUpKXtmb3IodmFyIHQ9W10scj0iIixhPTA7YTxlLmxlbmd0aDthKyspYSUyJiYocj1lW2EtMV0rZVthXSx0LnB1c2gocGFyc2VJbnQociwxNikpLHI9IiIpO3JldHVybiB0fXJldHVybiBlLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHBhcnNlSW50KGUsMTYpfSkpfWZ1bmN0aW9uIGllKGUsdCl7cmV0dXJuIE51bWJlcihlKyIuIit0KX12YXIgc2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToicGFyc2VBbm5leEIiLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPTIsYT0wO251bGwhPT1lW3JdJiZ2b2lkIDAhPT1lW3JdJiYxIT09ZVtyXTspcisrO2lmKChhPSsrcisyKT49dClyZXR1cm5bXTtmb3IodmFyIG49W107YTx0Oylzd2l0Y2goZVthXSl7Y2FzZSAwOmlmKDAhPT1lW2EtMV0pe2ErPTI7YnJlYWt9aWYoMCE9PWVbYS0yXSl7YSsrO2JyZWFrfXIhPT1hLTImJm4ucHVzaChlLnN1YmFycmF5KHIsYS0yKSk7ZG97YSsrfXdoaWxlKDEhPT1lW2FdJiZhPHQpO2E9KHI9YSsxKSsyO2JyZWFrO2Nhc2UgMTppZigwIT09ZVthLTFdfHwwIT09ZVthLTJdKXthKz0zO2JyZWFrfXIhPT1hLTImJm4ucHVzaChlLnN1YmFycmF5KHIsYS0yKSksYT0ocj1hKzEpKzI7YnJlYWs7ZGVmYXVsdDphKz0zfXJldHVybiByPHQmJm4ucHVzaChlLnN1YmFycmF5KHIpKSxufX0se2tleToicGFyc2VBdmNDIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06NDtpZighKGUubGVuZ3RoPDQpKXtmb3IodmFyIHIsYT1lLmxlbmd0aCxuPVtdLGk9MDtpK3Q8YTspaWYocj1lZShlLGkpLDM9PT10JiYocj4+Pj04KSxpKz10LHIpe2lmKGkrcj5hKWJyZWFrO24ucHVzaChlLnN1YmFycmF5KGksaStyKSksaSs9cn1yZXR1cm4gbn19fSx7a2V5OiJwYXJzZVNFSSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZS5sZW5ndGgsYT10PzI6MSxuPTAsaT0wLHM9IiI7MjU1PT09ZVthXTspbis9MjU1LGErKztmb3Iobis9ZVthKytdOzI1NT09PWVbYV07KWkrPTI1NSxhKys7aWYoaSs9ZVthKytdLDU9PT1uJiZyPmErMTYpZm9yKHZhciBvPTA7bzwxNjtvKyspcys9ZVthXS50b1N0cmluZygxNiksYSsrO3JldHVybntwYXlsb2FkOmUuc3ViYXJyYXkoYSxhK2kpLHR5cGU6bixzaXplOmksdXVpZDpzfX19LHtrZXk6InJlbW92ZUVQQiIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUuYnl0ZUxlbmd0aCxyPVtdLGE9MTthPHQtMjspMD09PWVbYV0mJjA9PT1lW2ErMV0mJjM9PT1lW2ErMl0/KHIucHVzaChhKzIpLGErPTIpOmErKztpZighci5sZW5ndGgpcmV0dXJuIGU7dmFyIG49dC1yLmxlbmd0aCxpPW5ldyBVaW50OEFycmF5KG4pLHM9MDtmb3IoYT0wO2E8bjtzKyssYSsrKXM9PT1yWzBdJiYocysrLHIuc2hpZnQoKSksaVthXT1lW3NdO3JldHVybiBpfX1dKSxlfSgpLG9lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3IodGhpcyxlKX1yZXR1cm4gbihlLG51bGwsW3trZXk6InBhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKCEodC5sZW5ndGg8Nykpe2Zvcih2YXIgcixhLG49MSsoMyZ0WzRdKSxpPVtdLHM9W10sbz02LHU9MzEmdFs1XSxjPTA7Yzx1O2MrKylpZihhPXRbb108PDh8dFtvKzFdLG8rPTIsYSl7dmFyIGw9dC5zdWJhcnJheShvLG8rYSk7bys9YSxpLnB1c2gobCkscnx8KHI9ZS5wYXJzZVNQUyhzZS5yZW1vdmVFUEIobCkpKX12YXIgZixkPXRbb107bysrO2Zvcih2YXIgaD0wO2g8ZDtoKyspZj10W29dPDw4fHRbbysxXSxvKz0yLGYmJihzLnB1c2godC5zdWJhcnJheShvLG8rZikpLG8rPWYpO3JldHVybntzcHM6cixzcHNBcnI6aSxwcHNBcnI6cyxuYWxVbml0U2l6ZTpufX19fSx7a2V5OiJwYXJzZVNQUyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IEcoZSk7dC5yZWFkVUJ5dGUoKTt2YXIgcj10LnJlYWRVQnl0ZSgpLGE9dC5yZWFkVUJ5dGUoKSxuPXQucmVhZFVCeXRlKCk7dC5za2lwVUVHKCk7dmFyIGk9NDIwO2lmKDEwMD09PXJ8fDExMD09PXJ8fDEyMj09PXJ8fDI0ND09PXJ8fDQ0PT09cnx8ODM9PT1yfHw4Nj09PXJ8fDExOD09PXJ8fDEyOD09PXJ8fDEzOD09PXJ8fDE0ND09PXIpe3ZhciBzPXQucmVhZFVFRygpO2lmKHM8PTMmJihpPVswLDQyMCw0MjIsNDQ0XVtzXSksMz09PXMmJnQuc2tpcEJpdHMoMSksdC5za2lwVUVHKCksdC5za2lwVUVHKCksdC5za2lwQml0cygxKSx0LnJlYWRCb29sKCkpZm9yKHZhciBvPTMhPT1zPzg6MTIsdT0wO3U8bzt1KyspdC5yZWFkQm9vbCgpJiYodTw2P3Quc2tpcFNjYWxpbmdMaXN0KDE2KTp0LnNraXBTY2FsaW5nTGlzdCg2NCkpfXQuc2tpcFVFRygpO3ZhciBjPXQucmVhZFVFRygpO2lmKDA9PT1jKXQucmVhZFVFRygpO2Vsc2UgaWYoMT09PWMpe3Quc2tpcEJpdHMoMSksdC5za2lwVUVHKCksdC5za2lwVUVHKCk7Zm9yKHZhciBsPXQucmVhZFVFRygpLGY9MDtmPGw7ZisrKXQuc2tpcFVFRygpfXQuc2tpcFVFRygpLHQuc2tpcEJpdHMoMSk7dmFyIGQ9dC5yZWFkVUVHKCksaD10LnJlYWRVRUcoKSxwPXQucmVhZEJpdHMoMSk7MD09PXAmJnQuc2tpcEJpdHMoMSksdC5za2lwQml0cygxKTt2YXIgdix5LG0sZyxrLGI9MCxfPTAsdz0wLHg9MDtpZih0LnJlYWRCb29sKCkmJihiPXQucmVhZFVFRygpLF89dC5yZWFkVUVHKCksdz10LnJlYWRVRUcoKSx4PXQucmVhZFVFRygpKSx0LnJlYWRCb29sKCkpe2lmKHQucmVhZEJvb2woKSlzd2l0Y2godC5yZWFkVUJ5dGUoKSl7Y2FzZSAxOnY9WzEsMV07YnJlYWs7Y2FzZSAyOnY9WzEyLDExXTticmVhaztjYXNlIDM6dj1bMTAsMTFdO2JyZWFrO2Nhc2UgNDp2PVsxNiwxMV07YnJlYWs7Y2FzZSA1OnY9WzQwLDMzXTticmVhaztjYXNlIDY6dj1bMjQsMTFdO2JyZWFrO2Nhc2UgNzp2PVsyMCwxMV07YnJlYWs7Y2FzZSA4OnY9WzMyLDExXTticmVhaztjYXNlIDk6dj1bODAsMzNdO2JyZWFrO2Nhc2UgMTA6dj1bMTgsMTFdO2JyZWFrO2Nhc2UgMTE6dj1bMTUsMTFdO2JyZWFrO2Nhc2UgMTI6dj1bNjQsMzNdO2JyZWFrO2Nhc2UgMTM6dj1bMTYwLDk5XTticmVhaztjYXNlIDE0OnY9WzQsM107YnJlYWs7Y2FzZSAxNTp2PVszLDJdO2JyZWFrO2Nhc2UgMTY6dj1bMiwxXTticmVhaztjYXNlIDI1NTp2PVt0LnJlYWRVQnl0ZSgpPDw4fHQucmVhZFVCeXRlKCksdC5yZWFkVUJ5dGUoKTw8OHx0LnJlYWRVQnl0ZSgpXX1pZih0LnJlYWRCb29sKCkmJnQucmVhZEJvb2woKSx0LnJlYWRCb29sKCkmJih0LnJlYWRCaXRzKDQpLHQucmVhZEJvb2woKSYmdC5yZWFkQml0cygyNCkpLHQucmVhZEJvb2woKSYmKHQucmVhZFVFRygpLHQucmVhZFVFRygpKSx0LnJlYWRCb29sKCkpe3ZhciBTPXQucmVhZEJpdHMoMzIpLEE9dC5yZWFkQml0cygzMik7eT10LnJlYWRCb29sKCksaz0obT1BKS8oZz0yKlMpfX1yZXR1cm57Y29kZWM6cmUoZS5zdWJhcnJheSgxLDQpKSxwcm9maWxlSWRjOnIscHJvZmlsZUNvbXBhdGliaWxpdHk6YSxsZXZlbElkYzpuLGNocm9tYUZvcm1hdDppLHdpZHRoOk1hdGguY2VpbCgxNiooZCsxKS0yKihiK18pKSxoZWlnaHQ6KDItcCkqKGgrMSkqMTYtKHA/Mjo0KSoodyt4KSxzYXJSYXRpbzp2LGZwc051bTptLGZwc0RlbjpnLGZwczprLGZpeGVkRnJhbWU6eX19fV0pLGV9KCksdWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToiZ2V0UmF0ZUluZGV4QnlSYXRlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5GUkVRLmluZGV4T2YodCl9fSx7a2V5OiJwYXJzZUFEVFMiLHZhbHVlOmZ1bmN0aW9uKHQscil7Zm9yKHZhciBhPXQubGVuZ3RoLG49MDtuKzI8YSYmKDI1NSE9PXRbbl18fDI0MCE9KDI0NiZ0W24rMV0pKTspbisrO2lmKCEobj49YSkpe3ZhciBpPW4scz1bXSxvPSg2MCZ0W24rMl0pPj4+Mix1PWUuRlJFUVtvXTtpZighdSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc2FtcGxpbmcgaW5kZXg6ICIuY29uY2F0KG8pKTtmb3IodmFyIGMsbCxmPTErKCgxOTImdFtuKzJdKT4+PjYpLGQ9KDEmdFtuKzJdKTw8MnwoMTkyJnRbbiszXSk+Pj42LGg9ZS5fZ2V0Q29uZmlnKG8sZCxmKSxwPWguY29uZmlnLHY9aC5jb2RlYyx5PTAsbT1lLmdldEZyYW1lRHVyYXRpb24odSk7bis3PGE7KWlmKDI1NT09PXRbbl0mJjI0MD09KDI0NiZ0W24rMV0pKXtpZighKGw9KDMmdFtuKzNdKTw8MTF8dFtuKzRdPDwzfCgyMjQmdFtuKzVdKT4+NSl8fGEtbjxsKWJyZWFrO2M9MiooMSZ+dFtuKzFdKSxzLnB1c2goe3B0czpyK3kqbSxkYXRhOnQuc3ViYXJyYXkobis3K2MsbitsKX0pLHkrKyxuKz1sfWVsc2UgbisrO3JldHVybntza2lwOmkscmVtYWluaW5nOm4+PWE/dm9pZCAwOnQuc3ViYXJyYXkobiksZnJhbWVzOnMsc2FtcGxpbmdGcmVxdWVuY3lJbmRleDpvLHNhbXBsZVJhdGU6dSxvYmplY3RUeXBlOmYsY2hhbm5lbENvdW50OmQsY29kZWM6dixjb25maWc6cCxvcmlnaW5Db2RlYzoibXA0YS40MC4iLmNvbmNhdChmKX19fX0se2tleToicGFyc2VBdWRpb1NwZWNpZmljQ29uZmlnIix2YWx1ZTpmdW5jdGlvbih0KXtpZih0Lmxlbmd0aCl7dmFyIHI9dFswXT4+PjMsYT0oNyZ0WzBdKTw8MXx0WzFdPj4+NyxuPSgxMjAmdFsxXSk+Pj4zLGk9ZS5GUkVRW2FdO2lmKGkpe3ZhciBzPWUuX2dldENvbmZpZyhhLG4scik7cmV0dXJue3NhbXBsaW5nRnJlcXVlbmN5SW5kZXg6YSxzYW1wbGVSYXRlOmksb2JqZWN0VHlwZTpyLGNoYW5uZWxDb3VudDpuLGNvbmZpZzpzLmNvbmZpZyxjb2RlYzpzLmNvZGVjLG9yaWdpbkNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KHIpfX19fX0se2tleToiZ2V0RnJhbWVEdXJhdGlvbiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjllNDtyZXR1cm4gMTAyNCp0L2V9fSx7a2V5OiJfZ2V0Q29uZmlnIix2YWx1ZTpmdW5jdGlvbihlLHQscil7dmFyIGEsbixpPVtdO3JldHVybiBZP2U+PTY/KGE9NSxuPWUtMyk6KGE9MixuPWUpOlo/KGE9MixuPWUpOihhPTI9PT1yfHw1PT09cj9yOjUsbj1lLGU+PTY/bj1lLTM6MT09PXQmJihhPTIsbj1lKSksaVswXT1hPDwzLGlbMF18PSgxNCZlKT4+MSxpWzFdPSgxJmUpPDw3LGlbMV18PXQ8PDMsNT09PWEmJihpWzFdfD0oMTQmbik+PjEsaVsyXT0oMSZuKTw8NyxpWzJdfD04LGlbM109MCkse2NvbmZpZzppLGNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KGEpfX19LHtrZXk6ImdldFNpbGVudEZyYW1lIix2YWx1ZTpmdW5jdGlvbihlLHQpe2lmKCJtcDRhLjQwLjIiPT09ZSl7aWYoMT09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzNSwxMjhdKTtpZigyPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzMzLDAsNzMsMTQ0LDIsMjUsMCwzNSwxMjhdKTtpZigzPT09dClyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzAsMjAwLDAsMTI4LDMyLDEzMiwxLDM4LDY0LDgsMTAwLDAsMTQyXSk7aWYoND09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEyOCw0NCwxMjgsOCwyLDU2XSk7aWYoNT09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDU2XSk7aWYoNj09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDAsMTc4LDAsMzIsOCwyMjRdKX1lbHNle2lmKDE9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDc4LDIzMCwxMjgsMTg2LDgsMCwwLDAsMjgsNiwyNDEsMTkzLDEwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDk0XSk7aWYoMj09PXQpcmV0dXJuIG5ldyBVaW50OEFycmF5KFsxLDY0LDM0LDEyOCwxNjMsOTQsMjMwLDEyOCwxODYsOCwwLDAsMCwwLDE0OSwwLDYsMjQxLDE2MSwxMCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5NF0pO2lmKDM9PT10KXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDk0LDIzMCwxMjgsMTg2LDgsMCwwLDAsMCwxNDksMCw2LDI0MSwxNjEsMTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTRdKX19fV0pLGV9KCk7aSh1ZSwiRlJFUSIsWzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdKTt2YXIgY2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsbnVsbCxbe2tleToicGFyc2VIRVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fTtpZighKHQubGVuZ3RoPDIzKSl7cj1yfHx7fTtmb3IodmFyIGEsbixpLHMsbyx1PTErKDMmdFsyMV0pLGM9W10sbD1bXSxmPVtdLGQ9MjMsaD10WzIyXSxwPTA7cDxoO3ArKyl7aT02MyZ0W2RdLHM9dFtkKzFdPDw4fHRbZCsyXSxkKz0zO2Zvcih2YXIgdj0wO3Y8czt2KyspaWYobz10W2RdPDw4fHRbZCsxXSxkKz0yLG8pe3N3aXRjaChpKXtjYXNlIDMyOnZhciB5PXQuc3ViYXJyYXkoZCxkK28pO2F8fChhPWUucGFyc2VWUFMoc2UucmVtb3ZlRVBCKHkpLHIpKSxmLnB1c2goeSk7YnJlYWs7Y2FzZSAzMzp2YXIgbT10LnN1YmFycmF5KGQsZCtvKTtufHwobj1lLnBhcnNlU1BTKHNlLnJlbW92ZUVQQihtKSxyKSksYy5wdXNoKG0pO2JyZWFrO2Nhc2UgMzQ6bC5wdXNoKHQuc3ViYXJyYXkoZCxkK28pKX1kKz1vfX1yZXR1cm57aHZjQzpyLHNwczpuLHNwc0FycjpjLHBwc0FycjpsLHZwc0FycjpmLG5hbFVuaXRTaXplOnV9fX19LHtrZXk6InBhcnNlVlBTIix2YWx1ZTpmdW5jdGlvbih0LHIpe3I9cnx8e307dmFyIGE9bmV3IEcodCk7YS5yZWFkVUJ5dGUoKSxhLnJlYWRVQnl0ZSgpLGEucmVhZEJpdHMoMTIpO3ZhciBuPWEucmVhZEJpdHMoMyk7cmV0dXJuIHIubnVtVGVtcG9yYWxMYXllcnM9TWF0aC5tYXgoci5udW1UZW1wb3JhbExheWVyc3x8MCxuKzEpLGEucmVhZEJpdHMoMTcpLGUuX3BhcnNlUHJvZmlsZVRpZXJMZXZlbChhLG4scikscn19LHtrZXk6InBhcnNlU1BTIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e307cj1yfHx7fTt2YXIgYT1uZXcgRyh0KTthLnJlYWRVQnl0ZSgpLGEucmVhZFVCeXRlKCksYS5yZWFkQml0cyg0KTt2YXIgbj1hLnJlYWRCaXRzKDMpO3IubnVtVGVtcG9yYWxMYXllcnM9TWF0aC5tYXgobisxLHIubnVtVGVtcG9yYWxMYXllcnN8fDApLHIudGVtcG9yYWxJZE5lc3RlZD1hLnJlYWRCaXRzKDEpLGUuX3BhcnNlUHJvZmlsZVRpZXJMZXZlbChhLG4sciksYS5yZWFkVUVHKCk7dmFyIGk9ci5jaHJvbWFGb3JtYXRJZGM9YS5yZWFkVUVHKCkscz00MjA7aTw9MyYmKHM9WzAsNDIwLDQyMiw0NDRdW2ldKTt2YXIgbz0wOzM9PT1pJiYobz1hLnJlYWRCaXRzKDEpKTt2YXIgdSxjLGwsZixkPWEucmVhZFVFRygpLGg9YS5yZWFkVUVHKCkscD1hLnJlYWRCaXRzKDEpO2lmKDE9PT1wJiYodT1hLnJlYWRVRUcoKSxjPWEucmVhZFVFRygpLGw9YS5yZWFkVUVHKCksZj1hLnJlYWRVRUcoKSksci5iaXREZXB0aEx1bWFNaW51czg9YS5yZWFkVUVHKCksci5iaXREZXB0aENocm9tYU1pbnVzOD1hLnJlYWRVRUcoKSwxPT09cCl7dmFyIHY9MSE9PWkmJjIhPT1pfHwwIT09bz8xOjIseT0xPT09aSYmMD09PW8/MjoxO2QtPXYqKGMrdSksaC09eSooZitsKX1yZXR1cm57Y29kZWM6ImhldjEuMS42Lkw5My5CMCIsd2lkdGg6ZCxoZWlnaHQ6aCxjaHJvbWFGb3JtYXQ6cyxodmNDOnJ9fX0se2tleToiX3BhcnNlUHJvZmlsZVRpZXJMZXZlbCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPXIuZ2VuZXJhbFRpZXJGbGFnfHwwO3IuZ2VuZXJhbFByb2ZpbGVTcGFjZT1lLnJlYWRCaXRzKDIpLHIuZ2VuZXJhbFRpZXJGbGFnPU1hdGgubWF4KGUucmVhZEJpdHMoMSksYSksci5nZW5lcmFsUHJvZmlsZUlkYz1NYXRoLm1heChlLnJlYWRCaXRzKDUpLHIuZ2VuZXJhbFByb2ZpbGVJZGN8fDApLHIuZ2VuZXJhbFByb2ZpbGVDb21wYXRpYmlsaXR5RmxhZ3M9ZS5yZWFkQml0cygzMiksci5nZW5lcmFsQ29uc3RyYWludEluZGljYXRvckZsYWdzPVtlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCksZS5yZWFkQml0cyg4KSxlLnJlYWRCaXRzKDgpLGUucmVhZEJpdHMoOCksZS5yZWFkQml0cyg4KV07dmFyIG49ZS5yZWFkQml0cyg4KTthPHIuZ2VuZXJhbFRpZXJGbGFnP3IuZ2VuZXJhbExldmVsSWRjPW46ci5nZW5lcmFsTGV2ZWxJZGM9TWF0aC5tYXgobixyLmdlbmVyYWxMZXZlbElkY3x8MCk7dmFyIGk9W10scz1bXTtpZih0PmUuYml0c0F2YWlsYWJsZSl0aHJvdyBuZXcgRXJyb3IoIm1heFN1YkxheWVyc01pbnVzIGluYXZsaWQgc2l6ZSAiLmNvbmNhdCh0KSk7Zm9yKHZhciBvPTA7bzx0O28rKylpW29dPWUucmVhZEJpdHMoMSksc1tvXT1lLnJlYWRCaXRzKDEpO3Q+MCYmZS5yZWFkQml0cygyKig4LXQpKTtmb3IodmFyIHU9MDt1PHQ7dSsrKTAhPT1pW3VdJiYoZS5yZWFkQml0cygyKSxlLnJlYWRCaXRzKDEpLGUucmVhZEJpdHMoNSksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cygxNiksZS5yZWFkQml0cyg0KSxlLnJlYWRCaXRzKDE2KSxlLnJlYWRCaXRzKDE2KSxlLnJlYWRCaXRzKDEyKSksMCE9PXNbdV0mJmUucmVhZEJpdHMoOCl9fV0pLGV9KCksbGU9MWUzLGZlPTVlMyxkZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxhLG4pe3IodGhpcyxlKSx0aGlzLnZpZGVvVHJhY2s9dCx0aGlzLmF1ZGlvVHJhY2s9YSx0aGlzLm1ldGFkYXRhVHJhY2s9bix0aGlzLl9iYXNlRHRzPS0xLHRoaXMuX2Jhc2VEdHNJbml0ZWQ9ITEsdGhpcy5fYXVkaW9OZXh0UHRzPXZvaWQgMCx0aGlzLl92aWRlb05leHREdHM9dm9pZCAwLHRoaXMuX2F1ZGlvVGltZXN0YW1wQnJlYWs9MCx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fbGFzdFZpZGVvRHVyYXRpb249MCx0aGlzLl9rZXlGcmFtZUluTmV4dENodW5rPSExLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdD0tMS8wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkxhcmdlR2FwRG90PS0xLzAsdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD0tMS8wfXJldHVybiBuKGUsW3trZXk6ImZpeCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOjAscj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdLGE9IShhcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSl8fGFyZ3VtZW50c1syXTt0PU1hdGgucm91bmQoMWUzKnQpO3ZhciBuPXRoaXMudmlkZW9UcmFjayxpPXRoaXMuYXVkaW9UcmFjazshciYmYXx8KHRoaXMuX3ZpZGVvTGFzdFNhbXBsZT1udWxsLHRoaXMuX2F1ZGlvTmV4dFB0cz12b2lkIDAsdGhpcy5fdmlkZW9OZXh0RHRzPXZvaWQgMCx0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fdmlkZW9UaW1lc3RhbXBCcmVhaz0wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdD0tMS8wLHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9LTEvMCx0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25MYXJnZUdhcERvdD0tMS8wLHRoaXMuX2xhc3RWaWRlb0V4Y2VwdGlvbkxhcmdlR2FwRG90PS0xLzAsdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD0tMS8wKSxyJiYhYSYmKHRoaXMuX2Jhc2VEdHNJbml0ZWQ9ITEpLHRoaXMuX2Jhc2VEdHNJbml0ZWR8fHRoaXMuX2NhbGN1bGF0ZUJhc2VEdHMoaSxuKSwhYSYmdCYmKHRoaXMuX2F1ZGlvTmV4dFB0cz10aGlzLl92aWRlb05leHREdHM9dCk7dmFyIHM9dGhpcy5fYmFzZUR0c0luaXRlZCYmKHRoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWt8fCF0aGlzLnZpZGVvVHJhY2suZXhpc3QoKSkmJih0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrfHwhdGhpcy5hdWRpb1RyYWNrLmV4aXN0KCkpO2lmKHMmJnRoaXMuX3Jlc2V0QmFzZUR0c1doZW5TdHJlYW1CcmVha2VkKCksdGhpcy5fZml4QXVkaW8oaSksdGhpcy5fa2V5RnJhbWVJbk5leHRDaHVuaz0hMSx0aGlzLl9maXhWaWRlbyhuKSx0aGlzLm1ldGFkYXRhVHJhY2suZXhpc3QoKSl7dmFyIG89dGhpcy5tZXRhZGF0YVRyYWNrLnRpbWVzY2FsZTt0aGlzLm1ldGFkYXRhVHJhY2suc2VpU2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXt0LnB0cz10Lm9yaWdpblB0cy1lLl9iYXNlRHRzLHQudGltZT1NYXRoLm1heCgwLHQucHRzKS9vfSkpLHRoaXMubWV0YWRhdGFUcmFjay5mbHZTY3JpcHRTYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3QucHRzPXQub3JpZ2luUHRzLWUuX2Jhc2VEdHMsdC50aW1lPU1hdGgubWF4KDAsdC5wdHMpL299KSl9bi5zYW1wbGVzLmxlbmd0aCYmKG4uYmFzZU1lZGlhRGVjb2RlVGltZT1uLnNhbXBsZXNbMF0uZHRzKSxpLnNhbXBsZXMubGVuZ3RoJiYoaS5iYXNlTWVkaWFEZWNvZGVUaW1lPWkuc2FtcGxlc1swXS5wdHMqaS50aW1lc2NhbGUvMWUzKX19LHtrZXk6Il9maXhWaWRlbyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuc2FtcGxlcztpZihyLmxlbmd0aCl7dmFyIGE7aWYoci5mb3JFYWNoKChmdW5jdGlvbihlKXtlLmR0cy09dC5fYmFzZUR0cyxlLnB0cy09dC5fYmFzZUR0cyxlLmtleWZyYW1lJiYodC5fa2V5RnJhbWVJbk5leHRDaHVuaz0hMCl9KSksZS5mcHNOdW0mJmUuZnBzRGVuKWE9ZS50aW1lc2NhbGUqKGUuZnBzRGVuL2UuZnBzTnVtKTtlbHNlIGlmKGUubGVuZ3RoPjEpe3ZhciBuPWUuc2FtcGxlc1swXSxpPWUuc2FtcGxlc1tyLmxlbmd0aC0xXTthPU1hdGguZmxvb3IoKGkuZHRzLW4uZHRzKS8oci5sZW5ndGgtMSkpfWVsc2UgYT10aGlzLl9sYXN0VmlkZW9EdXJhdGlvbnx8NDA7dmFyIHM9ci5wb3AoKTtpZih0aGlzLl92aWRlb0xhc3RTYW1wbGUmJnIudW5zaGlmdCh0aGlzLl92aWRlb0xhc3RTYW1wbGUpLHRoaXMuX3ZpZGVvTGFzdFNhbXBsZT1zLHIubGVuZ3RoKXtpZih2b2lkIDA9PT10aGlzLl92aWRlb05leHREdHMpe3ZhciBvPXJbMF07dGhpcy5fdmlkZW9OZXh0RHRzPW8uZHRzfXZhciB1PXIubGVuZ3RoLGM9MCxsPXJbMF0sZj10aGlzLl92aWRlb05leHREdHMtbC5kdHM7aWYoTWF0aC5hYnMoZik+MjAwKXt2YXIgZDtpZihNYXRoLmFicyhsLmR0cy10aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25DaHVua0ZpcnN0RHRzRG90KT41ZTMpdGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uQ2h1bmtGaXJzdER0c0RvdD1sLmR0cyxlLndhcm5pbmdzLnB1c2goe3R5cGU6QyxuZXh0RHRzOnRoaXMuX3ZpZGVvTmV4dER0cyxmaXJzdFNhbXBsZUR0czpsLmR0cyxuZXh0U2FtcGxlRHRzOm51bGw9PT0oZD1yWzFdKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5kdHMsc2FtcGxlRHVyYXRpb246Zn0pO3RoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWs+PTU/KHRoaXMuX3ZpZGVvTmV4dER0cz1sLmR0cyx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTApOihsLmR0cys9ZixsLnB0cys9Zix0aGlzLmF1ZGlvVHJhY2suZXhpc3QoKXx8KHRoaXMuX3ZpZGVvVGltZXN0YW1wQnJlYWs9MSkpfWZvcih2YXIgaD0wO2g8dTtoKyspe3ZhciBwPXJbaF0uZHRzLHY9cltoKzFdOygoYz1oPHUtMT92LmR0cy1wOnM/cy5kdHMtcDphKT4xZTN8fGM8MCkmJih0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrKyssTWF0aC5hYnMocC10aGlzLl9sYXN0VmlkZW9FeGNlcHRpb25MYXJnZUdhcERvdCk+NWUzJiYodGhpcy5fbGFzdFZpZGVvRXhjZXB0aW9uTGFyZ2VHYXBEb3Q9cCxlLndhcm5pbmdzLnB1c2goe3R5cGU6VSx0aW1lOnAvZS50aW1lc2NhbGUsZHRzOnAsb3JpZ2luRHRzOnJbaF0ub3JpZ2luRHRzLG5leHREdHM6dGhpcy5fdmlkZW9OZXh0RHRzLHNhbXBsZUR1cmF0aW9uOmMscmVmU2FtcGxlRHVyYXRpb246YX0pKSxjPWEpLHJbaF0uZHVyYXRpb249Yyx0aGlzLl92aWRlb05leHREdHMrPWMsdGhpcy5fbGFzdFZpZGVvRHVyYXRpb249Y319fX19LHtrZXk6Il9maXhBdWRpbyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuc2FtcGxlcztyLmxlbmd0aCYmKHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS5kdHM9ZS5wdHMtPXQuX2Jhc2VEdHN9KSksdGhpcy5fZG9GaXhBdWRpb0ludGVybmFsKGUsciwxZTMpKX19LHtrZXk6Il9jYWxjdWxhdGVCYXNlRHRzIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUuc2FtcGxlcyxhPXQuc2FtcGxlcztpZighci5sZW5ndGgmJiFhLmxlbmd0aClyZXR1cm4hMTt2YXIgbj0xLzAsaT0xLzA7ci5sZW5ndGgmJihlLmJhc2VEdHM9bj1yWzBdLnB0cyksYS5sZW5ndGgmJih0LmJhc2VEdHM9aT1hWzBdLmR0cyksdGhpcy5fYmFzZUR0cz1NYXRoLm1pbihuLGkpO3ZhciBzPWktbjtyZXR1cm4gTnVtYmVyLmlzRmluaXRlKHMpJiZNYXRoLmFicyhzKT41MDAmJnQud2FybmluZ3MucHVzaCh7dHlwZTpULHZpZGVvQmFzZUR0czppLGF1ZGlvQmFzZVB0czpuLGJhc2VEdHM6dGhpcy5fYmFzZUR0cyxkZWx0YTpzfSksdGhpcy5fYmFzZUR0c0luaXRlZD0hMCwhMH19LHtrZXk6Il9yZXNldEJhc2VEdHNXaGVuU3RyZWFtQnJlYWtlZCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9jYWxjdWxhdGVCYXNlRHRzKHRoaXMuYXVkaW9UcmFjayx0aGlzLnZpZGVvVHJhY2spJiYodGhpcy5hdWRpb1RyYWNrLmV4aXN0KCk/dGhpcy52aWRlb1RyYWNrLmV4aXN0KCk/dGhpcy5fYmFzZUR0cy09TWF0aC5taW4odGhpcy5fYXVkaW9OZXh0UHRzLHRoaXMuX3ZpZGVvTmV4dER0cyk6dGhpcy5fYmFzZUR0cy09dGhpcy5fYXVkaW9OZXh0UHRzOnRoaXMuX2Jhc2VEdHMtPXRoaXMuX3ZpZGVvTmV4dER0cyx0aGlzLl92aWRlb1RpbWVzdGFtcEJyZWFrPTAsdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz0wKX19LHtrZXk6Il9kb0ZpeEF1ZGlvSW50ZXJuYWwiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXtlLnNhbXBsZUR1cmF0aW9ufHwoZS5zYW1wbGVEdXJhdGlvbj1lLmNvZGVjVHlwZT09PUQ/dWUuZ2V0RnJhbWVEdXJhdGlvbihlLnRpbWVzY2FsZSxyKTp0aGlzLl9nZXRHNzExRHVyYXRpb24oZSkpO3ZhciBhPWUuc2FtcGxlRHVyYXRpb24sbj1lLmNvZGVjVHlwZT09PUQ/MTAyNDphKmUudGltZXNjYWxlLzFlMztpZih2b2lkIDA9PT10aGlzLl9hdWRpb05leHRQdHMpe3ZhciBpPXRbMF07dGhpcy5fYXVkaW9OZXh0UHRzPWkucHRzfWZvcih2YXIgcz0wO3M8dC5sZW5ndGg7cysrKXt2YXIgbz10aGlzLl9hdWRpb05leHRQdHMsdT10W3NdLGM9dS5wdHMtbztpZigwPT09cyYmdGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaz49NSYmdGhpcy5fa2V5RnJhbWVJbk5leHRDaHVuayYmKG89dGhpcy5fYXVkaW9OZXh0UHRzPXUuZHRzLGM9MCx0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrPTApLCF0aGlzLl9hdWRpb1RpbWVzdGFtcEJyZWFrJiZjPj0zKmEmJmM8PWxlJiYhWCl7dmFyIGw9dGhpcy5fZ2V0U2lsZW50RnJhbWUoZSl8fHRbMF0uZGF0YS5zdWJhcnJheSgpLGY9TWF0aC5mbG9vcihjL2EpO01hdGguYWJzKHUucHRzLXRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkdhcERvdCk+ZmUmJih0aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25HYXBEb3Q9dS5wdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOkkscHRzOnUucHRzLG9yaWdpblB0czp1Lm9yaWdpblB0cyxjb3VudDpmLG5leHRQdHM6byxyZWZTYW1wbGVEdXJhdGlvbjphfSkpO2Zvcih2YXIgZD0wO2Q8ZjtkKyspe3ZhciBoPW5ldyBMKE1hdGguZmxvb3IodGhpcy5fYXVkaW9OZXh0UHRzK2EpLU1hdGguZmxvb3IodGhpcy5fYXVkaW9OZXh0UHRzKSxsLG4pO2gub3JpZ2luUHRzPU1hdGguZmxvb3IodGhpcy5fYmFzZUR0cytvKSx0LnNwbGljZShzLDAsaCksdGhpcy5fYXVkaW9OZXh0UHRzKz1hLHMrK31zLS19ZWxzZSBjPD0tMyphJiZjPj0tMWUzPyhNYXRoLmFicyh1LnB0cy10aGlzLl9sYXN0QXVkaW9FeGNlcHRpb25PdmVybGFwRG90KT5mZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbk92ZXJsYXBEb3Q9dS5wdHMsZS53YXJuaW5ncy5wdXNoKHt0eXBlOk0scHRzOnUucHRzLG9yaWdpblB0czp1Lm9yaWdpblB0cyxuZXh0UHRzOm8scmVmU2FtcGxlRHVyYXRpb246YX0pKSx0LnNwbGljZShzLDEpLHMtLSk6KE1hdGguYWJzKGMpPmxlJiYodGhpcy5fYXVkaW9UaW1lc3RhbXBCcmVhaysrLE1hdGguYWJzKHUucHRzLXRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90KT5mZSYmKHRoaXMuX2xhc3RBdWRpb0V4Y2VwdGlvbkxhcmdlR2FwRG90PXUucHRzLGUud2FybmluZ3MucHVzaCh7dHlwZTpQLHRpbWU6dS5wdHMvMWUzLHB0czp1LnB0cyxvcmlnaW5QdHM6dS5vcmlnaW5QdHMsbmV4dFB0czpvLHNhbXBsZUR1cmF0aW9uOmMscmVmU2FtcGxlRHVyYXRpb246YX0pKSksdS5kdHM9dS5wdHM9byx1LmR1cmF0aW9uPW4sdGhpcy5fYXVkaW9OZXh0UHRzKz1hKX19fSx7a2V5OiJfZ2V0RzcxMUR1cmF0aW9uIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1lLnNhbXBsZVNpemUscj1lLmNoYW5uZWxDb3VudCxhPWUuc2FtcGxlUmF0ZSxuPWUuc2FtcGxlc1swXTtpZihuKXJldHVybiAyKm4uZGF0YS5ieXRlTGVuZ3RoL3IvKHQvOCkvYSoxZTN9fSx7a2V5OiJfZ2V0U2lsZW50RnJhbWUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlLmNvZGVjVHlwZT09PUQ/dWUuZ2V0U2lsZW50RnJhbWUoZS5jb2RlYyxlLmNoYW5uZWxDb3VudCk6bmV3IFVpbnQ4QXJyYXkoOCplLnNhbXBsZUR1cmF0aW9uKmUuY2hhbm5lbENvdW50KX19XSksZX0oKSxoZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJwYXJzZSIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoISh0Lmxlbmd0aDwzKSl7dmFyIHI9e30sYT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKSksbj1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrYS5zaXplLHQuYnl0ZUxlbmd0aC1hLnNpemUpKTtyZXR1cm4gclthLmRhdGFdPW4uZGF0YSxyfX19LHtrZXk6Il9wYXJzZVZhbHVlIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcixhPXQuYnl0ZUxlbmd0aCxuPTEsaT0hMTtzd2l0Y2godC5nZXRVaW50OCgwKSl7Y2FzZSAwOnI9dC5nZXRGbG9hdDY0KDEpLG4rPTg7YnJlYWs7Y2FzZSAxOnI9ISF0LmdldFVpbnQ4KDEpLG4rPTE7YnJlYWs7Y2FzZSAyOnZhciBzPWUuX3BhcnNlU3RyaW5nKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbix0LmJ5dGVMZW5ndGgtbikpO3I9cy5kYXRhLG4rPXMuc2l6ZTticmVhaztjYXNlIDM6cj17fTt2YXIgbz0wO2Zvcig5PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIoYS00KSkmJihvPTMpO248YS00Oyl7dmFyIHU9ZS5fcGFyc2VPYmplY3QobmV3IERhdGFWaWV3KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCtuLHQuYnl0ZUxlbmd0aC1uLW8pKSxjPXUuc2l6ZSxsPXUuZGF0YTtpZih1LmlzRW5kKWJyZWFrO3JbbC5uYW1lXT1sLnZhbHVlLG4rPWN9aWYobjw9YS0zKTk9PT0oMTY3NzcyMTUmdC5nZXRVaW50MzIobi0xKSkmJihuKz0zKTticmVhaztjYXNlIDg6cj17fSxuKz00O3ZhciBmPTA7Zm9yKDk9PSgxNjc3NzIxNSZ0LmdldFVpbnQzMihhLTQpKSYmKGY9Myk7bjxhLTg7KXt2YXIgZD1lLl9wYXJzZU9iamVjdChuZXcgRGF0YVZpZXcodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sdC5ieXRlTGVuZ3RoLW4tZikpLGg9ZC5zaXplLHA9ZC5kYXRhO2lmKGQuaXNFbmQpYnJlYWs7cltwLm5hbWVdPXAudmFsdWUsbis9aH1pZihuPD1hLTMpOT09PSgxNjc3NzIxNSZ0LmdldFVpbnQzMihuLTEpKSYmKG4rPTMpO2JyZWFrO2Nhc2UgOTpyPXZvaWQgMCxuPTEsaT0hMDticmVhaztjYXNlIDEwOnI9W107dmFyIHY9dC5nZXRVaW50MzIoMSk7bis9NDtmb3IodmFyIHk9MDt5PHY7eSsrKXt2YXIgbT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbix0LmJ5dGVMZW5ndGgtbikpLGc9bS5kYXRhLGs9bS5zaXplO3IucHVzaChnKSxuKz1rfWJyZWFrO2Nhc2UgMTE6dmFyIGI9dC5nZXRGbG9hdDY0KG4pKzZlNCp0LmdldEludDE2KG4rOCk7cj1uZXcgRGF0ZShiKSxuKz0xMDticmVhaztjYXNlIDEyOnZhciBfPXQuZ2V0VWludDMyKDEpO24rPTQscj0iIixfPjAmJihyPUsuZGVjb2RlKG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCtuLF8pKSksbis9XzticmVhaztkZWZhdWx0Om49YX1yZXR1cm57ZGF0YTpyLHNpemU6bixpc0VuZDppfX19LHtrZXk6Il9wYXJzZVN0cmluZyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5nZXRVaW50MTYoMCkscj0iIjtyZXR1cm4gdD4wJiYocj1LLmRlY29kZShuZXcgVWludDhBcnJheShlLmJ1ZmZlcixlLmJ5dGVPZmZzZXQrMix0KSkpLHtkYXRhOnIsc2l6ZToyK3R9fX0se2tleToiX3BhcnNlT2JqZWN0Iix2YWx1ZTpmdW5jdGlvbih0KXtpZighKHQuYnl0ZUxlbmd0aDwzKSl7dmFyIHI9ZS5fcGFyc2VTdHJpbmcodCksYT1lLl9wYXJzZVZhbHVlKG5ldyBEYXRhVmlldyh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrci5zaXplLHQuYnl0ZUxlbmd0aC1yLnNpemUpKTtyZXR1cm57ZGF0YTp7bmFtZTpyLmRhdGEsdmFsdWU6YS5kYXRhfSxzaXplOnIuc2l6ZSthLnNpemUsaXNFbmQ6YS5pc0VuZH19fX1dKSxlfSgpLHBlPW5ldyBIKCJGbHZEZW11eGVyIiksdmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksaSh0aGlzLCJfaGVhZGVyUGFyc2VkIiwhMSksaSh0aGlzLCJfcmVtYWluaW5nRGF0YSIsbnVsbCksaSh0aGlzLCJfZ29wSWQiLDApLGkodGhpcywiX25lZWRBZGRNZXRhQmVmb3JlS2V5RnJhbWVOYWwiLCEwKSx0aGlzLnZpZGVvVHJhY2s9dHx8bmV3IHosdGhpcy5hdWRpb1RyYWNrPWF8fG5ldyBPLHRoaXMubWV0YWRhdGFUcmFjaz1ufHxuZXcgaix0aGlzLl9maXhlcj1uZXcgZGUodGhpcy52aWRlb1RyYWNrLHRoaXMuYXVkaW9UcmFjayx0aGlzLm1ldGFkYXRhVHJhY2spfXJldHVybiBuKGUsW3trZXk6ImRlbXV4Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXSYmYXJndW1lbnRzWzFdLGE9IShhcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSl8fGFyZ3VtZW50c1syXSxuPXRoaXMuYXVkaW9UcmFjayxpPXRoaXMudmlkZW9UcmFjayxzPXRoaXMubWV0YWRhdGFUcmFjaztpZighciYmYXx8KHRoaXMuX3JlbWFpbmluZ0RhdGE9bnVsbCksciYmKHRoaXMuX2hlYWRlclBhcnNlZD0hMSkscj8oaS5yZXNldCgpLG4ucmVzZXQoKSxzLnJlc2V0KCkpOihpLnNhbXBsZXM9W10sbi5zYW1wbGVzPVtdLHMuc2VpU2FtcGxlcz1bXSxzLmZsdlNjcmlwdFNhbXBsZXM9W10saS53YXJuaW5ncz1bXSxuLndhcm5pbmdzPVtdLHRoaXMuX3JlbWFpbmluZ0RhdGEmJih0PVEodGhpcy5fcmVtYWluaW5nRGF0YSx0KSx0aGlzLl9yZW1haW5pbmdEYXRhPW51bGwpKSwhdC5sZW5ndGgpcmV0dXJue3ZpZGVvVHJhY2s6aSxhdWRpb1RyYWNrOm4sbWV0YWRhdGFUcmFjazpzfTt2YXIgbz0wO2lmKCF0aGlzLl9oZWFkZXJQYXJzZWQpe2lmKCFlLnByb2JlKHQpKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBmbHYgZmlsZSIpO24ucHJlc2VudD0oNCZ0WzRdKT4+PjIhPTAsaS5wcmVzZW50PTAhPSgxJnRbNF0pLHRoaXMuX2hlYWRlclBhcnNlZD0hMCxvPWVlKHQsNSkrNH1mb3IodmFyIHUsYyxsLGYsZCxoPXQubGVuZ3RoO28rMTU8aCYmKHU9dFtvXSwhKG8rMTUrKGM9dFtvKzFdPDwxNnx0W28rMl08PDh8dFtvKzNdKT5oKSk7KWw9KHRbbys3XTw8MjQ+Pj4wKSsodFtvKzRdPDwxNikrKHRbbys1XTw8OCkrdFtvKzZdLG8rPTExLGY9dC5zdWJhcnJheShvLG8rYyksOD09PXU/dGhpcy5fcGFyc2VBdWRpbyhmLGwpOjk9PT11P3RoaXMuX3BhcnNlVmlkZW8oZixsKToxOD09PXU/dGhpcy5fcGFyc2VTY3JpcHQoZixsKTpwZS53YXJuKCJJbnZhbGlkIHRhZyB0eXBlOiAiLmNvbmNhdCh1KSksKGQ9ZWUodCxvKz1jKSkhPT0xMStjJiZwZS53YXJuKCJJbnZhbGlkIFByZXZUYWdTaXplICIuY29uY2F0KGQsIiAoIikuY29uY2F0KDExK2MsIikiKSksbys9NDtyZXR1cm4gbzxoJiYodGhpcy5fcmVtYWluaW5nRGF0YT10LnN1YmFycmF5KG8pKSxuLmZvcm1hdFRpbWVzY2FsZT1pLmZvcm1hdFRpbWVzY2FsZT1pLnRpbWVzY2FsZT1zLnRpbWVzY2FsZT0xZTMsbi50aW1lc2NhbGU9bi5zYW1wbGVSYXRlfHwwLCFuLmV4aXN0KCkmJm4uaGFzU2FtcGxlKCkmJm4ucmVzZXQoKSwhaS5leGlzdCgpJiZpLmhhc1NhbXBsZSgpJiZpLnJlc2V0KCkse3ZpZGVvVHJhY2s6aSxhdWRpb1RyYWNrOm4sbWV0YWRhdGFUcmFjazpzfX19LHtrZXk6ImZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0aGlzLl9maXhlci5maXgoZSx0LHIpLHt2aWRlb1RyYWNrOnRoaXMudmlkZW9UcmFjayxhdWRpb1RyYWNrOnRoaXMuYXVkaW9UcmFjayxtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJkZW11eEFuZEZpeCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7cmV0dXJuIHRoaXMuZGVtdXgoZSx0LHIpLHRoaXMuZml4KGEsdCxyKX19LHtrZXk6Il9wYXJzZUF1ZGlvIix2YWx1ZTpmdW5jdGlvbih0LHIpe2lmKHQubGVuZ3RoKXt2YXIgYT0oMjQwJnRbMF0pPj4+NCxuPXRoaXMuYXVkaW9UcmFjaztpZigxMCE9PWEmJjchPT1hJiY4IT09YSlyZXR1cm4gcGUud2FybigiVW5zdXBwb3J0ZWQgc291bmQgZm9ybWF0OiAiLmNvbmNhdChhKSksdm9pZCBuLnJlc2V0KCk7aWYoMTAhPT1hKXt2YXIgaT0oMTImdFswXSk+PjIscz0oMiZ0WzBdKT4+MSxvPTEmdFswXTtuLnNhbXBsZVJhdGU9ZS5BVURJT19SQVRFW2ldLG4uc2FtcGxlU2l6ZT1zPzE2Ojgsbi5jaGFubmVsQ291bnQ9bysxfTEwPT09YT90aGlzLl9wYXJzZUFhYyh0LHIpOnRoaXMuX3BhcnNlRzcxMSh0LHIsYSl9fX0se2tleToiX3BhcnNlRzcxMSIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPXRoaXMuYXVkaW9UcmFjazthLmNvZGVjVHlwZT03PT09cj9COkUsYS5zYW1wbGVSYXRlPThlMyxhLmNvZGVjPWEuY29kZWNUeXBlLGEuc2FtcGxlcy5wdXNoKG5ldyBMKHQsZS5zdWJhcnJheSgxKSkpfX0se2tleToiX3BhcnNlQWFjIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuYXVkaW9UcmFjaztpZihyLmNvZGVjVHlwZT1ELDA9PT1lWzFdKXt2YXIgYT11ZS5wYXJzZUF1ZGlvU3BlY2lmaWNDb25maWcoZS5zdWJhcnJheSgyKSk7YT8oci5jb2RlYz1hLmNvZGVjLHIuY2hhbm5lbENvdW50PWEuY2hhbm5lbENvdW50LHIuc2FtcGxlUmF0ZT1hLnNhbXBsZVJhdGUsci5jb25maWc9YS5jb25maWcsci5vYmplY3RUeXBlPWEub2JqZWN0VHlwZSxyLnNhbXBsZVJhdGVJbmRleD1hLnNhbXBsaW5nRnJlcXVlbmN5SW5kZXgpOihyLnJlc2V0KCkscGUud2FybigiQ2Fubm90IHBhcnNlIEF1ZGlvU3BlY2lmaWNDb25maWciLGUpKX1lbHNlIGlmKDE9PT1lWzFdKXtpZihudWxsPT10KXJldHVybjtyLnNhbXBsZXMucHVzaChuZXcgTCh0LGUuc3ViYXJyYXkoMikpKX1lbHNlIHBlLndhcm4oIlVua25vd24gQUFDUGFja2V0VHlwZTogIi5jb25jYXQoZVsxXSkpfX0se2tleToiX3BhcnNlVmlkZW8iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztpZighKGUubGVuZ3RoPDYpKXt2YXIgYT0oMjQwJmVbMF0pPj4+NCxuPTE1JmVbMF0saT10aGlzLnZpZGVvVHJhY2s7aWYoNyE9PW4mJjEyIT09bilyZXR1cm4gaS5yZXNldCgpLHZvaWQgcGUud2FybigiVW5zdXBwb3J0ZWQgY29kZWNJZDogIi5jb25jYXQobikpO3ZhciBzPTEyPT09bjtpLmNvZGVjVHlwZT1zP0E6Uzt2YXIgbz1lWzFdLHU9KGVbMl08PDE2fGVbM108PDh8ZVs0XSk8PDg+Pjg7aWYoMD09PW8pe3ZhciBjPWUuc3ViYXJyYXkoNSksbD1zP2NlLnBhcnNlSEVWQ0RlY29kZXJDb25maWd1cmF0aW9uUmVjb3JkKGMpOm9lLnBhcnNlQVZDRGVjb2RlckNvbmZpZ3VyYXRpb25SZWNvcmQoYyk7aWYobCl7dmFyIGY9bC5odmNDLGQ9bC5zcHMsaD1sLnBwc0FycixwPWwuc3BzQXJyLHY9bC52cHNBcnIseT1sLm5hbFVuaXRTaXplO2YmJihpLmh2Y0M9aS5odmNDfHxmKSxkJiYoaS5jb2RlYz1kLmNvZGVjLGkud2lkdGg9ZC53aWR0aCxpLmhlaWdodD1kLmhlaWdodCxpLnNhclJhdGlvPWQuc2FyUmF0aW8saS5mcHNOdW09ZC5mcHNOdW0saS5mcHNEZW49ZC5mcHNEZW4pLHAubGVuZ3RoJiYoaS5zcHM9cCksaC5sZW5ndGgmJihpLnBwcz1oKSx2JiZ2Lmxlbmd0aCYmKGkudnBzPXYpLHkmJihpLm5hbFVuaXRTaXplPXkpfWVsc2UgcGUud2FybigiQ2Fubm90IHBhcnNlICIuY29uY2F0KHM/IkhFVkMiOiJBVkMiLCJEZWNvZGVyQ29uZmlndXJhdGlvblJlY29yZCIpLGUpfWVsc2UgaWYoMT09PW8pe3ZhciBtPXNlLnBhcnNlQXZjQyhlLnN1YmFycmF5KDUpLGkubmFsVW5pdFNpemUpO2lmKChtPXRoaXMuX2NoZWNrQWRkTWV0YU5hbFRvVW5pdHMocyxtLGkpKSYmbS5sZW5ndGgpe3ZhciBnPW5ldyBSKHQrdSx0LG0pOzE9PT1hJiZnLnNldFRvS2V5ZnJhbWUoKSxpLnNhbXBsZXMucHVzaChnKSxtLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciBhPXM/ZVswXT4+PjEmNjM6MzEmZVswXTtzd2l0Y2goYSl7Y2FzZSA1OmNhc2UgMTY6Y2FzZSAxNzpjYXNlIDE4OmNhc2UgMTk6Y2FzZSAyMDpjYXNlIDIxOmNhc2UgMjI6Y2FzZSAyMzppZighcyYmNSE9PWF8fHMmJjU9PT1hKWJyZWFrO2cuc2V0VG9LZXlmcmFtZSgpO2JyZWFrO2Nhc2UgNjpjYXNlIDM5OmNhc2UgNDA6aWYoIXMmJjYhPT1hfHxzJiY2PT09YSlicmVhaztyLm1ldGFkYXRhVHJhY2suc2VpU2FtcGxlcy5wdXNoKG5ldyBOKHNlLnBhcnNlU0VJKHNlLnJlbW92ZUVQQihlKSxzKSx0K3UpKX19KSksZy5rZXlmcmFtZSYmdGhpcy5fZ29wSWQrKyxnLmdvcElkPXRoaXMuX2dvcElkfWVsc2UgcGUud2FybigiQ2Fubm90IHBhcnNlIE5BTFVzIixlKX1lbHNlIDI9PT1vfHxwZS53YXJuKCJVbmtub3duIEFWQ1BhY2tldFR5cGU6ICIuY29uY2F0KG8pKX19fSx7a2V5OiJfY2hlY2tBZGRNZXRhTmFsVG9Vbml0cyIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlJiZ0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsP3QubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT4+PjEmNjN9KSkuaW5jbHVkZXMoMzIpPyh0aGlzLl9uZWVkQWRkTWV0YUJlZm9yZUtleUZyYW1lTmFsPSExLHQpOih0LnVuc2hpZnQoci5wcHNbMF0pLHQudW5zaGlmdChyLnNwc1swXSksdC51bnNoaWZ0KHIudnBzWzBdKSx0LmZpbHRlcihCb29sZWFuKSk6KHRoaXMuX25lZWRBZGRNZXRhQmVmb3JlS2V5RnJhbWVOYWw9ITEsdCl9fSx7a2V5OiJfcGFyc2VTY3JpcHQiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5tZXRhZGF0YVRyYWNrLmZsdlNjcmlwdFNhbXBsZXMucHVzaChuZXcgRihoZS5wYXJzZShlKSx0KSl9fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gNzA9PT1lWzBdJiY3Nj09PWVbMV0mJjg2PT09ZVsyXSYmMT09PWVbM10mJmVlKGUsNSk+PTl9fV0pLGV9KCk7aSh2ZSwiQVVESU9fUkFURSIsWzU1MDAsMTFlMywyMmUzLDQ0ZTNdKSxuZXcgSCgiVHNEZW11eGVyIik7dmFyIHllPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEsbil7cih0aGlzLGUpLHRoaXMuZHY9bmV3IERhdGFWaWV3KHQpLHRoaXMuc3RhcnQ9dGhpcy5vZmZzZXQ9YXx8dGhpcy5kdi5ieXRlT2Zmc2V0LHRoaXMuZW5kPW4/dGhpcy5zdGFydCtuOnRoaXMuc3RhcnQrdGhpcy5kdi5ieXRlTGVuZ3RofXJldHVybiBuKGUsW3trZXk6ImJ1ZmZlciIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZHYuYnVmZmVyfX0se2tleToidW5yZWFkTGVuZ3RoIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5tYXgodGhpcy5lbmQtdGhpcy5vZmZzZXQsMCl9fSx7a2V5OiJzaXplIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbmQtdGhpcy5zdGFydH19LHtrZXk6InJlYWRGbG9hdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9MDtzd2l0Y2goZSl7Y2FzZSA0OnQ9dGhpcy5kdi5nZXRGbG9hdDMyKHRoaXMub2Zmc2V0KTticmVhaztjYXNlIDg6dD10aGlzLmR2LmdldEZsb2F0NjQodGhpcy5vZmZzZXQpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJyZWFkICIuY29uY2F0KGUsIi1ieXRlIGZsb2F0IGlzIG5vdCBzdXBwb3J0ZWQiKSl9cmV0dXJuIHRoaXMub2Zmc2V0Kz1lLHR9fSx7a2V5OiJiYWNrIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLm9mZnNldC09ZX19LHtrZXk6InNraXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMub2Zmc2V0Kz1lfX0se2tleToicmVhZEludCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5nZXRJbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRJbnQxNih0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuZ2V0SW50MzIodCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInJlYWQgIi5jb25jYXQoZSwiLWJ5dGUgaW50ZWdlcnMgaXMgbm90IHN1cHBvcnRlZCIpKX19fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLm9mZnNldDtzd2l0Y2godGhpcy5vZmZzZXQrPWUsZSl7Y2FzZSAxOnJldHVybiB0aGlzLmR2LmdldFVpbnQ4KHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MTYodCk7Y2FzZSAzOnJldHVybih0aGlzLmR2LmdldFVpbnQxNih0KTw8OCkrdGhpcy5kdi5nZXRVaW50OCh0KzIpO2Nhc2UgNDpyZXR1cm4gdGhpcy5kdi5nZXRVaW50MzIodCk7ZGVmYXVsdDpyZXR1cm4gdGhpcy5iYWNrKGUtNCksdGhpcy5yZWFkKGUtNCkrdGhpcy5kdi5nZXRVaW50MzIodCkqTWF0aC5wb3coMjU2LGUtNCl9fX0se2tleToid3JpdGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcy5vZmZzZXQ7c3dpdGNoKHRoaXMub2Zmc2V0Kz1lLGUpe2Nhc2UgMTpyZXR1cm4gdGhpcy5kdi5zZXRVaW50OChyLHQpO2Nhc2UgMjpyZXR1cm4gdGhpcy5kdi5zZXRVaW50MTYocix0KTtjYXNlIDM6cmV0dXJuIHRoaXMuZHYuc2V0VWludDgocix0Pj4+MTYpLHRoaXMuZHYuc2V0VWludDE2KHIrMSw2NTUzNSZ0KTtjYXNlIDQ6cmV0dXJuIHRoaXMuZHYuc2V0VWludDMyKHIsdCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIndyaXRlICIuY29uY2F0KGUsIi1ieXRlIGludGVnZXJzIGlzIG5vdCBzdXBwb3J0ZWQiKSl9fX0se2tleToicmVhZFRvQnVmZmVyIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gdD10aGlzLm9mZnNldHx8ZT90aGlzLmR2LmJ1ZmZlci5zbGljZSh0aGlzLm9mZnNldCxlP3RoaXMub2Zmc2V0K2U6dGhpcy5lbmQpOnRoaXMuZHYuYnVmZmVyLHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRUb1VpbnQ4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1uZXcgVWludDhBcnJheSh0aGlzLmR2LmJ1ZmZlcix0aGlzLm9mZnNldCxlfHx0aGlzLnVucmVhZExlbmd0aCk7cmV0dXJuIHRoaXMub2Zmc2V0Kz10LmJ5dGVMZW5ndGgsdH19LHtrZXk6InJlYWRTdHJpbmciLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9IiI7dDxlO3QrKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMuZHYuZ2V0VWludDgodGhpcy5vZmZzZXQpKSx0aGlzLm9mZnNldCsrO3JldHVybiByfX1dLFt7a2V5OiJmcm9tVWludDgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKX19LHtrZXk6ImNvbmNhdFVpbnQ4cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoZS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCkpLHI9MDtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbihlKXt0LnNldChlLHIpLHIrPWUuYnl0ZUxlbmd0aH0pKSx0fX0se2tleToiY29uY2F0VWludDgiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIHRoaXMuY29uY2F0VWludDhzKHQpfX1dKSxlfSgpLG1lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEpe3IodGhpcyxlKSx0aGlzLm9mZnNldD0wLHRoaXMudmFsPXQsdGhpcy5zaXplPWF9cmV0dXJuIG4oZSxbe2tleToic2tpcCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5vZmZzZXQrPWV9fSx7a2V5OiJyZWFkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnNpemUtdGhpcy5vZmZzZXQtZTtpZih0Pj0wKXt2YXIgcj0wLGE9MDtpZih0aGlzLm9mZnNldCs9ZSx0aGlzLnNpemU+MzEpe2Zvcig7YTxlO2ErKylyKz1NYXRoLnBvdygyLGEpO3JldHVybiB0aGlzLnZhbC9NYXRoLnBvdygyLHQpJnJ9Zm9yKDthPGU7YSsrKXIrPTE8PGE7cmV0dXJuIHRoaXMudmFsPj4+dCZyfXRocm93IG5ldyBFcnJvcigidGhlIG51bWJlciBvZiB0aGUgcmVhZCBvcGVyYXRpb24gZXhjZWVkcyB0aGUgdG90YWwgbGVuZ3RoIGxpbWl0IG9mIGJpdHMiKX19XSxbe2tleToiZnJvbUJ5dGUiLHZhbHVlOmZ1bmN0aW9uKHQscil7cmV0dXJuIG5ldyBlKHQucmVhZChyKSxyPDwzKX19XSksZX0oKSxnZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJmaW5kQm94Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTowLG49W107aWYoIXQpcmV0dXJuIG47Zm9yKHZhciBpPTAscz0iIixvPTA7dC5sZW5ndGg+Nzspe2lmKGk9ZWUodCkscz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsdC5zdWJhcnJheSg0LDgpKSxvPTgsMT09PWk/KGk9dGUodCw4KSxvKz04KTppfHwoaT10Lmxlbmd0aCksIXJbMF18fHM9PT1yWzBdKXt2YXIgdT10LnN1YmFycmF5KDAsaSk7aWYoIShyLmxlbmd0aDwyKSlyZXR1cm4gZS5maW5kQm94KHUuc3ViYXJyYXkobyksci5zbGljZSgxKSxhK28pO24ucHVzaCh7c3RhcnQ6YSxzaXplOmksaGVhZGVyU2l6ZTpvLHR5cGU6cyxkYXRhOnV9KX1hKz1pLHQ9dC5zdWJhcnJheShpKX1yZXR1cm4gbn19LHtrZXk6InRmaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2UudHJhY2tJZD1lZSh0KTt2YXIgcj00LGE9MSZlLmZsYWdzLG49MiZlLmZsYWdzLGk9OCZlLmZsYWdzLHM9MTYmZS5mbGFncyxvPTMyJmUuZmxhZ3M7YSYmKHIrPTQsZS5iYXNlRGF0YU9mZnNldD1lZSh0LHIpLHIrPTQpLG4mJihlLnNhbXBsZURlc2NyaXB0aW9uSW5kZXg9ZWUodCxyKSxyKz00KSxpJiYoZS5kZWZhdWx0U2FtcGxlRHVyYXRpb249ZWUodCxyKSxyKz00KSxzJiYoZS5kZWZhdWx0U2FtcGxlU2l6ZT1lZSh0LHIpLHIrPTQpLG8mJihlLmRlZmF1bHRTYW1wbGVGbGFncz1lZSh0LHIpKX0pKX19LHtrZXk6InNpZHgiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7ZS5yZWZlcmVuY2VfSUQ9ZWUodCxyKSxyKz00LGUudGltZXNjYWxlPWVlKHQscikscis9NCwwPT09ZS52ZXJzaW9uPyhlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPWVlKHQscikscis9NCxlLmZpcnN0X29mZnNldD1lZSh0LHIpLHIrPTQpOihlLmVhcmxpZXN0X3ByZXNlbnRhdGlvbl90aW1lPXRlKHQscikscis9OCxlLmZpcnN0X29mZnNldD10ZSh0LHIpLHIrPTgpLHIrPTIsZS5yZWZlcmVuY2VzPVtdO3ZhciBhPSQodCxyKTtyKz0yO2Zvcih2YXIgbj0wO248YTtuKyspe3ZhciBpPXt9O2UucmVmZXJlbmNlcy5wdXNoKGkpO3ZhciBzPWVlKHQscik7cis9NCxpLnJlZmVyZW5jZV90eXBlPXM+PjMxJjEsaS5yZWZlcmVuY2VkX3NpemU9MjE0NzQ4MzY0NyZzLGkuc3Vic2VnbWVudF9kdXJhdGlvbj1lZSh0LHIpLHM9ZWUodCxyKz00KSxyKz00LGkuc3RhcnRzX3dpdGhfU0FQPXM+PjMxJjEsaS5TQVBfdHlwZT1zPj4yOCY3LGkuU0FQX2RlbHRhX3RpbWU9MjY4NDM1NDU1JnN9fSkpfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0Lm12aGQ9ZS5tdmhkKGUuZmluZEJveChyLFsibXZoZCJdLGEpWzBdKSx0LnRyYWs9ZS5maW5kQm94KHIsWyJ0cmFrIl0sYSkubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpLHQucHNzaD1lLnBzc2goZS5maW5kQm94KHIsWyJwc3NoIl0sYSlbMF0pfSkpfX0se2tleToibXZoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7dmFyIHI9MDsxPT09ZS52ZXJzaW9uPyhlLnRpbWVzY2FsZT1lZSh0LDE2KSxlLmR1cmF0aW9uPXRlKHQsMjApLHIrPTI4KTooZS50aW1lc2NhbGU9ZWUodCw4KSxlLmR1cmF0aW9uPWVlKHQsMTIpLHIrPTE2KSxlLm5leHRUcmFja0lkPWVlKHQscis3Nil9KSl9fSx7a2V5OiJ0cmFrIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3QudGtoZD1lLnRraGQoZS5maW5kQm94KHIsWyJ0a2hkIl0sYSlbMF0pLHQubWRpYT1lLm1kaWEoZS5maW5kQm94KHIsWyJtZGlhIl0sYSlbMF0pfSkpfX0se2tleToidGtoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7dmFyIHI9eWUuZnJvbVVpbnQ4KHQpOzE9PT1lLnZlcnNpb24/KHIucmVhZCg4KSxyLnJlYWQoOCksZS50cmFja0lkPXIucmVhZCg0KSxyLnJlYWQoNCksZS5kdXJhdGlvbj1yLnJlYWQoOCkpOihyLnJlYWQoNCksci5yZWFkKDQpLGUudHJhY2tJZD1yLnJlYWQoNCksci5yZWFkKDQpLGUuZHVyYXRpb249ci5yZWFkKDQpKSxyLnNraXAoMTYpLGUubWF0cml4PVtdO2Zvcih2YXIgYT0wO2E8MzY7YSsrKWUubWF0cml4LnB1c2goci5yZWFkKDEpKTtyLmJhY2soMzYpO2Zvcih2YXIgbixpPVtdLHM9MDtzPDM7cysrKWkucHVzaChpZShyLnJlYWRJbnQoMiksci5yZWFkSW50KDIpKSksaS5wdXNoKGllKHIucmVhZEludCgyKSxyLnJlYWRJbnQoMikpKSxuPXIucmVhZEludCg0KSxpLnB1c2goaWUobj4+MzAsMTA3Mzc0MTgyMyZuKSk7ZS5yb3RhdGlvbj1mdW5jdGlvbihlKXtpZihlLmxlbmd0aDw1KXJldHVybiAwO3ZhciB0PU1hdGguaHlwb3QoZVswXSxlWzNdKSxyPU1hdGguaHlwb3QoZVsxXSxlWzRdKTtyZXR1cm4gMD09PXR8fDA9PT1yPzA6MTgwKk1hdGguYXRhbjIoZVsxXS9yLGVbMF0vdCkvTWF0aC5QSX0oaSksZS53aWR0aD1yLnJlYWQoNCksZS5oZWlnaHQ9ci5yZWFkKDQpfSkpfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0Lm1kaGQ9ZS5tZGhkKGUuZmluZEJveChyLFsibWRoZCJdLGEpWzBdKSx0LmhkbHI9ZS5oZGxyKGUuZmluZEJveChyLFsiaGRsciJdLGEpWzBdKSx0Lm1pbmY9ZS5taW5mKGUuZmluZEJveChyLFsibWluZiJdLGEpWzBdKX0pKX19LHtrZXk6Im1kaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPTA7MT09PWUudmVyc2lvbj8oZS50aW1lc2NhbGU9ZWUodCwxNiksZS5kdXJhdGlvbj10ZSh0LDIwKSxyKz0yOCk6KGUudGltZXNjYWxlPWVlKHQsOCksZS5kdXJhdGlvbj1lZSh0LDEyKSxyKz0xNik7dmFyIGE9JCh0LHIpO2UubGFuZ3VhZ2U9U3RyaW5nLmZyb21DaGFyQ29kZSg5NisoYT4+MTAmMzEpLDk2KyhhPj41JjMxKSw5NisoMzEmYSkpfSkpfX0se2tleToiaGRsciIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUsdCl7MD09PWUudmVyc2lvbiYmKGUuaGFuZGxlclR5cGU9U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQuc3ViYXJyYXkoNCw4KSkpfSkpfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnZtaGQ9ZS52bWhkKGUuZmluZEJveChyLFsidm1oZCJdLGEpWzBdKSx0LnNtaGQ9ZS5zbWhkKGUuZmluZEJveChyLFsic21oZCJdLGEpWzBdKSx0LnN0Ymw9ZS5zdGJsKGUuZmluZEJveChyLFsic3RibCJdLGEpWzBdKX0pKX19LHtrZXk6InZtaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2UuZ3JhcGhpY3Ntb2RlPSQodCksZS5vcGNvbG9yPVskKHQsMiksJCh0LDQpLCQodCw2KV19KSl9fSx7a2V5OiJzbWhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmJhbGFuY2U9JCh0KX0pKX19LHtrZXk6InN0YmwiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dmFyIG4saSxzO3Quc3RzZD1lLnN0c2QoZS5maW5kQm94KHIsWyJzdHNkIl0sYSlbMF0pLHQuc3R0cz1lLnN0dHMoZS5maW5kQm94KHIsWyJzdHRzIl0sYSlbMF0pLHQuY3R0cz1lLmN0dHMoZS5maW5kQm94KHIsWyJjdHRzIl0sYSlbMF0pLHQuc3RzYz1lLnN0c2MoZS5maW5kQm94KHIsWyJzdHNjIl0sYSlbMF0pLHQuc3Rzej1lLnN0c3ooZS5maW5kQm94KHIsWyJzdHN6Il0sYSlbMF0pLHQuc3Rjbz1lLnN0Y28oZS5maW5kQm94KHIsWyJzdGNvIl0sYSlbMF0pLHQuc3Rjb3x8KHQuY282ND1lLmNvNjQoZS5maW5kQm94KHIsWyJjbzY0Il0sYSlbMF0pLHQuc3Rjbz10LmNvNjQpO3ZhciBvPW51bGw9PT0obj10LnN0c2QuZW50cmllc1swXSl8fHZvaWQgMD09PW58fG51bGw9PT0oaT1uLnNpbmYpfHx2b2lkIDA9PT1pfHxudWxsPT09KHM9aS5zY2hpKXx8dm9pZCAwPT09cz92b2lkIDA6cy50ZW5jLmRlZmF1bHRfSVZfc2l6ZTt0LnN0c3M9ZS5zdHNzKGUuZmluZEJveChyLFsic3RzcyJdLGEpWzBdKSx0LnNlbmM9ZS5zZW5jKGUuZmluZEJveChyLFsic2VuYyJdLGEpWzBdLG8pfSkpfX0se2tleToic2VuYyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjg7cmV0dXJuIHdlKGUsITAsKGZ1bmN0aW9uKGUscil7dmFyIGE9MCxuPWVlKHIsYSk7YSs9NCxlLnNhbXBsZXM9W107Zm9yKHZhciBpPTA7aTxuO2krKyl7Zm9yKHZhciBzPXtJbml0aWFsaXphdGlvblZlY3RvcjpbXX0sbz0wO288dDtvKyspcy5Jbml0aWFsaXphdGlvblZlY3RvcltvXT1yW2Erb107aWYoYSs9dCwyJmUuZmxhZ3Mpe3Muc3Vic2FtcGxlcz1bXTt2YXIgdT0kKHIsYSk7YSs9Mjtmb3IodmFyIGM9MDtjPHU7YysrKXt2YXIgbD17fTtsLkJ5dGVzT2ZDbGVhckRhdGE9JChyLGEpLGErPTIsbC5CeXRlc09mUHJvdGVjdGVkRGF0YT1lZShyLGEpLGErPTQscy5zdWJzYW1wbGVzLnB1c2gobCl9fWUuc2FtcGxlcy5wdXNoKHMpfX0pKX19LHtrZXk6InBzc2giLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1bXSxhPVtdLG49MCxpPTA7aTwxNjtpKyspYS5wdXNoKFNlKHRbbitpXSkpO2lmKG4rPTE2LGUudmVyc2lvbj4wKXt2YXIgcz1lZSh0LG4pO24rPTQ7Zm9yKHZhciBvPTA7bzwoIiIrcykubGVuZ3RoO28rKylmb3IodmFyIHU9MDt1PDE2O3UrKyl7dmFyIGM9dFtuXTtuKz0xLHIucHVzaChTZShjKSl9fXZhciBsPWVlKHQsbik7ZS5kYXRhX3NpemU9bCxuKz00LGUua2lkPXIsZS5zeXN0ZW1faWQ9YSxlLmJ1ZmZlcj10fSkpfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITAsKGZ1bmN0aW9uKHQscixhKXt0LmVudHJ5Q291bnQ9ZWUociksdC5lbnRyaWVzPWUuZmluZEJveChyLnN1YmFycmF5KDQpLFtdLGErNCkubWFwKChmdW5jdGlvbih0KXtzd2l0Y2godC50eXBlKXtjYXNlImF2MDEiOnJldHVybiBlLmF2MDEodCk7Y2FzZSJhdmMxIjpjYXNlImF2YzIiOmNhc2UiYXZjMyI6Y2FzZSJhdmM0IjpyZXR1cm4gZS5hdmMxKHQpO2Nhc2UiaHZjMSI6Y2FzZSJoZXYxIjpyZXR1cm4gZS5odmMxKHQpO2Nhc2UibXA0YSI6cmV0dXJuIGUubXA0YSh0KTtjYXNlImFsYXciOmNhc2UidWxhdyI6cmV0dXJuIGUuYWxhdyh0KTtjYXNlImVuY2EiOnJldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5jaGFubmVsQ291bnQ9JChyLDE2KSx0LnNhbXBsZXNpemU9JChyLDE4KSx0LnNhbXBsZVJhdGU9ZWUociwyNCkvNjU1MzYscj1yLnN1YmFycmF5KDI4KSx0LnNpbmY9ZS5zaW5mKGUuZmluZEJveChyLFsic2luZiJdLGEpWzBdKSx0LmVzZHM9ZS5lc2RzKGUuZmluZEJveChyLFsiZXNkcyJdLGEpWzBdKX0pKTtjYXNlImVuY3YiOnJldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC53aWR0aD0kKHIsMjQpLHQuaGVpZ2h0PSQociwyNiksdC5ob3JpenJlc29sdXRpb249ZWUociwyOCksdC52ZXJ0cmVzb2x1dGlvbj1lZShyLDMyKSxyPXIuc3ViYXJyYXkoNzgpLHQuc2luZj1lLnNpbmYoZS5maW5kQm94KHIsWyJzaW5mIl0sYSlbMF0pLHQuYXZjQz1lLmF2Y0MoZS5maW5kQm94KHIsWyJhdmNDIl0sYSlbMF0pLHQuaHZjQz1lLmh2Y0MoZS5maW5kQm94KHIsWyJodmNDIl0sYSlbMF0pLHQucGFzcD1lLnBhc3AoZS5maW5kQm94KHIsWyJwYXNwIl0sYSlbMF0pfSkpfX0pKS5maWx0ZXIoQm9vbGVhbil9KSl9fSx7a2V5OiJ0ZW5jIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24oZSx0KXt2YXIgcj02O2UuZGVmYXVsdF9Jc0VuY3J5cHRlZD10W3JdLHIrPTEsZS5kZWZhdWx0X0lWX3NpemU9dFtyXSxyKz0xLGUuZGVmYXVsdF9LSUQ9W107Zm9yKHZhciBhPTA7YTwxNjthKyspZS5kZWZhdWx0X0tJRC5wdXNoKFNlKHRbcl0pKSxyKz0xfSkpfX0se2tleToic2NoaSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRlbmM9ZS50ZW5jKGUuZmluZEJveChyLFsidGVuYyJdLGEpWzBdKX0pKX19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB3ZSh0LCExLChmdW5jdGlvbih0LHIsYSl7dC5zY2hpPWUuc2NoaShlLmZpbmRCb3gocixbInNjaGkiXSxhKVswXSksdC5mcm1hPWUuZnJtYShlLmZpbmRCb3gocixbImZybWEiXSxhKVswXSl9KSl9fSx7a2V5OiJmcm1hIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24oZSx0KXtlLmRhdGFfZm9ybWF0PSIiO2Zvcih2YXIgcj0wO3I8NDtyKyspZS5kYXRhX2Zvcm1hdCs9U3RyaW5nLmZyb21DaGFyQ29kZSh0W3JdKX0pKX19LHtrZXk6ImNvbHIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCExLChmdW5jdGlvbih0LHIpe3ZhciBhPXllLmZyb21VaW50OChyKTt0LmRhdGE9ZS5kYXRhLHQuY29sb3JUeXBlPWEucmVhZFN0cmluZyg0KSwibmNseCI9PT10LmNvbG9yVHlwZT8odC5jb2xvclByaW1hcmllcz1hLnJlYWQoMiksdC50cmFuc2ZlckNoYXJhY3RlcmlzdGljcz1hLnJlYWQoMiksdC5tYXRyaXhDb2VmZmljaWVudHM9YS5yZWFkKDIpLHQuZnVsbFJhbmdlRmxhZz1hLnJlYWQoMSk+PjcpOiJySUNDIiE9PXQuY29sb3JUeXBlJiYicHJvZiIhPT10LmNvbG9yVHlwZXx8KHQuaWNjUHJvZmlsZT1yLnJlYWRUb1VpbnQ4KCkpfSkpfX0se2tleToiYXYwMSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1iZSh0LHIpLGk9ci5zdWJhcnJheShuKTthKz1uLHQuYXYxQz1lLmF2MUMoZS5maW5kQm94KGksWyJhdjFDIl0sYSlbMF0pLHQuY29scj1lLmNvbHIoZS5maW5kQm94KGksWyJjb2xyIl0sYSlbMF0pfSkpfX0se2tleToiYXYxQyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITEsKGZ1bmN0aW9uKHQscil7dC5kYXRhPWUuZGF0YTt2YXIgYSxuPXllLmZyb21VaW50OChyKSxpPW1lLmZyb21CeXRlKG4sNCk7dC5tYXJrZXI9aS5yZWFkKDEpLHQudmVyc2lvbj1pLnJlYWQoNyksdC5zZXFQcm9maWxlPWkucmVhZCgzKSx0LnNlcUxldmVsSWR4MD1pLnJlYWQoNSksdC5zZXFUaWVyMD1pLnJlYWQoMSksdC5oaWdoQml0ZGVwdGg9aS5yZWFkKDEpLHQudHdlbHZlQml0PWkucmVhZCgxKSx0Lm1vbm9jaHJvbWU9aS5yZWFkKDEpLHQuY2hyb21hU3Vic2FtcGxpbmdYPWkucmVhZCgxKSx0LmNocm9tYVN1YnNhbXBsaW5nWT1pLnJlYWQoMSksdC5jaHJvbWFTYW1wbGVQb3NpdGlvbj1pLnJlYWQoMiksdC5yZXNlcnZlZD1pLnJlYWQoMyksdC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlQcmVzZW50PWkucmVhZCgxKSx0LmluaXRpYWxQcmVzZW50YXRpb25EZWxheVByZXNlbnQ/dC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlNaW51c09uZT1pLnJlYWQoNCk6dC5pbml0aWFsUHJlc2VudGF0aW9uRGVsYXlNaW51c09uZT0wLHQuY29uZmlnT0JVcz1uLnJlYWRUb1VpbnQ4KCksMj09PXQuc2VxTGV2ZWxJZHgwJiYxPT09dC5oaWdoQml0ZGVwdGg/YT0xPT09dC50d2VsdmVCaXQ/IjEyIjoiMTAiOnQuc2VxUHJvZmlsZTw9MiYmKGE9MT09PXQuaGlnaEJpdGRlcHRoPyIxMCI6IjA4IiksdC5jb2RlYz1bImF2MDEiLHQuc2VxUHJvZmlsZSwodC5zZXFMZXZlbElkeDA8MTA/IjAiK3Quc2VxTGV2ZWxJZHgwOnQuc2VxTGV2ZWxJZHgwKSsodC5zZXFUaWVyMD8iSCI6Ik0iKSxhXS5qb2luKCIuIil9KSl9fSx7a2V5OiJhdmMxIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuPWJlKHQsciksaT1yLnN1YmFycmF5KG4pO2ErPW4sdC5hdmNDPWUuYXZjQyhlLmZpbmRCb3goaSxbImF2Y0MiXSxhKVswXSksdC5wYXNwPWUucGFzcChlLmZpbmRCb3goaSxbInBhc3AiXSxhKVswXSl9KSl9fSx7a2V5OiJhdmNDIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24odCxyKXt0LmRhdGE9ZS5kYXRhLHQuY29uZmlndXJhdGlvblZlcnNpb249clswXSx0LkFWQ1Byb2ZpbGVJbmRpY2F0aW9uPXJbMV0sdC5wcm9maWxlQ29tcGF0aWJpbGl0eT1yWzJdLHQuQVZDTGV2ZWxJbmRpY2F0aW9uPXJbM10sdC5jb2RlYz1yZShbclsxXSxyWzJdLHJbM11dKSx0Lmxlbmd0aFNpemVNaW51c09uZT0zJnJbNF0sdC5zcHNMZW5ndGg9MzEmcls1XSx0LnNwcz1bXTtmb3IodmFyIGE9NixuPTA7bjx0LnNwc0xlbmd0aDtuKyspe3ZhciBpPSQocixhKTthKz0yLHQuc3BzLnB1c2goci5zdWJhcnJheShhLGEraSkpLGErPWl9dC5wcHNMZW5ndGg9clthXSxhKz0xLHQucHBzPVtdO2Zvcih2YXIgcz0wO3M8dC5wcHNMZW5ndGg7cysrKXt2YXIgbz0kKHIsYSk7YSs9Mix0LnBwcy5wdXNoKHIuc3ViYXJyYXkoYSxhKz1vKSksYSs9b319KSl9fSx7a2V5OiJodmMxIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3ZhciBuPWJlKHQsciksaT1yLnN1YmFycmF5KG4pO2ErPW4sdC5odmNDPWUuaHZjQyhlLmZpbmRCb3goaSxbImh2Y0MiXSxhKVswXSksdC5wYXNwPWUucGFzcChlLmZpbmRCb3goaSxbInBhc3AiXSxhKVswXSl9KSl9fSx7a2V5OiJodmNDIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMSwoZnVuY3Rpb24odCxyKXt0LmRhdGE9ZS5kYXRhLHQuY29kZWM9ImhldjEuMS42Lkw5My5CMCIsdC5jb25maWd1cmF0aW9uVmVyc2lvbj1yWzBdO3ZhciBhPXJbMV07dC5nZW5lcmFsUHJvZmlsZVNwYWNlPWE+PjYsdC5nZW5lcmFsVGllckZsYWc9KDMyJmEpPj41LHQuZ2VuZXJhbFByb2ZpbGVJZGM9MzEmYSx0LmdlbmVyYWxQcm9maWxlQ29tcGF0aWJpbGl0eT1lZShyLDIpLHQuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncz1yLnN1YmFycmF5KDYsMTIpLHQuZ2VuZXJhbExldmVsSWRjPXJbMTJdLHQuYXZnRnJhbWVSYXRlPSQociwxOSksdC5udW1PZkFycmF5cz1yWzIyXSx0LnZwcz1bXSx0LnNwcz1bXSx0LnBwcz1bXTtmb3IodmFyIG49MjMsaT0wLHM9MCxvPTAsdT0wO3U8dC5udW1PZkFycmF5czt1Kyspe2k9NjMmcltuXSxzPSQocixuKzEpLG4rPTM7Zm9yKHZhciBjLGw9W10sZj0wO2Y8cztmKyspbz0kKHIsbiksbis9MixsLnB1c2goci5zdWJhcnJheShuLG4rbykpLG4rPW87aWYoMzI9PT1pKShjPXQudnBzKS5wdXNoLmFwcGx5KGMsbCk7ZWxzZSBpZigzMz09PWkpe3ZhciBkOyhkPXQuc3BzKS5wdXNoLmFwcGx5KGQsbCl9ZWxzZSBpZigzND09PWkpe3ZhciBoOyhoPXQucHBzKS5wdXNoLmFwcGx5KGgsbCl9fX0pKX19LHtrZXk6InBhc3AiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCExLChmdW5jdGlvbihlLHQpe2UuaFNwYWNpbmc9ZWUodCksZS52U3BhY2luZz1lZSh0LDQpfSkpfX0se2tleToibXA0YSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt2YXIgbj1fZSh0LHIpO3QuZXNkcz1lLmVzZHMoZS5maW5kQm94KHIuc3ViYXJyYXkobiksWyJlc2RzIl0sYStuKVswXSl9KSl9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLmNvZGVjPSJtcDRhLiI7Zm9yKHZhciByPTAsYT0wLG49MCxpPTA7dC5sZW5ndGg7KXtmb3IoaT10W3I9MF0sYT10W3IrMV0scis9MjsxMjgmYTspbj0oMTI3JmEpPDw3LGE9dFtyXSxyKz0xO2lmKG4rPTEyNyZhLDM9PT1pKXQ9dC5zdWJhcnJheShyKzMpO2Vsc2V7aWYoNCE9PWkpe2lmKDU9PT1pKXt2YXIgcz1lLmNvbmZpZz10LnN1YmFycmF5KHIscituKSxvPSgyNDgmc1swXSk+PjM7cmV0dXJuIDMxPT09byYmcy5sZW5ndGg+PTImJihvPTMyKygoNyZzWzBdKTw8MykrKCgyMjQmc1sxXSk+PjUpKSxlLm9iamVjdFR5cGU9byxlLmNvZGVjKz1vLnRvU3RyaW5nKDE2KSx2b2lkKCIuIj09PWUuY29kZWNbZS5jb2RlYy5sZW5ndGgtMV0mJihlLmNvZGVjPWUuY29kZWMuc3Vic3RyaW5nKDAsZS5jb2RlYy5sZW5ndGgtMSkpKX1yZXR1cm4gdm9pZCgiLiI9PT1lLmNvZGVjW2UuY29kZWMubGVuZ3RoLTFdJiYoZS5jb2RlYz1lLmNvZGVjLnN1YnN0cmluZygwLGUuY29kZWMubGVuZ3RoLTEpKSl9ZS5jb2RlYys9KHRbcl0udG9TdHJpbmcoMTYpKyIuIikucGFkU3RhcnQoMywiMCIpLHQ9dC5zdWJhcnJheShyKzEzKX19fSkpfX0se2tleToiYWxhdyIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGUsITEsKGZ1bmN0aW9uKGUsdCl7X2UoZSx0KX0pKX19LHtrZXk6InN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OmVlKHQsbiksZGVsdGE6ZWUodCxuKzQpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPWVlKHQpLGE9W10sbj00O2lmKDE9PT1lLnZlcnNpb24pZm9yKHZhciBpPTA7aTxyO2krKylhLnB1c2goe2NvdW50OmVlKHQsbiksb2Zmc2V0OmVlKHQsbis0KX0pLG4rPTg7ZWxzZSBmb3IodmFyIHM9MDtzPHI7cysrKWEucHVzaCh7Y291bnQ6ZWUodCxuKSxvZmZzZXQ6LSgxK35lZSh0LG4rNCkpfSksbis9ODtlLmVudHJ5Q291bnQ9cixlLmVudHJpZXM9YX0pKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1lZSh0KSxhPVtdLG49NCxpPTA7aTxyO2krKylhLnB1c2goe2ZpcnN0Q2h1bms6ZWUodCxuKSxzYW1wbGVzUGVyQ2h1bms6ZWUodCxuKzQpLHNhbXBsZURlc2NyaXB0aW9uSW5kZXg6ZWUodCxuKzgpfSksbis9MTI7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXt2YXIgcj1lZSh0KSxhPWVlKHQsNCksbj1bXTtpZighcilmb3IodmFyIGk9OCxzPTA7czxhO3MrKyluLnB1c2goZWUodCxpKSksaSs9NDtlLnNhbXBsZVNpemU9cixlLnNhbXBsZUNvdW50PWEsZS5lbnRyeVNpemVzPW59KSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKGVlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJjbzY0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKHRlKHQsbikpLG4rPTg7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJzdHNzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZWUodCksYT1bXSxuPTQsaT0wO2k8cjtpKyspYS5wdXNoKGVlKHQsbikpLG4rPTQ7ZS5lbnRyeUNvdW50PXIsZS5lbnRyaWVzPWF9KSl9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gd2UodCwhMSwoZnVuY3Rpb24odCxyLGEpe3QubWZoZD1lLm1maGQoZS5maW5kQm94KHIsWyJtZmhkIl0sYSlbMF0pLHQudHJhZj1lLmZpbmRCb3gocixbInRyYWYiXSxhKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSl9KSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXtlLnNlcXVlbmNlTnVtYmVyPWVlKHQpfSkpfX0se2tleToidHJhZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHdlKHQsITEsKGZ1bmN0aW9uKHQscixhKXt0LnRmaGQ9ZS50ZmhkKGUuZmluZEJveChyLFsidGZoZCJdLGEpWzBdKSx0LnRmZHQ9ZS50ZmR0KGUuZmluZEJveChyLFsidGZkdCJdLGEpWzBdKSx0LnRydW49ZS50cnVuKGUuZmluZEJveChyLFsidHJ1biJdLGEpWzBdKX0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB3ZShlLCEwLChmdW5jdGlvbihlLHQpe3ZhciByPWUudmVyc2lvbixhPWUuZmxhZ3Msbj10Lmxlbmd0aCxpPWUuc2FtcGxlQ291bnQ9ZWUodCkscz00O2lmKG4+cyYmMSZhJiYoZS5kYXRhT2Zmc2V0PS0oMSt+ZWUodCxzKSkscys9NCksbj5zJiY0JmEmJihlLmZpcnN0U2FtcGxlRmxhZ3M9ZWUodCxzKSxzKz00KSxlLnNhbXBsZXM9W10sbj5zKWZvcih2YXIgbyx1PTA7dTxpO3UrKylvPXt9LDI1NiZhJiYoby5kdXJhdGlvbj1lZSh0LHMpLHMrPTQpLDUxMiZhJiYoby5zaXplPWVlKHQscykscys9NCksMTAyNCZhJiYoby5mbGFncz1lZSh0LHMpLHMrPTQpLDIwNDgmYSYmKG8uY3RzPXI/LSgxK35lZSh0LHMrNCkpOmVlKHQscykscys9NCksZS5zYW1wbGVzLnB1c2gobyl9KSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gd2UoZSwhMCwoZnVuY3Rpb24oZSx0KXsxPT09ZS52ZXJzaW9uP2UuYmFzZU1lZGlhRGVjb2RlVGltZT10ZSh0KTplLmJhc2VNZWRpYURlY29kZVRpbWU9ZWUodCl9KSl9fSx7a2V5OiJwcm9iZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuISFlLmZpbmRCb3godCxbImZ0eXAiXSl9fSx7a2V5OiJwYXJzZVNhbXBsZUZsYWdzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm57aXNMZWFkaW5nOigxMiZlWzBdKT4+PjIsZGVwZW5kc09uOjMmZVswXSxpc0RlcGVuZGVkT246KDE5MiZlWzFdKT4+PjYsaGFzUmVkdW5kYW5jeTooNDgmZVsxXSk+Pj40LHBhZGRpbmdWYWx1ZTooMTQmZVsxXSk+Pj4xLGlzTm9uU3luY1NhbXBsZToxJmVbMV0sZGVncmFkYXRpb25Qcmlvcml0eTplWzJdPDw4fGVbM119fX0se2tleToibW9vdlRvVHJhY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuLGk9ZS50cmFrO2lmKGkmJmkubGVuZ3RoKXt2YXIgcz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksbz1pLmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocyYmdCl7dmFyIHUsYyxsLGYsZCxoLHAsdj10LHk9bnVsbD09PSh1PXMudGtoZCl8fHZvaWQgMD09PXU/dm9pZCAwOnUudHJhY2tJZDtudWxsIT15JiYodi5pZD1zLnRraGQudHJhY2tJZCksdi50a2hkRHVyYXRpb249cy50a2hkLmR1cmF0aW9uLHYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLHYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsdi50aW1lc2NhbGU9di5mb3JtYXRUaW1lc2NhbGU9cy5tZGlhLm1kaGQudGltZXNjYWxlLHYuZHVyYXRpb249cy5tZGlhLm1kaGQuZHVyYXRpb258fHYubXZoZER1cnRpb24vdi5tdmhkVGltZWNhbGUqdi50aW1lc2NhbGUsdi5yb3RhdGlvbj1zLnRraGQucm90YXRpb24sdi5tYXRyaXg9cy50a2hkLm1hdHJpeDt2YXIgbSxnLGssYixfLHcsUyxELFQ9cy5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbMF07aWYodi53aWR0aD1ULndpZHRoLHYuaGVpZ2h0PVQuaGVpZ2h0LFQucGFzcCYmKHYuc2FyUmF0aW89W1QucGFzcC5oU3BhY2luZyxULnBhc3AudlNwYWNpbmddKSxULmF2MUMpdi5jb2RlY1R5cGU9eCx2LmNvZGVjPVQuYXYxQy5jb2RlYyx2LmF2MUM9VC5hdjFDLmRhdGEsdi5jb2xyPVQuY29sci5kYXRhO2Vsc2UgaWYoVC5odmNDKXYuY29kZWNUeXBlPUEsdi5jb2RlYz1ULmh2Y0MuY29kZWMsdi52cHM9VC5odmNDLnZwcyx2LnNwcz1ULmh2Y0Muc3BzLHYucHBzPVQuaHZjQy5wcHMsdi5odmNDPVQuaHZjQy5kYXRhO2Vsc2V7aWYoIVQuYXZjQyl0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdmlkZW8gc3RzZCBlbnRyeSIpO3YuY29kZWM9VC5hdmNDLmNvZGVjLHYuc3BzPVQuYXZjQy5zcHMsdi5wcHM9VC5hdmNDLnBwc31pZih2LnByZXNlbnQ9ITAsdi5leHQ9e30sdi5leHQuc3Rzcz1udWxsPT09KGM9cy5tZGlhKXx8dm9pZCAwPT09Y3x8bnVsbD09PShsPWMubWluZil8fHZvaWQgMD09PWx8fG51bGw9PT0oZj1sLnN0YmwpfHx2b2lkIDA9PT1mP3ZvaWQgMDpmLnN0c3Msdi5leHQuY3R0cz1udWxsPT09KGQ9cy5tZGlhKXx8dm9pZCAwPT09ZHx8bnVsbD09PShoPWQubWluZil8fHZvaWQgMD09PWh8fG51bGw9PT0ocD1oLnN0YmwpfHx2b2lkIDA9PT1wP3ZvaWQgMDpwLmN0dHMsVCYmImVuY3YiPT09VC50eXBlKXYuaXNWaWRlb0VuY3J5cHRpb249ITAsVC5kZWZhdWx0X0tJRD1udWxsPT09KG09VC5zaW5mKXx8dm9pZCAwPT09bXx8bnVsbD09PShnPW0uc2NoaSl8fHZvaWQgMD09PWc/dm9pZCAwOmcudGVuYy5kZWZhdWx0X0tJRCxULmRlZmF1bHRfSXNFbmNyeXB0ZWQ9bnVsbD09PShrPVQuc2luZil8fHZvaWQgMD09PWt8fG51bGw9PT0oYj1rLnNjaGkpfHx2b2lkIDA9PT1iP3ZvaWQgMDpiLnRlbmMuZGVmYXVsdF9Jc0VuY3J5cHRlZCxULmRlZmF1bHRfSVZfc2l6ZT1udWxsPT09KF89VC5zaW5mKXx8dm9pZCAwPT09X3x8bnVsbD09PSh3PV8uc2NoaSl8fHZvaWQgMD09PXc/dm9pZCAwOncudGVuYy5kZWZhdWx0X0lWX3NpemUsdi52aWRlb1NlbmM9cy5tZGlhLm1pbmYuc3RibC5zZW5jJiZzLm1kaWEubWluZi5zdGJsLnNlbmMuc2FtcGxlcyxULmRhdGFfZm9ybWF0PW51bGw9PT0oUz1ULnNpbmYpfHx2b2lkIDA9PT1TfHxudWxsPT09KEQ9Uy5mcm1hKXx8dm9pZCAwPT09RD92b2lkIDA6RC5kYXRhX2Zvcm1hdCx2LnVzZUVNRT1lLnVzZUVNRSx2LmtpZFZhbHVlPWUua2lkVmFsdWUsdi5wc3NoPWUucHNzaCx2LmVuY3Y9VH1pZihvJiZyKXt2YXIgVSxDLFAsSSxNLHosTyxSLEwsVj1yLEY9bnVsbD09PShVPW8udGtoZCl8fHZvaWQgMD09PVU/dm9pZCAwOlUudHJhY2tJZDtudWxsIT1GJiYoVi5pZD1vLnRraGQudHJhY2tJZCksVi50a2hkRHVyYXRpb249by50a2hkLmR1cmF0aW9uLFYubXZoZER1cnRpb249ZS5tdmhkLmR1cmF0aW9uLFYubXZoZFRpbWVjYWxlPWUubXZoZC50aW1lc2NhbGUsVi50aW1lc2NhbGU9Vi5mb3JtYXRUaW1lc2NhbGU9by5tZGlhLm1kaGQudGltZXNjYWxlLFYuZHVyYXRpb249by5tZGlhLm1kaGQuZHVyYXRpb258fFYubXZoZER1cnRpb24vVi5tdmhkVGltZWNhbGUqVi50aW1lc2NhbGU7dmFyIE4saixHLEgsSyxxLFcsWCxZPW8ubWRpYS5taW5mLnN0Ymwuc3RzZC5lbnRyaWVzWzBdO3N3aXRjaChWLnNhbXBsZVNpemU9WS5zYW1wbGVTaXplLFYuc2FtcGxlUmF0ZT1ZLnNhbXBsZVJhdGUsVi5jaGFubmVsQ291bnQ9WS5jaGFubmVsQ291bnQsVi5wcmVzZW50PSEwLFkudHlwZSl7Y2FzZSJhbGF3IjpWLmNvZGVjVHlwZT1WLmNvZGVjPUIsVi5zYW1wbGVSYXRlPThlMzticmVhaztjYXNlInVsYXciOlYuY29kZWNUeXBlPVYuY29kZWM9RSxWLnNhbXBsZVJhdGU9OGUzO2JyZWFrO2RlZmF1bHQ6Vi5zYW1wbGVEdXJhdGlvbj11ZS5nZXRGcmFtZUR1cmF0aW9uKFYuc2FtcGxlUmF0ZSxWLnRpbWVzY2FsZSksVi5zYW1wbGVSYXRlSW5kZXg9dWUuZ2V0UmF0ZUluZGV4QnlSYXRlKFYuc2FtcGxlUmF0ZSksVi5vYmplY3RUeXBlPShudWxsPT09KGE9WS5lc2RzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5vYmplY3RUeXBlKXx8MixZLmVzZHMmJihWLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpKSxWLmNvZGVjPShudWxsPT09KG49WS5lc2RzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5jb2RlYyl8fCJtcDRhLjQwLjIifWlmKFYuc2FtcGxlRHVyYXRpb249dWUuZ2V0RnJhbWVEdXJhdGlvbihWLnNhbXBsZVJhdGUsVi50aW1lc2NhbGUpLFYub2JqZWN0VHlwZT0obnVsbD09PShDPVkuZXNkcyl8fHZvaWQgMD09PUM/dm9pZCAwOkMub2JqZWN0VHlwZSl8fDIsWS5lc2RzJiYoWS5lc2RzLmNvbmZpZz9WLmNvbmZpZz1BcnJheS5mcm9tKFkuZXNkcy5jb25maWcpOmNvbnNvbGUud2FybigiZXNkcyBjb25maWcgaXMgbnVsbCIpKSxWLmNvZGVjPShudWxsPT09KFA9WS5lc2RzKXx8dm9pZCAwPT09UD92b2lkIDA6UC5jb2RlYyl8fCJtcDRhLjQwLjIiLFYuc2FtcGxlUmF0ZUluZGV4PXVlLmdldFJhdGVJbmRleEJ5UmF0ZShWLnNhbXBsZVJhdGUpLFYuZXh0PXt9LFYuZXh0LnN0c3M9bnVsbD09PShJPW8ubWRpYSl8fHZvaWQgMD09PUl8fG51bGw9PT0oTT1JLm1pbmYpfHx2b2lkIDA9PT1NfHxudWxsPT09KHo9TS5zdGJsKXx8dm9pZCAwPT09ej92b2lkIDA6ei5zdHNzLFYuZXh0LmN0dHM9bnVsbD09PShPPW8ubWRpYSl8fHZvaWQgMD09PU98fG51bGw9PT0oUj1PLm1pbmYpfHx2b2lkIDA9PT1SfHxudWxsPT09KEw9Ui5zdGJsKXx8dm9pZCAwPT09TD92b2lkIDA6TC5jdHRzLFYucHJlc2VudD0hMCxZJiYiZW5jYSI9PT1ZLnR5cGUpVi5pc0F1ZGlvRW5jcnlwdGlvbj0hMCxZLmRhdGFfZm9ybWF0PW51bGw9PT0oTj1ZLnNpbmYpfHx2b2lkIDA9PT1OfHxudWxsPT09KGo9Ti5mcm1hKXx8dm9pZCAwPT09aj92b2lkIDA6ai5kYXRhX2Zvcm1hdCxZLmRlZmF1bHRfS0lEPW51bGw9PT0oRz1ZLnNpbmYpfHx2b2lkIDA9PT1HfHxudWxsPT09KEg9Ry5zY2hpKXx8dm9pZCAwPT09SD92b2lkIDA6SC50ZW5jLmRlZmF1bHRfS0lELFkuZGVmYXVsdF9Jc0VuY3J5cHRlZD1udWxsPT09KEs9WS5zaW5mKXx8dm9pZCAwPT09S3x8bnVsbD09PShxPUsuc2NoaSl8fHZvaWQgMD09PXE/dm9pZCAwOnEudGVuYy5kZWZhdWx0X0lzRW5jcnlwdGVkLFkuZGVmYXVsdF9JVl9zaXplPW51bGw9PT0oVz1ZLnNpbmYpfHx2b2lkIDA9PT1XfHxudWxsPT09KFg9Vy5zY2hpKXx8dm9pZCAwPT09WD92b2lkIDA6WC50ZW5jLmRlZmF1bHRfSVZfc2l6ZSxWLmF1ZGlvU2VuYz1vLm1kaWEubWluZi5zdGJsLnNlbmMmJm8ubWRpYS5taW5mLnN0Ymwuc2VuYy5zYW1wbGVzLFYudXNlRU1FPWUudXNlRU1FLFYua2lkVmFsdWU9ZS5raWRWYWx1ZSxWLmVuY2E9WX1pZihyJiYoci5pc1ZpZGVvRW5jcnlwdGlvbj0hIXQmJnQuaXNWaWRlb0VuY3J5cHRpb24pLHQmJih0LmlzQXVkaW9FbmNyeXB0aW9uPSEhciYmci5pc0F1ZGlvRW5jcnlwdGlvbiksbnVsbCE9dCYmdC5lbmN2fHxudWxsIT1yJiZyLmVuY2Epe3ZhciBaLFEsSj1udWxsPT10fHxudWxsPT09KFo9dC5lbmN2KXx8dm9pZCAwPT09Wj92b2lkIDA6Wi5kZWZhdWx0X0tJRCwkPW51bGw9PXJ8fG51bGw9PT0oUT1yLmVuY2EpfHx2b2lkIDA9PT1RP3ZvaWQgMDpRLmRlZmF1bHRfS0lELGVlPUp8fCQ/KEp8fCQpLmpvaW4oIiIpOm51bGw7dCYmKHQua2lkPWVlKSxyJiYoci5raWQ9ZWUpfXJldHVybiB0JiYodC5mbGFncz0zODQxKSxyJiYoci5mbGFncz0xNzkzKSx7dmlkZW9UcmFjazp0LGF1ZGlvVHJhY2s6cn19fX0se2tleToiZXZhbHVhdGVEZWZhdWx0RHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgYSxuPW51bGw9PXR8fG51bGw9PT0oYT10LnNhbXBsZXMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLmxlbmd0aDtyZXR1cm4gbj8xMDI0Km4vdC50aW1lc2NhbGUqZS50aW1lc2NhbGUvcjoxMDI0fX0se2tleToibW9vZlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24odCxyLGEpe3ZhciBuPXt9O3JldHVybiB0Lm1maGQmJihyJiYoci5zZXF1ZW5jZU51bWJlcj10Lm1maGQuc2VxdWVuY2VOdW1iZXIpLGEmJihhLnNlcXVlbmNlTnVtYmVyPXQubWZoZC5zZXF1ZW5jZU51bWJlcikpLHQudHJhZi5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgaT10LnRmaGQscz10LnRmZHQsbz10LnRydW47aWYoaSYmbyl7cyYmKHImJnIuaWQ9PT1pLnRyYWNrSWQmJihyLmJhc2VNZWRpYURlY29kZVRpbWU9cy5iYXNlTWVkaWFEZWNvZGVUaW1lKSxhJiZhLmlkPT09aS50cmFja0lkJiYoYS5iYXNlTWVkaWFEZWNvZGVUaW1lPXMuYmFzZU1lZGlhRGVjb2RlVGltZSkpO3ZhciB1PWkuZGVmYXVsdFNhbXBsZVNpemV8fDAsYz1pLmRlZmF1bHRTYW1wbGVEdXJhdGlvbnx8ZS5ldmFsdWF0ZURlZmF1bHREdXJhdGlvbihyLGEsby5zYW1wbGVzLmxlbmd0aHx8by5zYW1wbGVDb3VudCksbD1vLmRhdGFPZmZzZXR8fDAsZj0wLGQ9LTE7aWYoIW8uc2FtcGxlcy5sZW5ndGgmJm8uc2FtcGxlQ291bnQpe25baS50cmFja0lkXT1bXTtmb3IodmFyIGg9MDtoPG8uc2FtcGxlQ291bnQ7aCsrKW5baS50cmFja0lkXS5wdXNoKHtvZmZzZXQ6bCxkdHM6ZixkdXJhdGlvbjpjLHNpemU6dX0pLGYrPWMsbCs9dX1lbHNlIG5baS50cmFja0lkXT1vLnNhbXBsZXMubWFwKChmdW5jdGlvbihlLHQpe3JldHVybihlPXtvZmZzZXQ6bCxkdHM6ZixwdHM6ZisoZS5jdHN8fDApLGR1cmF0aW9uOmUuZHVyYXRpb258fGMsc2l6ZTplLnNpemV8fHUsZ29wSWQ6ZCxrZXlmcmFtZTowPT09dHx8bnVsbCE9PWUuZmxhZ3MmJnZvaWQgMCE9PWUuZmxhZ3MmJig2NTUzNiZlLmZsYWdzKT4+PjAhPTY1NTM2fSkua2V5ZnJhbWUmJihkKyssZS5nb3BJZD1kKSxmKz1lLmR1cmF0aW9uLGwrPWUuc2l6ZSxlfSkpfX0pKSxufX0se2tleToibW9vdlRvU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50cmFrO2lmKHQmJnQubGVuZ3RoKXt2YXIgcj10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInZpZGUiPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSksYT10LmZpbmQoKGZ1bmN0aW9uKGUpe3ZhciB0LHI7cmV0dXJuInNvdW4iPT09KG51bGw9PT0odD1lLm1kaWEpfHx2b2lkIDA9PT10fHxudWxsPT09KHI9dC5oZGxyKXx8dm9pZCAwPT09cj92b2lkIDA6ci5oYW5kbGVyVHlwZSl9KSk7aWYocnx8YSl7dmFyIG4saTtpZihyKXt2YXIgcyxvLHU9bnVsbD09PShzPXIubWRpYSl8fHZvaWQgMD09PXN8fG51bGw9PT0obz1zLm1pbmYpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLnN0Ymw7aWYoIXUpcmV0dXJuO3ZhciBjPXUuc3R0cyxsPXUuc3RzYyxmPXUuc3RzeixkPXUuc3RjbyxoPXUuc3RzcyxwPXUuY3R0cztpZighKGMmJmwmJmYmJmQmJmgpKXJldHVybjtuPWtlKGMsbCxmLGQscCxoKX1pZihhKXt2YXIgdix5LG0sZz1udWxsPT09KHY9YS5tZGlhKXx8dm9pZCAwPT09dnx8bnVsbD09PSh5PXYubWluZil8fHZvaWQgMD09PXk/dm9pZCAwOnkuc3RibDtpZighZylyZXR1cm47dmFyIGs9bnVsbD09PShtPWEubWRpYS5tZGhkKXx8dm9pZCAwPT09bT92b2lkIDA6bS50aW1lc2NhbGUsYj1nLnN0dHMsXz1nLnN0c2Msdz1nLnN0c3oseD1nLnN0Y287aWYoIShrJiZiJiZfJiZ3JiZ4KSlyZXR1cm47aT1rZShiLF8sdyx4KX1yZXR1cm57dmlkZW9TYW1wbGVzOm4sYXVkaW9TYW1wbGVzOml9fX19fV0pLGV9KCk7ZnVuY3Rpb24ga2UoZSx0LHIsYSxuLGkpe3ZhciBzLG8sdSxjPVtdLGw9bnVsbD09bj92b2lkIDA6bi5lbnRyaWVzLGY9dC5lbnRyaWVzLGQ9YS5lbnRyaWVzLGg9ci5lbnRyeVNpemVzLHA9bnVsbD09aT92b2lkIDA6aS5lbnRyaWVzO3AmJihzPXt9LHAuZm9yRWFjaCgoZnVuY3Rpb24oZSl7c1tlLTFdPSEwfSkpKSxsJiYobz1bXSxsLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LHI9ZS5vZmZzZXQsYT0wO2E8dDthKyspby5wdXNoKHIpfSkpKTt2YXIgdj0tMSx5PTAsbT0wLGc9MCxrPTAsYj0wLF89ZlswXS5zYW1wbGVzUGVyQ2h1bmssdz1mWzFdP2ZbMV0uZmlyc3RDaHVuay0xOjEvMDtyZXR1cm4gZS5lbnRyaWVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNvdW50LGE9ZS5kZWx0YSxuPTA7bjx0O24rKyl1PXtkdHM6eSxkdXJhdGlvbjphLHNpemU6aFttXXx8ci5zYW1wbGVTaXplLG9mZnNldDpkW2ddK2IsaW5kZXg6bX0scCYmKHUua2V5ZnJhbWU9c1ttXSx1LmtleWZyYW1lJiZ2KyssdS5nb3BJZD12KSxvJiZtPG8ubGVuZ3RoJiYodS5wdHM9dS5kdHMrb1ttXSksYy5wdXNoKHUpLHkrPWEsKyttPF8/Yis9dS5zaXplOihnKyssYj0wLGc+PXcmJihrKyssdz1mW2srMV0/ZltrKzFdLmZpcnN0Q2h1bmstMToxLzApLF8rPWZba10uc2FtcGxlc1BlckNodW5rKX0pKSxjfWZ1bmN0aW9uIGJlKGUsdCl7cmV0dXJuIGUuZGF0YVJlZmVyZW5jZUluZGV4PSQodCw2KSxlLndpZHRoPSQodCwyNCksZS5oZWlnaHQ9JCh0LDI2KSxlLmhvcml6cmVzb2x1dGlvbj1lZSh0LDI4KSxlLnZlcnRyZXNvbHV0aW9uPWVlKHQsMzIpLGUuZnJhbWVDb3VudD0kKHQsNDApLGUuZGVwdGg9JCh0LDc0KSw3OH1mdW5jdGlvbiBfZShlLHQpe3JldHVybiBlLmRhdGFSZWZlcmVuY2VJbmRleD0kKHQsNiksZS5jaGFubmVsQ291bnQ9JCh0LDE2KSxlLnNhbXBsZVNpemU9JCh0LDE4KSxlLnNhbXBsZVJhdGU9ZWUodCwyNCkvNjU1MzYsMjh9ZnVuY3Rpb24gd2UoZSx0LHIpe2lmKGUpe2lmKGUuc2l6ZSE9PWUuZGF0YS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJib3ggIi5jb25jYXQoZS50eXBlLCIgc2l6ZSAhPT0gZGF0YS5sZW5ndGgiKSk7dmFyIGE9e3N0YXJ0OmUuc3RhcnQsc2l6ZTplLnNpemUsaGVhZGVyU2l6ZTplLmhlYWRlclNpemUsdHlwZTplLnR5cGV9O3JldHVybiB0JiYoYS52ZXJzaW9uPWUuZGF0YVtlLmhlYWRlclNpemVdLGEuZmxhZ3M9ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKGVbdF08PDE2KSsoZVt0KzFdPDw4KSsoZVt0KzJdfHwwKX0oZS5kYXRhLGUuaGVhZGVyU2l6ZSsxKSxhLmhlYWRlclNpemUrPTQpLHIoYSxlLmRhdGEuc3ViYXJyYXkoYS5oZWFkZXJTaXplKSxhLnN0YXJ0K2EuaGVhZGVyU2l6ZSksYX19dmFyIHhlPWZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIGE9U3RyaW5nKHIpLG49dD4+MCxpPU1hdGguY2VpbChuL2EubGVuZ3RoKSxzPVtdLG89U3RyaW5nKGUpO2ktLTspcy5wdXNoKGEpO3JldHVybiBzLmpvaW4oIiIpLnN1YnN0cmluZygwLG4tby5sZW5ndGgpK299LFNlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPVtdLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxhPTA7YTx0O2ErKylyW2FdPWFyZ3VtZW50c1thXTtyZXR1cm4gci5mb3JFYWNoKChmdW5jdGlvbih0KXtlLnB1c2goeGUoTnVtYmVyKHQpLnRvU3RyaW5nKDE2KSwyLDApKX0pKSxlWzBdfTtmdW5jdGlvbiBBZShlKXtmb3IodmFyIHQ9MCxyPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkocj4xP3ItMTowKSxuPTE7bjxyO24rKylhW24tMV09YXJndW1lbnRzW25dO2EuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dCs9ZS5sZW5ndGh9KSk7dmFyIGk9bmV3IGUodCkscz0wO3JldHVybiBhLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kuc2V0KGUscykscys9ZS5sZW5ndGh9KSksaX12YXIgRGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpLHRoaXMuYnVmZmVyPW5ldyBVaW50OEFycmF5KDApfXJldHVybiBuKGUsW3trZXk6IndyaXRlIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxhPTA7YTx0O2ErKylyW2FdPWFyZ3VtZW50c1thXTtyLmZvckVhY2goKGZ1bmN0aW9uKHQpe3Q/ZS5idWZmZXI9QWUoVWludDhBcnJheSxlLmJ1ZmZlcix0KTp3aW5kb3cuY29uc29sZS53YXJuKHQpfSkpfX1dLFt7a2V5OiJ3cml0ZVVpbnQxNiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlPj44JjI1NSwyNTUmZV0pfX0se2tleToid3JpdGVVaW50MzIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgVWludDhBcnJheShbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSl9fV0pLGV9KCksQmU9TWF0aC5wb3coMiwzMiktMSxFZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtyKHRoaXMsZSl9cmV0dXJuIG4oZSxudWxsLFt7a2V5OiJib3giLHZhbHVlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQ+MT90LTE6MCksYT0xO2E8dDthKyspclthLTFdPWFyZ3VtZW50c1thXTt2YXIgbj04KyhyPXIuZmlsdGVyKEJvb2xlYW4pKS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCksaT1uZXcgVWludDhBcnJheShuKTtpWzBdPW4+PjI0JjI1NSxpWzFdPW4+PjE2JjI1NSxpWzJdPW4+PjgmMjU1LGlbM109MjU1Jm4saS5zZXQoZSw0KTt2YXIgcz04O3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kuc2V0KGUscykscys9ZS5ieXRlTGVuZ3RofSkpLGl9fSx7a2V5OiJmdHlwIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5maW5kKChmdW5jdGlvbihlKXtyZXR1cm4gZS50eXBlPT09YiYmZS5jb2RlY1R5cGU9PT1BfSkpP2UuRlRZUEhFVjE6ZS5GVFlQQVZDMX19LHtrZXk6ImluaXRTZWdtZW50Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gUShlLmZ0eXAodCksZS5tb292KHQpKX19LHtrZXk6InBzc2giLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFsxLDAsMCwwXS5jb25jYXQoWzE2LDExOSwyMzksMjM2LDE5MiwxNzgsNzcsMiwxNzIsMjI3LDYwLDMwLDgyLDIyNiwyNTEsNzVdLFswLDAsMCwxXSxuZSh0LmtpZCksWzAsMCwwLDBdKSk7cmV0dXJuIGUuYm94KGUudHlwZXMucHNzaCxyKX19LHtrZXk6Im1vb3YiLHZhbHVlOmZ1bmN0aW9uKHQpe2lmKHRbMF0udXNlRU1FJiYodFswXS5lbmN2fHx0WzBdLmVuY2EpKXt0WzBdLnBzc2h8fCh0WzBdLnBzc2g9e2tpZDp0WzBdLmtpZH0pO3ZhciByPXRoaXMucHNzaCh0WzBdLnBzc2gpO3JldHVybiBlLmJveC5hcHBseShlLFtlLnR5cGVzLm1vb3YsZS5tdmhkKHRbMF0ubXZoZER1cnRpb258fHRbMF0uZHVyYXRpb24sdFswXS5tdmhkVGltZWNhbGV8fHRbMF0udGltZXNjYWxlKSxlLm12ZXgodCldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpKSxbcl0pKX1yZXR1cm4gZS5ib3guYXBwbHkoZSxbZS50eXBlcy5tb292LGUubXZoZCh0WzBdLm12aGREdXJ0aW9ufHx0WzBdLmR1cmF0aW9uLHRbMF0ubXZoZFRpbWVjYWxlfHx0WzBdLnRpbWVzY2FsZSldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFrKHQpfSkpKSxbZS5tdmV4KHQpXSkpfX0se2tleToibXZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjllNCxhPWUuYm94KGUudHlwZXMubXZoZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcix0Pj4yNCYyNTUsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMSwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDY0LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI1NSwyNTUsMjU1LDI1NV0pKTtyZXR1cm4gYX19LHtrZXk6InRyYWsiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLnRyYWssZS50a2hkKHQuaWQsdC50a2hkRHVyYXRpb258fDAsdC53aWR0aCx0LmhlaWdodCksZS5tZGlhKHQpKX19LHtrZXk6InRraGQiLHZhbHVlOmZ1bmN0aW9uKHQscil7dmFyIGE9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOjAsbj1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106MCxpPWUuYm94KGUudHlwZXMudGtoZCxuZXcgVWludDhBcnJheShbMCwwLDAsNywwLDAsMCwwLDAsMCwwLDAsdD4+MjQmMjU1LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCwwLDAsMCwwLHI+PjI0JjI1NSxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsYT4+OCYyNTUsMjU1JmEsMCwwLG4+PjgmMjU1LDI1NSZuLDAsMF0pKTtyZXR1cm4gaX19LHtrZXk6Im1kaWEiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1kaWEsZS5tZGhkKHQuZHVyYXRpb24sdC50aW1lc2NhbGUpLGUuaGRscih0LnR5cGUpLGUubWluZih0KSl9fSx7a2V5OiJtZGhkIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06OWU0LGE9ZS5ib3goZS50eXBlcy5tZGhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLHQ+PjI0JjI1NSx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsODUsMTk2LDAsMF0pKTtyZXR1cm4gYX19LHtrZXk6ImhkbHIiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLmhkbHIsZS5IRExSX1RZUEVTW3RdKX19LHtrZXk6Im1pbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1pbmYsdC50eXBlPT09Yj9lLlZNSEQ6ZS5TTUhELGUuRElORixlLnN0YmwodCkpfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9W107cmV0dXJuIHQmJnQuZXh0JiZ0LmV4dC5zdHNzJiZyLnB1c2goZS5zdHNzKHQuZXh0LnN0c3MuZW50cmllcykpLGUuYm94KGUudHlwZXMuc3RibCxlLnN0c2QodCksZS5TVFRTLHJbMF0sZS5TVFNDLGUuU1RTWixlLlNUQ08pfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI7cmV0dXJuIHI9ImF1ZGlvIj09PXQudHlwZT90LnVzZUVNRSYmdC5lbmNhP2UuZW5jYSh0KTplLm1wNGEodCk6dC51c2VFTUUmJnQuZW5jdj9lLmVuY3YodCk6dC5hdjFDP2UuYXYwMSh0KTplLmF2YzFoZXYxKHQpLGUuYm94KGUudHlwZXMuc3RzZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxXSkscil9fSx7a2V5OiJlbmNhIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10LmVuY2EuY2hhbm5lbENvdW50LGE9dC5lbmNhLnNhbXBsZVJhdGUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLHIsMCwxNiwwLDAsMCwwLGE+PjgmMjU1LDI1NSZhLDAsMF0pLGk9ZS5lc2RzKHQuY29uZmlnKSxzPWUuc2luZih0LmVuY2EpO3JldHVybiBlLmJveChlLnR5cGVzLmVuY2EsbixpLHMpfX0se2tleToiZW5jdiIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHIsYSxuPXQuc3BzLmxlbmd0aD4wP3Quc3BzWzBdOltdLGk9dC5wcHMubGVuZ3RoPjA/dC5wcHNbMF06W10scz10LndpZHRoLG89dC5oZWlnaHQsdT10LnNhclJhdGlvWzBdLGM9dC5zYXJSYXRpb1sxXSxsPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxzPj44JjI1NSwyNTUmcyxvPj44JjI1NSwyNTUmbywwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwxOCwxMDAsOTcsMTA1LDEwOCwxMjEsMTA5LDExMSwxMTYsMTA1LDExMSwxMTAsNDcsMTA0LDEwOCwxMTUsNDYsMTA2LDExNSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjQsMTcsMTddKSxmPW5ldyBVaW50OEFycmF5KChyPShhPVsxLG5bMV0sblsyXSxuWzNdLDI1NSwyMjUsbi5sZW5ndGg+Pj44JjI1NSwyNTUmbi5sZW5ndGhdKS5jb25jYXQuYXBwbHkoYSx5KG4pKS5jb25jYXQoWzEsaS5sZW5ndGg+Pj44JjI1NSwyNTUmaS5sZW5ndGhdKSkuY29uY2F0LmFwcGx5KHIseShpKSkpLGQ9bmV3IFVpbnQ4QXJyYXkoWzAsMCw4OCw1NywwLDE1LDIwMCwxOTIsMCw0LDg2LDcyXSksaD1lLnNpbmYodC5lbmN2KSxwPW5ldyBVaW50OEFycmF5KFt1Pj4yNCx1Pj4xNiYyNTUsdT4+OCYyNTUsMjU1JnUsYz4+MjQsYz4+MTYmMjU1LGM+PjgmMjU1LDI1NSZjXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuZW5jdixsLGUuYm94KGUudHlwZXMuYXZjQyxmKSxlLmJveChlLnR5cGVzLmJ0cnQsZCksaCxlLmJveChlLnR5cGVzLnBhc3AscCkpfX0se2tleToic2NoaSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoW10pLGE9ZS50ZW5jKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnNjaGkscixhKX19LHtrZXk6InRlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwyNTUmdC5kZWZhdWx0X0lzRW5jcnlwdGVkLDI1NSZ0LmRlZmF1bHRfSVZfc2l6ZV0uY29uY2F0KG5lKHQuZGVmYXVsdF9LSUQpKSk7cmV0dXJuIGUuYm94KGUudHlwZXMudGVuYyxyKX19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBVaW50OEFycmF5KFtdKSxhPW5ldyBVaW50OEFycmF5KFt0LmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMCksdC5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDEpLHQuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgyKSx0LmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMyldKSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDk5LDEwMSwxMTAsOTksMCwxLDAsMF0pLGk9ZS5zY2hpKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnNpbmYscixlLmJveChlLnR5cGVzLmZybWEsYSksZS5ib3goZS50eXBlcy5zY2htLG4pLGkpfX0se2tleToiYXYwMSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMuYXYwMSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsdC53aWR0aD4+OCYyNTUsMjU1JnQud2lkdGgsdC5oZWlnaHQ+PjgmMjU1LDI1NSZ0LmhlaWdodCwwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLHQuYXYxQyx0LmNvbHIpfX0se2tleToiYXZjMWhldjEiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuY29kZWNUeXBlPT09QSxhPXI/ZS50eXBlcy5odmMxOmUudHlwZXMuYXZjMSxuPXI/ZS5odmNDKHQpOmUuYXZjQyh0KSxpPVtuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsdC53aWR0aD4+OCYyNTUsMjU1JnQud2lkdGgsdC5oZWlnaHQ+PjgmMjU1LDI1NSZ0LmhlaWdodCwwLDcyLDAsMCwwLDcyLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLG5dO3JldHVybiByP2kucHVzaChlLmJveChlLnR5cGVzLmZpZWwsbmV3IFVpbnQ4QXJyYXkoWzEsMF0pKSk6dC5zYXJSYXRpbyYmdC5zYXJSYXRpby5sZW5ndGg+MSYmaS5wdXNoKGUucGFzcCh0LnNhclJhdGlvKSksZS5ib3guYXBwbHkoZSxbYV0uY29uY2F0KGkpKX19LHtrZXk6ImF2Y0MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByLGEsbixpPVtdLHM9W107cmV0dXJuIHQuc3BzLmZvckVhY2goKGZ1bmN0aW9uKGUpe249ZS5ieXRlTGVuZ3RoLGkucHVzaChuPj4+OCYyNTUpLGkucHVzaCgyNTUmbiksaS5wdXNoLmFwcGx5KGkseShlKSl9KSksdC5wcHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bj1lLmJ5dGVMZW5ndGgscy5wdXNoKG4+Pj44JjI1NSkscy5wdXNoKDI1NSZuKSxzLnB1c2guYXBwbHkocyx5KGUpKX0pKSxlLmJveChlLnR5cGVzLmF2Y0MsbmV3IFVpbnQ4QXJyYXkoKHI9KGE9WzEsaVszXSxpWzRdLGlbNV0sMjU1LDIyNHx0LnNwcy5sZW5ndGhdKS5jb25jYXQuYXBwbHkoYSxpKS5jb25jYXQoW3QucHBzLmxlbmd0aF0pKS5jb25jYXQuYXBwbHkocixzKSkpfX0se2tleToiaHZjQyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5odmNDO2lmKHIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcnx8ciBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpcmV0dXJuIHI7dmFyIGEsbj10LnZwcyxpPXQuc3BzLHM9dC5wcHM7aWYocil7dmFyIG89ci5nZW5lcmFsUHJvZmlsZUNvbXBhdGliaWxpdHlGbGFncyx1PXIuZ2VuZXJhbENvbnN0cmFpbnRJbmRpY2F0b3JGbGFncyxjPShuLmxlbmd0aCYmMSkrKGkubGVuZ3RoJiYxKSsocy5sZW5ndGgmJjEpO2E9WzEsci5nZW5lcmFsUHJvZmlsZVNwYWNlPDw2fHIuZ2VuZXJhbFRpZXJGbGFnPDw1fHIuZ2VuZXJhbFByb2ZpbGVJZGMsbz4+PjI0LG8+Pj4xNixvPj4+OCxvLHVbMF0sdVsxXSx1WzJdLHVbM10sdVs0XSx1WzVdLHIuZ2VuZXJhbExldmVsSWRjLDI0MCwwLDI1MiwyNTJ8ci5jaHJvbWFGb3JtYXRJZGMsMjQ4fHIuYml0RGVwdGhMdW1hTWludXM4LDI0OHxyLmJpdERlcHRoQ2hyb21hTWludXM4LDAsMCxyLm51bVRlbXBvcmFsTGF5ZXJzPDwzfHIudGVtcG9yYWxJZE5lc3RlZDw8MnwzLGNdO3ZhciBsPWZ1bmN0aW9uKGUpe3ZhciB0O2EucHVzaChlLmxlbmd0aD4+OCxlLmxlbmd0aCksKHQ9YSkucHVzaC5hcHBseSh0LHkoZSkpfTtuLmxlbmd0aCYmKGEucHVzaCgxNjAsMCxuLmxlbmd0aCksbi5mb3JFYWNoKGwpKSxpLmxlbmd0aCYmKGEucHVzaCgxNjEsMCxpLmxlbmd0aCksaS5mb3JFYWNoKGwpKSxzLmxlbmd0aCYmKGEucHVzaCgxNjIsMCxzLmxlbmd0aCkscy5mb3JFYWNoKGwpKX1lbHNlIGE9WzEsMSw5NiwwLDAsMCwxNDQsMCwwLDAsMCwwLDkzLDI0MCwwLDI1MiwyNTMsMjQ4LDI0OCwwLDAsMTUsMywxNjAsMCwxLDAsMjQsNjQsMSwxMiwxLDI1NSwyNTUsMSw5NiwwLDAsMywwLDE0NCwwLDAsMywwLDAsMywwLDkzLDE1MywxNTIsOSwxNjEsMCwxLDAsNDUsNjYsMSwxLDEsOTYsMCwwLDMsMCwxNDQsMCwwLDMsMCwwLDMsMCw5MywxNjAsMiwxMjgsMTI4LDQ1LDIyLDg5LDE1MywxNjQsMTQ3LDQzLDE1NCwxMjgsMTI4LDEyOCwxMzAsMCwwLDMsMCwyLDAsMCwzLDAsNTAsMTYsMTYyLDAsMSwwLDcsNjgsMSwxOTMsMTE0LDE4MCw5OCw2NF07cmV0dXJuIGUuYm94KGUudHlwZXMuaHZjQyxuZXcgVWludDhBcnJheShhKSl9fSx7a2V5OiJwYXNwIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj12KHQsMiksYT1yWzBdLG49clsxXTtyZXR1cm4gZS5ib3goZS50eXBlcy5wYXNwLG5ldyBVaW50OEFycmF5KFthPj4yNCxhPj4xNiYyNTUsYT4+OCYyNTUsMjU1JmEsbj4+MjQsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuXSkpfX0se2tleToibXA0YSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMubXA0YSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLHQuY2hhbm5lbENvdW50LDAsMTYsMCwwLDAsMCx0LnNhbXBsZVJhdGU+PjgmMjU1LDI1NSZ0LnNhbXBsZVJhdGUsMCwwXSksdC5jb25maWcubGVuZ3RoP2UuZXNkcyh0LmNvbmZpZyk6dm9pZCAwKX19LHtrZXk6ImVzZHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoO3JldHVybiBlLmJveChlLnR5cGVzLmVzZHMsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMywyMytyLDAsMCwwLDQsMTUrciw2NCwyMSwwLDYsMCwwLDAsMjE4LDE5MiwwLDAsMjE4LDE5Miw1XS5jb25jYXQoW3JdKS5jb25jYXQodCkuY29uY2F0KFs2LDEsMl0pKSl9fSx7a2V5OiJtdmV4Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3guYXBwbHkoZSxbZS50eXBlcy5tdmV4XS5jb25jYXQoeSh0Lm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIGUudHJleCh0LmlkKX0pKSkpKX19LHtrZXk6InRyZXgiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLnRyZXgsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0LDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDFdKSl9fSx7a2V5OiJ0cmV4MSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudHJleCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnQsMCwwLDAsMSwwLDAsMiwwLDAsMCwwLDAsMCwxLDAsMF0pKX19LHtrZXk6InRyZXgyIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmV4LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCwwLDAsMCwxLDAsMCw0LDAsMCwwLDAsMCwyLDAsMCwwXSkpfX0se2tleToibW9vZiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vZixlLm1maGQodFswXS5zYW1wbGVzP3RbMF0uc2FtcGxlc1swXS5nb3BJZDowKV0uY29uY2F0KHkodC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYWYodCl9KSkpKSl9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZmhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHQ+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pKX19LHtrZXk6InRyYWYiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPWUudGZoZCh0LmlkKSxhPWUudGZkdCh0LHQuYmFzZU1lZGlhRGVjb2RlVGltZSksbj0wO2lmKHQuaXNWaWRlbyYmdC52aWRlb1NlbmMmJnQudmlkZW9TZW5jLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPTgsZS5zdWJzYW1wbGVzJiZlLnN1YnNhbXBsZXMubGVuZ3RoJiYobis9MixuKz02KmUuc3Vic2FtcGxlcy5sZW5ndGgpfSkpLHQudmlkZW9TZW5jTGVuZ3RoPW4sdC51c2VFTUUmJih0LmlzVmlkZW9FbmNyeXB0aW9ufHx0LmlzQXVkaW9FbmNyeXB0aW9uKSl7aWYodC5pc1ZpZGVvRW5jcnlwdGlvbil7aWYodC5pc1ZpZGVvKXt2YXIgaT1lLnNhaXoodCkscz1lLnNhaW8odCksbz1lLnRydW4xKHQpLHU9ZS5zZW5jKHQpO3JldHVybiBlLmJveChlLnR5cGVzLnRyYWYscixhLGkscyxvLHUpfWlmKHQuaXNBdWRpb0VuY3J5cHRpb24pe3ZhciBjPWUuc2JncCgpLGw9ZS5zYWl6KHQpLGY9ZS5zYWlvKHQpLGQ9ZS5zZW5jKHQpLGg9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxjLGwsZixkLGgpfXZhciBwPWUuc2JncCgpLHY9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSxwLHYpfWlmKHQuaXNWaWRlbyl7dmFyIHk9ZS50cnVuMSh0KTtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFmLHIsYSx5KX12YXIgbT1lLnNiZ3AoKSxnPWUuc2Fpeih0KSxrPWUuc2Fpbyh0KSxiPWUuc2VuYyh0KSxfPWUudHJ1bjEodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsbSxnLGssYixfKX12YXIgdz1lLnNkdHAodCk7cmV0dXJuIGUuYm94KGUudHlwZXMudHJhZixyLGEsdyxlLnRydW4odC5zYW1wbGVzLHcuYnl0ZUxlbmd0aCs3NikpfX0se2tleToic2R0cCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IERlO3JldHVybiB0LnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShuZXcgVWludDhBcnJheSh0LmlzVmlkZW8/W2Uua2V5ZnJhbWU/MzI6MTZdOlsxNl0pKX0pKSxlLmJveChlLnR5cGVzLnNkdHAsdGhpcy5leHRlbnNpb24oMCwwKSxyLmJ1ZmZlcil9fSx7a2V5OiJ0cnVuMSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9bmV3IERlLGE9RGUud3JpdGVVaW50MzIodC5zYW1wbGVzLmxlbmd0aCksbj1udWxsO2lmKHQuaXNWaWRlbyl7dmFyIGk9dC52aWRlb1NlbmNMZW5ndGg7bj1EZS53cml0ZVVpbnQzMigxNip0LnNhbXBsZXMubGVuZ3RoK2krMTQ5KSwhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG49RGUud3JpdGVVaW50MzIoMTYqdC5zYW1wbGVzLmxlbmd0aCs5MikpfWVsc2V7dmFyIHM9MTIqdC5zYW1wbGVzLmxlbmd0aCsxMjQ7dC5pc0F1ZGlvRW5jcnlwdGlvbiYmKHM9MTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCsxNzcpLG49RGUud3JpdGVVaW50MzIocyl9cmV0dXJuIHQuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtyLndyaXRlKERlLndyaXRlVWludDMyKGUuZHVyYXRpb24pKSxyLndyaXRlKERlLndyaXRlVWludDMyKGUuc2l6ZSkpLHIud3JpdGUoRGUud3JpdGVVaW50MzIoZS5rZXlmcmFtZT8zMzU1NDQzMjo2NTUzNikpLHQuaXNWaWRlbyYmci53cml0ZShEZS53cml0ZVVpbnQzMihlLmN0cz9lLmN0czowKSl9KSksZS5ib3goZS50eXBlcy50cnVuLHRoaXMuZXh0ZW5zaW9uKDAsdC5mbGFncyksYSxuLHIuYnVmZmVyKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPW5ldyBEZSxhPXQuc2FtcGxlcy5sZW5ndGgsbj10LmlzVmlkZW8/MTY6OCxpPXQuaXNWaWRlbz8yOjAscz1bXSxvPTA7cmV0dXJuIHQuaXNWaWRlbz8ocz10LnZpZGVvU2VuYyxvPXQudmlkZW9TZW5jTGVuZ3RoKTpzPXQuYXVkaW9TZW5jLG89b3x8biphLHIud3JpdGUoRGUud3JpdGVVaW50MzIoMTYrbyksZS50eXBlcy5zZW5jLHRoaXMuZXh0ZW5zaW9uKDAsaSkpLHIud3JpdGUoRGUud3JpdGVVaW50MzIoYSkpLHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTA7dDxlLkluaXRpYWxpemF0aW9uVmVjdG9yLmxlbmd0aDt0Kyspci53cml0ZShuZXcgVWludDhBcnJheShbZS5Jbml0aWFsaXphdGlvblZlY3Rvclt0XV0pKTtlLnN1YnNhbXBsZXMmJmUuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKERlLndyaXRlVWludDE2KGUuc3Vic2FtcGxlcy5sZW5ndGgpKSxlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShEZS53cml0ZVVpbnQxNihlLkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKERlLndyaXRlVWludDMyKGUuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj0xMip0LnNhbXBsZXMubGVuZ3RoKzE0MTshdC5pc1ZpZGVvJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYocj0xNDkpO3ZhciBhPW5ldyBVaW50OEFycmF5KFsxLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpbyxhKX19LHtrZXk6InNhaXoiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuc2FtcGxlcy5sZW5ndGgsYT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxNixyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSk7cmV0dXJuIGUuYm94KGUudHlwZXMuc2FpeixhKX19LHtrZXk6InNiZ3AiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoWzExNCwxMTEsMTA4LDEwOCwwLDAsMCwxLDAsMCwxLDI1LDAsMCwwLDFdKTtyZXR1cm4gZS5ib3goZS50eXBlcy5zYmdwLHRoaXMuZXh0ZW5zaW9uKDAsMCksdCl9fSx7a2V5OiJleHRlbnNpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlLHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0pfX0se2tleToidGZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94KGUudHlwZXMudGZoZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCx0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdKSl9fSx7a2V5OiJ0ZmR0Iix2YWx1ZTpmdW5jdGlvbih0LHIpe3ZhciBhPU1hdGguZmxvb3Ioci8oQmUrMSkpLG49TWF0aC5mbG9vcihyJShCZSsxKSk7cmV0dXJuIHQudXNlRU1FJiYodC5pc1ZpZGVvRW5jcnlwdGlvbnx8dC5pc0F1ZGlvRW5jcnlwdGlvbik/ZS5ib3goZS50eXBlcy50ZmR0LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKTplLmJveChlLnR5cGVzLnRmZHQsbmV3IFVpbnQ4QXJyYXkoWzEsMCwwLDAsYT4+MjQsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pKX19LHtrZXk6InRydW4iLHZhbHVlOmZ1bmN0aW9uKHQscil7dmFyIGE9dC5sZW5ndGgsbj0xMisxNiphO3IrPTgrbjt2YXIgaT1uZXcgVWludDhBcnJheShuKTtpLnNldChbMCwwLDE1LDEsYT4+PjI0JjI1NSxhPj4+MTYmMjU1LGE+Pj44JjI1NSwyNTUmYSxyPj4+MjQmMjU1LHI+Pj4xNiYyNTUscj4+PjgmMjU1LDI1NSZyXSwwKTtmb3IodmFyIHM9MDtzPGE7cysrKXt2YXIgbz10W3NdLHU9by5kdXJhdGlvbixjPW8uc2l6ZSxsPW8uZmxhZyxmPXZvaWQgMD09PWw/e306bCxkPW8uY3RzLGg9dm9pZCAwPT09ZD8wOmQ7aS5zZXQoW3U+Pj4yNCYyNTUsdT4+PjE2JjI1NSx1Pj4+OCYyNTUsMjU1JnUsYz4+PjI0JjI1NSxjPj4+MTYmMjU1LGM+Pj44JjI1NSwyNTUmYyxmLmlzTGVhZGluZzw8MnwobnVsbD09PWYuZGVwZW5kc09ufHx2b2lkIDA9PT1mLmRlcGVuZHNPbj8xOmYuZGVwZW5kc09uKSxmLmlzRGVwZW5kZWRPbjw8NnxmLmhhc1JlZHVuZGFuY3k8PDR8Zi5wYWRkaW5nVmFsdWU8PDF8KG51bGw9PT1mLmlzTm9uU3luY1NhbXBsZXx8dm9pZCAwPT09Zi5pc05vblN5bmNTYW1wbGU/MTpmLmlzTm9uU3luY1NhbXBsZSksNjE0NDAmZi5kZWdyYWRhdGlvblByaW9yaXR5LDE1JmYuZGVncmFkYXRpb25Qcmlvcml0eSxoPj4+MjQmMjU1LGg+Pj4xNiYyNTUsaD4+PjgmMjU1LDI1NSZoXSwxMisxNipzKX1yZXR1cm4gZS5ib3goZS50eXBlcy50cnVuLGkpfX0se2tleToibW9vdk1QNCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGUuYm94LmFwcGx5KGUsW2UudHlwZXMubW9vdixlLm12aGQodFswXS5kdXJhdGlvbix0WzBdLnRpbWVzY2FsZSldLmNvbmNhdCh5KHQubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gZS50cmFja01QNCh0KX0pKSkpKX19LHtrZXk6InRyYWNrTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy50cmFrLGUudGtoZCh0LmlkLHQuZHVyYXRpb24sdC53aWR0aCx0LmhlaWdodCksZS5tZGlhTVA0KHQpKX19LHtrZXk6Im1kaWFNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmJveChlLnR5cGVzLm1kaWEsZS5tZGhkKHQuZHVyYXRpb24sdC50aW1lc2NhbGUpLGUuaGRscih0LnR5cGUpLGUubWluZk1QNCh0KSl9fSx7a2V5OiJtaW5mTVA0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5taW5mLHQudHlwZT09PWI/ZS5WTUhEOmUuU01IRCxlLkRJTkYsZS5zdGJsTVA0KHQpKX19LHtrZXk6InN0YmxNUDQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQuZXh0LGE9W2Uuc3RzZCh0KSxlLnN0dHMoci5zdHRzKSxlLnN0c2Moci5zdHNjKSxlLnN0c3ooci5zdHN6KSxlLnN0Y28oci5zdGNvKV07cmV0dXJuIHIuc3Rzcy5sZW5ndGgmJmEucHVzaChlLnN0c3Moci5zdHNzKSksci5jdHRzLmxlbmd0aCYmYS5wdXNoKGUuY3R0cyhyLmN0dHMpKSxlLmJveC5hcHBseShlLFtlLnR5cGVzLnN0YmxdLmNvbmNhdChhKSl9fSx7a2V5OiJzdHRzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDgqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUudmFsdWUscj1lLmNvdW50O2Euc2V0KFtyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSxuKSxuKz04fSkpLGUuYm94KGUudHlwZXMuc3R0cyxRKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoMTIqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUuZmlyc3RDaHVuayxyPWUuc2FtcGxlc1BlckNodW5rLGk9ZS5zYW1wbGVEZXNjSW5kZXg7YS5zZXQoW3Q+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsaT4+MjQsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpXSxuKSxuKz0xMn0pKSxlLmJveChlLnR5cGVzLnN0c2MsUShuZXcgVWludDhBcnJheShbMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdHN6Iix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdHN6LFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxhKSl9fSx7a2V5OiJzdGNvIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgcj10Lmxlbmd0aCxhPW5ldyBVaW50OEFycmF5KDQqciksbj0wO3JldHVybiB0LmZvckVhY2goKGZ1bmN0aW9uKGUpe2Euc2V0KFtlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLG4pLG4rPTR9KSksZS5ib3goZS50eXBlcy5zdGNvLFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3RzcyIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC5sZW5ndGgsYT1uZXcgVWludDhBcnJheSg0KnIpLG49MDtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbihlKXthLnNldChbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSxuKSxuKz00fSkpLGUuYm94KGUudHlwZXMuc3RzcyxRKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLGEpKX19LHtrZXk6ImN0dHMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciByPXQubGVuZ3RoLGE9bmV3IFVpbnQ4QXJyYXkoOCpyKSxuPTA7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS52YWx1ZSxyPWUuY291bnQ7YS5zZXQoW3I+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcix0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdLG4pLG4rPTh9KSksZS5ib3goZS50eXBlcy5jdHRzLFEobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksYSkpfX0se2tleToic3R5cCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gZS5ib3goZS50eXBlcy5zdHlwLG5ldyBVaW50OEFycmF5KFsxMDksMTE1LDEwMCwxMDQsMCwwLDAsMCwxMDksMTE1LDEwMCwxMDQsMTA5LDExNSwxMDUsMTIwXSkpfX0se2tleToic2lkeCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIHI9dC50aW1lc2NhbGUsYT10LnNhbXBsZXNbMF0uZHVyYXRpb24sbj1hKnQuc2FtcGxlcy5sZW5ndGgsaT10LnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0KmEscz04O3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtzKz1lLnNpemV9KSk7dmFyIG89MDtpZih0LmlzVmlkZW8pe3ZhciB1LGM9MDt0LnZpZGVvU2VuYyYmKHU9dC52aWRlb1NlbmMpLHQuaXNWaWRlbyYmdS5mb3JFYWNoKChmdW5jdGlvbihlKXtjKz04LGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCYmKGMrPTIsYys9NiplLnN1YnNhbXBsZXMubGVuZ3RoKX0pKSx0LnZpZGVvU2VuY0xlbmd0aD1jLG89cysxNDErMTYqdC5zYW1wbGVzLmxlbmd0aCtjLHQudXNlRU1FJiZ0LmlzQXVkaW9FbmNyeXB0aW9uJiYhdC5pc1ZpZGVvRW5jcnlwdGlvbiYmKG89cysxNip0LnNhbXBsZXMubGVuZ3RoKzg0KX1lbHNlIG89cysxMTYrMTIqdC5zYW1wbGVzLmxlbmd0aCx0LnVzZUVNRSYmdC5pc0F1ZGlvRW5jcnlwdGlvbiYmKG89cysxNjkrMTIqdC5zYW1wbGVzLmxlbmd0aCs4KnQuYXVkaW9TZW5jLmxlbmd0aCk7dmFyIGw9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMjU1JnQuaWQscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcixpPj4yNCYyNTUsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpLDAsMCwwLDAsMCwwLDAsMSwwLG8+PjE2JjI1NSxvPj44JjI1NSwyNTUmbyxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLDE0NCwwLDAsMF0pO3JldHVybiBlLmJveChlLnR5cGVzLnNpZHgsbCl9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gZS5ib3goZS50eXBlcy5tZGF0LHQpfX1dKSxlfSgpO2koRWUsInR5cGVzIixbImF2MDEiLCJhdjFDIiwiYXZjMSIsImF2Y0MiLCJodmMxIiwiaHZjQyIsImRpbmYiLCJkcmVmIiwiZXNkcyIsImZ0eXAiLCJoZGxyIiwibWRhdCIsIm1kaGQiLCJtZGlhIiwibWZoZCIsIm1pbmYiLCJtb29mIiwibW9vdiIsIm1wNGEiLCJtdmV4IiwibXZoZCIsInBhc3AiLCJzdGJsIiwic3RjbyIsInN0c2MiLCJzdHNkIiwic3RzeiIsInN0dHMiLCJ0ZmR0IiwidGZoZCIsInRyYWYiLCJ0cmFrIiwidHJleCIsInRraGQiLCJ2bWhkIiwic21oZCIsImN0dHMiLCJzdHNzIiwic3R5cCIsInBzc2giLCJzaWR4Iiwic2JncCIsInNhaXoiLCJzYWlvIiwic2VuYyIsInRydW4iLCJlbmN2IiwiZW5jYSIsInNpbmYiLCJidHJ0IiwiZnJtYSIsInRlbmMiLCJzY2htIiwic2NoaSIsIm1laGQiLCJmaWVsIiwic2R0cCJdLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gZVt0XT1bdC5jaGFyQ29kZUF0KDApLHQuY2hhckNvZGVBdCgxKSx0LmNoYXJDb2RlQXQoMiksdC5jaGFyQ29kZUF0KDMpXSxlfSksT2JqZWN0LmNyZWF0ZShudWxsKSkpLGkoRWUsIkhETFJfVFlQRVMiLHt2aWRlbzpuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDExOCwxMDUsMTAwLDEwMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCw4NiwxMDUsMTAwLDEwMSwxMTEsNzIsOTcsMTEwLDEwMCwxMDgsMTAxLDExNCwwXSksYXVkaW86bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwxMTUsMTExLDExNywxMTAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsODMsMTExLDExNywxMTAsMTAwLDcyLDk3LDExMCwxMDAsMTA4LDEwMSwxMTQsMF0pfSksaShFZSwiRlRZUEFWQzEiLEVlLmJveChFZS50eXBlcy5mdHlwLG5ldyBVaW50OEFycmF5KFsxMDUsMTE1LDExMSwxMDksMCwwLDAsMSwxMDUsMTE1LDExMSwxMDksOTcsMTE4LDk5LDQ5XSkpKSxpKEVlLCJGVFlQSEVWMSIsRWUuYm94KEVlLnR5cGVzLmZ0eXAsbmV3IFVpbnQ4QXJyYXkoWzEwNSwxMTUsMTExLDEwOSwwLDAsMCwxLDEwNSwxMTUsMTExLDEwOSwxMDQsMTAxLDExOCw0OV0pKSksaShFZSwiRElORiIsRWUuYm94KEVlLnR5cGVzLmRpbmYsRWUuYm94KEVlLnR5cGVzLmRyZWYsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwxMiwxMTcsMTE0LDEwOCwzMiwwLDAsMCwxXSkpKSksaShFZSwiVk1IRCIsRWUuYm94KEVlLnR5cGVzLnZtaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTTUhEIixFZS5ib3goRWUudHlwZXMuc21oZCxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTdGJsVGFibGUiLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDBdKSksaShFZSwiU1RUUyIsRWUuYm94KEVlLnR5cGVzLnN0dHMsRWUuU3RibFRhYmxlKSksaShFZSwiU1RTQyIsRWUuYm94KEVlLnR5cGVzLnN0c2MsRWUuU3RibFRhYmxlKSksaShFZSwiU1RTWiIsRWUuYm94KEVlLnR5cGVzLnN0c3osbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwXSkpKSxpKEVlLCJTVENPIixFZS5ib3goRWUudHlwZXMuc3RjbyxFZS5TdGJsVGFibGUpKTt2YXIgVGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSl7cih0aGlzLGUpLHRoaXMubmFtZT10fHwiIix0aGlzLl9wcmVmaXg9IlsiLmNvbmNhdCh0aGlzLm5hbWUsIl0iKSxlLmRpc2FibGVkPWF9cmV0dXJuIG4oZSxbe2tleToiZGVidWciLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmRlYnVnLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJsb2ciLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmxvZy5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX0se2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtpZighZS5kaXNhYmxlZCl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsYT1uZXcgQXJyYXkociksbj0wO248cjtuKyspYVtuXT1hcmd1bWVudHNbbl07KHQ9Y29uc29sZSkud2Fybi5hcHBseSh0LFt0aGlzLl9wcmVmaXhdLmNvbmNhdChhKSl9fX0se2tleToiZXJyb3IiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIWUuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLGE9bmV3IEFycmF5KHIpLG49MDtuPHI7bisrKWFbbl09YXJndW1lbnRzW25dOyh0PWNvbnNvbGUpLmVycm9yLmFwcGx5KHQsW3RoaXMuX3ByZWZpeF0uY29uY2F0KGEpKX19fSx7a2V5OiJ0YWJsZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDtlLmRpc2FibGVkfHwoY29uc29sZS5ncm91cCh0aGlzLl9wcmVmaXgpLCh0PWNvbnNvbGUpLnRhYmxlLmFwcGx5KHQsYXJndW1lbnRzKSxjb25zb2xlLmdyb3VwRW5kKCkpfX1dLFt7a2V5OiJlbmFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMX19LHtrZXk6ImRpc2FibGUiLHZhbHVlOmZ1bmN0aW9uKCl7ZS5kaXNhYmxlZD0hMH19XSksZX0oKTtpKFRlLCJkaXNhYmxlZCIsITApO2Zvcih2YXIgVWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsYSxuKXtyKHRoaXMsZSksdGhpcy52aWRlb1RyYWNrPXQsdGhpcy5hdWRpb1RyYWNrPWE7dmFyIGk9L0Nocm9tZVwvKFteLl0rKS8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KTt0aGlzLmZvcmNlRmlyc3RJRFI9aSYmTnVtYmVyKGlbMV0pPDUwLHRoaXMubG9nPW5ldyBUZSgiRk1QNFJlbXV4ZXIiLCFufHwhbi5vcGVuTG9nfHwhbi5vcGVuTG9nKX1yZXR1cm4gbihlLFt7a2V5OiJyZW11eCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZSx0LHIsYSxuLGk9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0mJmFyZ3VtZW50c1swXSxzPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7fSxvPXRoaXMudmlkZW9UcmFjayx1PXRoaXMuYXVkaW9UcmFjayxjPW8uZXhpc3QoKSxsPXUuZXhpc3QoKSxmPVtdO3JldHVybiBpJiYocyYmcy5pbml0TWVyZ2U/KGMmJmYucHVzaCh0aGlzLnZpZGVvVHJhY2spLGwmJmYucHVzaCh0aGlzLmF1ZGlvVHJhY2spLHI9RWUuaW5pdFNlZ21lbnQoZikpOihjJiYoZT1FZS5pbml0U2VnbWVudChbdGhpcy52aWRlb1RyYWNrXSkpLGwmJih0PUVlLmluaXRTZWdtZW50KFt0aGlzLmF1ZGlvVHJhY2tdKSkpKSxjJiZvLmhhc1NhbXBsZSgpJiYoYT10aGlzLl9yZW11eFZpZGVvKCkpLGwmJnUuaGFzU2FtcGxlKCkmJihuPXRoaXMuX3JlbXV4QXVkaW8oKSksby5zYW1wbGVzPVtdLHUuc2FtcGxlcz1bXSx7aW5pdFNlZ21lbnQ6cix2aWRlb0luaXRTZWdtZW50OmUsYXVkaW9Jbml0U2VnbWVudDp0LHZpZGVvU2VnbWVudDphLGF1ZGlvU2VnbWVudDpufX19LHtrZXk6Il9yZW11eFZpZGVvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMudmlkZW9UcmFjazt0aGlzLmZvcmNlRmlyc3RJRFImJihlLnNhbXBsZXNbMF0uZmxhZz17ZGVwZW5kc09uOjIsaXNOb25TeW5jU2FtcGxlOjB9KTt2YXIgdD1lLnNhbXBsZXMscj0vYXYwMS8udGVzdChlLmNvZGVjKSxhPTA7cj90LmZvckVhY2goKGZ1bmN0aW9uKGUpe2ErPWUuZGF0YS5ieXRlTGVuZ3RofSkpOnQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7YSs9ZS51bml0cy5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5ieXRlTGVuZ3RofSksMCksYSs9NCplLnVuaXRzLmxlbmd0aH0pKTt2YXIgbj1uZXcgVWludDhBcnJheShhKTtpZihyKWZvcih2YXIgaSxzPTAsbz10Lmxlbmd0aCx1PTA7czxvO3MrKylpPXRbc10sbi5zZXQoaS5kYXRhLHUpLGkuc2l6ZT1pLmRhdGEuYnl0ZUxlbmd0aCx1Kz1pLnNpemU7ZWxzZSBmb3IodmFyIGMsbD1uZXcgRGF0YVZpZXcobi5idWZmZXIpLGY9ZnVuY3Rpb24oZSxyKXtyPXRbZF07dmFyIGE9MDtyLnVuaXRzLmZvckVhY2goKGZ1bmN0aW9uKHQpe2wuc2V0VWludDMyKGUsdC5ieXRlTGVuZ3RoKSxlKz00LG4uc2V0KHQsZSksZSs9dC5ieXRlTGVuZ3RoLGErPTQrdC5ieXRlTGVuZ3RofSkpLHIuc2l6ZT1hLHA9ZSxjPXJ9LGQ9MCxoPXQubGVuZ3RoLHA9MDtkPGg7ZCsrKWYocCxjKTt2YXIgdj1FZS5tZGF0KG4pO3JldHVybiBRKEVlLm1vb2YoW2VdKSx2KX19LHtrZXk6Il9yZW11eEF1ZGlvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuYXVkaW9UcmFjayx0PW5ldyBVaW50OEFycmF5KGUuc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdC5zaXplfSksMCkpO2Uuc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKGUscil7cmV0dXJuIHQuc2V0KHIuZGF0YSxlKSxlK3Iuc2l6ZX0pLDApO3ZhciByPUVlLm1kYXQodCk7cmV0dXJuIFEoRWUubW9vZihbZV0pLHIpfX0se2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy52aWRlb1RyYWNrLnJlc2V0KCksdGhpcy5hdWRpb1RyYWNrLnJlc2V0KCl9fV0pLGV9KCksQ2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7cih0aGlzLGUpfXJldHVybiBuKGUsW3trZXk6Im1peEluIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmFzc2lnbih0aGlzLGUpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHRoaXMuY29uc3RydWN0b3I7cmV0dXJuIE9iamVjdC5hc3NpZ24oZSx0aGlzKSxlfX1dLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIGwodGhpcyx0KX19XSksZX0oKSxQZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7dmFyIGUsbj1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06W10saT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06NCpuLmxlbmd0aDtyKHRoaXMsYSksZT10LmNhbGwodGhpcyk7dmFyIHM9bjtpZihzIGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJihzPW5ldyBVaW50OEFycmF5KHMpKSwocyBpbnN0YW5jZW9mIEludDhBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHxzIGluc3RhbmNlb2YgSW50MTZBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHxzIGluc3RhbmNlb2YgSW50MzJBcnJheXx8cyBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHxzIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHxzIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHM9bmV3IFVpbnQ4QXJyYXkocy5idWZmZXIscy5ieXRlT2Zmc2V0LHMuYnl0ZUxlbmd0aCkpLHMgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIG89cy5ieXRlTGVuZ3RoLHU9W10sYz0wO2M8bztjKz0xKXVbYz4+PjJdfD1zW2NdPDwyNC1jJTQqODtlLndvcmRzPXUsZS5zaWdCeXRlcz1vfWVsc2UgZS53b3Jkcz1uLGUuc2lnQnl0ZXM9aTtyZXR1cm4gZX1yZXR1cm4gbihhLFt7a2V5OiJ0b1N0cmluZyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06SWU7cmV0dXJuIGUuc3RyaW5naWZ5KHRoaXMpfX0se2tleToiY29uY2F0Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLndvcmRzLHI9ZS53b3JkcyxhPXRoaXMuc2lnQnl0ZXMsbj1lLnNpZ0J5dGVzO2lmKHRoaXMuY2xhbXAoKSxhJTQpZm9yKHZhciBpPTA7aTxuO2krPTEpe3ZhciBzPXJbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O3RbYStpPj4+Ml18PXM8PDI0LShhK2kpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288bjtvKz00KXRbYStvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPW4sdGhpc319LHtrZXk6ImNsYW1wIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMud29yZHMsdD10aGlzLnNpZ0J5dGVzO2VbdD4+PjJdJj00Mjk0OTY3Mjk1PDwzMi10JTQqOCxlLmxlbmd0aD1NYXRoLmNlaWwodC80KX19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXAobyhhLnByb3RvdHlwZSksImNsb25lIix0aGlzKS5jYWxsKHRoaXMpO3JldHVybiBlLndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksZX19XSxbe2tleToicmFuZG9tIix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQscj1bXSxuPWZ1bmN0aW9uKGUpe3ZhciB0PWUscj05ODc2NTQzMjEsYT00Mjk0OTY3Mjk1O3JldHVybiBmdW5jdGlvbigpe3ZhciBlPSgocj0zNjk2OSooNjU1MzUmcikrKHI+PjE2KSZhKTw8MTYpKyh0PTE4ZTMqKDY1NTM1JnQpKyh0Pj4xNikmYSkmYTtyZXR1cm4gZS89NDI5NDk2NzI5NiwoZSs9LjUpKihNYXRoLnJhbmRvbSgpPi41PzE6LTEpfX0saT0wO2k8ZTtpKz00KXt2YXIgcz1uKDQyOTQ5NjcyOTYqKHR8fE1hdGgucmFuZG9tKCkpKTt0PTk4NzY1NDA3MSpzKCksci5wdXNoKDQyOTQ5NjcyOTYqcygpfDApfXJldHVybiBuZXcgYShyLGUpfX1dKSxhfShDZSksSWU9e3N0cmluZ2lmeTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS53b3JkcyxyPWUuc2lnQnl0ZXMsYT1bXSxuPTA7bjxyO24rPTEpe3ZhciBpPXRbbj4+PjJdPj4+MjQtbiU0KjgmMjU1O2EucHVzaCgoaT4+PjQpLnRvU3RyaW5nKDE2KSksYS5wdXNoKCgxNSZpKS50b1N0cmluZygxNikpfXJldHVybiBhLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5sZW5ndGgscj1bXSxhPTA7YTx0O2ErPTIpclthPj4+M118PXBhcnNlSW50KGUuc3Vic3RyKGEsMiksMTYpPDwyNC1hJTgqNDtyZXR1cm4gbmV3IFBlKHIsdC8yKX19LE1lPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLGE9MDthPHQ7YSs9MSlyW2E+Pj4yXXw9KDI1NSZlLmNoYXJDb2RlQXQoYSkpPDwyNC1hJTQqODtyZXR1cm4gbmV3IFBlKHIsdCl9LHplPWZ1bmN0aW9uKGUpe3JldHVybiBNZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZSkpKX0sT2U9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3ZhciBlO3JldHVybiByKHRoaXMsYSksKGU9dC5jYWxsKHRoaXMpKS5fbWluQnVmZmVyU2l6ZT0wLGV9cmV0dXJuIG4oYSxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YT1uZXcgUGUsdGhpcy5fbkRhdGFCeXRlcz0wfX0se2tleToiX2FwcGVuZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZTsic3RyaW5nIj09dHlwZW9mIHQmJih0PXplKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfX0se2tleToiX3Byb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcy5fZGF0YSxhPXRoaXMuYmxvY2tTaXplLG49ci53b3JkcyxpPXIuc2lnQnl0ZXMscz1pLyg0KmEpLG89KHM9ZT9NYXRoLmNlaWwocyk6TWF0aC5tYXgoKDB8cyktdGhpcy5fbWluQnVmZmVyU2l6ZSwwKSkqYSx1PU1hdGgubWluKDQqbyxpKTtpZihvKXtmb3IodmFyIGM9MDtjPG87Yys9YSl0aGlzLl9kb1Byb2Nlc3NCbG9jayhuLGMpO3Q9bi5zcGxpY2UoMCxvKSxyLnNpZ0J5dGVzLT11fXJldHVybiBuZXcgUGUodCx1KX19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXAobyhhLnByb3RvdHlwZSksImNsb25lIix0aGlzKS5jYWxsKHRoaXMpO3JldHVybiBlLl9kYXRhPXRoaXMuX2RhdGEuY2xvbmUoKSxlfX1dKSxhfShDZSksUmU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlKXt2YXIgbjtyZXR1cm4gcih0aGlzLGEpLChuPXQuY2FsbCh0aGlzKSkuYmxvY2tTaXplPTE2LG4uY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLGUpLG4ucmVzZXQoKSxufXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX19LHtrZXk6InVwZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX2FwcGVuZChlKSx0aGlzLl9wcm9jZXNzKCksdGhpc319LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmdGhpcy5fYXBwZW5kKGUpLHRoaXMuX2RvRmluYWxpemUoKX19XSxbe2tleToiX2NyZWF0ZUhlbHBlciIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIG5ldyBlKHIpLmZpbmFsaXplKHQpfX19LHtrZXk6Il9jcmVhdGVIbWFjSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IExlKGUscikuZmluYWxpemUodCl9fX1dKSxhfShPZSksTGU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlLG4pe3ZhciBpO3IodGhpcyxhKSxpPXQuY2FsbCh0aGlzKTt2YXIgcz1uZXcgZTtpLl9oYXNoZXI9czt2YXIgbz1uOyJzdHJpbmciPT10eXBlb2YgbyYmKG89emUobykpO3ZhciB1PXMuYmxvY2tTaXplLGM9NCp1O28uc2lnQnl0ZXM+YyYmKG89cy5maW5hbGl6ZShuKSksby5jbGFtcCgpO3ZhciBsPW8uY2xvbmUoKTtpLl9vS2V5PWw7dmFyIGY9by5jbG9uZSgpO2kuX2lLZXk9Zjtmb3IodmFyIGQ9bC53b3JkcyxoPWYud29yZHMscD0wO3A8dTtwKz0xKWRbcF1ePTE1NDk1NTY4MjgsaFtwXV49OTA5NTIyNDg2O3JldHVybiBsLnNpZ0J5dGVzPWMsZi5zaWdCeXRlcz1jLGkucmVzZXQoKSxpfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuX2hhc2hlcjtlLnJlc2V0KCksZS51cGRhdGUodGhpcy5faUtleSl9fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9oYXNoZXIudXBkYXRlKGUpLHRoaXN9fSx7a2V5OiJmaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5faGFzaGVyLHI9dC5maW5hbGl6ZShlKTtyZXR1cm4gdC5yZXNldCgpLHQuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChyKSl9fV0pLGF9KENlKSxWZT17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe3ZhciB0PWUud29yZHMscj1lLnNpZ0J5dGVzLGE9dGhpcy5fbWFwO2UuY2xhbXAoKTtmb3IodmFyIG49W10saT0wO2k8cjtpKz0zKWZvcih2YXIgcz0odFtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTUpPDwxNnwodFtpKzE+Pj4yXT4+PjI0LShpKzEpJTQqOCYyNTUpPDw4fHRbaSsyPj4+Ml0+Pj4yNC0oaSsyKSU0KjgmMjU1LG89MDtvPDQmJmkrLjc1Km88cjtvKz0xKW4ucHVzaChhLmNoYXJBdChzPj4+NiooMy1vKSY2MykpO3ZhciB1PWEuY2hhckF0KDY0KTtpZih1KWZvcig7bi5sZW5ndGglNDspbi5wdXNoKHUpO3JldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbihlKXt2YXIgdD1lLmxlbmd0aCxyPXRoaXMuX21hcCxhPXRoaXMuX3JldmVyc2VNYXA7aWYoIWEpe3RoaXMuX3JldmVyc2VNYXA9W10sYT10aGlzLl9yZXZlcnNlTWFwO2Zvcih2YXIgbj0wO248ci5sZW5ndGg7bis9MSlhW3IuY2hhckNvZGVBdChuKV09bn12YXIgaT1yLmNoYXJBdCg2NCk7aWYoaSl7dmFyIHM9ZS5pbmRleE9mKGkpOy0xIT09cyYmKHQ9cyl9cmV0dXJuIGZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIGE9W10sbj0wLGk9MDtpPHQ7aSs9MSlpZihpJTQpe3ZhciBzPXJbZS5jaGFyQ29kZUF0KGktMSldPDxpJTQqMnxyW2UuY2hhckNvZGVBdChpKV0+Pj42LWklNCoyO2Fbbj4+PjJdfD1zPDwyNC1uJTQqOCxuKz0xfXJldHVybiBQZS5jcmVhdGUoYSxuKX0oZSx0LGEpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9LEZlPVtdLE5lPTA7TmU8NjQ7TmUrPTEpRmVbTmVdPTQyOTQ5NjcyOTYqTWF0aC5hYnMoTWF0aC5zaW4oTmUrMSkpfDA7dmFyIGplPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHQmcnx+dCZhKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEdlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHQmYXxyJn5hKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEhlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHRecl5hKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LEtlPWZ1bmN0aW9uKGUsdCxyLGEsbixpLHMpe3ZhciBvPWUrKHJeKHR8fmEpKStuK3M7cmV0dXJuKG88PGl8bz4+PjMyLWkpK3R9LHFlPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsW3trZXk6Il9kb1Jlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IFBlKFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZSxhPTA7YTwxNjthKz0xKXt2YXIgbj10K2EsaT1lW25dO3Jbbl09MTY3MTE5MzUmKGk8PDh8aT4+PjI0KXw0Mjc4MjU1MzYwJihpPDwyNHxpPj4+OCl9dmFyIHM9dGhpcy5faGFzaC53b3JkcyxvPXJbdCswXSx1PXJbdCsxXSxjPXJbdCsyXSxsPXJbdCszXSxmPXJbdCs0XSxkPXJbdCs1XSxoPXJbdCs2XSxwPXJbdCs3XSx2PXJbdCs4XSx5PXJbdCs5XSxtPXJbdCsxMF0sZz1yW3QrMTFdLGs9clt0KzEyXSxiPXJbdCsxM10sXz1yW3QrMTRdLHc9clt0KzE1XSx4PXNbMF0sUz1zWzFdLEE9c1syXSxEPXNbM107eD1qZSh4LFMsQSxELG8sNyxGZVswXSksRD1qZShELHgsUyxBLHUsMTIsRmVbMV0pLEE9amUoQSxELHgsUyxjLDE3LEZlWzJdKSxTPWplKFMsQSxELHgsbCwyMixGZVszXSkseD1qZSh4LFMsQSxELGYsNyxGZVs0XSksRD1qZShELHgsUyxBLGQsMTIsRmVbNV0pLEE9amUoQSxELHgsUyxoLDE3LEZlWzZdKSxTPWplKFMsQSxELHgscCwyMixGZVs3XSkseD1qZSh4LFMsQSxELHYsNyxGZVs4XSksRD1qZShELHgsUyxBLHksMTIsRmVbOV0pLEE9amUoQSxELHgsUyxtLDE3LEZlWzEwXSksUz1qZShTLEEsRCx4LGcsMjIsRmVbMTFdKSx4PWplKHgsUyxBLEQsayw3LEZlWzEyXSksRD1qZShELHgsUyxBLGIsMTIsRmVbMTNdKSxBPWplKEEsRCx4LFMsXywxNyxGZVsxNF0pLFM9amUoUyxBLEQseCx3LDIyLEZlWzE1XSkseD1HZSh4LFMsQSxELHUsNSxGZVsxNl0pLEQ9R2UoRCx4LFMsQSxoLDksRmVbMTddKSxBPUdlKEEsRCx4LFMsZywxNCxGZVsxOF0pLFM9R2UoUyxBLEQseCxvLDIwLEZlWzE5XSkseD1HZSh4LFMsQSxELGQsNSxGZVsyMF0pLEQ9R2UoRCx4LFMsQSxtLDksRmVbMjFdKSxBPUdlKEEsRCx4LFMsdywxNCxGZVsyMl0pLFM9R2UoUyxBLEQseCxmLDIwLEZlWzIzXSkseD1HZSh4LFMsQSxELHksNSxGZVsyNF0pLEQ9R2UoRCx4LFMsQSxfLDksRmVbMjVdKSxBPUdlKEEsRCx4LFMsbCwxNCxGZVsyNl0pLFM9R2UoUyxBLEQseCx2LDIwLEZlWzI3XSkseD1HZSh4LFMsQSxELGIsNSxGZVsyOF0pLEQ9R2UoRCx4LFMsQSxjLDksRmVbMjldKSxBPUdlKEEsRCx4LFMscCwxNCxGZVszMF0pLFM9R2UoUyxBLEQseCxrLDIwLEZlWzMxXSkseD1IZSh4LFMsQSxELGQsNCxGZVszMl0pLEQ9SGUoRCx4LFMsQSx2LDExLEZlWzMzXSksQT1IZShBLEQseCxTLGcsMTYsRmVbMzRdKSxTPUhlKFMsQSxELHgsXywyMyxGZVszNV0pLHg9SGUoeCxTLEEsRCx1LDQsRmVbMzZdKSxEPUhlKEQseCxTLEEsZiwxMSxGZVszN10pLEE9SGUoQSxELHgsUyxwLDE2LEZlWzM4XSksUz1IZShTLEEsRCx4LG0sMjMsRmVbMzldKSx4PUhlKHgsUyxBLEQsYiw0LEZlWzQwXSksRD1IZShELHgsUyxBLG8sMTEsRmVbNDFdKSxBPUhlKEEsRCx4LFMsbCwxNixGZVs0Ml0pLFM9SGUoUyxBLEQseCxoLDIzLEZlWzQzXSkseD1IZSh4LFMsQSxELHksNCxGZVs0NF0pLEQ9SGUoRCx4LFMsQSxrLDExLEZlWzQ1XSksQT1IZShBLEQseCxTLHcsMTYsRmVbNDZdKSxTPUhlKFMsQSxELHgsYywyMyxGZVs0N10pLHg9S2UoeCxTLEEsRCxvLDYsRmVbNDhdKSxEPUtlKEQseCxTLEEscCwxMCxGZVs0OV0pLEE9S2UoQSxELHgsUyxfLDE1LEZlWzUwXSksUz1LZShTLEEsRCx4LGQsMjEsRmVbNTFdKSx4PUtlKHgsUyxBLEQsayw2LEZlWzUyXSksRD1LZShELHgsUyxBLGwsMTAsRmVbNTNdKSxBPUtlKEEsRCx4LFMsbSwxNSxGZVs1NF0pLFM9S2UoUyxBLEQseCx1LDIxLEZlWzU1XSkseD1LZSh4LFMsQSxELHYsNixGZVs1Nl0pLEQ9S2UoRCx4LFMsQSx3LDEwLEZlWzU3XSksQT1LZShBLEQseCxTLGgsMTUsRmVbNThdKSxTPUtlKFMsQSxELHgsYiwyMSxGZVs1OV0pLHg9S2UoeCxTLEEsRCxmLDYsRmVbNjBdKSxEPUtlKEQseCxTLEEsZywxMCxGZVs2MV0pLEE9S2UoQSxELHgsUyxjLDE1LEZlWzYyXSksUz1LZShTLEEsRCx4LHksMjEsRmVbNjNdKSxzWzBdPXNbMF0reHwwLHNbMV09c1sxXStTfDAsc1syXT1zWzJdK0F8MCxzWzNdPXNbM10rRHwwfX0se2tleToiX2RvRmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5fZGF0YSx0PWUud29yZHMscj04KnRoaXMuX25EYXRhQnl0ZXMsYT04KmUuc2lnQnl0ZXM7dFthPj4+NV18PTEyODw8MjQtYSUzMjt2YXIgbj1NYXRoLmZsb29yKHIvNDI5NDk2NzI5NiksaT1yO3RbMTUrKGErNjQ+Pj45PDw0KV09MTY3MTE5MzUmKG48PDh8bj4+PjI0KXw0Mjc4MjU1MzYwJihuPDwyNHxuPj4+OCksdFsxNCsoYSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KSxlLnNpZ0J5dGVzPTQqKHQubGVuZ3RoKzEpLHRoaXMuX3Byb2Nlc3MoKTtmb3IodmFyIHM9dGhpcy5faGFzaCxvPXMud29yZHMsdT0wO3U8NDt1Kz0xKXt2YXIgYz1vW3VdO29bdV09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIHN9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1wKG8oYS5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gZS5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksZX19XSksYX0oUmUpO1JlLl9jcmVhdGVIZWxwZXIocWUpLFJlLl9jcmVhdGVIbWFjSGVscGVyKHFlKTt2YXIgV2U9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYShlKXt2YXIgbjtyZXR1cm4gcih0aGlzLGEpLChuPXQuY2FsbCh0aGlzKSkuY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLHtrZXlTaXplOjQsaGFzaGVyOnFlLGl0ZXJhdGlvbnM6MX0sZSksbn1yZXR1cm4gbihhLFt7a2V5OiJjb21wdXRlIix2YWx1ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcixhPXRoaXMuY2ZnLG49YS5oYXNoZXIuY3JlYXRlKCksaT1QZS5jcmVhdGUoKSxzPWkud29yZHMsbz1hLmtleVNpemUsdT1hLml0ZXJhdGlvbnM7cy5sZW5ndGg8bzspe3ImJm4udXBkYXRlKHIpLHI9bi51cGRhdGUoZSkuZmluYWxpemUodCksbi5yZXNldCgpO2Zvcih2YXIgYz0xO2M8dTtjKz0xKXI9bi5maW5hbGl6ZShyKSxuLnJlc2V0KCk7aS5jb25jYXQocil9cmV0dXJuIGkuc2lnQnl0ZXM9NCpvLGl9fV0pLGF9KENlKSxYZT1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUsbixpKXt2YXIgcztyZXR1cm4gcih0aGlzLGEpLChzPXQuY2FsbCh0aGlzKSkuY2ZnPU9iamVjdC5hc3NpZ24obmV3IENlLGkpLHMuX3hmb3JtTW9kZT1lLHMuX2tleT1uLHMucmVzZXQoKSxzfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX19LHtrZXk6InByb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9hcHBlbmQoZSksdGhpcy5fcHJvY2VzcygpfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlJiZ0aGlzLl9hcHBlbmQoZSksdGhpcy5fZG9GaW5hbGl6ZSgpfX1dLFt7a2V5OiJjcmVhdGVFbmNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLGUsdCl9fSx7a2V5OiJjcmVhdGVEZWNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLGUsdCl9fSx7a2V5OiJfY3JlYXRlSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbihlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGU/bnQ6cnR9O3JldHVybntlbmNyeXB0OmZ1bmN0aW9uKHIsYSxuKXtyZXR1cm4gdChhKS5lbmNyeXB0KGUscixhLG4pfSxkZWNyeXB0OmZ1bmN0aW9uKHIsYSxuKXtyZXR1cm4gdChhKS5kZWNyeXB0KGUscixhLG4pfX19fV0pLGF9KE9lKTtYZS5fRU5DX1hGT1JNX01PREU9MSxYZS5fREVDX1hGT1JNX01PREU9MixYZS5rZXlTaXplPTQsWGUuaXZTaXplPTQ7dmFyIFllPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSxuKXt2YXIgaTtyZXR1cm4gcih0aGlzLGEpLChpPXQuY2FsbCh0aGlzKSkuX2NpcGhlcj1lLGkuX2l2PW4saX1yZXR1cm4gbihhLG51bGwsW3trZXk6ImNyZWF0ZUVuY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5FbmNyeXB0b3IuY3JlYXRlKGUsdCl9fSx7a2V5OiJjcmVhdGVEZWNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZShlLHQpfX1dKSxhfShDZSk7ZnVuY3Rpb24gWmUoZSx0LHIpe3ZhciBhLG49ZSxpPXRoaXMuX2l2O2k/KGE9aSx0aGlzLl9pdj12b2lkIDApOmE9dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgcz0wO3M8cjtzKz0xKW5bdCtzXV49YVtzXX12YXIgUWU9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSl9KFllKTtRZS5FbmNyeXB0b3I9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixhPXIuYmxvY2tTaXplO1plLmNhbGwodGhpcyxlLHQsYSksci5lbmNyeXB0QmxvY2soZSx0KSx0aGlzLl9wcmV2QmxvY2s9ZS5zbGljZSh0LHQrYSl9fV0pLGF9KFFlKSxRZS5EZWNyeXB0b3I9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixhPXIuYmxvY2tTaXplLG49ZS5zbGljZSh0LHQrYSk7ci5kZWNyeXB0QmxvY2soZSx0KSxaZS5jYWxsKHRoaXMsZSx0LGEpLHRoaXMuX3ByZXZCbG9jaz1ufX1dKSxhfShRZSk7dmFyIEplPXtwYWQ6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9NCp0LGE9ci1lLnNpZ0J5dGVzJXIsbj1hPDwyNHxhPDwxNnxhPDw4fGEsaT1bXSxzPTA7czxhO3MrPTQpaS5wdXNoKG4pO3ZhciBvPVBlLmNyZWF0ZShpLGEpO2UuY29uY2F0KG8pfSx1bnBhZDpmdW5jdGlvbihlKXt2YXIgdD1lLHI9MjU1JnQud29yZHNbdC5zaWdCeXRlcy0xPj4+Ml07dC5zaWdCeXRlcy09cn19LCRlPWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoZSxuLGkpe3ZhciBzO3JldHVybiByKHRoaXMsYSksKHM9dC5jYWxsKHRoaXMsZSxuLE9iamVjdC5hc3NpZ24oe21vZGU6UWUscGFkZGluZzpKZX0saSkpKS5ibG9ja1NpemU9NCxzfXJldHVybiBuKGEsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO3AobyhhLnByb3RvdHlwZSksInJlc2V0Iix0aGlzKS5jYWxsKHRoaXMpO3ZhciB0PXRoaXMuY2ZnLHI9dC5pdixuPXQubW9kZTt0aGlzLl94Zm9ybU1vZGU9PT10aGlzLmNvbnN0cnVjdG9yLl9FTkNfWEZPUk1fTU9ERT9lPW4uY3JlYXRlRW5jcnlwdG9yOihlPW4uY3JlYXRlRGVjcnlwdG9yLHRoaXMuX21pbkJ1ZmZlclNpemU9MSksdGhpcy5fbW9kZT1lLmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPWV9fSx7a2V5OiJfZG9Qcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5fbW9kZS5wcm9jZXNzQmxvY2soZSx0KX19LHtrZXk6Il9kb0ZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT09dGhpcy5jb25zdHJ1Y3Rvci5fRU5DX1hGT1JNX01PREU/KHQucGFkKHRoaXMuX2RhdGEsdGhpcy5ibG9ja1NpemUpLGU9dGhpcy5fcHJvY2VzcyghMCkpOihlPXRoaXMuX3Byb2Nlc3MoITApLHQudW5wYWQoZSkpLGV9fV0pLGF9KFhlKSxldD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKGUpe3ZhciBuO3JldHVybiByKHRoaXMsYSksKG49dC5jYWxsKHRoaXMpKS5taXhJbihlKSxufXJldHVybiBuKGEsW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4oZXx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19XSksYX0oQ2UpLHR0PXtzdHJpbmdpZnk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jaXBoZXJ0ZXh0LHI9ZS5zYWx0O3JldHVybihyP1BlLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdCh0KTp0KS50b1N0cmluZyhWZSl9LHBhcnNlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9VmUucGFyc2UoZSksYT1yLndvcmRzO3JldHVybiAxMzk4ODkzNjg0PT09YVswXSYmMTcwMTA3NjgzMT09PWFbMV0mJih0PVBlLmNyZWF0ZShhLnNsaWNlKDIsNCkpLGEuc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLGV0LmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6dH0pfX0scnQ9ZnVuY3Rpb24oZSl7cyhhLGUpO3ZhciB0PWQoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiByKHRoaXMsYSksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIG4oYSxudWxsLFt7a2V5OiJlbmNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj1PYmplY3QuYXNzaWduKG5ldyBDZSx0aGlzLmNmZyxhKSxpPWUuY3JlYXRlRW5jcnlwdG9yKHIsbikscz1pLmZpbmFsaXplKHQpLG89aS5jZmc7cmV0dXJuIGV0LmNyZWF0ZSh7Y2lwaGVydGV4dDpzLGtleTpyLGl2Om8uaXYsYWxnb3JpdGhtOmUsbW9kZTpvLm1vZGUscGFkZGluZzpvLnBhZGRpbmcsYmxvY2tTaXplOmkuYmxvY2tTaXplLGZvcm1hdHRlcjpuLmZvcm1hdH0pfX0se2tleToiZGVjcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7dmFyIG49dCxpPU9iamVjdC5hc3NpZ24obmV3IENlLHRoaXMuY2ZnLGEpO3JldHVybiBuPXRoaXMuX3BhcnNlKG4saS5mb3JtYXQpLGUuY3JlYXRlRGVjcnlwdG9yKHIsaSkuZmluYWxpemUobi5jaXBoZXJ0ZXh0KX19LHtrZXk6Il9wYXJzZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGU/dC5wYXJzZShlLHRoaXMpOmV9fV0pLGF9KENlKTtydC5jZmc9T2JqZWN0LmFzc2lnbihuZXcgQ2Use2Zvcm1hdDp0dH0pO3ZhciBhdD17ZXhlY3V0ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj1hO258fChuPVBlLnJhbmRvbSg4KSk7dmFyIGk9V2UuY3JlYXRlKHtrZXlTaXplOnQrcn0pLmNvbXB1dGUoZSxuKSxzPVBlLmNyZWF0ZShpLndvcmRzLnNsaWNlKHQpLDQqcik7cmV0dXJuIGkuc2lnQnl0ZXM9NCp0LGV0LmNyZWF0ZSh7a2V5OmksaXY6cyxzYWx0Om59KX19LG50PWZ1bmN0aW9uKGUpe3MoYSxlKTt2YXIgdD1kKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gcih0aGlzLGEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBuKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSl7dmFyIG49T2JqZWN0LmFzc2lnbihuZXcgQ2UsdGhpcy5jZmcsYSksaT1uLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplKTtuLml2PWkuaXY7dmFyIHM9cnQuZW5jcnlwdC5jYWxsKHRoaXMsZSx0LGkua2V5LG4pO3JldHVybiBzLm1peEluKGkpLHN9fSx7a2V5OiJkZWNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixhKXt2YXIgbj10LGk9T2JqZWN0LmFzc2lnbihuZXcgQ2UsdGhpcy5jZmcsYSk7bj10aGlzLl9wYXJzZShuLGkuZm9ybWF0KTt2YXIgcz1pLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplLG4uc2FsdCk7cmV0dXJuIGkuaXY9cy5pdixydC5kZWNyeXB0LmNhbGwodGhpcyxlLG4scy5rZXksaSl9fV0pLGF9KHJ0KTtudC5jZmc9T2JqZWN0LmFzc2lnbihydC5jZmcse2tkZjphdH0pO2Zvcih2YXIgaXQ9W10sc3Q9W10sb3Q9W10sdXQ9W10sY3Q9W10sbHQ9W10sZnQ9W10sZHQ9W10saHQ9W10scHQ9W10sdnQ9W10seXQ9MDt5dDwyNTY7eXQrPTEpdnRbeXRdPXl0PDEyOD95dDw8MTp5dDw8MV4yODM7Zm9yKHZhciBtdD0wLGd0PTAsa3Q9MDtrdDwyNTY7a3QrPTEpe3ZhciBidD1ndF5ndDw8MV5ndDw8Ml5ndDw8M15ndDw8NDtidD1idD4+PjheMjU1JmJ0Xjk5LGl0W210XT1idCxzdFtidF09bXQ7dmFyIF90PXZ0W210XSx3dD12dFtfdF0seHQ9dnRbd3RdLFN0PTI1Nyp2dFtidF1eMTY4NDMwMDgqYnQ7b3RbbXRdPVN0PDwyNHxTdD4+PjgsdXRbbXRdPVN0PDwxNnxTdD4+PjE2LGN0W210XT1TdDw8OHxTdD4+PjI0LGx0W210XT1TdCxTdD0xNjg0MzAwOSp4dF42NTUzNyp3dF4yNTcqX3ReMTY4NDMwMDgqbXQsZnRbYnRdPVN0PDwyNHxTdD4+PjgsZHRbYnRdPVN0PDwxNnxTdD4+PjE2LGh0W2J0XT1TdDw8OHxTdD4+PjI0LHB0W2J0XT1TdCxtdD8obXQ9X3RednRbdnRbdnRbeHReX3RdXV0sZ3RePXZ0W3Z0W2d0XV0pOm10PWd0PTF9dmFyIEF0PVswLDEsMiw0LDgsMTYsMzIsNjQsMTI4LDI3LDU0XSxEdD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7dGhpcy5fa2V5UHJpb3JSZXNldD10aGlzLl9rZXk7dmFyIHQ9dGhpcy5fa2V5UHJpb3JSZXNldCxyPXQud29yZHMsYT10LnNpZ0J5dGVzLzQ7dGhpcy5fblJvdW5kcz1hKzY7dmFyIG49NCoodGhpcy5fblJvdW5kcysxKTt0aGlzLl9rZXlTY2hlZHVsZT1bXTtmb3IodmFyIGk9dGhpcy5fa2V5U2NoZWR1bGUscz0wO3M8bjtzKz0xKXM8YT9pW3NdPXJbc106KGU9aVtzLTFdLHMlYT9hPjYmJnMlYT09NCYmKGU9aXRbZT4+PjI0XTw8MjR8aXRbZT4+PjE2JjI1NV08PDE2fGl0W2U+Pj44JjI1NV08PDh8aXRbMjU1JmVdKTooZT1pdFsoZT1lPDw4fGU+Pj4yNCk+Pj4yNF08PDI0fGl0W2U+Pj4xNiYyNTVdPDwxNnxpdFtlPj4+OCYyNTVdPDw4fGl0WzI1NSZlXSxlXj1BdFtzL2F8MF08PDI0KSxpW3NdPWlbcy1hXV5lKTt0aGlzLl9pbnZLZXlTY2hlZHVsZT1bXTtmb3IodmFyIG89dGhpcy5faW52S2V5U2NoZWR1bGUsdT0wO3U8bjt1Kz0xKXt2YXIgYz1uLXU7ZT11JTQ/aVtjXTppW2MtNF0sb1t1XT11PDR8fGM8PTQ/ZTpmdFtpdFtlPj4+MjRdXV5kdFtpdFtlPj4+MTYmMjU1XV1eaHRbaXRbZT4+PjgmMjU1XV1ecHRbaXRbMjU1JmVdXX19fX0se2tleToiZW5jcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3RoaXMuX2RvQ3J5cHRCbG9jayhlLHQsdGhpcy5fa2V5U2NoZWR1bGUsb3QsdXQsY3QsbHQsaXQpfX0se2tleToiZGVjcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUsYT1yW3QrMV07clt0KzFdPXJbdCszXSxyW3QrM109YSx0aGlzLl9kb0NyeXB0QmxvY2socix0LHRoaXMuX2ludktleVNjaGVkdWxlLGZ0LGR0LGh0LHB0LHN0KSxhPXJbdCsxXSxyW3QrMV09clt0KzNdLHJbdCszXT1hfX0se2tleToiX2RvQ3J5cHRCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyxvKXtmb3IodmFyIHU9ZSxjPXRoaXMuX25Sb3VuZHMsbD11W3RdXnJbMF0sZj11W3QrMV1eclsxXSxkPXVbdCsyXV5yWzJdLGg9dVt0KzNdXnJbM10scD00LHY9MTt2PGM7dis9MSl7dmFyIHk9YVtsPj4+MjRdXm5bZj4+PjE2JjI1NV1eaVtkPj4+OCYyNTVdXnNbMjU1JmhdXnJbcF07cCs9MTt2YXIgbT1hW2Y+Pj4yNF1ebltkPj4+MTYmMjU1XV5pW2g+Pj44JjI1NV1ec1syNTUmbF1ecltwXTtwKz0xO3ZhciBnPWFbZD4+PjI0XV5uW2g+Pj4xNiYyNTVdXmlbbD4+PjgmMjU1XV5zWzI1NSZmXV5yW3BdO3ArPTE7dmFyIGs9YVtoPj4+MjRdXm5bbD4+PjE2JjI1NV1eaVtmPj4+OCYyNTVdXnNbMjU1JmRdXnJbcF07cCs9MSxsPXksZj1tLGQ9ZyxoPWt9dmFyIGI9KG9bbD4+PjI0XTw8MjR8b1tmPj4+MTYmMjU1XTw8MTZ8b1tkPj4+OCYyNTVdPDw4fG9bMjU1JmhdKV5yW3BdO3ArPTE7dmFyIF89KG9bZj4+PjI0XTw8MjR8b1tkPj4+MTYmMjU1XTw8MTZ8b1toPj4+OCYyNTVdPDw4fG9bMjU1JmxdKV5yW3BdO3ArPTE7dmFyIHc9KG9bZD4+PjI0XTw8MjR8b1toPj4+MTYmMjU1XTw8MTZ8b1tsPj4+OCYyNTVdPDw4fG9bMjU1JmZdKV5yW3BdO3ArPTE7dmFyIHg9KG9baD4+PjI0XTw8MjR8b1tsPj4+MTYmMjU1XTw8MTZ8b1tmPj4+OCYyNTVdPDw4fG9bMjU1JmRdKV5yW3BdO3ArPTEsdVt0XT1iLHVbdCsxXT1fLHVbdCsyXT13LHVbdCszXT14fX1dKSxhfSgkZSk7RHQua2V5U2l6ZT04O3ZhciBCdD0kZS5fY3JlYXRlSGVscGVyKER0KSxFdD1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhKX0oWWUpO0V0LkVuY3J5cHRvcj1mdW5jdGlvbihlKXtzKGEsZSk7dmFyIHQ9ZChhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIHIodGhpcyxhKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gbihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9ZSxhPXRoaXMuX2NpcGhlcixuPWEuYmxvY2tTaXplLGk9dGhpcy5faXYscz10aGlzLl9jb3VudGVyO2kmJih0aGlzLl9jb3VudGVyPWkuc2xpY2UoMCkscz10aGlzLl9jb3VudGVyLHRoaXMuX2l2PXZvaWQgMCk7dmFyIG89cy5zbGljZSgwKTthLmVuY3J5cHRCbG9jayhvLDApLHNbbi0xXT1zW24tMV0rMXwwO2Zvcih2YXIgdT0wO3U8bjt1Kz0xKXJbdCt1XV49b1t1XX19XSksYX0oRXQpLEV0LkRlY3J5cHRvcj1FdC5FbmNyeXB0b3I7dmFyIFR0PXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sVXQ9e2RlY3J5cHRXb3JkQXJyYXk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBhPUllLnBhcnNlKHQpLG49SWUucGFyc2UoYWUocikpLGk9UGUuY3JlYXRlKG5ldyBVaW50OEFycmF5KGUpKSxzPUJ0LmRlY3J5cHQoZXQuY3JlYXRlKHtjaXBoZXJ0ZXh0Oml9KSxhLHtpdjpuLG1vZGU6RXQscGFkZGluZzpUdH0pO3JldHVybiBVdC53b3JkQXJyYXlUb1VpbnQ4QXJyYXkocyl9LHdvcmRBcnJheVRvVWludDhBcnJheTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5zaWdCeXRlcyxyPWUud29yZHMsYT1uZXcgVWludDhBcnJheSh0KSxuPTAsaT0wO24hPT10Oyl7dmFyIHM9cltpKytdO2lmKGFbbisrXT0oNDI3ODE5MDA4MCZzKT4+PjI0LG49PT10KWJyZWFrO2lmKGFbbisrXT0oMTY3MTE2ODAmcyk+Pj4xNixuPT09dClicmVhaztpZihhW24rK109KDY1MjgwJnMpPj4+OCxuPT09dClicmVhazthW24rK109MjU1JnN9cmV0dXJuIGF9LGRlY29kZXJBRVNDVFJEYXRhOmZ1bmN0aW9uKGUsdCxyKXtpZihlLnZpZGVvU2VuYyl7dmFyIGE9ZS5raWRWYWx1ZSxuPWUudmlkZW9TZW5jO2Uuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0LGkpe3ZhciBzPW5baV0sbz10LmRhdGEsdT1bXSxjPVtdLGw9cy5Jbml0aWFsaXphdGlvblZlY3RvcjtpZihzLnN1YnNhbXBsZXMmJnMuc3Vic2FtcGxlcy5sZW5ndGgpcy5zdWJzYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUuQnl0ZXNPZkNsZWFyRGF0YStlLkJ5dGVzT2ZQcm90ZWN0ZWREYXRhLHI9by5zbGljZSgwLHQpO3UucHVzaChyLnNsaWNlKDAsZS5CeXRlc09mQ2xlYXJEYXRhKSksYy5wdXNoKHIuc2xpY2UoZS5CeXRlc09mQ2xlYXJEYXRhKSksbz1vLnNsaWNlKHQpfSkpO2Vsc2V7dmFyIGY9dC5zaXplO3UucHVzaChvLnNsaWNlKDAsMCkpLGMucHVzaChvLnNsaWNlKDAsZikpLG89by5zbGljZShmKX12YXIgZD1uZXcgRGU7ZC53cml0ZS5hcHBseShkLGMpO3ZhciBoPXI/cihkLmJ1ZmZlcixhLGwpOlV0LmRlY3J5cHRXb3JkQXJyYXkoZC5idWZmZXIsYSxsKSxwPW5ldyBEZTt1LmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7dmFyIHI9Y1t0XS5sZW5ndGgsYT1oLnNsaWNlKDAscik7cC53cml0ZShlKSxwLndyaXRlKGEpLGg9aC5zbGljZShyKX0pKSxlLnNhbXBsZXNbaV0uZGF0YT1wLmJ1ZmZlcn0pKX1pZih0LmF1ZGlvU2VuYyl7dmFyIGk9dC5raWRWYWx1ZSxzPXQuYXVkaW9TZW5jO3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlLGEpe3ZhciBuPXNbYV0sbz1yP3IoZS5kYXRhLGksbi5Jbml0aWFsaXphdGlvblZlY3Rvcik6VXQuZGVjcnlwdFdvcmRBcnJheShlLmRhdGEsaSxuLkluaXRpYWxpemF0aW9uVmVjdG9yKTt0LnNhbXBsZXNbYV0uZGF0YT1vfSkpfX19LEN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LGEsbixzKXt2YXIgbz10aGlzO3IodGhpcyxlKSxpKHRoaXMsIl92aWRlb1NhbXBsZXMiLFtdKSxpKHRoaXMsIl9hdWRpb1NhbXBsZXMiLFtdKSxpKHRoaXMsIl9sYXN0UmVtYWluQnVmZmVyIixbXSksaSh0aGlzLCJfbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zIiwwKSx0aGlzLnZpZGVvVHJhY2s9bmV3IHosdGhpcy5hdWRpb1RyYWNrPW5ldyBPLHRoaXMubWV0YWRhdGFUcmFjaz1ufHxuZXcgaix0aGlzLmxvZz1uZXcgVGUoIk1QNERlbXV4ZXIiLCFzfHwhcy5vcGVuTG9nfHwhcy5vcGVuTG9nKSx0JiZ0LmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0Oyh0PW8uX3ZpZGVvU2FtcGxlcykucHVzaC5hcHBseSh0LHkoZS5mcmFtZXMpKX0pKSxhJiZhLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0Oyh0PW8uX2F1ZGlvU2FtcGxlcykucHVzaC5hcHBseSh0LHkoZS5mcmFtZXMpKX0pKX1yZXR1cm4gbihlLFt7a2V5OiJwYXJzZVNhbXBsZXMiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFlKXRocm93IG5ldyBFcnJvcigibW9vdiBpcyByZXF1aXJlZCIpO2lmKHRoaXMudmlkZW9UcmFjay5jb2RlY3x8dGhpcy5hdWRpb1RyYWNrLmNvZGVjfHwoZ2UubW9vdlRvVHJhY2soZSx0aGlzLnZpZGVvVHJhY2ssdGhpcy5hdWRpb1RyYWNrKSx0aGlzLnZpZGVvU2VuYz10aGlzLnZpZGVvVHJhY2sudmlkZW9TZW5jLHRoaXMuYXVkaW9TZW5jPXRoaXMuYXVkaW9UcmFjay5hdWRpb1NlbmMpLCF0aGlzLl9hdWRpb1NhbXBsZXMubGVuZ3RoJiYhdGhpcy5fdmlkZW9TYW1wbGVzLmxlbmd0aCl7dmFyIHQ9Z2UubW9vdlRvU2FtcGxlcyhlKTtpZighdCl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBwYXJzZSBzYW1wbGVzIGZyb20gbW9vdiBib3giKTt0aGlzLl92aWRlb1NhbXBsZXM9dC52aWRlb1NhbXBsZXN8fFtdLHRoaXMuX2F1ZGlvU2FtcGxlcz10LmF1ZGlvU2FtcGxlc3x8W119fX0se2tleToiZGVtdXgiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLGEsbil7dGhpcy5wYXJzZVNhbXBsZXMobik7dmFyIGkscyxvLHU9dGhpcy52aWRlb1RyYWNrLGM9dGhpcy5hdWRpb1RyYWNrO2lmKHUuc2FtcGxlcz1bXSxjLnNhbXBsZXM9W10scil7Zm9yKHZhciBsLGY9MCxkPXJbMF0saD1yWzFdO2Q8PWg7ZCsrKXtpZighKGk9dGhpcy5fdmlkZW9TYW1wbGVzW2RdKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQoZCkpO289aS5vZmZzZXQtdCxzPWUuc3ViYXJyYXkobyxvK2kuc2l6ZSksKGw9bmV3IFIoaS5wdHN8fGkuZHRzLGkuZHRzKSkuZHVyYXRpb249aS5kdXJhdGlvbixsLmdvcElkPWkuZ29wSWQsaS5rZXlmcmFtZSYmbC5zZXRUb0tleWZyYW1lKCk7Zm9yKHZhciBwPTAsdj1zLmxlbmd0aC0xO3A8djspZj1lZShzLHApLHArPTQsbC51bml0cy5wdXNoKHMuc3ViYXJyYXkocCxwK2YpKSxwKz1mO3Uuc2FtcGxlcy5wdXNoKGwpfXUuYmFzZU1lZGlhRGVjb2RlVGltZT11LnNhbXBsZXNbMF0uZHRzfWlmKGEpe2Zvcih2YXIgeT1hWzBdLG09YVsxXTt5PD1tO3krKyl7aWYoIShpPXRoaXMuX2F1ZGlvU2FtcGxlc1t5XSkpdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm91bmQgdmlkZW8gZnJhbWUgIyIuY29uY2F0KHkpKTtvPWkub2Zmc2V0LXQscz1lLnN1YmFycmF5KG8sbytpLnNpemUpLGMuc2FtcGxlcy5wdXNoKG5ldyBMKGkuZHRzLHMsaS5kdXJhdGlvbikpfWMuYmFzZU1lZGlhRGVjb2RlVGltZT1jLnNhbXBsZXNbMF0uZHRzfXJldHVybnt2aWRlb1RyYWNrOnUsYXVkaW9UcmFjazpjLG1ldGFkYXRhVHJhY2s6dGhpcy5tZXRhZGF0YVRyYWNrfX19LHtrZXk6ImRlbXV4UGFydCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsYSxuLGkscyxvKXtpZih0aGlzLnBhcnNlU2FtcGxlcyhuKSx0aGlzLnZpZGVvVHJhY2sudXNlRU1FPWksdGhpcy5hdWRpb1RyYWNrLnVzZUVNRT1pLHRoaXMuX2xhc3RSZW1haW5CdWZmZXImJnRoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aD4wJiZ0PnRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcyYmdDw9dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zK3RoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aClmb3IodmFyIHU9MDt1PDIwOyl0cnl7dmFyIGM9dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5zdWJhcnJheSgwLHQtdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zKSxsPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCtjLmJ5dGVMZW5ndGgpO2wuc2V0KGMsMCksbC5zZXQobmV3IFVpbnQ4QXJyYXkoZSksYy5ieXRlTGVuZ3RoKSxlPWwsdC09Yy5ieXRlTGVuZ3RoLHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9bnVsbCx0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MDticmVha31jYXRjaChCKXtpZighKHU8MjApKXRocm93IG5ldyBFcnJvcigibmV3IFVpbnQ4QXJyYXkgZXJyb3I6LCIrQi5lcnJvck1lc3NhZ2UpO3UrK312YXIgZixkLGgscD10aGlzLnZpZGVvVHJhY2ssdj10aGlzLmF1ZGlvVHJhY2s7cC5zYW1wbGVzPVtdLHYuc2FtcGxlcz1bXSxwLnZpZGVvU2VuYz1udWxsLHYuYXVkaW9TZW5jPW51bGw7dmFyIHk9MCxtPTA7aWYodGhpcy5fdmlkZW9TYW1wbGVzLmxlbmd0aD4wJiZyLmxlbmd0aD4wKXtmb3IodmFyIGcsaz1lLmJ5dGVMZW5ndGgrdCxiPXJbMF07Yjw9clsxXTtiKyspe2lmKCEoZj10aGlzLl92aWRlb1NhbXBsZXNbYl0pKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGZvdW5kIHZpZGVvIGZyYW1lICMiLmNvbmNhdChiKSk7Zi5vZmZzZXQ+PXQmJmYub2Zmc2V0K2Yuc2l6ZTw9ayYmKHk9KGg9Zi5vZmZzZXQtdCkrZi5zaXplLGQ9ZS5zdWJhcnJheShoLHkpLChnPW5ldyBSKGYucHRzfHxmLmR0cyxmLmR0cykpLmR1cmF0aW9uPWYuZHVyYXRpb24sZy5nb3BJZD1mLmdvcElkLGcuc2FtcGxlT2Zmc2V0PWYuaW5kZXgsZi5rZXlmcmFtZSYmZy5zZXRUb0tleWZyYW1lKCksZy5kYXRhPWQsZy5zaXplPWYuc2l6ZSxwLnNhbXBsZXMucHVzaChnKSl9cC5zYW1wbGVzLmxlbmd0aD4wJiYocC5nb3BJZD1wLnNhbXBsZXNbMF0uZ29wSWQscC5iYXNlTWVkaWFEZWNvZGVUaW1lPXAuc2FtcGxlc1swXS5kdHMscC5zdGFydFB0cz1wLnNhbXBsZXNbMF0ucHRzL3AudGltZXNjYWxlLHAuZW5kUHRzPXAuc2FtcGxlc1twLnNhbXBsZXMubGVuZ3RoLTFdLnB0cy9wLnRpbWVzY2FsZSx0aGlzLnZpZGVvU2VuYyYmKHAudmlkZW9TZW5jPXRoaXMudmlkZW9TZW5jLnNsaWNlKHAuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQscC5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCtwLnNhbXBsZXMubGVuZ3RoKSxwLmtpZFZhbHVlPXMpKX1pZih0aGlzLl9hdWRpb1NhbXBsZXMubGVuZ3RoPjAmJmEubGVuZ3RoPjApe2Zvcih2YXIgXz1hWzBdO188PWFbMV07XysrKXtpZighKGY9dGhpcy5fYXVkaW9TYW1wbGVzW19dKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQoXykpO2Yub2Zmc2V0Pj10JiZmLm9mZnNldCtmLnNpemU8PWUuYnl0ZUxlbmd0aCt0JiYobT0oaD1mLm9mZnNldC10KStmLnNpemUsZD1lLnN1YmFycmF5KGgsbSksdi5zYW1wbGVzLnB1c2gobmV3IEwoZi5kdHMsZCxmLmR1cmF0aW9uLGYuaW5kZXgpKSl9di5zYW1wbGVzLmxlbmd0aD4wJiYodi5nb3BJZD12LnNhbXBsZXNbMF0uZ29wSWR8fHAuZ29wSWQsdi5iYXNlTWVkaWFEZWNvZGVUaW1lPXYuc2FtcGxlc1swXS5kdHMsdi5zdGFydFB0cz12LnNhbXBsZXNbMF0ucHRzL3YudGltZXNjYWxlLHYuZW5kUHRzPXYuc2FtcGxlc1t2LnNhbXBsZXMubGVuZ3RoLTFdLnB0cy92LnRpbWVzY2FsZSx0aGlzLmF1ZGlvU2VuYyYmKHYuYXVkaW9TZW5jPXRoaXMuYXVkaW9TZW5jLnNsaWNlKHYuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQsdi5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCt2LnNhbXBsZXMubGVuZ3RoKSx2LmtpZFZhbHVlPXMpKX10aGlzLmRlY29kZXJEYXRhKHAsdixvKTtmb3IodmFyIHc9MCx4PTA7eDxwLnNhbXBsZXMubGVuZ3RoO3grKylmb3IodmFyIFM9MCxBPXAuc2FtcGxlc1t4XS5kYXRhLEQ9QS5sZW5ndGgtMTtTPEQ7KXc9ZWUoQSxTKSxTKz00LHAuc2FtcGxlc1t4XS51bml0cy5wdXNoKEEuc3ViYXJyYXkoUyxTK3cpKSxTKz13O3JldHVybiB0aGlzLl9sYXN0UmVtYWluQnVmZmVyPWUuc3ViYXJyYXkoTWF0aC5tYXgoeSxtKSksdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoPjA/dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zPXQrZS5ieXRlTGVuZ3RoLXRoaXMuX2xhc3RSZW1haW5CdWZmZXIuYnl0ZUxlbmd0aDp0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MCx7dmlkZW9UcmFjazpwLGF1ZGlvVHJhY2s6dixtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl92aWRlb1NhbXBsZXM9W10sdGhpcy5fYXVkaW9TYW1wbGVzPVtdLHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9bnVsbCx0aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9MCx0aGlzLnZpZGVvVHJhY2sucmVzZXQoKSx0aGlzLmF1ZGlvVHJhY2sucmVzZXQoKSx0aGlzLm1ldGFkYXRhVHJhY2sucmVzZXQoKX19LHtrZXk6ImRlY29kZXJEYXRhIix2YWx1ZTpmdW5jdGlvbihlLHQscil7ZS51c2VFTUV8fHQudXNlRU1FfHxVdC5kZWNvZGVyQUVTQ1RSRGF0YShlLHQscil9fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZ2UucHJvYmUoZSl9fV0pLGV9KCksUHQ9e25vd1RpbWU6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIHBhcnNlSW50KHBlcmZvcm1hbmNlLm5vdygpLDEwKX1jYXRjaChlKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX19LGNvbmNhdERhdGE6ZnVuY3Rpb24oZSx0KXt2YXIgcj1bXSxhPTA7ZSYmci5wdXNoKGUpLHQmJnIucHVzaCh0KSxyLmV2ZXJ5KChmdW5jdGlvbihlKXtyZXR1cm4gZSYmKGErPWUuYnl0ZUxlbmd0aCksITB9KSk7dmFyIG49bmV3IFVpbnQ4QXJyYXkoYSksaT0wO3JldHVybiByLmV2ZXJ5KChmdW5jdGlvbihlKXtyZXR1cm4gZSYmKG4uc2V0KGUsaSksaSs9ZS5ieXRlTGVuZ3RoKSwhMH0pKSxufX07b25tZXNzYWdlPWZ1bmN0aW9uKGUpe3ZhciByPWUuZGF0YTtzd2l0Y2goci5tZXRob2Qpe2Nhc2UiaW5pdCI6dGhpcy5jb2RlY1R5cGU9ci5hcmdzLmNvZGVjVHlwZSx0aGlzLm9wZW5sb2c9ci5hcmdzLm9wZW5Mb2csdGhpcy5NUDREZW11eGVyPW51bGwsdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMCx0aGlzLnN1cHBvcnRIZXZjPXIuYXJncy5zdXBwb3J0SGV2YzticmVhaztjYXNlInRyYW5zbXV4Ijp2YXIgYT1lLmRhdGEuYXJncyxuPW5ldyBVaW50OEFycmF5KGUuZGF0YS5idWZmZXIpO3RoaXMuTVA0RGVtdXhlcnx8KHRoaXMuTVA0RGVtdXhlcj1uZXcgQ3QobnVsbCxudWxsLG51bGwse29wZW5sb2c6dGhpcy5vcGVubG9nfSkpO3ZhciBpLHM9dGhpcy5NUDREZW11eGVyLmRlbXV4UGFydChuLGEuc3RhcnQsYS52aWRlb0lkeCxhLmF1ZGlvSWR4LGEubW9vdixhLnVzZUVNRSxhLmtpZFZhbHVlKTtpZih0aGlzLkZNUDRSZW11eGVyfHwiaDI2NSI9PT10aGlzLmNvZGVjVHlwZSYmIXRoaXMuc3VwcG9ydEhldmN8fCh0aGlzLkZNUDRSZW11eGVyPW5ldyBVZSh0aGlzLk1QNERlbXV4ZXIudmlkZW9UcmFjayx0aGlzLk1QNERlbXV4ZXIuYXVkaW9UcmFjayx7b3BlbkxvZzp0aGlzLm9wZW5sb2d9KSksdGhpcy5GTVA0UmVtdXhlcil7dmFyIG89dGhpcy5GTVA0UmVtdXhlci5yZW11eCh0aGlzLl9uZWVkSW5pdFNlZ21lbnQse2luaXRNZXJnZTohMH0pO28uaW5pdFNlZ21lbnQmJih0aGlzLl9uZWVkSW5pdFNlZ21lbnQ9ITEpLGk9e2J1ZmZlcjpQdC5jb25jYXREYXRhKG8uYXVkaW9TZWdtZW50LG8udmlkZW9TZWdtZW50KSxyYW5nZTphLmNvbnRleHQucmFuZ2Usc3RhdGU6YS5jb250ZXh0LnN0YXRlLGNvbnRleHQ6e3JhbmdlOmEuY29udGV4dC5yYW5nZSxmcmFnSW5kZXg6YS5jb250ZXh0LmZyYWdJbmRleCxzdGFydFB0czpNYXRoLm1pbihzLnZpZGVvVHJhY2suc3RhcnRQdHMscy5hdWRpb1RyYWNrLnN0YXJ0UHRzKSxlbmRQdHM6TWF0aC5tYXgocy52aWRlb1RyYWNrLmVuZFB0cyxzLmF1ZGlvVHJhY2suZW5kUHRzKX0saW5pdFNlZzpvLmluaXRTZWdtZW50fX10aGlzLnBvc3RNZXNzYWdlKHttZXRob2Q6InRyYW5zbXV4IixpZDplLmRhdGEuaWQsYXJnczp0KHt9LGkpfSk7YnJlYWs7Y2FzZSJyZXNldCI6dGhpcy5GTVA0UmVtdXhlciYmdGhpcy5GTVA0UmVtdXhlci5yZXNldCgpLHRoaXMuTVA0RGVtdXhlciYmdGhpcy5NUDREZW11eGVyLnJlc2V0KCksdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuTVA0RGVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMH19fSgpOwo=",dn=typeof window<"u"&&window.Blob&&new Blob([atob(fa)],{type:"text/javascript;charset=utf-8"});function sl(){var a=dn&&(window.URL||window.webkitURL).createObjectURL(dn);try{return a?new Worker(a,{}):new Worker("data:application/javascript;base64,"+fa,{type:"module"})}finally{a&&(window.URL||window.webkitURL).revokeObjectURL(a)}}var ol=function(a){hi(t,a);var s=mi(t);function t(r){var e;return Vt(this,t),e=s.call(this),e.openlog=r.openLog,e.codecType=r.codecType,e.supportHevc=r.supportHevc,e.worker=new sl,e.worker.onmessage=function(i){e.emit(i.data.method,i.data)},e.worker.postMessage({method:"init",id:r.id||0,args:{openlog:e.openlog,supportHevc:e.supportHevc,codecType:e.codecType}}),e}return Tt(t,[{key:"transmux",value:function(e,i,n,o,l,u,c,d,h){var p=i.buffer;this.worker&&this.worker.postMessage({method:"transmux",id:e,buffer:p,args:{start:n,videoIdx:o,audioIdx:l,moov:u,useEME:c,kidValue:d,context:h}},[p])}},{key:"reset",value:function(){this.worker&&this.worker.postMessage({method:"reset"})}},{key:"destroy",value:function(){this.worker&&this.worker.terminate()}}]),t}(yt),Ye={ERROR:"error",META_READY:"metaReady",MOOV_REQ_PROGRESS:"moov_request_Progress",UPDATE_LOAD_IDX:"update_load_fragmentIdx"},ll=function(a){hi(t,a);var s=mi(t);function t(r,e){var i;if(Vt(this,t),i=s.call(this),ze(Xe(i),"onprogressDataArrive",function(){var n=Ve(re().mark(function o(l,u,c){var d;return re().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:l&&l.byteLength>0&&(d=i.timeRange[c.index].range,d&&c.range[1]>=d[1]&&!u&&(u=!0),i.log("[mp4.loadFragment onprogressDataArrive ] receive data, >>> index,",c.index,",range,",JSON.stringify(c.range),", dataLen,",l.byteLength),i._mux(l,c.range[0],c.index,u)),u&&(i.timeRange[c.index].downloaded=!0,i.bufferLoadedPos=-1,i.log("[FragLoadDowned],fragmentIdx,",c.index,",rangeEnd,",c.range[1]));case 2:case"end":return p.stop()}},o)}));return function(o,l,u){return n.apply(this,arguments)}}()),i.url=r,i.options=t.getDefaultConfig(),Object.keys(e).map(function(n){e[n]!==void 0&&e[n]!==null&&(i.options[n]=e[n])}),i.timeRange=[],i.CHUNK_SIZE=i.options.chunkSize,i.bufferLoaded=new Uint8Array(0),i.bufferLoadedPos=0,i.meta=null,i.videoTrak=null,i.audioTrak=null,i.canDownload=!0,i._loadSuccessCallBack=null,i._isPending=!1,i._metaLoading=!1,i.MP4Loader=new el(ft(ft({segmentDuration:i.options.segmentDuration,url:r,vid:e.vid,retry:i.options.retryCount,retryDelay:i.options.retryDelay,timeout:i.options.timeout},e.reqOptions),{},{openLog:Pt()})),i.fMP4Demuxer=null,i.MP4Demuxer=null,i.FMP4Remuxer=null,i._needInitSegment=!0,i._switchBitRate=!1,i.enableWorker=i.options.enableWorker,i.enableWorker&&typeof Worker<"u")try{i.workerSequence=0,i.transmuxerWorkerControl=new ol({id:i.workerSequence,codecType:e.codecType,supportHevc:i.options.supportHevc,openLog:Pt()}),i.transmuxerWorkerControl.on("transmux",function(n){var o=n.args;i.log("[transmuxerworker end] ,range, ",JSON.stringify(o.range),",dataLen,",o.buffer.byteLength,o.context),i._loadSuccessCallBack&&i._loadSuccessCallBack(o)})}catch(n){i.log("Error in worker:",n),i.enableWorker=!1,i.transmuxerWorkerControl=null}return i.enableWorker||(i.MP4Demuxer=null,i.FMP4Remuxer=null),i.seekTime=-1,i.changeBitRateTime=-1,i}return Tt(t,[{key:"changeBitRate",value:function(){var r=Ve(re().mark(function i(n){return re().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.url=n.url,l.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:this._switchBitRate=!0,this.log("[switchBitrate] changeUrl, bitRate,",this.url);case 5:case"end":return l.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"log",value:function(e){for(var i=this.options,n=i&&i.vid?"[MP4] ".concat(i.vid," ").concat(e):"[MP4] ".concat(e),o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];ma.apply(void 0,[n].concat(l))}},{key:"errorHandler",value:function(){var r=Ve(re().mark(function i(n,o){var l,u,c,d;return re().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:l=n.response,u=n.message,c=this.options?this.options.vid:"",d=null,this._isPending=!0,l?(d=new Yo("network",l.status,{httpText:l.httpText,message:u,url:l.url}),this.emit(Ye.ERROR,d)):(console.log("[MP4] [".concat(c,"] errorHandler,"),n),d=n,this.emit(Ye.ERROR,d));case 6:case"end":return p.stop()}},i,this)}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"init",value:function(){var r=Ve(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.url){o.next=3;break}return o.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+Date.now(),this.CHUNK_SIZE);case 3:return o.next=5,this.getMetaInfo();case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"getTimeRange",value:function(){for(var e=[],i=null,n=0;this.videoTrak&&n<this.videoTrak.length;n++)i={startTime:this.videoTrak[n].startTime,endTime:this.videoTrak[n].endTime,downloaded:!1,isLoading:!1},e.push(i);if(this.audioTrak&&this.audioTrak.length>e.length)for(var o=e.length;o<this.audioTrak.length;o++)i={startTime:Math.max(this.audioTrak[o].startTime,i?i.endTime:0),endTime:Math.max(this.audioTrak[o].endTime,i?i.endTime:0),downloaded:!1,isLoading:!1},e.push(i);return e}},{key:"getMetaInfo",value:function(){var r=Ve(re().mark(function i(){var n=this,o,l,u,c=arguments;return re().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=c.length>0&&c[0]!==void 0?c[0]:!0,h.prev=1,this._metaLoading=!0,this.log("getMetaInfo start"),this.bufferLoaded=new Uint8Array(0),l=0,u=function(){var p=Ve(re().mark(function v(Z,b,L){var w;return re().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:n.log("getMetaInfo onProgressHandle, dataLen,",Z?Z.byteLength:-1,", state,",b,",range,",JSON.stringify(L.range)),Z&&L.range[0]===l&&(n.bufferLoaded=xo(Uint8Array,n.bufferLoaded,new Uint8Array(Z)),l+=Z.byteLength),L.meta&&!n.meta&&(w=L.meta,n.videoTrak=w.videoSegments,n.audioTrak=w.audioSegments,n.timeRange=n.getTimeRange(),n.meta=ft(ft({},w.meta),{},{ext:{videoTrak:n.videoTrak,audioTrak:n.audioTrak}}),w.bufferLoaded=n.bufferLoaded,n.log("meta reach"),o&&n.emit(Ye.META_READY,n.meta)),n.meta&&b&&(n.log("[getMetaInfo req end]"),n._metaLoading=!1),n.meta&&(Z||b)&&(n.log("emit moov_req_progress"),n.emit(Ye.MOOV_REQ_PROGRESS));case 5:case"end":return X.stop()}},v)}));return function(Z,b,L){return p.apply(this,arguments)}}(),h.next=9,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this.CHUNK_SIZE],u);case 9:h.next=15;break;case 11:h.prev=11,h.t0=h.catch(1),console.error("[MP4] trigger errorHandler getMetaInfo",h.t0===null||h.t0===void 0?void 0:h.t0.message),this.loadError(h.t0,"getMetaInfo");case 15:case"end":return h.stop()}},i,this,[[1,11]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"getFragmentIdx",value:function(e){var i,n;if(this.videoTrak.length){if(i=this.videoTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),n=this.audioTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),i&&n)return Math.min(i.index,n.index);if(i||n)return i?i.index:n.index;var o=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(o=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(o=Math.min(this.audioTrak.length-1,o)),o}else return n=this.audioTrak.find(function(l){return l.startTime<=e&&l.endTime>e}),n?n.index:0}},{key:"_checkHasMeta",value:function(){var r=Ve(re().mark(function i(){var n;return re().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.log(" loadMeta start"),this._metaLoading=!0,l.next=4,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 4:return n=l.sent,this._metaLoading=!1,this.videoTrak=n.videoSegments,this.audioTrak=n.audioSegments,this.meta=ft(ft({},n.meta),{},{ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak}}),this.timeRange=this.getTimeRange(),this.bufferLoaded=new Uint8Array(0),n.bufferLoaded=this.bufferLoaded,l.abrupt("return",!0);case 13:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"resetFragmentLoadState",value:function(e){for(var i=0;i<this.timeRange.length;i++)i<e?(this.timeRange[i].downloaded=!0,this.timeRange[i].isLoading=!0):(this.timeRange[i].downloaded=!1,this.timeRange[i].isLoading=!1)}},{key:"getFragRange",value:function(e){var i,n,o,l,u=null;this.videoTrak&&(u=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1]);var c=null;this.audioTrak&&(c=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1]);var d=0,h=0;this.videoTrak&&e>=this.videoTrak.length-1&&(d=-1),this.audioTrak&&e>=this.audioTrak.length-1&&(h=-1);var p=[Math.min(((i=u)===null||i===void 0?void 0:i.range[0])||1/0,((n=c)===null||n===void 0?void 0:n.range[0])||1/0),Math.max(((o=u)===null||o===void 0?void 0:o.range[1])+d||0,((l=c)===null||l===void 0?void 0:l.range[1])+h||0)];return e<this.timeRange.length&&(this.timeRange[e].range=p),p}},{key:"load",value:function(){var r=Ve(re().mark(function i(n,o){var l,u,c;return re().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this._loadSuccessCallBack=o,!(this._switchBitRate&&!this._metaLoading)){h.next=12;break}return this.log("[switchBitrate], switch bitRate start load, time,",n>=this.videoTrak.length?this.audioTrak[n].startTime:this.videoTrak[n].startTime,", fragIndex,",n),h.next=5,this._checkHasMeta();case 5:l=h.sent,this.changeBitRateTime>0&&(this.timeRange[n].startTime<=this.changeBitRateTime&&this.changeBitRateTime<this.timeRange[n].endTime?this.log("[switchBitrate], not need update load fragIndex",n,",stTime,",this.changeBitRateTime):(n=this.getFragmentIdx(this.changeBitRateTime),this.log("[switchBitrate], need update load fragIndex",n,",stTime,",this.changeBitRateTime,",newBitrateTimeRange,",this.timeRange[n].startTime,"-",this.timeRange[n].endTime),this.emit(Ye.UPDATE_LOAD_IDX,n)),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1),this.resetFragmentLoadState(n),this.log("[switchBitrate], reset timerange state,",n),this._needInitSegment=!0,this.resetTansmuxer(),l&&(this._switchBitRate=!1);case 12:if(!(this._switchBitRate&&this._metaLoading)){h.next=14;break}return h.abrupt("return");case 14:u=this.getFragRange(n),this.log("loadFragment,",n,",range,",JSON.stringify(u)),this.seekTime>0?(c=this.getSubRange(n,this.seekTime,u),this.loadFragment(n,c),this.seekTime=-1):this.loadFragment(n,u);case 17:case"end":return h.stop()}},i,this)}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"getSubRange",value:function(e,i,n){var o=n[0],l=n[0],u=1,c=!1;if(this.log(">>>>>getSubRange time,",i,JSON.stringify(n)),this.videoTrak){var d=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1];if(d.frames.length===0)return this.log(">>>>>getSubRange video, no frames"),n;var h=d.frames.filter(ul),p=this.meta.videoTimescale,v=h[0].startTime/p;this.log(">>>>>getSubRange video, startTime,",d.startTime,",endTime,",d.endTime);for(var Z=0;Z<h.length;Z++)this.log(">>>>>getSubRange video keyFrameList, startTime,",h[Z].startTime/p,",range,",h[Z].offset);for(;u<h.length;u++){var b=h[u].startTime/p;if(v<=i&&i<b&&n[0]<h[u-1].offset){o=h[u-1].offset,c=!0,this.log(">>>>>getSubRange video end, startTime,",v,",endTime,",b,",startRange,",o,", keyFrameIndex,",u-1);break}v=b}!c&&v<=i&&i<d.endTime+.8&&(o=h[u-1].offset,this.log(">>>>>getSubRange video last, startTime,",v,",endTime,",d.endTime,",startRange,",o))}if(u=1,this.audioTrak){var L=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1];if(L.frames.length===0)return this.log(">>>>>getSubRange video, no frames"),n;var w=L.frames,W=this.meta.audioTimescale;u=Math.floor((i*W-w[0].startTime)/L.frames[0].duration),u=Math.min(w.length-1,u);for(var X=u>0?w[u-1].startTime/W:w[0].startTime/W;u>=0&&u<w.length;){if(u>0&&X>i){u-=1,X=w[u].startTime/W;continue}var S=(w[u].startTime+w[u].duration)/W;if(X<=i&&i<S&&n[0]<w[u].offset){l=w[u].offset,c=!0,this.log(">>>>>getSubRange audio end, startTime,",X,",endTime,",S,",startRange,",l,", index,",u);break}X=S,u++}}var R=[Math.min(l,o),n[1]];return this.log(">>>>>getSubRange finalRange ",JSON.stringify(R),",oldRange,",JSON.stringify(n)),R}},{key:"_mux",value:function(e,i,n,o){var l=this.getSamplesRange(n,"video"),u=this.getSamplesRange(n,"audio"),c=[i,i+e.byteLength];if(this.transmuxerWorkerControl&&!this.meta.isFragmentMP4){var d={range:c,state:o,fragIndex:n};this.log("[transmuxerworker start] ,range, ",JSON.stringify(c),",dataLen,",e.byteLength,d),this.transmuxerWorkerControl.transmux(this.workerSequence,e,i,l,u,this.meta.moov,this.useEME,this.kidValue,d)}else try{var h;this.meta.isFragmentMP4?(this.fMP4Demuxer||(this.fMP4Demuxer=new Dn),h=this.fMP4Demuxer.demuxPart(e,i,this.meta.moov)):(this.MP4Demuxer||(this.MP4Demuxer=new Cs(this.videoTrak,this.audioTrak,null,{openLog:Pt()})),h=this.MP4Demuxer.demuxPart(e,i,l,u,this.meta.moov,this.useEME,this.kidValue)),!this.FMP4Remuxer&&(!this.checkCodecH265()||this.options.supportHevc)&&(this.FMP4Remuxer=new ci(h.videoTrack,h.audioTrack,{openLog:Pt()}));var p;this.log("[mux], videoTimeRange,",h.videoTrack?[h.videoTrack.startPts,h.videoTrack.endPts]:null,",audioTimeRange,",h.audioTrack?[h.audioTrack.startPts,h.audioTrack.endPts]:null);var v=Math.min(h.videoTrack.startPts,h.audioTrack.startPts),Z=Math.max(h.videoTrack.endPts,h.audioTrack.endPts),b=[v,Z];if(this.FMP4Remuxer){var L=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:c});L.initSegment&&(this._needInitSegment=!1);var w=et.concatData(L.audioSegment,L.videoSegment);p={buffer:w,range:c,state:o,context:{range:c,fragIndex:n,timeRange:b},initSeg:L.initSegment}}else p={videoTrack:h.videoTrack,audioTrack:h.audioTrack,buffer:null,range:c,state:o,context:{range:c,fragIndex:n,timeRange:b}};this._loadSuccessCallBack&&this._loadSuccessCallBack(p)}catch(X){console.error("mux err:",X);var W=new Io(Mt.remux,$e.muxError,{msg:JSON.stringify(X)});this.errorHandler(W,"mux",{fragIndex:n,range:[i,i+e.byteLength]})}}},{key:"getSamplesRange",value:function(e,i){var n=[];switch(i){case"video":if(this.videoTrak&&e<this.videoTrak.length){var o=this.videoTrak[e].frames;if(!o.length)break;n.push(o[0].index),n.push(o[o.length-1].index)}break;case"audio":if(this.audioTrak&&e<this.audioTrak.length){var l=this.audioTrak[e].frames;if(!l.length)break;n.push(l[0].index),n.push(l[l.length-1].index)}break;default:console.warn("[getSamplesRange] type ",i," is invalid");break}return n}},{key:"loadFragment",value:function(){var r=Ve(re().mark(function i(n,o){var l,u,c,d;return re().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this._isPending||o.length>0&&o[0]===0&&o[1]===0||this.timeRange[n].isLoading)){p.next=2;break}return p.abrupt("return");case 2:if(this.log("[MP4.loadFragment] ,fragIndex,",n,",range ",o,",len ,",o[1]-o[0],", bufferLoaded_Len,",this.bufferLoaded.byteLength),!(o.length>=2&&o[1]&&o[1]>0&&o[1]<=this.bufferLoaded.byteLength)){p.next=13;break}this.timeRange[n].isLoading=!0,l=Math.max(o[0],this.bufferLoadedPos),u=new Uint8Array(this.bufferLoaded.slice(l,o[1])),this.log("[mp4.loadFragment] has all data: ",l,o[1]),this.timeRange[n].downloaded=!0,this.bufferLoadedPos=-1,this._mux(u,l,n,!0),p.next=34;break;case 13:if(!(o.length>=2&&o[0]&&o[0]<=this.bufferLoaded.byteLength)){p.next=29;break}if(this.timeRange[n].isLoading){p.next=27;break}if(c=Math.max(o[0],this.bufferLoadedPos),d=new Uint8Array(this.bufferLoaded.slice(c,o[1])),!(d.byteLength>0)){p.next=22;break}return this.bufferLoadedPos=c+d.byteLength,this.log("[mp4.loadFragment] has part data: ",c,c+d.byteLength),this._mux(d,c,n,o[1]<=this.bufferLoadedPos),p.abrupt("return");case 22:if(!(!this._metaLoading&&!this.timeRange[n].isLoading)){p.next=27;break}return this.log("[mp4.loadFragment] ready to load part data >>> ",this.bufferLoaded.byteLength,o[1]),this.timeRange[n].isLoading=!0,p.next=27,this.startLoad([this.bufferLoaded.byteLength,o[1]],n);case 27:p.next=34;break;case 29:if(!((!this._metaLoading||o[0]>=this.CHUNK_SIZE)&&!this.timeRange[n].isLoading)){p.next=34;break}return this.timeRange[n].isLoading=!0,this.log("[mp4.loadFragment],ready to load all data ,segmentIdx, ",n,",range >>> ",JSON.stringify(o)),p.next=34,this.startLoad(o,n);case 34:case"end":return p.stop()}},i,this)}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"startLoad",value:function(){var r=Ve(re().mark(function i(n,o){return re().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,this.MP4Loader.loadData(n,this.MP4Loader.cache,{index:o,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen});case 3:u.next=9;break;case 5:u.prev=5,u.t0=u.catch(0),console.error("[MP4] trigger errorHandler getMetaInfo",u.t0===null||u.t0===void 0?void 0:u.t0.message),this.loadError(u.t0,"loadFragment",{range:n,fragIndex:o});case 9:case"end":return u.stop()}},i,this,[[0,5]])}));function e(i,n){return r.apply(this,arguments)}return e}()},{key:"loadError",value:function(e,i,n){var o;!e.response&&(e.response={}),e.isTimeout?e.response.status="timeout":e!=null&&(o=e.response)!==null&&o!==void 0&&o.status||(e.response.status="networkError"),this.errorHandler(e,i,n)}},{key:"cancelLoading",value:function(){var r=Ve(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.MP4Loader;case 2:if(o.t0=o.sent,!o.t0){o.next=5;break}this.MP4Loader.cancel();case 5:case"end":return o.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"update",value:function(e){this.url=e}},{key:"checkCodecH265",value:function(){var e=this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1);return e}},{key:"destroy",value:function(){this.hasDestroyed||(this.resetTansmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this._isPending=!1,this._metaLoading=!1,this.bufferLoadedPos=0,this.bufferLoaded=new Uint8Array(0),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this.hasDestroyed=!0)}},{key:"resetTansmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}}],[{key:"getDefaultConfig",value:function(){return{segmentDuration:5,onProcessMinLen:1024,chunkSize:8e5,retryCount:3,retryDelay:1e3,timeout:3e3,enableWorker:!1,playerId:"",vid:"",ext:{}}}}]),t}(yt);function ul(a){if(a.keyframe)return a}var cl=function(){function a(s){Vt(this,a),this.onTick_=s,this.cancelPending_=null}return Tt(a,[{key:"tickAfter",value:function(t){var r=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.stop();var i=!0,n=null;this.cancelPending_=function(){window.clearTimeout(n),i=!1};var o=function(){i&&(r.onTick_(),e&&e())};return n=window.setTimeout(o,t*1e3),this}},{key:"tickEvery",value:function(t){var r=this;this.tickAfter(t,function(){r.tickEvery(t)})}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),a}(),dl=function(){function a(){Vt(this,a);var s,t,r=new Promise(function(i,n){s=i,t=n}),e=r;return e.resolve=function(i){s(i),e.state="fulfilled"},e.reject=function(i){t(i),e.state="rejected",e.isBreak=i==="DESTROYED"},e.state="pending",e}return Tt(a,[{key:"resolve",value:function(t){}},{key:"reject",value:function(t){}}]),a}(),hl="DESTROYED",hn=null,Hr=null,mn=null,fn=null,pl=function(a){hi(t,a);var s=mi(t);function t(r){var e;return Vt(this,t),e=s.call(this,r),ze(Xe(e),"_onMp4DataCallBack",function(){e._isMseInit&&e._onTimeUpdate()}),ze(Xe(e),"_onMp4MetaReady",function(i){var n=Xe(e),o=n.config,l=e.mp4.checkCodecH265();try{if(l&&!e.config.supportHevc){var u="browser not support HEVC",c=new St(e.player,{errorType:"runtime",errorTypeCode:Mt.runtime,errorCode:$e.h265Error,errorMessage:u,vid:o.vid,mediaError:{code:$e.h265Error,message:u}});e._errorHandler(c)}else e._initMse(i),e._initPromise.resolve()}catch(h){var d=new St(e.player,{errorType:"runtime",errorTypeCode:Mt.runtime,errorCode:$e.mse,errorMessage:h==null?void 0:h.message,vid:o.vid,mediaError:{code:$e.other1,message:h==null?void 0:h.message}});e._errorHandler(d);return}e._loadData()}),ze(Xe(e),"_onMp4Error",function(i){var n=e.playerConfig.vid;console.error("[Index] _onMp4Error",n,i),e._errorHandler(i)}),ze(Xe(e),"_loadDataSuccess",function(i){if(!(e.isDestroy||!e.mse)){e.log("[loadFragment] _loadDataSuccess ",JSON.stringify(i.context.range),",dataLen,",i.buffer?i.buffer.byteLength:0,i.state);try{i.initSeg&&(e._appendInitSeg(i.initSeg),(!i.buffer||i.buffer.byteLength<1)&&(e.log("no data, must load data"),e._onTimeUpdate()));var n=i.buffer,o=i.state,l=i.context;if(e.mse&&o&&(!n||n.byteLength<=0)&&l.fragIndex===e.mp4.timeRange.length-1){var u=e.player.buffered;u&&u.length>0&&(e.bufferEndTime=u.end(u.length-1)),e._isEnded(),e.log("loaded ended !!!==>>>",JSON.stringify(l.range),", fragIndex,",l.fragIndex,", bufferEndTime,",e.bufferEndTime,",meta_duration,",e.mp4.meta.duration)}if(e.mse&&o&&l.fragIndex===e.mp4.timeRange.length-1&&(!n||n.byteLength<=0)){var c=e.player.buffered;c&&c.length>0&&(e.bufferEndTime=c.end(c.length-1)),e._isEnded(),e.log("load ended !!!==>>>",e.playerConfig.vid,JSON.stringify(l.range),", fragIndex,",l.fragIndex,", bufferEndTime,",e.bufferEndTime,",meta_duration,",e.mp4.meta.duration)}n&&e.mse&&n&&n.byteLength>0&&e._appendBuffer(he.VIDEO,n,l,o)}catch(h){e.log("appendBuffer error",h);var d=new St(e.player,{errorType:"runtime",errorTypeCode:Mt.runtime,errorCode:$e.mse,vid:e.player.config.vid,errorMessage:h.message,mediaError:{code:$e.mse,message:h.message}});e._errorHandler(d)}i!=null&&i.state&&e._onTimeUpdate()}}),ze(Xe(e),"_onWaiting",function(){var i=Xe(e),n=i.player,o=i.config;clearTimeout(e._waitInBufferTimer),e._waitInBufferTimer=null;var l=n.currentTime,u=n.bufferedPoint;u.end>0&&u.end-n.currentTime>=2&&e._waitAdjustTimeCnt<o.waitJampBufferMaxCnt&&(e._waitInBufferTimer=setTimeout(function(){e._waitAdjustTimeCnt++,n.currentTime=n.currentTime+.5,e.log("[waitInBufferTimeout], waitAdjustTimeCnt,",e._waitAdjustTimeCnt,",curtime,",l,et.nowTime())},o.waitingInBufferTimeOut))}),ze(Xe(e),"_onSeeking",Ve(re().mark(function i(){var n,o,l,u,c,d,h,p,v,Z,b;return re().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(n=Xe(e),o=n.player,l=n.mp4,u=o.currentTime,e.log("[seekTime], curTime,",u,",buffer,",o.buffered2.bufferedList),!(!l||!l.meta)){w.next=5;break}return w.abrupt("return");case 5:if(e.endofstream=!1,l.bufferLoadedPos=-1,l._metaLoading=!1,c=o.bufferedPoint,d=!1,h=0,!(c.end>0)){w.next=25;break}if(d=!0,!(l.meta.duration-c.end<.5)){w.next=17;break}return e._startProgress(),e.log("[seeking in buffered range], buffer end,",c.end,", duration,",l.meta.duration),w.abrupt("return");case 17:if(h=l.getFragmentIdx(c.end),e._curLoadSegmentIdx!==h){w.next=22;break}return e._startProgress(),e.log("[seeking in buffered range], seek fragIndex is current load segmentIdx",h),w.abrupt("return");case 22:l.seekTime=c.end,h<0&&(h=e._curLoadSegmentIdx),e.log("[seeking in buffered range], seekTime ",u,",bufferRange,",c.start,"-",c.end,", fragIndex,",h);case 25:return d||(l.seekTime=u,h=l.getFragmentIdx(u),h<0&&(h=e._curLoadSegmentIdx),e.log("[seekTime out buffer range], curTime,",u,", Idx,",h),p=Xe(e),v=p.mse,v&&v.isFull()&&(Z=o.buffered2.bufferedList,b=Z[Z.length-1],v.clearOpQueues(he.VIDEO),e._checkRemoveSourceBuffer([b.start,b.end],o.currentTime,!0,!0))),w.next=28,l.cancelLoading();case 28:l.resetFragmentLoadState(h),e._curLoadSegmentIdx=h,e._onTimeUpdate(),e._startProgress(),e._isEnded();case 33:case"end":return w.stop()}},i)}))),ze(Xe(e),"changeDefineCanPlay",function(i,n,o,l){var u=Xe(e),c=u.player;if(c.ended){c.currentTime=0;return}e.log("[oldChangeDefinition],this._changeDefState,",e._changeDefState),c.currentTime=e._changeDefState?e._changeDefState.currentTime:i;var d=e._changeDefState?e._changeDefState.paused:n;d?c.pause():c.play(),e._changeDefState=null,c.emit(ya,{from:o,to:l})}),ze(Xe(e),"changeDefinition",function(){var i=Ve(re().mark(function n(o,l){var u,c,d,h,p,v,Z;return re().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(u=Xe(e),c=u.player,d=u.config,h=u.mp4,l||(l=c.curDefinition),e._MSEError=!1,!d.witchBitRateWay){L.next=6;break}return e.oldChangeDefinition(o,l),L.abrupt("return");case 6:if(c.emit(ba,{from:l,to:o}),p=c.currentTime,v=h.getFragmentIdx(p),v<0&&(v=e._curLoadSegmentIdx),e.log("switchBitrate:point,fragIndex,",v,",startTime,",h.timeRange[v].startTime,",currentTime,",c.currentTime),!h){L.next=16;break}return e.mp4.changeBitRateTime=p,L.next=15,h.cancelLoading();case 15:h._metaLoading&&(h._metaLoading=!1);case 16:return e._removeBuffeEndTime=h.timeRange[v].startTime,e._isChangeDefinition=!0,Z=c.getBufferedRange(c.buffered),Z[1]>0&&Z[1]-c.currentTime>5&&(e.mse.clearOpQueues(he.VIDEO),e.mse.remove(he.VIDEO,c.currentTime+5,Z[1])),e.log("switchBitrate: resetFragmentLoadState,",v),h.resetFragmentLoadState(v),e._curLoadSegmentIdx=v,L.next=25,e.mp4.changeBitRate(o);case 25:e._onTimeUpdate(),c.emit("RESOLUTION_UPDATE",o);case 27:case"end":return L.stop()}},n)}));return function(n,o){return i.apply(this,arguments)}}()),ze(Xe(e),"_replayHook",function(){var i;return(i=e.player)===null||i===void 0||i.play(),!1}),ze(Xe(e),"_retryHook",function(){return e.beforePlayerInit(),!1}),e.mp4=null,e.mse=null,e._waitAdjustTimeCnt=0,e._lastCheckTime=et.nowTime(),e._removeBuffeEndTime=0,e._pendingPromises=[],e}return Tt(t,[{key:"afterCreate",value:function(){var e=this;window.__mp4player=this;try{_t.defineGetterOrSetter(this.player,{__url:{get:function(){try{return e.mse?e.mse.url:e.config.url}catch{return null}}}})}catch{}this._proxyPlayer()}},{key:"attachEvents",value:function(){this.off(wr,this._onSeeking),this.on(wr,this._onSeeking),this.on(gi,this._onWaiting),this.off(Ht,this.switchURL),this.on(Ht,this.switchURL)}},{key:"detachEvents",value:function(){this.off(wr,this._onSeeking),this.off(gi,this._onWaiting),this.off(Ht,this.switchURL)}},{key:"_proxyPlayer",value:function(){var e=this;typeof this.player.playNext=="function"&&(hn=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},Hr=this.player._startInit,fn=this.player.switchURL,mn=this.player.changeDefinition,this.player._startInit=this._playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this),this.player.removeHooks("replay",this._replayHook),this.player.removeHooks("retry",this._retryHook)}},{key:"_playerStartInit",value:function(e){var i=this,n=this.config,o=this.playerConfig;n.supportHevc===void 0&&At!==null&&At!==void 0&&At.isHevcSupported&&At.isHevcSupported()&&(n.supportHevc=!0);var l=this.initMp4();this._initPromise=l,this._addPendingPromise(this._initPromise),this.mse&&va.typeOf(e)==="String"&&/^blob/.test(e)&&e!==this.mse.url&&(e=o.url),l.then(function(){i.mse&&(e=i.mse.url),i.attachEvents(),i._startProgress()}).catch(function(u){var c=i._initPromise?i._initPromise.isBreak:!1;if(!(i.isDestroy||c)){var d=u;d.errorCode||(d=new St(i.player,{errorType:Mt.RUNTIME,errorCode:(u==null?void 0:u.errorCode)||$e.other,vid:i.playerConfig.vid,errorMessage:(u==null?void 0:u.errorMessage)||(u==null?void 0:u.message),mediaError:{code:(u==null?void 0:u.httpCode)||$e.other,message:(u==null?void 0:u.errorMessage)||(u==null?void 0:u.message),errorType:u==null?void 0:u.errorType}}),d.url=e),i.useVideoLoad=!0,i.player.vtype="MP4_1",i.player.emit("playCatch",i.player.vtype,d)}}).finally(function(){if(i._initPromise){var u=i._initPromise.isBreak;u||(i._initPromise&&i._removePendingPromise(i._initPromise),i._initPromise=null,!i.isDestroy&&!u&&Hr.call(i.player,e))}})}},{key:"initMp4",value:function(){var e=this,i=this.player;i.config.vid||(i.config.vid=Date.now());var n=new dl;return this.mp4&&(this.mp4.off(Ye.META_READY,this._onMp4MetaReady),this.mp4.off(Ye.ERROR,this._onMp4Error),this.mp4.off(Ye.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mp4=new ll(i.config.url,ft(ft({},this.config),{},{vid:i.config.vid})),this.mp4.on(Ye.META_READY,this._onMp4MetaReady),this.mp4.on(Ye.ERROR,this._onMp4Error),this.mp4.on(Ye.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.on(Ye.UPDATE_LOAD_IDX,function(o){e._curLoadSegmentIdx=o,e.log("[update curLoadSegmentIdx]",o)}),this.mp4.init(),n}},{key:"setConfig",value:function(e){this.config=Object.assign(this.config,e)}},{key:"playNext",value:function(e){var i=this.player;this._defInited=!1,i.resetState(),i._currentTime=0,i._duration=0,i.isPlaying=!1,this._MSEError=!1,i.pause(),this._reset(),i.setConfig(e),this.log("[Index] playNext",e),i.play(),this.emit("playnext")}},{key:"checkDegrade",value:function(e){var i=this.config.closeDowngrade;return!i||e.httpCode==="networkError"}},{key:"_errorHandler",value:function(e){var i,n=this.player,o=this.config;if(!(!n||this.useVideoLoad)){!e.url&&(i=this.mp4)!==null&&i!==void 0&&i.url&&(e.url=this.mp4.url);var l=n.paused;console.error("final error !!!!, ",o.vid,e),this.player.vtype="MP4_2",this.player.emit("playCatch",this.player.vtype,e);var u=this.checkDegrade(e);if(u)this._initPromise?this._removeAndRejectInitPromise(e):this._startDegradedPlayback(e,l);else{this.player.pause(),this._reset();var c=n.currentTime;this.destroyMSE(),n.currentTime=c,this.emit("error",e)}}}},{key:"_startDegradedPlayback",value:function(e,i){var n=this;console.log(">>>_startDegradedPlayback");var o=this.player,l=this.playerConfig;this.useVideoLoad=!0,this.destroyMSE(),this._currentTime=o.currentTime,this.__onmetadataHandle=function(){n._currentTime&&(o.currentTime=n._currentTime),i?n.player.pause():n.player.play(),o.media.removeEventListener("loadedmetadata",n.__onmetadataHandle),n.__onmetadataHandle=null},o.media.addEventListener("loadedmetadata",this.__onmetadataHandle);var u=l.url;o.media.src=u}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){var i=this._pendingPromises.indexOf(e);i>-1&&this._pendingPromises.splice(i,1)}},{key:"_cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach(function(e){e.reject(hl)}),this._pendingPromises=[]}},{key:"_removeAndRejectInitPromise",value:function(e){this._initPromise&&(this._removePendingPromise(this._initPromise),this._initPromise.reject(e))}},{key:"_initMse",value:function(){var r=Ve(re().mark(function i(n){var o=this,l,u,c,d,h;return re().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!this.mse){v.next=4;break}return v.next=3,this.mse.unbindMedia();case 3:this.mse=null;case 4:l=!!n.videoCodec,u=!!n.audioCodec,l&&u?c='video/mp4; codecs="'.concat(n.videoCodec,', mp4a.40.5"'):l?c='video/mp4; codecs="'.concat(n.videoCodec,'"'):c='video/mp4; codecs="mp4a.40.5"',d=ze({},he.VIDEO,{mimeType:"video/mp4",codec:c}),this.mse=new he,h=this.mse.bindMedia(this.player.video),h.then(function(){var Z=Object.keys(d);try{for(var b=0;b<Z.length;b++){var L=Z[b];o.mse.createSource(L,d[L].codec)}}catch(w){console.error("MSE error: ",w),o._errorHandler(w)}o._isMseInit=!0,o._onTimeUpdate()});case 11:case"end":return v.stop()}},i,this)}));function e(i){return r.apply(this,arguments)}return e}()},{key:"destroyMSE",value:function(){var r=Ve(re().mark(function i(){var n;return re().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(n=this.mse)===null||n===void 0?void 0:n.unbindMedia();case 2:this.mse=null;case 3:case"end":return l.stop()}},i,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_onTimeUpdate",value:function(){var e=this,i=this.mse,n=this.mp4,o=this.player,l=this.config;if(n){var u=n.timeRange,c=o.getBufferedRange(o.buffered2);if(i&&n&&n.canDownload){et.nowTime()-this._lastCheckTime>1e3&&(this._lastCheckTime=et.nowTime(),this._loadStuckCheck(),this._checkRemoveSourceBuffer(c,o.currentTime));var d=o.paused?o.currentTime+l.minBufferLength:o.currentTime+l.maxBufferLength;c[1]-d<0&&u.every(function(h,p){if(h.downloaded)return!0;if(!e._isChangeDefinition&&h.endTime-h.startTime>1&&e._isInBuffer(h))return h.downloaded=!0,h.isLoading=!0,e.log("onTimeUpdate, ".concat(p," download segment, has buffer"),h.startTime,h.endTime),!0;h.startTime-o.currentTime<l.maxBufferLength&&(e._curLoadSegmentIdx=p,e.log("[onTimeUpdate],load index==>>>, ",p,",IdxTimeRange, ",h.startTime,"-",h.endTime,",buffEnd, ",c[1],",playCurTime,",o.currentTime,", bufferLen,",c[1]-o.currentTime,",bufferRangeList,",e.player.buffered2?e.player.buffered2.bufferedList:null),e._loadData())}),this._isEnded()}this.checkRemoveOldBitrateBuffer()}}},{key:"checkRemoveOldBitrateBuffer",value:function(){var e=this.mse,i=this.player;e&&this._removeBuffeEndTime>0&&i.currentTime>this._removeBuffeEndTime+1&&(this.log("remove old bitrate buffer",this._removeBuffeEndTime),e.remove(he.VIDEO,0,this._removeBuffeEndTime-1),this._removeBuffeEndTime=0)}},{key:"_isInBuffer",value:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=!1,o=this.player.video.buffered,l=0;l<o.length;l++){var u=o.start(l)-i,c=o.end(l)+i;if(u<=e.startTime&&e.endTime<=c){n=!0;break}}return n}},{key:"_loadData",value:function(){var r=Ve(re().mark(function i(){return re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!this.mp4||!this._isMseInit)){o.next=3;break}return this.log("loadData, player.mp4 null",this._isMseInit),o.abrupt("return");case 3:return o.prev=3,o.next=6,this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess);case 6:o.next=11;break;case 8:o.prev=8,o.t0=o.catch(3),console.error("[Index] _loadData error",this.playerConfig.vid,o.t0);case 11:case"end":return o.stop()}},i,this,[[3,8]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"_appendInitSeg",value:function(e){var i=this;!this.mp4||!this.mse||this.mse.append(he.VIDEO,e,{vid:this.playerConfig.vid,range:null,dataLen:e.byteLength,isinit:!0}).then(function(n){i.log("appendInitSeg end ==>>>",n.context?n.context:null,", costTime,",n.costtime)})}},{key:"_appendBuffer",value:function(e,i){var n=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,u=this.mse,c=this.config;u.append(e,i,{vid:c.vid,fragIndex:o.fragIndex,range:o.range,dataLen:i.byteLength,state:l}).then(function(d){if(n.log("player appendBuffer end ==>>>",d.context?d.context:null,", costTime,",d.costtime,", opt,",d.name,",bufferRange,",n.player.getBufferedRange()),n.mse&&o.state&&o.fragIndex===n.mp4.timeRange.length-1){var h=n.player.buffered;h&&h.length>0&&(n.bufferEndTime=h.end(h.length-1)),n._isEnded(),n.log("loaded ended !!!==>>>",o.range,", fragIndex,",o.fragIndex,", bufferEndTime,",n.bufferEndTime,",meta_duration,",n.mp4.meta.duration)}}).catch(function(d){if(console.log("[MSE error]",d),d&&u!==null&&u!==void 0&&u.isFull()){var h=n.player.getBufferedRange(n.player.buffered2);n._checkRemoveSourceBuffer(h,n.player.currentTime,!0)}})}},{key:"_checkRemoveSourceBuffer",value:function(e,i,n){var o=this,l=this.mse,u=this.mp4,c=this.player;if(!(!l||!u||!c)&&(n&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),e||(e=c.getBufferedRange(c.buffered2)),i||(i=c.currentTime),!(!n&&et.nowTime()-this._checkRemoveBufferLastTime<=this.config.removeBufferLen||this.endofstream)&&(this._checkRemoveBufferLastTime=et.nowTime(),e&&e[0]>=0&&(i-e[0]>this.config.removeBufferLen||l.isFull())))){var d=e[1],h=u.getFragmentIdx(d);if(h>=0&&u.timeRange[h].startTime<i){var p=Math.floor(Math.min(u.timeRange[h].startTime,e[1]));e[0]<p?(this.log("[checkremoveSourceBuffer], remove range==>>>",e[0],p),l.remove(he.VIDEO,e[0],p)):l.isFull()&&!this._removeBufferTimer&&(this._removeBufferTimer=setTimeout(function(){o._checkRemoveSourceBuffer(null,null,!0)},10*1e3))}}}},{key:"_isEnded",value:function(){var e=this.player,i=this.mp4,n=e.bufferedPoint,o=n?n.end:0;return!this.endofstream&&this.mse&&i.meta.duration-e.currentTime<.5&&(this.log("[check player isEnded],deal mse.endOfStream, currentTime,",e.currentTime,", bufferend,",o,", duration,",i.meta.duration),this.endofstream=!0,this.mse.endOfStream()),i&&i.meta&&i.meta.duration-e.currentTime<.5?(this._stopProgress(),this.log("[check player isEnded],stopProgress and endOfStream,currentTime, ",e.currentTime,", bufferend,",o,", duration,",i.meta.duration),this.mse&&this.mse.endOfStream(),!0):!1}},{key:"switchURL",value:function(e){this.changeDefinition(e)}},{key:"oldChangeDefinition",value:function(e,i){var n=this,o=this.config,l=this.player;this.log("[oldChangeDefinition],currentTime,",l.currentTime,",from,",i,",to,",e);var u=l.currentTime,c=l.paused;this._changeDefState||(this._changeDefState={currentTime:u,paused:c},this.log("[oldChangeDefinition],currentTime,",l.currentTime,",pause,",c)),l.config.url=e.url,o.focusUserDefinition=!0,l.currentTime=0,l.pause(),this._reset(),this._isMseInit=!1,this._changeDefineCanPlay&&l.off("canplay",this._changeDefineCanPlay),this._changeDefineCanPlay=function(){n.changeDefineCanPlay(u,c,i,e),n._changeDefineCanPlay=null},l.once("canplay",this._changeDefineCanPlay),this.player.video.load(),this.initMp4()}},{key:"_loadStuckCheck",value:function(){var e=this,i=this.config,n=this.player;i.disableBufferBreakCheck||(n.currentTime-(this._lastCurrentTime||0)>.1||n.paused?(this._bufferBreakFlag===1||this._bufferBreakFlag===2)&&(this.log("视频没有卡死,重置卡死标记"),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null):this._bufferBreakFlag||(this._bufferBreakFlag=1,this.log("卡死计时开始! 持续".concat(i.waitingTimeOut,"毫秒则确认卡死")),this._bufferBreakTimer=setTimeout(function(){e.isDestroy||(e._bufferBreakFlag===1&&(e._bufferBreakFlag=2,e.log("确认卡死!!!"),e._errorHandler(new St(e.player,{errorType:"runtime",errorTypeCode:Mt.runtime,errorCode:$e.waitTimeout,errorMessage:"wait_timeout",vid:i.vid}))),e._bufferBreakTimer=null)},i.waitingTimeOut)),this._lastCurrentTime=n.currentTime)}},{key:"isDestroy",get:function(){return!this.player}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0)}},{key:"_startProgress",value:function(){var e=this;this._hasStartProgress||(this._stopProgress(),this._requestTimer=new cl(function(){e._requestTimer&&e._onTimeUpdate()}),this._requestTimer.tickEvery(this.config.tickInSeconds),this._hasStartProgress=!0)}},{key:"log",value:function(e){for(var i=this.playerConfig,n=i&&i.vid?"[Index]".concat(i.vid," ").concat(e):"[Index] ".concat(e),o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];ma.apply(void 0,[n].concat(l))}},{key:"_reset",value:function(){this._isMseInit=!1,this.endofstream=!1,this._curLoadSegmentIdx=0,this._removeBuffeEndTime=0,this._isChangeDefinition=!1,this._stopProgress(),this.mp4&&(this.mp4.off(Ye.META_READY,this._onMp4MetaReady),this.mp4.off(Ye.ERROR,this._onMp4Error),this.mp4.off(Ye.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mse&&(this.mse.unbindMedia(),this.mse=null),this._unloadVideo()}},{key:"_unloadVideo",value:function(){var e=this.player;try{this.log("unloadVideo src ".concat(e.video.src)),e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(i){this.log("unloadVideo error",i)}}},{key:"destroy",value:function(){var e=this.player;e.removeHooks("replay",this._replayHook),e.removeHooks("retry",this._retryHook),this.detachEvents(),this._reset(),this.player.playNext=hn,this.player._startInit=Hr,this.player.changeDefinition=mn,this.player.switchURL=fn,this._bufferBreakTimer&&clearInterval(this._bufferBreakTimer),this._removeBufferTimer&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),this._waitInBufferTimer&&(clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null)}}],[{key:"pluginName",get:function(){return"mp4Plugin"}},{key:"defaultConfig",get:function(){return{maxBufferLength:40,minBufferLength:5,disableBufferBreakCheck:!1,waitingTimeOut:15e3,waitingInBufferTimeOut:5e3,waitJampBufferMaxCnt:3,tickInSeconds:.1,reqOptions:null,closeDowngrade:!1}}},{key:"version",get:function(){return"3.0.19"}}]),t}(_t);export{Ds as F,oa as H,pl as M};
