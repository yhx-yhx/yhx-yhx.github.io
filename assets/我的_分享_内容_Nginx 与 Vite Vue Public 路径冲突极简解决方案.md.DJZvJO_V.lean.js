import{an as s,j as t,k as a,S as i,K as l,aH as o,ae as p,h as c}from"./chunks/framework.DkOBDE9j.js";const _=JSON.parse('{"title":"Nginx 与 Vite Vue Public 路径冲突极简解决方案","description":"","frontmatter":{},"headers":[],"relativePath":"我的/分享/内容/Nginx 与 Vite Vue Public 路径冲突极简解决方案.md","filePath":"我的/分享/内容/Nginx 与 Vite Vue Public 路径冲突极简解决方案.md","lastUpdated":1757220242000}'),d={name:"我的/分享/内容/Nginx 与 Vite Vue Public 路径冲突极简解决方案.md"};function r(u,e,b,h,g,m){const n=p("ArticleMetadata");return c(),t("div",null,[e[0]||(e[0]=a("h1",{id:"nginx-与-vite-vue-public-路径冲突极简解决方案",tabindex:"-1"},[i("Nginx 与 Vite Vue Public 路径冲突极简解决方案 "),a("a",{class:"header-anchor",href:"#nginx-与-vite-vue-public-路径冲突极简解决方案","aria-label":'Permalink to "Nginx 与 Vite Vue Public 路径冲突极简解决方案"'},"​")],-1)),l(n),e[1]||(e[1]=o(`<h2 id="_1-核心问题" tabindex="-1">1. 核心问题 <a class="header-anchor" href="#_1-核心问题" aria-label="Permalink to &quot;1. 核心问题&quot;">​</a></h2><p>Nginx 的 <code>location</code> 路径与 Vite Vue 项目 <code>public</code> 目录<strong>第一层子目录同名</strong>时，Nginx 优先匹配 <code>location</code> 规则，导致 <code>public</code> 下静态资源报 <strong>404</strong>。</p><h2 id="_2-问题本质" tabindex="-1">2. 问题本质 <a class="header-anchor" href="#_2-问题本质" aria-label="Permalink to &quot;2. 问题本质&quot;">​</a></h2><ol><li><p><strong>Vite 机制</strong>：<code>public</code> 目录文件原样复制到 <code>dist</code> 根目录，需用绝对路径（如 <code>/static/img/logo.png</code>）访问。</p></li><li><p><strong>Nginx 优先级</strong>：<code>location</code> 前缀匹配（如 <code>/static/</code>）优先级高于 SPA 路由的 <code>try_files</code> 逻辑，拦截了静态资源请求。</p></li></ol><h2 id="_3-解决方案-优先级排序" tabindex="-1">3. 解决方案（优先级排序） <a class="header-anchor" href="#_3-解决方案-优先级排序" aria-label="Permalink to &quot;3. 解决方案（优先级排序）&quot;">​</a></h2><h3 id="方案-1-修改项目目录-推荐" tabindex="-1">方案 1：修改项目目录（推荐） <a class="header-anchor" href="#方案-1-修改项目目录-推荐" aria-label="Permalink to &quot;方案 1：修改项目目录（推荐）&quot;">​</a></h3><p><strong>核心</strong>：重命名 <code>public</code> 下冲突目录，从根源避免冲突。</p><ol><li><p>把 <code>public/static/</code> 改为 <code>public/assets/</code>（或其他名称）。</p></li><li><p>代码中资源引用从 <code>/static/xxx</code> 改为 <code>/assets/xxx</code>。</p></li><li><p>重新 <code>npm run build</code> 部署。</p></li></ol><h3 id="方案-2-vite-配置基础路径" tabindex="-1">方案 2：Vite 配置基础路径 <a class="header-anchor" href="#方案-2-vite-配置基础路径" aria-label="Permalink to &quot;方案 2：Vite 配置基础路径&quot;">​</a></h3><p><strong>核心</strong>：给资源加前缀，避开冲突路径。</p><ol><li><strong>修改 vite.config.js</strong>：</li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export default defineConfig({</span></span>
<span class="line"><span></span></span>
<span class="line"><span> base: &#39;/app/&#39; // 加前缀 /app/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li><p>资源引用改为 <code>/app/static/xxx</code>。</p></li><li><p><strong>Nginx 适配</strong>：</p></li></ol><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>location /app/ {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   try\\_files \\$uri \\$uri/ /app/index.html;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-验证步骤" tabindex="-1">4. 验证步骤 <a class="header-anchor" href="#_4-验证步骤" aria-label="Permalink to &quot;4. 验证步骤&quot;">​</a></h2><ol><li><p>执行 <code>nginx -t</code> 检查配置，<code>systemctl restart nginx</code> 重启。</p></li><li><p>直接访问资源路径（如 <code>http://example.com/static/img/logo.png</code>），确认返回 200。</p></li><li><p>访问项目，检查控制台无 404。</p></li></ol><h2 id="_5-关键排查" tabindex="-1">5. 关键排查 <a class="header-anchor" href="#_5-关键排查" aria-label="Permalink to &quot;5. 关键排查&quot;">​</a></h2><table tabindex="0"><thead><tr><th>问题现象</th><th>核心原因</th><th>解决办法</th></tr></thead><tbody><tr><td>改配置后仍 404</td><td>Nginx 未重启 / 语法错误</td><td>执行 <code>nginx -t</code> 并重启</td></tr><tr><td>静态资源不匹配</td><td>location 优先级错误</td><td>确保静态资源规则用 <code>^~</code> 前缀</td></tr><tr><td>路径异常</td><td>Vite base 与 Nginx 不匹配</td><td>统一 <code>base</code> 配置与 Nginx 访问路径</td></tr></tbody></table>`,18))])}const v=s(d,[["render",r]]);export{_ as __pageData,v as default};
